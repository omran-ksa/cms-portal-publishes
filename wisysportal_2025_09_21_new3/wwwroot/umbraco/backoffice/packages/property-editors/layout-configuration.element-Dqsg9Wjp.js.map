{"version":3,"file":"layout-configuration.element-Dqsg9Wjp.js","sources":["../../../src/packages/property-editors/collection/config/layout/layout-configuration.element.ts"],"sourcesContent":["import {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tifDefined,\r\n\tnothing,\r\n\tproperty,\r\n\trepeat,\r\n\twhen,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { extractUmbColorVariable } from '@umbraco-cms/backoffice/resources';\r\nimport { simpleHashCode } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbSorterController } from '@umbraco-cms/backoffice/sorter';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { UmbInputManifestElement } from '@umbraco-cms/backoffice/components';\r\nimport type {\r\n\tUmbPropertyEditorConfigCollection,\r\n\tUmbPropertyEditorUiElement,\r\n} from '@umbraco-cms/backoffice/property-editor';\r\nimport type { UUIInputElement, UUIInputEvent } from '@umbraco-cms/backoffice/external/uui';\r\nimport { UMB_ICON_PICKER_MODAL } from '@umbraco-cms/backoffice/icon';\r\n\r\ninterface UmbCollectionLayoutConfiguration {\r\n\ticon?: string;\r\n\tname?: string;\r\n\tcollectionView?: string;\r\n\tisSystem?: boolean;\r\n\tselected?: boolean;\r\n}\r\n\r\n/**\r\n * @element umb-property-editor-ui-collection-layout-configuration\r\n */\r\n@customElement('umb-property-editor-ui-collection-layout-configuration')\r\nexport class UmbPropertyEditorUICollectionLayoutConfigurationElement\r\n\textends UmbLitElement\r\n\timplements UmbPropertyEditorUiElement\r\n{\r\n\t#sorter = new UmbSorterController<UmbCollectionLayoutConfiguration>(this, {\r\n\t\tgetUniqueOfElement: (element) => {\r\n\t\t\treturn element.id;\r\n\t\t},\r\n\t\tgetUniqueOfModel: (modelEntry) => {\r\n\t\t\treturn this.#getUnique(modelEntry);\r\n\t\t},\r\n\t\titemSelector: '.layout-item',\r\n\t\tcontainerSelector: '#layout-wrapper',\r\n\t\tonChange: ({ model }) => {\r\n\t\t\tthis.value = model;\r\n\t\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t\t},\r\n\t});\r\n\r\n\t@property({ type: Array })\r\n\tpublic set value(value: Array<UmbCollectionLayoutConfiguration> | undefined) {\r\n\t\tthis.#value = value ?? [];\r\n\t\tthis.#sorter.setModel(this.#value);\r\n\t}\r\n\tpublic get value(): Array<UmbCollectionLayoutConfiguration> {\r\n\t\treturn this.#value;\r\n\t}\r\n\t#value: Array<UmbCollectionLayoutConfiguration> = [];\r\n\r\n\t@property({ type: Object, attribute: false })\r\n\tpublic config?: UmbPropertyEditorConfigCollection;\r\n\r\n\tasync #focusNewItem() {\r\n\t\tawait this.updateComplete;\r\n\t\tconst input = this.shadowRoot?.querySelector('.layout-item:last-of-type > uui-input') as UUIInputElement;\r\n\t\tinput.focus();\r\n\t}\r\n\r\n\t#onAdd(event: { target: UmbInputManifestElement }) {\r\n\t\tconst manifest = event.target.value;\r\n\r\n\t\tconst duplicate = this.value?.find((config) => manifest?.value === config.collectionView);\r\n\r\n\t\tif (duplicate) {\r\n\t\t\t// TODO: Show error to user, can not add duplicate `collectionView` aliases. [LK]\r\n\t\t\tthrow new Error('Duplicate `collectionView` aliases are not allowed.');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.value = [\r\n\t\t\t...(this.value ?? []),\r\n\t\t\t{\r\n\t\t\t\ticon: manifest?.icon,\r\n\t\t\t\tname: manifest?.label,\r\n\t\t\t\tcollectionView: manifest?.value,\r\n\t\t\t},\r\n\t\t];\r\n\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\r\n\t\tthis.#focusNewItem();\r\n\t}\r\n\r\n\t#onChangeLabel(e: UUIInputEvent, index: number) {\r\n\t\tconst values = [...(this.value ?? [])];\r\n\t\tvalues[index] = { ...values[index], name: e.target.value as string };\r\n\t\tthis.value = values;\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\t#onRemove(unique: number) {\r\n\t\tconst values = [...(this.value ?? [])];\r\n\t\tvalues.splice(unique, 1);\r\n\t\tthis.value = values;\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\tasync #onIconChange(icon: typeof UMB_ICON_PICKER_MODAL.VALUE, index: number) {\r\n\t\tconst picked = await (await import('@umbraco-cms/backoffice/modal'))\r\n\t\t\t.umbOpenModal(this, UMB_ICON_PICKER_MODAL, { value: icon })\r\n\t\t\t.catch(() => undefined);\r\n\t\tif (!picked) return;\r\n\r\n\t\tconst values = [...(this.value ?? [])];\r\n\t\tvalues[index] = { ...values[index], icon: `${picked.icon} color-${picked.color}` };\r\n\t\tthis.value = values;\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\t#parseIcon(iconString: string | undefined): typeof UMB_ICON_PICKER_MODAL.VALUE {\r\n\t\tconst [icon, color] = iconString?.split(' ') ?? [];\r\n\t\treturn { icon, color: color?.replace('color-', '') };\r\n\t}\r\n\r\n\t#getUnique(layout: UmbCollectionLayoutConfiguration): string {\r\n\t\treturn 'x' + simpleHashCode('' + layout.collectionView + layout.name + layout.icon).toString(16);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<div id=\"layout-wrapper\">${this.#renderLayouts()}</div>\r\n\t\t\t${this.#renderInput()}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderInput() {\r\n\t\treturn html`<umb-input-manifest extension-type=\"collectionView\" @change=${this.#onAdd}></umb-input-manifest>`;\r\n\t}\r\n\r\n\t#renderLayouts() {\r\n\t\tif (!this.value) return nothing;\r\n\t\treturn repeat(\r\n\t\t\tthis.value,\r\n\t\t\t(layout) => this.#getUnique(layout),\r\n\t\t\t(layout, index) => this.#renderLayout(layout, index),\r\n\t\t);\r\n\t}\r\n\r\n\t#renderLayout(layout: UmbCollectionLayoutConfiguration, index: number) {\r\n\t\tconst icon = this.#parseIcon(layout.icon);\r\n\t\tconst varName = icon.color ? extractUmbColorVariable(icon.color) : undefined;\r\n\t\treturn html`\r\n\t\t\t<div class=\"layout-item\" id=${this.#getUnique(layout)}>\r\n\t\t\t\t<uui-icon class=\"drag-handle\" name=\"icon-grip\"></uui-icon>\r\n\r\n\t\t\t\t<uui-button compact look=\"outline\" label=\"pick icon\" @click=${() => this.#onIconChange(icon, index)}>\r\n\t\t\t\t\t${when(\r\n\t\t\t\t\t\ticon.color,\r\n\t\t\t\t\t\t() => html`<uui-icon name=${ifDefined(icon.icon)} style=\"color:var(${varName})\"></uui-icon>`,\r\n\t\t\t\t\t\t() => html`<uui-icon name=${ifDefined(icon.icon)}></uui-icon>`,\r\n\t\t\t\t\t)}\r\n\t\t\t\t</uui-button>\r\n\r\n\t\t\t\t<uui-input\r\n\t\t\t\t\tlabel=\"name\"\r\n\t\t\t\t\tvalue=${ifDefined(layout.name)}\r\n\t\t\t\t\tplaceholder=\"Enter a label...\"\r\n\t\t\t\t\t@change=${(e: UUIInputEvent) => this.#onChangeLabel(e, index)}></uui-input>\r\n\r\n\t\t\t\t<div class=\"alias\">\r\n\t\t\t\t\t<code>${layout.collectionView}</code>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div class=\"actions\">\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlabel=${this.localize.term('general_remove')}\r\n\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\t@click=${() => this.#onRemove(index)}></uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#layout-wrapper {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: 1px;\r\n\t\t\t\tmargin-bottom: var(--uui-size-1);\r\n\t\t\t}\r\n\r\n\t\t\t.layout-item {\r\n\t\t\t\tbackground-color: var(--uui-color-surface-alt);\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-6);\r\n\t\t\t\tpadding: var(--uui-size-3) var(--uui-size-6);\r\n\t\t\t}\r\n\r\n\t\t\t.layout-item > uui-icon {\r\n\t\t\t\tflex: 0 0 var(--uui-size-6);\r\n\t\t\t}\r\n\r\n\t\t\t.layout-item > uui-button {\r\n\t\t\t\tflex: 0 0 var(--uui-size-10);\r\n\t\t\t}\r\n\r\n\t\t\t.layout-item > uui-input,\r\n\t\t\t.layout-item > .alias {\r\n\t\t\t\tflex: 1;\r\n\t\t\t}\r\n\r\n\t\t\t.layout-item > .actions {\r\n\t\t\t\tflex: 0 0 auto;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t}\r\n\r\n\t\t\t.drag-handle {\r\n\t\t\t\tcursor: grab;\r\n\t\t\t}\r\n\r\n\t\t\t.drag-handle:active {\r\n\t\t\t\tcursor: grabbing;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbPropertyEditorUICollectionLayoutConfigurationElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-property-editor-ui-collection-layout-configuration': UmbPropertyEditorUICollectionLayoutConfigurationElement;\r\n\t}\r\n}\r\n"],"names":["_sorter","_value","_UmbPropertyEditorUICollectionLayoutConfigurationElement_instances","focusNewItem_fn","onAdd_fn","onChangeLabel_fn","onRemove_fn","onIconChange_fn","parseIcon_fn","getUnique_fn","renderInput_fn","renderLayouts_fn","renderLayout_fn","UmbPropertyEditorUICollectionLayoutConfigurationElement","UmbLitElement","__privateAdd","UmbSorterController","element","modelEntry","__privateMethod","model","UmbChangeEvent","value","__privateSet","__privateGet","html","event","manifest","config","e","index","values","unique","icon","picked","UMB_ICON_PICKER_MODAL","iconString","color","layout","simpleHashCode","repeat","nothing","varName","extractUmbColorVariable","when","ifDefined","UmbTextStyles","css","__decorateClass","property","customElement","UmbPropertyEditorUICollectionLayoutConfigurationElement$1"],"mappings":"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"}