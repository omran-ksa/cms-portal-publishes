{"version":3,"file":"app-language-select.element-DrTscH-B.js","sources":["../../../src/packages/language/app-language-select/app-language-select.element.ts"],"sourcesContent":["import { UmbLanguageCollectionRepository } from '../collection/index.js';\r\nimport type { UmbLanguageDetailModel } from '../types.js';\r\nimport type { UmbAppLanguageContext } from '../global-contexts/index.js';\r\nimport { UMB_APP_LANGUAGE_CONTEXT } from '../constants.js';\r\nimport type { UUIPopoverContainerElement } from '@umbraco-cms/backoffice/external/uui';\r\nimport {\r\n\tcss,\r\n\thtml,\r\n\tcustomElement,\r\n\tstate,\r\n\trepeat,\r\n\tifDefined,\r\n\tquery,\r\n\tnothing,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_CURRENT_USER_CONTEXT } from '@umbraco-cms/backoffice/current-user';\r\n\r\n@customElement('umb-app-language-select')\r\nexport class UmbAppLanguageSelectElement extends UmbLitElement {\r\n\t@query('#dropdown-popover')\r\n\tprivate _popoverElement?: UUIPopoverContainerElement;\r\n\r\n\t@state()\r\n\tprivate _languages: Array<UmbLanguageDetailModel> = [];\r\n\r\n\t@state()\r\n\tprivate _appLanguage?: UmbLanguageDetailModel;\r\n\r\n\t@state()\r\n\tprivate _appLanguageIsReadOnly = false;\r\n\r\n\t@state()\r\n\tprivate _isOpen = false;\r\n\r\n\t#collectionRepository = new UmbLanguageCollectionRepository(this);\r\n\t#appLanguageContext?: UmbAppLanguageContext;\r\n\t#languagesObserver?: any;\r\n\r\n\t// TODO: Here we have some read only state logic and then we have it again in the context. We should align this otherwise it will become a nightmare to maintain. [NL]\r\n\t#currentUserAllowedLanguages?: Array<string>;\r\n\t#currentUserHasAccessToAllLanguages?: boolean;\r\n\r\n\t@state()\r\n\t_disallowedLanguages: Array<UmbLanguageDetailModel> = [];\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_APP_LANGUAGE_CONTEXT, (instance) => {\r\n\t\t\tthis.#appLanguageContext = instance;\r\n\t\t\tthis.#observeAppLanguage();\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_CURRENT_USER_CONTEXT, (context) => {\r\n\t\t\tthis.observe(context?.languages, (languages) => {\r\n\t\t\t\tthis.#currentUserAllowedLanguages = languages;\r\n\t\t\t\tthis.#checkForLanguageAccess();\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(context?.hasAccessToAllLanguages, (hasAccessToAllLanguages) => {\r\n\t\t\t\tthis.#currentUserHasAccessToAllLanguages = hasAccessToAllLanguages;\r\n\t\t\t\tthis.#checkForLanguageAccess();\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t#checkForLanguageAccess() {\r\n\t\t// find all disallowed languages\r\n\t\tthis._disallowedLanguages = this._languages?.filter((language) => {\r\n\t\t\tif (this.#currentUserHasAccessToAllLanguages) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\r\n\t\t\treturn !this.#currentUserAllowedLanguages?.includes(language.unique);\r\n\t\t});\r\n\t}\r\n\r\n\tasync #observeAppLanguage() {\r\n\t\tif (!this.#appLanguageContext) return;\r\n\r\n\t\tthis.observe(this.#appLanguageContext.appLanguage, (language) => {\r\n\t\t\tthis._appLanguage = language;\r\n\t\t});\r\n\r\n\t\tthis.observe(this.#appLanguageContext.appLanguageReadOnlyState.isReadOnly, (isReadOnly) => {\r\n\t\t\tthis._appLanguageIsReadOnly = isReadOnly;\r\n\t\t});\r\n\t}\r\n\r\n\tasync #observeLanguages() {\r\n\t\tconst { data } = await this.#collectionRepository.requestCollection({});\r\n\r\n\t\t// TODO: listen to changes\r\n\t\tif (data) {\r\n\t\t\tthis._languages = data.items;\r\n\t\t\tthis.#checkForLanguageAccess();\r\n\t\t}\r\n\t}\r\n\r\n\t#onPopoverToggle(event: ToggleEvent) {\r\n\t\t// TODO: This ignorer is just neede for JSON SCHEMA TO WORK, As its not updated with latest TS jet.\r\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t// @ts-ignore\r\n\t\tthis._isOpen = event.newState === 'open';\r\n\t\tif (this._isOpen && !this.#languagesObserver) {\r\n\t\t\tif (this._popoverElement) {\r\n\t\t\t\tconst host = this.getBoundingClientRect();\r\n\t\t\t\tthis._popoverElement.style.width = `${host.width}px`;\r\n\t\t\t}\r\n\r\n\t\t\tthis.#observeLanguages();\r\n\t\t}\r\n\t}\r\n\r\n\t#chooseLanguage(unique: string) {\r\n\t\tthis.#appLanguageContext?.setLanguage(unique);\r\n\t\tthis._isOpen = false;\r\n\t\tthis._popoverElement?.hidePopover();\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`${this.#renderTrigger()} ${this.#renderContent()}`;\r\n\t}\r\n\r\n\t#renderTrigger() {\r\n\t\treturn html`<button id=\"toggle\" data-mark=\"action:open\" popovertarget=\"dropdown-popover\">\r\n\t\t\t<span\r\n\t\t\t\t>${this._appLanguage?.name}\r\n\t\t\t\t${this._appLanguageIsReadOnly ? this.#renderReadOnlyTag(this._appLanguage?.unique) : nothing}</span\r\n\t\t\t>\r\n\t\t\t<uui-symbol-expand .open=${this._isOpen}></uui-symbol-expand>\r\n\t\t</button>`;\r\n\t}\r\n\r\n\t#renderContent() {\r\n\t\treturn html` <uui-popover-container\r\n\t\t\tid=\"dropdown-popover\"\r\n\t\t\tdata-mark=\"app-language-menu\"\r\n\t\t\t@beforetoggle=${this.#onPopoverToggle}>\r\n\t\t\t\t\t\t<umb-popover-layout>\r\n\t\t\t<uui-scroll-container style=\"max-height:calc(100vh - (var(--umb-header-layout-height) + 60px));\">\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._languages,\r\n\t\t\t\t\t(language) => language.unique,\r\n\t\t\t\t\t(language) => html`\r\n\t\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\t\tlabel=${ifDefined(language.name)}\r\n\t\t\t\t\t\t\tdata-mark=\"${language.entityType}:${language.unique}\"\r\n\t\t\t\t\t\t\t?active=${language.unique === this._appLanguage?.unique}\r\n\t\t\t\t\t\t\t@click-label=${() => this.#chooseLanguage(language.unique)}>\r\n\t\t\t\t\t\t\t${this.#isLanguageReadOnly(language.unique) ? this.#renderReadOnlyTag(language.unique) : nothing}\r\n\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t`,\r\n\t\t\t\t)}\r\n\t\t\t\t</uui-scroll-container>\r\n\t\t\t\t\t\t\t</umb-popover-layout>\r\n\r\n\t\t</uui-popover-container>`;\r\n\t}\r\n\r\n\t#isLanguageReadOnly(culture?: string) {\r\n\t\tif (!culture) return false;\r\n\t\treturn this._disallowedLanguages.find((language) => language.unique === culture) ? true : false;\r\n\t}\r\n\r\n\t#renderReadOnlyTag(culture?: string) {\r\n\t\tif (!culture) return nothing;\r\n\t\treturn html`<uui-tag slot=\"badge\" look=\"secondary\">${this.localize.term('general_readOnly')}</uui-tag>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tz-index: 10;\r\n\t\t\t}\r\n\r\n\t\t\t#toggle {\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\ttext-align: left;\r\n\t\t\t\tbackground: none;\r\n\t\t\t\tborder: none;\r\n\t\t\t\theight: var(--umb-header-layout-height);\r\n\t\t\t\tpadding: 0 var(--uui-size-8);\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t\tfont-size: 14px;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\tcursor: pointer;\r\n\t\t\t\tfont-family: inherit;\r\n\t\t\t}\r\n\r\n\t\t\t#toggle:hover {\r\n\t\t\t\tbackground-color: var(--uui-color-surface-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\tuui-menu-item {\r\n\t\t\t\tcolor: var(--uui-color-text);\r\n\t\t\t\t\r\n\t\t\t\twidth: auto;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbAppLanguageSelectElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-app-language-select': UmbAppLanguageSelectElement;\r\n\t}\r\n}\r\n"],"names":["_collectionRepository","_appLanguageContext","_languagesObserver","_currentUserAllowedLanguages","_currentUserHasAccessToAllLanguages","_UmbAppLanguageSelectElement_instances","checkForLanguageAccess_fn","observeAppLanguage_fn","observeLanguages_fn","onPopoverToggle_fn","chooseLanguage_fn","renderTrigger_fn","renderContent_fn","isLanguageReadOnly_fn","renderReadOnlyTag_fn","UmbAppLanguageSelectElement","UmbLitElement","__privateAdd","UmbLanguageCollectionRepository","UMB_APP_LANGUAGE_CONTEXT","instance","__privateSet","__privateMethod","UMB_CURRENT_USER_CONTEXT","context","languages","hasAccessToAllLanguages","html","language","__privateGet","isReadOnly","data","event","host","unique","nothing","repeat","ifDefined","culture","css","__decorateClass","query","state","customElement","UmbAppLanguageSelectElement$1"],"mappings":"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"}