{"version":3,"file":"index.js","sources":["../../../src/packages/language/components/input-language/input-language.context.ts","../../../src/packages/language/components/input-language/input-language.element.ts"],"sourcesContent":["import type { UmbLanguageItemModel } from '../../types.js';\r\nimport { UMB_LANGUAGE_ITEM_REPOSITORY_ALIAS } from '../../constants.js';\r\nimport { UMB_LANGUAGE_PICKER_MODAL } from '../../modals/language-picker/constants.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbPickerInputContext } from '@umbraco-cms/backoffice/picker-input';\r\n\r\nexport class UmbLanguagePickerInputContext extends UmbPickerInputContext<UmbLanguageItemModel> {\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_LANGUAGE_ITEM_REPOSITORY_ALIAS, UMB_LANGUAGE_PICKER_MODAL);\r\n\t}\r\n}\r\n","import type { UmbLanguageItemModel } from '../../types.js';\r\nimport { UmbLanguagePickerInputContext } from './input-language.context.js';\r\nimport { css, html, customElement, property, state, repeat, nothing, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { splitStringToArray } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbSorterController } from '@umbraco-cms/backoffice/sorter';\r\nimport { UUIFormControlMixin } from '@umbraco-cms/backoffice/external/uui';\r\n\r\n@customElement('umb-input-language')\r\nexport class UmbInputLanguageElement extends UUIFormControlMixin(UmbLitElement, '') {\r\n\t#sorter = new UmbSorterController<string>(this, {\r\n\t\tgetUniqueOfElement: (element) => {\r\n\t\t\treturn element.id;\r\n\t\t},\r\n\t\tgetUniqueOfModel: (modelEntry) => {\r\n\t\t\treturn modelEntry;\r\n\t\t},\r\n\t\tidentifier: 'Umb.SorterIdentifier.InputLanguage',\r\n\t\titemSelector: 'uui-ref-node',\r\n\t\tcontainerSelector: 'uui-ref-list',\r\n\t\tonChange: ({ model }) => {\r\n\t\t\tthis.selection = model;\r\n\t\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t\t},\r\n\t});\r\n\r\n\t/**\r\n\t * This is a minimum amount of selected items in this input.\r\n\t * @type {number}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Number })\r\n\tpublic set min(value: number) {\r\n\t\tthis.#pickerContext.min = value;\r\n\t}\r\n\tpublic get min(): number {\r\n\t\treturn this.#pickerContext.min;\r\n\t}\r\n\r\n\t/**\r\n\t * Min validation message.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: String, attribute: 'min-message' })\r\n\tminMessage = 'This field need more items';\r\n\r\n\t/**\r\n\t * This is a maximum amount of selected items in this input.\r\n\t * @type {number}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Number })\r\n\tpublic set max(value: number) {\r\n\t\tthis.#pickerContext.max = value;\r\n\t}\r\n\tpublic get max(): number {\r\n\t\treturn this.#pickerContext.max;\r\n\t}\r\n\r\n\t/**\r\n\t * Max validation message.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: String, attribute: 'min-message' })\r\n\tmaxMessage = 'This field exceeds the allowed amount of items';\r\n\r\n\t@property({ type: Object, attribute: false })\r\n\tpublic filter: (language: UmbLanguageItemModel) => boolean = () => true;\r\n\r\n\t@property({ type: Array })\r\n\tpublic set selection(uniques: Array<string>) {\r\n\t\tthis.#pickerContext.setSelection(uniques);\r\n\t\tthis.#sorter.setModel(uniques);\r\n\t}\r\n\tpublic get selection(): Array<string> {\r\n\t\treturn this.#pickerContext.getSelection();\r\n\t}\r\n\r\n\t@property()\r\n\tpublic override set value(uniques: string) {\r\n\t\tthis.selection = splitStringToArray(uniques);\r\n\t}\r\n\tpublic override get value(): string {\r\n\t\treturn this.selection.join(',');\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the input to readonly mode, meaning value cannot be changed but still able to read and select its content.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Boolean, reflect: true })\r\n\tpublic get readonly() {\r\n\t\treturn this.#readonly;\r\n\t}\r\n\tpublic set readonly(value) {\r\n\t\tthis.#readonly = value;\r\n\r\n\t\tif (this.#readonly) {\r\n\t\t\tthis.#sorter.disable();\r\n\t\t} else {\r\n\t\t\tthis.#sorter.enable();\r\n\t\t}\r\n\t}\r\n\t#readonly = false;\r\n\r\n\t@state()\r\n\tprivate _items: Array<UmbLanguageItemModel> = [];\r\n\r\n\t#pickerContext = new UmbLanguagePickerInputContext(this);\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.addValidator(\r\n\t\t\t'rangeUnderflow',\r\n\t\t\t() => this.minMessage,\r\n\t\t\t() => !!this.min && this.#pickerContext.getSelection().length < this.min,\r\n\t\t);\r\n\r\n\t\tthis.addValidator(\r\n\t\t\t'rangeOverflow',\r\n\t\t\t() => this.maxMessage,\r\n\t\t\t() => !!this.max && this.#pickerContext.getSelection().length > this.max,\r\n\t\t);\r\n\r\n\t\tthis.observe(this.#pickerContext.selection, (selection) => (this.value = selection.join(',')), '_observeSelection');\r\n\t\tthis.observe(this.#pickerContext.selectedItems, (selectedItems) => (this._items = selectedItems), '_observerItems');\r\n\t}\r\n\r\n\tprotected override getFormElement() {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\t#openPicker() {\r\n\t\tthis.#pickerContext.openPicker({\r\n\t\t\tfilter: this.filter,\r\n\t\t\tmultiple: this.max > 1 ? true : false,\r\n\t\t});\r\n\t}\r\n\r\n\t#onRemove(item: UmbLanguageItemModel) {\r\n\t\tthis.#pickerContext.requestRemoveItem(item.unique);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`${this.#renderItems()} ${this.#renderAddButton()}`;\r\n\t}\r\n\r\n\t#renderAddButton() {\r\n\t\tif (this.max > 0 && this.selection.length >= this.max) return nothing;\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\tid=\"btn-add\"\r\n\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t@click=${this.#openPicker}\r\n\t\t\t\tlabel=\"${this.localize.term('general_choose')}\"></uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderItems() {\r\n\t\tif (!this._items) return;\r\n\t\treturn html`\r\n\t\t\t<uui-ref-list>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._items,\r\n\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t(item) =>\r\n\t\t\t\t\t\thtml`<umb-entity-item-ref\r\n\t\t\t\t\t\t\tid=${item.unique}\r\n\t\t\t\t\t\t\t.item=${item}\r\n\t\t\t\t\t\t\t?readonly=${this.readonly}\r\n\t\t\t\t\t\t\t?standalone=${this.max === 1}>\r\n\t\t\t\t\t\t\t${when(\r\n\t\t\t\t\t\t\t\t!this.readonly,\r\n\t\t\t\t\t\t\t\t() => html`\r\n\t\t\t\t\t\t\t\t\t<uui-action-bar slot=\"actions\">\r\n\t\t\t\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\t\t\t\tlabel=${this.localize.term('general_remove')}\r\n\t\t\t\t\t\t\t\t\t\t\t@click=${() => this.#onRemove(item)}></uui-button>\r\n\t\t\t\t\t\t\t\t\t</uui-action-bar>\r\n\t\t\t\t\t\t\t\t`,\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</umb-entity-item-ref>`,\r\n\t\t\t\t)}\r\n\t\t\t</uui-ref-list>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t#btn-add {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbInputLanguageElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-input-language': UmbInputLanguageElement;\r\n\t}\r\n}\r\n"],"names":["UmbLanguagePickerInputContext","UmbPickerInputContext","host","UMB_LANGUAGE_ITEM_REPOSITORY_ALIAS","UMB_LANGUAGE_PICKER_MODAL","_sorter","_readonly","_pickerContext","_UmbInputLanguageElement_instances","openPicker_fn","onRemove_fn","renderAddButton_fn","renderItems_fn","UmbInputLanguageElement","UUIFormControlMixin","UmbLitElement","__privateAdd","UmbSorterController","element","modelEntry","model","UmbChangeEvent","__privateGet","selection","selectedItems","value","uniques","splitStringToArray","__privateSet","html","__privateMethod","item","nothing","repeat","when","css","__decorateClass","property","state","customElement"],"mappings":"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"}