{"version":3,"file":"property-value-cloner-block-rte.cloner-CXXyelaj.js","sources":["../../../src/packages/block/block-rte/property-value-cloner/property-value-cloner-block-rte.cloner.ts"],"sourcesContent":["import {\r\n\tUMB_BLOCK_RTE_PROPERTY_EDITOR_SCHEMA_ALIAS,\r\n\ttype UmbPropertyEditorRteValueType,\r\n} from '@umbraco-cms/backoffice/rte';\r\nimport type { UmbPropertyValueCloner } from '@umbraco-cms/backoffice/property';\r\nimport { UmbFlatLayoutBlockPropertyValueCloner } from '@umbraco-cms/backoffice/block';\r\n\r\nexport class UmbBlockRTEPropertyValueCloner implements UmbPropertyValueCloner<UmbPropertyEditorRteValueType> {\r\n\t#markup?: string;\r\n\t#markupDoc?: Document;\r\n\r\n\tasync cloneValue(value: UmbPropertyEditorRteValueType) {\r\n\t\tif (value) {\r\n\t\t\tthis.#markup = value.markup;\r\n\r\n\t\t\tconst parser = new DOMParser();\r\n\t\t\tthis.#markupDoc = parser.parseFromString(this.#markup, 'text/html');\r\n\r\n\t\t\tconst cloner = new UmbFlatLayoutBlockPropertyValueCloner(UMB_BLOCK_RTE_PROPERTY_EDITOR_SCHEMA_ALIAS, {\r\n\t\t\t\tcontentIdUpdatedCallback: this.#replaceContentKeyInMarkup,\r\n\t\t\t});\r\n\t\t\tconst result = {} as UmbPropertyEditorRteValueType;\r\n\t\t\tif (value.blocks) {\r\n\t\t\t\tresult.blocks = await cloner.cloneValue(value.blocks);\r\n\t\t\t}\r\n\t\t\tresult.markup = this.#markup;\r\n\t\t\treturn result;\r\n\t\t}\r\n\t\treturn value;\r\n\t}\r\n\r\n\t#replaceContentKeyInMarkup = (contentKey: string, newContentKey: string) => {\r\n\t\tif (!this.#markupDoc) throw new Error('Markup document is not initialized');\r\n\t\tconst elements = this.#markupDoc.querySelectorAll(\r\n\t\t\t`umb-rte-block[data-content-key='${contentKey}'], umb-rte-block-inline[data-content-key='${contentKey}']`,\r\n\t\t);\r\n\t\telements.forEach((element) => {\r\n\t\t\telement.setAttribute('data-content-key', newContentKey);\r\n\t\t});\r\n\t\tthis.#markup = this.#markupDoc.body.innerHTML ?? undefined;\r\n\t};\r\n\r\n\tdestroy(): void {}\r\n}\r\n\r\nexport { UmbBlockRTEPropertyValueCloner as api };\r\n"],"names":["UmbBlockRTEPropertyValueCloner","#markup","#markupDoc","value","parser","cloner","UmbFlatLayoutBlockPropertyValueCloner","UMB_BLOCK_RTE_PROPERTY_EDITOR_SCHEMA_ALIAS","#replaceContentKeyInMarkup","result","contentKey","newContentKey","element"],"mappings":";;AAOO,MAAMA,EAAgG;AAAA,EAC5GC;AAAA,EACAC;AAAA,EAEA,MAAM,WAAWC,GAAsC;AACtD,QAAIA,GAAO;AACV,WAAKF,KAAUE,EAAM;AAEf,YAAAC,IAAS,IAAI,UAAU;AAC7B,WAAKF,KAAaE,EAAO,gBAAgB,KAAKH,IAAS,WAAW;AAE5D,YAAAI,IAAS,IAAIC,EAAsCC,GAA4C;AAAA,QACpG,0BAA0B,KAAKC;AAAA,MAAA,CAC/B,GACKC,IAAS,CAAC;AAChB,aAAIN,EAAM,WACTM,EAAO,SAAS,MAAMJ,EAAO,WAAWF,EAAM,MAAM,IAErDM,EAAO,SAAS,KAAKR,IACdQ;AAAA,IAAA;AAED,WAAAN;AAAA,EAAA;AAAA,EAGRK,KAA6B,CAACE,GAAoBC,MAA0B;AAC3E,QAAI,CAAC,KAAKT,GAAkB,OAAA,IAAI,MAAM,oCAAoC;AAIjE,IAHQ,KAAKA,GAAW;AAAA,MAChC,mCAAmCQ,CAAU,8CAA8CA,CAAU;AAAA,IACtG,EACS,QAAQ,CAACE,MAAY;AACrB,MAAAA,EAAA,aAAa,oBAAoBD,CAAa;AAAA,IAAA,CACtD,GACD,KAAKV,KAAU,KAAKC,GAAW,KAAK,aAAa;AAAA,EAClD;AAAA,EAEA,UAAgB;AAAA,EAAA;AACjB;"}