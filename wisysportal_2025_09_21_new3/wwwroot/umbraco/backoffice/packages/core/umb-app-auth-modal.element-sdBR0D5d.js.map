{"version":3,"file":"umb-app-auth-modal.element-sdBR0D5d.js","sources":["../../../src/packages/core/auth/modals/umb-app-auth-modal.element.ts"],"sourcesContent":["import type { ManifestAuthProvider } from '../auth-provider.extension.js';\r\nimport { UmbModalBaseElement } from '../../modal/index.js';\r\nimport { UmbTextStyles } from '../../style/text-style.style.js';\r\nimport { UMB_AUTH_CONTEXT } from '../auth.context.token.js';\r\nimport type { UmbAuthProviderDefaultProps } from '../types.js';\r\nimport type { UmbModalAppAuthConfig, UmbModalAppAuthValue } from './umb-app-auth-modal.token.js';\r\nimport { css, customElement, html, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UMB_SERVER_CONTEXT } from '@umbraco-cms/backoffice/server';\r\n\r\n@customElement('umb-app-auth-modal')\r\nexport class UmbAppAuthModalElement extends UmbModalBaseElement<UmbModalAppAuthConfig, UmbModalAppAuthValue> {\r\n\t@state()\r\n\tprivate _error?: string;\r\n\r\n\t@state()\r\n\tprivate _serverUrl = '';\r\n\r\n\t@state()\r\n\tprivate _loading = true;\r\n\r\n\t@state()\r\n\tprivate _allowLocalLogin = false;\r\n\r\n\tget props(): UmbAuthProviderDefaultProps {\r\n\t\treturn {\r\n\t\t\tuserLoginState: this.data?.userLoginState ?? 'loggingIn',\r\n\t\t\tonSubmit: this.onSubmit.bind(this),\r\n\t\t};\r\n\t}\r\n\r\n\tget headline() {\r\n\t\treturn this.data?.userLoginState === 'timedOut'\r\n\t\t\t? this.localize.term('login_instruction')\r\n\t\t\t: this.localize.term(\r\n\t\t\t\t\t[\r\n\t\t\t\t\t\t'login_greeting0',\r\n\t\t\t\t\t\t'login_greeting1',\r\n\t\t\t\t\t\t'login_greeting2',\r\n\t\t\t\t\t\t'login_greeting3',\r\n\t\t\t\t\t\t'login_greeting4',\r\n\t\t\t\t\t\t'login_greeting5',\r\n\t\t\t\t\t\t'login_greeting6',\r\n\t\t\t\t\t][new Date().getDay()],\r\n\t\t\t\t);\r\n\t}\r\n\r\n\toverride firstUpdated(): void {\r\n\t\tthis.consumeContext(UMB_SERVER_CONTEXT, (context) => {\r\n\t\t\tthis._serverUrl = context?.getServerUrl() ?? '';\r\n\t\t\tthis.style.setProperty(\r\n\t\t\t\t'--image',\r\n\t\t\t\t`url('${this._serverUrl}/umbraco/management/api/v1/security/back-office/graphics/login-background') no-repeat center center/cover`,\r\n\t\t\t);\r\n\r\n\t\t\tconst serverConnection = context?.getServerConnection();\r\n\r\n\t\t\tthis.observe(serverConnection?.allowLocalLogin, (allowLocalLogin) => {\r\n\t\t\t\tthis._allowLocalLogin = allowLocalLogin ?? false;\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(serverConnection?.isConnected, (isConnected) => {\r\n\t\t\t\tthis._loading = !isConnected;\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<div id=\"layout\">\r\n\t\t\t\t<img\r\n\t\t\t\t\tid=\"logo-on-background\"\r\n\t\t\t\t\tsrc=\"${this._serverUrl}/umbraco/management/api/v1/security/back-office/graphics/login-logo-alternative\"\r\n\t\t\t\t\talt=\"Logo\"\r\n\t\t\t\t\taria-hidden=\"true\"\r\n\t\t\t\t\tpart=\"auth-logo-background\" />\r\n\t\t\t\t<div id=\"graphic\" aria-hidden=\"true\">\r\n\t\t\t\t\t<img\r\n\t\t\t\t\t\tpart=\"auth-logo\"\r\n\t\t\t\t\t\tid=\"logo-on-image\"\r\n\t\t\t\t\t\tsrc=\"${this._serverUrl}/umbraco/management/api/v1/security/back-office/graphics/login-logo\"\r\n\t\t\t\t\t\talt=\"Logo\" />\r\n\t\t\t\t\t<svg\r\n\t\t\t\t\t\tid=\"curve-top\"\r\n\t\t\t\t\t\twidth=\"1746\"\r\n\t\t\t\t\t\theight=\"1374\"\r\n\t\t\t\t\t\tviewBox=\"0 0 1746 1374\"\r\n\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\">\r\n\t\t\t\t\t\t<path d=\"M8 1C61.5 722.5 206.5 1366.5 1745.5 1366.5\" stroke=\"currentColor\" stroke-width=\"15\"></path>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t\t<svg\r\n\t\t\t\t\t\tid=\"curve-bottom\"\r\n\t\t\t\t\t\twidth=\"1364\"\r\n\t\t\t\t\t\theight=\"552\"\r\n\t\t\t\t\t\tviewBox=\"0 0 1364 552\"\r\n\t\t\t\t\t\tfill=\"none\"\r\n\t\t\t\t\t\txmlns=\"http://www.w3.org/2000/svg\">\r\n\t\t\t\t\t\t<path d=\"M1 8C387 24 1109 11 1357 548\" stroke=\"currentColor\" stroke-width=\"15\"></path>\r\n\t\t\t\t\t</svg>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div id=\"content-container\">\r\n\t\t\t\t\t<div id=\"content\">\r\n\t\t\t\t\t\t<header id=\"header\">\r\n\t\t\t\t\t\t\t<h1 id=\"greeting\">${this.headline}</h1>\r\n\t\t\t\t\t\t</header>\r\n\t\t\t\t\t\t${this._error ? html`<p style=\"margin-top:0;color:red\">${this._error}</p>` : ''}\r\n\t\t\t\t\t\t${this.data?.userLoginState === 'timedOut'\r\n\t\t\t\t\t\t\t? html`<p style=\"margin-top:0\">${this.localize.term('login_timeout')}</p>`\r\n\t\t\t\t\t\t\t: ''}\r\n\t\t\t\t\t\t${when(\r\n\t\t\t\t\t\t\tthis._loading,\r\n\t\t\t\t\t\t\t() => html`\r\n\t\t\t\t\t\t\t\t<div id=\"loader\">\r\n\t\t\t\t\t\t\t\t\t<uui-loader></uui-loader>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t`,\r\n\t\t\t\t\t\t\t() =>\r\n\t\t\t\t\t\t\t\thtml` <umb-extension-slot\r\n\t\t\t\t\t\t\t\t\tid=\"providers\"\r\n\t\t\t\t\t\t\t\t\ttype=\"authProvider\"\r\n\t\t\t\t\t\t\t\t\tdefault-element=\"umb-auth-provider-default\"\r\n\t\t\t\t\t\t\t\t\t.props=${this.props}\r\n\t\t\t\t\t\t\t\t\t.filter=${this.#filterProvider}></umb-extension-slot>`,\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#filterProvider = (provider: ManifestAuthProvider) => {\r\n\t\tif (this._allowLocalLogin) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\r\n\t\t// Do not show any Umbraco auth provider if local login is disabled\r\n\t\treturn provider.forProviderName.toLowerCase() !== 'umbraco';\r\n\t};\r\n\r\n\tprivate onSubmit = async (providerOrManifest: string | ManifestAuthProvider, loginHint?: string) => {\r\n\t\ttry {\r\n\t\t\tconst authContext = await this.getContext(UMB_AUTH_CONTEXT);\r\n\t\t\tif (!authContext) {\r\n\t\t\t\tthrow new Error('Auth context not available');\r\n\t\t\t}\r\n\r\n\t\t\tconst manifest = typeof providerOrManifest === 'string' ? undefined : providerOrManifest;\r\n\t\t\tconst providerName =\r\n\t\t\t\ttypeof providerOrManifest === 'string' ? providerOrManifest : providerOrManifest.forProviderName;\r\n\r\n\t\t\t// If the user is timed out, we do not want to lose the state, so avoid redirecting to the provider\r\n\t\t\t// and instead just make the authorization request. In all other cases, we want to redirect to the provider.\r\n\t\t\tconst isTimedOut = this.data?.userLoginState === 'timedOut';\r\n\r\n\t\t\tawait authContext.makeAuthorizationRequest(providerName, isTimedOut ? false : true, loginHint, manifest);\r\n\r\n\t\t\tconst isAuthed = authContext.getIsAuthorized();\r\n\t\t\tthis.value = { success: isAuthed };\r\n\t\t\tif (isAuthed) {\r\n\t\t\t\tthis._submitModal();\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('[AuthModal] Error submitting auth request', error);\r\n\t\t\tthis._error = error instanceof Error ? error.message : 'Unknown error (see console)';\r\n\t\t}\r\n\t};\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tbackground: var(--uui-color-background, #f4f4f4);\r\n\r\n\t\t\t\t--curves-color: var(--umb-login-curves-color, #f5c1bc);\r\n\t\t\t\t--curves-display: var(--umb-login-curves-display, inline);\r\n\t\t\t}\r\n\r\n\t\t\t#layout {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\tpadding: 32px 0 32px 32px;\r\n\t\t\t\twidth: 100vw;\r\n\t\t\t\tmax-width: 1920px;\r\n\t\t\t\theight: calc(100vh - 64px);\r\n\t\t\t}\r\n\r\n\t\t\t#graphic {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tbackground: var(--umb-login-image, var(--image));\r\n\t\t\t\tborder-radius: var(--umb-login-image-border-radius, 38px);\r\n\t\t\t\tposition: relative;\r\n\t\t\t\toverflow: hidden;\r\n\t\t\t\tcolor: var(--curves-color);\r\n\t\t\t}\r\n\r\n\t\t\t#graphic svg {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\twidth: 45%;\r\n\t\t\t\theight: fit-content;\r\n\t\t\t\tdisplay: var(--curves-display);\r\n\t\t\t}\r\n\r\n\t\t\t#curve-top {\r\n\t\t\t\ttop: -9%;\r\n\t\t\t\tright: -9%;\r\n\t\t\t}\r\n\r\n\t\t\t#curve-bottom {\r\n\t\t\t\tbottom: -0.5%;\r\n\t\t\t\tleft: -0.1%;\r\n\t\t\t}\r\n\r\n\t\t\t#content-container {\r\n\t\t\t\tbackground: var(--umb-login-content-background, none);\r\n\t\t\t\tdisplay: var(--umb-login-content-display, flex);\r\n\t\t\t\twidth: var(--umb-login-content-width, 100%);\r\n\t\t\t\theight: var(--umb-login-content-height, 100%);\r\n\t\t\t\toverflow: auto;\r\n\t\t\t\tborder-radius: var(--umb-login-content-border-radius, 0);\r\n\t\t\t\tpadding: 16px;\r\n\t\t\t\tmargin: auto;\r\n\t\t\t}\r\n\r\n\t\t\t#content {\r\n\t\t\t\tmax-width: 360px;\r\n\t\t\t\tmargin: auto;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#logo-on-background {\r\n\t\t\t\tdisplay: none;\r\n\t\t\t}\r\n\r\n\t\t\t#logo-on-image,\r\n\t\t\t#logo-on-background {\r\n\t\t\t\tposition: absolute;\r\n\t\t\t\ttop: 24px;\r\n\t\t\t\tleft: 24px;\r\n\t\t\t\theight: 55px;\r\n\t\t\t}\r\n\r\n\t\t\t#header {\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-space-5);\r\n\t\t\t}\r\n\r\n\t\t\t#greeting {\r\n\t\t\t\tcolor: var(--umb-login-greeting-color, var(--uui-color-interactive-emphasis));\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tfont-weight: 400;\r\n\t\t\t\tfont-size: var(--umb-login-header-font-size-large, 4rem);\r\n\t\t\t\tmargin: 0 0 var(--uui-size-layout-1);\r\n\t\t\t\tline-height: 1.2;\r\n\t\t\t}\r\n\r\n\t\t\t#providers {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tgap: var(--uui-size-space-5);\r\n\t\t\t}\r\n\r\n\t\t\t#loader {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\t\t\t}\r\n\r\n\t\t\t@media (max-width: 900px) {\r\n\t\t\t\t#graphic {\r\n\t\t\t\t\tdisplay: none;\r\n\t\t\t\t}\r\n\t\t\t\t#logo-on-background {\r\n\t\t\t\t\tdisplay: block;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbAppAuthModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-app-auth-modal': UmbAppAuthModalElement;\r\n\t}\r\n}\r\n"],"names":["_filterProvider","UmbAppAuthModalElement","UmbModalBaseElement","__privateAdd","provider","providerOrManifest","loginHint","authContext","UMB_AUTH_CONTEXT","manifest","providerName","isTimedOut","isAuthed","error","UMB_SERVER_CONTEXT","context","serverConnection","allowLocalLogin","isConnected","html","when","__privateGet","UmbTextStyles","css","__decorateClass","state","customElement","UmbAppAuthModalElement$1"],"mappings":"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"}