{"version":3,"file":"section-item.repository-B9ft9W21.js","sources":["../../../src/packages/core/section/repository/item/section-item.repository.ts"],"sourcesContent":["import type { ManifestSection } from '../../extensions/index.js';\r\nimport type { UmbSectionItemModel } from './types.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbItemRepository } from '@umbraco-cms/backoffice/repository';\r\nimport { UmbRepositoryBase } from '@umbraco-cms/backoffice/repository';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { createObservablePart } from '@umbraco-cms/backoffice/observable-api';\r\n\r\nexport class UmbSectionItemRepository extends UmbRepositoryBase implements UmbItemRepository<UmbSectionItemModel> {\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t}\r\n\r\n\t/**\r\n\t * Requests the items for the given uniques\r\n\t * @param {Array<string>} uniques\r\n\t * @returns {*}\r\n\t * @memberof UmbItemRepositoryBase\r\n\t */\r\n\tasync requestItems(uniques: Array<string>) {\r\n\t\tif (!uniques) throw new Error('Uniques are missing');\r\n\r\n\t\tconst sectionManifests = umbExtensionsRegistry\r\n\t\t\t.getAllExtensions()\r\n\t\t\t.filter((manifest) => manifest.type === 'section')\r\n\t\t\t.filter((manifest) => uniques.includes(manifest.alias)) as Array<ManifestSection>;\r\n\r\n\t\tconst sectionItems: Array<UmbSectionItemModel> = sectionManifests.map((manifest) => itemMapper(manifest));\r\n\r\n\t\treturn { data: sectionItems, asObservable: () => sectionItemsByUniquesObservable(uniques) };\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a promise with an observable of the items for the given uniques\r\n\t * @param {Array<string>} uniques\r\n\t * @returns {*}\r\n\t * @memberof UmbItemRepositoryBase\r\n\t */\r\n\tasync items(uniques: Array<string>) {\r\n\t\treturn sectionItemsByUniquesObservable(uniques);\r\n\t}\r\n}\r\n\r\nconst sectionItemsObservable = createObservablePart(umbExtensionsRegistry.byType('section'), (manifests) =>\r\n\tmanifests.map((manifest) => itemMapper(manifest)),\r\n);\r\n\r\nconst sectionItemsByUniquesObservable = (uniques: Array<string>) =>\r\n\tcreateObservablePart(sectionItemsObservable, (items) => items.filter((x) => uniques.includes(x.unique)));\r\n\r\nconst itemMapper = (manifest: ManifestSection): UmbSectionItemModel => {\r\n\treturn {\r\n\t\t...manifest,\r\n\t\tunique: manifest.alias,\r\n\t};\r\n};\r\n\r\nexport default UmbSectionItemRepository;\r\n"],"names":["UmbSectionItemRepository","UmbRepositoryBase","host","uniques","umbExtensionsRegistry","manifest","itemMapper","sectionItemsByUniquesObservable","sectionItemsObservable","createObservablePart","manifests","items","x"],"mappings":";;;AAQO,MAAMA,UAAiCC,EAAoE;AAAA,EACjH,YAAYC,GAAyB;AACpC,UAAMA,CAAI;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASX,MAAM,aAAaC,GAAwB;AAC1C,QAAI,CAACA,EAAe,OAAA,IAAI,MAAM,qBAAqB;AASnD,WAAO,EAAE,MAPgBC,EACvB,iBAAA,EACA,OAAO,CAACC,MAAaA,EAAS,SAAS,SAAS,EAChD,OAAO,CAACA,MAAaF,EAAQ,SAASE,EAAS,KAAK,CAAC,EAEW,IAAI,CAACA,MAAaC,EAAWD,CAAQ,CAAC,GAE3E,cAAc,MAAME,EAAgCJ,CAAO,EAAE;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAS3F,MAAM,MAAMA,GAAwB;AACnC,WAAOI,EAAgCJ,CAAO;AAAA,EAAA;AAEhD;AAEA,MAAMK,IAAyBC;AAAA,EAAqBL,EAAsB,OAAO,SAAS;AAAA,EAAG,CAACM,MAC7FA,EAAU,IAAI,CAACL,MAAaC,EAAWD,CAAQ,CAAC;AACjD,GAEME,IAAkC,CAACJ,MACxCM,EAAqBD,GAAwB,CAACG,MAAUA,EAAM,OAAO,CAACC,MAAMT,EAAQ,SAASS,EAAE,MAAM,CAAC,CAAC,GAElGN,IAAa,CAACD,OACZ;AAAA,EACN,GAAGA;AAAA,EACH,QAAQA,EAAS;AAClB;"}