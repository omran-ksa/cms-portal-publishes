{"version":3,"file":"restore-from-recycle-bin-modal.element-DOgZ0gFw.js","sources":["../../../src/packages/core/recycle-bin/entity-action/restore-from-recycle-bin/modal/restore-from-recycle-bin-modal.element.ts"],"sourcesContent":["import type { UmbRecycleBinRepository } from '../../../recycle-bin-repository.interface.js';\r\nimport type {\r\n\tUmbRestoreFromRecycleBinModalData,\r\n\tUmbRestoreFromRecycleBinModalValue,\r\n} from './restore-from-recycle-bin-modal.token.js';\r\nimport type { PropertyValueMap } from '@umbraco-cms/backoffice/external/lit';\r\nimport { html, customElement, state, css } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbModalBaseElement, umbOpenModal } from '@umbraco-cms/backoffice/modal';\r\nimport { createExtensionApiByAlias } from '@umbraco-cms/backoffice/extension-registry';\r\nimport type { UmbItemRepository } from '@umbraco-cms/backoffice/repository';\r\n\r\nconst elementName = 'umb-restore-from-recycle-bin-modal';\r\n\r\n@customElement(elementName)\r\nexport class UmbRestoreFromRecycleBinModalElement extends UmbModalBaseElement<\r\n\tUmbRestoreFromRecycleBinModalData,\r\n\tUmbRestoreFromRecycleBinModalValue\r\n> {\r\n\t@state()\r\n\t_isAutomaticRestore = false;\r\n\r\n\t@state()\r\n\t_restoreItem?: any;\r\n\r\n\t@state()\r\n\t_destinationItem?: any;\r\n\r\n\t#recycleBinRepository?: UmbRecycleBinRepository;\r\n\r\n\tprotected override async firstUpdated(\r\n\t\t_changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>,\r\n\t): Promise<void> {\r\n\t\tsuper.firstUpdated(_changedProperties);\r\n\t\tif (!this.data?.unique) throw new Error('Cannot restore an item without a unique identifier.');\r\n\r\n\t\tthis._restoreItem = await this.#requestItem(this.data.unique);\r\n\t\tconst unique = await this.#requestAutomaticRestoreDestination();\r\n\r\n\t\tif (unique !== undefined) {\r\n\t\t\tthis.setDestination(unique);\r\n\t\t\tthis._isAutomaticRestore = true;\r\n\t\t}\r\n\t}\r\n\r\n\tasync setDestination(unique: string | null) {\r\n\t\t// TODO: handle ROOT lookup. Currently, we can't look up the root in the item repository.\r\n\t\t// This is a temp solution to show something in the UI.\r\n\t\tif (unique === null) {\r\n\t\t\tthis._destinationItem = {\r\n\t\t\t\tname: 'ROOT',\r\n\t\t\t};\r\n\r\n\t\t\tthis.#setDestinationValue({\r\n\t\t\t\tunique: null,\r\n\t\t\t\tentityType: 'unknown',\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (unique) {\r\n\t\t\tthis._destinationItem = await this.#requestItem(unique);\r\n\t\t\tif (!this._destinationItem) throw new Error('Cant find destination item.');\r\n\r\n\t\t\tthis.#setDestinationValue({\r\n\t\t\t\tunique: this._destinationItem.unique,\r\n\t\t\t\tentityType: this._destinationItem.entityType,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tasync #requestAutomaticRestoreDestination(): Promise<string | null | undefined> {\r\n\t\tif (!this.data?.unique) throw new Error('Cannot restore an item without a unique identifier.');\r\n\t\tif (!this.data?.recycleBinRepositoryAlias)\r\n\t\t\tthrow new Error('Cannot restore an item without a recycle bin repository alias.');\r\n\r\n\t\tthis.#recycleBinRepository = await createExtensionApiByAlias<UmbRecycleBinRepository>(\r\n\t\t\tthis,\r\n\t\t\tthis.data.recycleBinRepositoryAlias,\r\n\t\t);\r\n\r\n\t\tconst { data } = await this.#recycleBinRepository.requestOriginalParent({\r\n\t\t\tunique: this.data.unique,\r\n\t\t});\r\n\r\n\t\t// only check for undefined because data can be null if the parent is the root\r\n\t\tif (data !== undefined) {\r\n\t\t\treturn data ? data.unique : null;\r\n\t\t}\r\n\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tasync #requestItem(unique: string) {\r\n\t\tif (!this.data?.itemRepositoryAlias) throw new Error('Cannot restore an item without an item repository alias.');\r\n\r\n\t\tconst itemRepository = await createExtensionApiByAlias<UmbItemRepository<any>>(this, this.data.itemRepositoryAlias);\r\n\t\tconst { data } = await itemRepository.requestItems([unique]);\r\n\r\n\t\treturn data?.[0];\r\n\t}\r\n\r\n\tasync #onSelectCustomDestination() {\r\n\t\tif (!this.data?.pickerModal) throw new Error('Cannot select a destination without a picker modal.');\r\n\r\n\t\tconst { selection } = await umbOpenModal(this, this.data.pickerModal, {\r\n\t\t\tdata: {\r\n\t\t\t\tmultiple: false,\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tif (selection.length > 0) {\r\n\t\t\tconst unique = selection[0];\r\n\t\t\tthis.setDestination(unique);\r\n\t\t}\r\n\t}\r\n\r\n\tasync #onSubmit() {\r\n\t\tif (!this.value.destination) throw new Error('Cannot restore an item without a destination.');\r\n\t\tif (!this.#recycleBinRepository) throw new Error('Cannot restore an item without a destination.');\r\n\t\tif (!this.data?.unique) throw new Error('Cannot restore an item without a unique identifier.');\r\n\r\n\t\tconst { error } = await this.#recycleBinRepository.requestRestore({\r\n\t\t\tunique: this.data.unique,\r\n\t\t\tdestination: { unique: this.value.destination.unique },\r\n\t\t});\r\n\r\n\t\tif (!error) {\r\n\t\t\tthis._submitModal();\r\n\t\t}\r\n\t}\r\n\r\n\t#setDestinationValue(destination: UmbRestoreFromRecycleBinModalValue['destination']) {\r\n\t\tthis.updateValue({ destination });\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=\"Restore\">\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t${this._isAutomaticRestore\r\n\t\t\t\t\t\t? html` Restore ${this._restoreItem?.name} to ${this._destinationItem?.name}`\r\n\t\t\t\t\t\t: this.#renderCustomSelectDestination()}\r\n\t\t\t\t</uui-box>\r\n\t\t\t\t${this.#renderActions()}\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderCustomSelectDestination() {\r\n\t\treturn html`\r\n\t\t\t<h4>Cannot automatically restore this item.</h4>\r\n\t\t\t<p>There is no location where this item can be automatically restored. You can select a new location below.</p>\r\n\t\t\t<h5>Restore to:</h5>\r\n\t\t\t${this._destinationItem\r\n\t\t\t\t? html`<uui-ref-node name=${this._destinationItem.name}>\r\n\t\t\t\t\t\t<uui-action-bar slot=\"actions\">\r\n\t\t\t\t\t\t\t<uui-button @click=${() => (this._destinationItem = undefined)} label=\"Remove\"\r\n\t\t\t\t\t\t\t\t>${this.localize.term('general_remove')}</uui-button\r\n\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t</uui-action-bar>\r\n\t\t\t\t\t</uui-ref-node>`\r\n\t\t\t\t: html` <uui-button id=\"placeholder\" look=\"placeholder\" @click=${this.#onSelectCustomDestination}\r\n\t\t\t\t\t\t>Select location</uui-button\r\n\t\t\t\t\t>`}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderActions() {\r\n\t\treturn html`\r\n\t\t\t<uui-button slot=\"actions\" id=\"cancel\" label=\"Cancel\" @click=\"${this._rejectModal}\"></uui-button>\r\n\t\t\t<uui-button slot=\"actions\" color=\"positive\" look=\"primary\" label=\"Restore\" @click=${this.#onSubmit}></uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#placeholder {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbRestoreFromRecycleBinModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t[elementName]: UmbRestoreFromRecycleBinModalElement;\r\n\t}\r\n}\r\n"],"names":["_recycleBinRepository","_UmbRestoreFromRecycleBinModalElement_instances","requestAutomaticRestoreDestination_fn","requestItem_fn","onSelectCustomDestination_fn","onSubmit_fn","setDestinationValue_fn","renderCustomSelectDestination_fn","renderActions_fn","elementName","UmbRestoreFromRecycleBinModalElement","UmbModalBaseElement","__privateAdd","_changedProperties","__privateMethod","unique","html","__privateSet","createExtensionApiByAlias","data","__privateGet","itemRepository","selection","umbOpenModal","error","destination","UmbTextStyles","css","__decorateClass","state","customElement","UmbRestoreFromRecycleBinModalElement$1"],"mappings":"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"}