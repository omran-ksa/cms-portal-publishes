{"version":3,"file":"collection-create-action.element-C6F2mRL7.js","sources":["../../../src/packages/core/collection/action/create/collection-create-action.element.ts"],"sourcesContent":["import { customElement, html, ifDefined, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UmbExtensionsApiInitializer } from '@umbraco-cms/backoffice/extension-api';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_ENTITY_CONTEXT } from '@umbraco-cms/backoffice/entity';\r\nimport type { ManifestEntityCreateOptionAction } from '@umbraco-cms/backoffice/entity-create-option-action';\r\nimport type { UmbExtensionApiInitializer } from '@umbraco-cms/backoffice/extension-api';\r\n\r\ntype ManifestType = ManifestEntityCreateOptionAction;\r\n\r\n@customElement('umb-collection-create-action-button')\r\nexport class UmbCollectionCreateActionButtonElement extends UmbLitElement {\r\n\t@state()\r\n\tprivate _popoverOpen = false;\r\n\r\n\t@state()\r\n\tprivate _multipleOptions = false;\r\n\r\n\t@state()\r\n\tprivate _apiControllers: Array<UmbExtensionApiInitializer<ManifestType>> = [];\r\n\r\n\t@state()\r\n\t_hrefList: Array<string | undefined> = [];\r\n\r\n\t#createLabel = this.localize.term('general_create');\r\n\t#entityContext?: typeof UMB_ENTITY_CONTEXT.TYPE;\r\n\r\n\t#onPopoverToggle(event: PointerEvent) {\r\n\t\t// TODO: This ignorer is just neede for JSON SCHEMA TO WORK, As its not updated with latest TS jet.\r\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t// @ts-ignore\r\n\t\tthis._popoverOpen = event.newState === 'open';\r\n\t}\r\n\r\n\tasync #onClick(event: Event, controller: UmbExtensionApiInitializer<ManifestType>, href?: string) {\r\n\t\tevent.stopPropagation();\r\n\r\n\t\t// skip if href is defined\r\n\t\tif (href) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!controller.api) throw new Error('No API found');\r\n\t\tawait controller.api.execute().catch(() => {});\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_ENTITY_CONTEXT, (context) => {\r\n\t\t\tthis.#entityContext = context;\r\n\t\t\tthis.#initApi();\r\n\t\t});\r\n\t}\r\n\r\n\t#initApi() {\r\n\t\tif (!this.#entityContext) return;\r\n\r\n\t\tconst entityType = this.#entityContext.getEntityType();\r\n\t\tif (!entityType) throw new Error('No entity type found');\r\n\r\n\t\tconst unique = this.#entityContext.getUnique();\r\n\t\tif (unique === undefined) throw new Error('No unique found');\r\n\r\n\t\tnew UmbExtensionsApiInitializer(\r\n\t\t\tthis,\r\n\t\t\tumbExtensionsRegistry,\r\n\t\t\t'entityCreateOptionAction',\r\n\t\t\t(manifest: ManifestType) => {\r\n\t\t\t\treturn [{ entityType, unique, meta: manifest.meta }];\r\n\t\t\t},\r\n\t\t\t(manifest: ManifestType) => manifest.forEntityTypes.includes(entityType),\r\n\t\t\tasync (controllers) => {\r\n\t\t\t\tthis._apiControllers = controllers as unknown as Array<UmbExtensionApiInitializer<ManifestType>>;\r\n\t\t\t\tthis._multipleOptions = controllers.length > 1;\r\n\t\t\t\tconst hrefPromises = this._apiControllers.map((controller) => controller.api?.getHref());\r\n\t\t\t\tthis._hrefList = await Promise.all(hrefPromises);\r\n\t\t\t},\r\n\t\t);\r\n\t}\r\n\r\n\t#getTarget(href?: string) {\r\n\t\tif (href && href.startsWith('http')) {\r\n\t\t\treturn '_blank';\r\n\t\t}\r\n\r\n\t\treturn '_self';\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn this._multipleOptions ? this.#renderMultiOptionAction() : this.#renderSingleOptionAction();\r\n\t}\r\n\r\n\t#renderSingleOptionAction() {\r\n\t\tconst href = this._hrefList[0];\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\tlabel=${this.#createLabel}\r\n\t\t\t\tcolor=\"default\"\r\n\t\t\t\tlook=\"outline\"\r\n\t\t\t\thref=${ifDefined(href)}\r\n\t\t\t\ttarget=${this.#getTarget(href)}\r\n\t\t\t\t@click=${(event: Event) => this.#onClick(event, this._apiControllers[0], href)}></uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderMultiOptionAction() {\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\tpopovertarget=\"collection-action-menu-popover\"\r\n\t\t\t\tlabel=${this.#createLabel}\r\n\t\t\t\tcolor=\"default\"\r\n\t\t\t\tlook=\"outline\">\r\n\t\t\t\t${this.#createLabel}\r\n\t\t\t\t<uui-symbol-expand .open=${this._popoverOpen}></uui-symbol-expand>\r\n\t\t\t</uui-button>\r\n\t\t\t${this.#renderDropdown()}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderDropdown() {\r\n\t\treturn html`\r\n\t\t\t<uui-popover-container\r\n\t\t\t\tid=\"collection-action-menu-popover\"\r\n\t\t\t\tplacement=\"bottom-start\"\r\n\t\t\t\t@toggle=${this.#onPopoverToggle}>\r\n\t\t\t\t<umb-popover-layout>\r\n\t\t\t\t\t<uui-scroll-container>\r\n\t\t\t\t\t\t${this._apiControllers.map((controller, index) => this.#renderMenuItem(controller, index))}\r\n\t\t\t\t\t</uui-scroll-container>\r\n\t\t\t\t</umb-popover-layout>\r\n\t\t\t</uui-popover-container>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderMenuItem(controller: UmbExtensionApiInitializer<ManifestType>, index: number) {\r\n\t\tconst manifest = controller.manifest;\r\n\t\tif (!manifest) throw new Error('No manifest found');\r\n\r\n\t\tconst label = manifest.meta.label ? this.localize.string(manifest.meta.label) : manifest.name;\r\n\t\tconst href = this._hrefList[index];\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-menu-item\r\n\t\t\t\tlabel=${label}\r\n\t\t\t\thref=${ifDefined(href)}\r\n\t\t\t\ttarget=${this.#getTarget(href)}\r\n\t\t\t\t@click=${(event: Event) => this.#onClick(event, controller, href)}>\r\n\t\t\t\t<umb-icon slot=\"icon\" .name=${manifest.meta.icon}></umb-icon>\r\n\t\t\t</uui-menu-item>\r\n\t\t`;\r\n\t}\r\n}\r\n\r\nexport { UmbCollectionCreateActionButtonElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-collection-create-action-button': UmbCollectionCreateActionButtonElement;\r\n\t}\r\n}\r\n"],"names":["_createLabel","_entityContext","_UmbCollectionCreateActionButtonElement_instances","onPopoverToggle_fn","onClick_fn","initApi_fn","getTarget_fn","renderSingleOptionAction_fn","renderMultiOptionAction_fn","renderDropdown_fn","renderMenuItem_fn","UmbCollectionCreateActionButtonElement","UmbLitElement","__privateAdd","UMB_ENTITY_CONTEXT","context","__privateSet","__privateMethod","event","controller","href","__privateGet","entityType","unique","UmbExtensionsApiInitializer","umbExtensionsRegistry","manifest","controllers","hrefPromises","html","ifDefined","index","label","__decorateClass","state","customElement"],"mappings":"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"}