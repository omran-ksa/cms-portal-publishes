{"version":3,"file":"rename-server-file-modal.element-Bm5IsErL.js","sources":["../../../src/packages/core/server-file-system/rename/modal/rename-server-file-modal.element.ts"],"sourcesContent":["import type { UmbRenameServerFileRepository } from '../types.js';\r\nimport type { UmbRenameModalData, UmbRenameServerFileModalValue } from './rename-server-file-modal.token.js';\r\nimport type { PropertyValueMap } from '@umbraco-cms/backoffice/external/lit';\r\nimport { html, customElement, css, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbExtensionApiInitializer } from '@umbraco-cms/backoffice/extension-api';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport type { UmbItemRepository } from '@umbraco-cms/backoffice/repository';\r\nimport { umbFocus } from '@umbraco-cms/backoffice/lit-element';\r\n\r\n@customElement('umb-rename-modal')\r\nexport class UmbRenameModalElement extends UmbModalBaseElement<UmbRenameModalData, UmbRenameServerFileModalValue> {\r\n\t// TODO: make base type for item and detail models\r\n\t#itemRepository?: UmbItemRepository<any>;\r\n\t#renameRepository?: UmbRenameServerFileRepository<any>;\r\n\t#init?: Promise<unknown>;\r\n\r\n\t@state()\r\n\t_name = '';\r\n\r\n\toverride connectedCallback(): void {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.#observeRepository();\r\n\t}\r\n\r\n\t#observeRepository() {\r\n\t\tif (!this.data?.renameRepositoryAlias) throw new Error('A rename repository alias is required');\r\n\t\tif (!this.data?.itemRepositoryAlias) throw new Error('An item repository alias is required');\r\n\r\n\t\t// TODO: We should properly look into how we can simplify the one time usage of a extension api, as its a bit of overkill to take conditions/overwrites and observation of extensions into play here: [NL]\r\n\t\t// But since this happens when we execute an action, it does most likely not hurt any users, but it is a bit of a overkill to do this for every action: [NL]\r\n\t\tthis.#init = Promise.all([\r\n\t\t\tnew UmbExtensionApiInitializer(\r\n\t\t\t\tthis,\r\n\t\t\t\tumbExtensionsRegistry,\r\n\t\t\t\tthis.data.itemRepositoryAlias,\r\n\t\t\t\t[this],\r\n\t\t\t\t(permitted, ctrl) => {\r\n\t\t\t\t\tthis.#itemRepository = permitted ? (ctrl.api as UmbItemRepository<any>) : undefined;\r\n\t\t\t\t},\r\n\t\t\t).asPromise(),\r\n\r\n\t\t\tnew UmbExtensionApiInitializer(\r\n\t\t\t\tthis,\r\n\t\t\t\tumbExtensionsRegistry,\r\n\t\t\t\tthis.data.renameRepositoryAlias,\r\n\t\t\t\t[this],\r\n\t\t\t\t(permitted, ctrl) => {\r\n\t\t\t\t\tthis.#renameRepository = permitted ? (ctrl.api as UmbRenameServerFileRepository<any>) : undefined;\r\n\t\t\t\t},\r\n\t\t\t).asPromise(),\r\n\t\t]);\r\n\t}\r\n\r\n\tprotected override async firstUpdated(\r\n\t\t_changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>,\r\n\t): Promise<void> {\r\n\t\tsuper.firstUpdated(_changedProperties);\r\n\t\tif (!this.data?.unique) throw new Error('Unique identifier is not available');\r\n\t\tawait this.#init;\r\n\t\tif (!this.#itemRepository) throw new Error('Item repository is not available');\r\n\r\n\t\tconst { data } = await this.#itemRepository.requestItems([this.data.unique]);\r\n\t\tthis._name = data?.[0].name ?? '';\r\n\t}\r\n\r\n\tasync #onSubmit(event: SubmitEvent) {\r\n\t\tevent.preventDefault();\r\n\t\tif (!this.#renameRepository) throw new Error('Rename repository is not available');\r\n\t\tif (!this.data?.unique) throw new Error('Unique identifier is not available');\r\n\r\n\t\tconst form = event.target as HTMLFormElement;\r\n\t\tif (!form) return;\r\n\r\n\t\tconst isValid = form.checkValidity();\r\n\t\tif (!isValid) return;\r\n\r\n\t\tconst formData = new FormData(form);\r\n\t\tconst name = formData.get('name') as string;\r\n\r\n\t\tconst { data } = await this.#renameRepository.rename(this.data.unique, name);\r\n\r\n\t\tif (data) {\r\n\t\t\tthis.value = {\r\n\t\t\t\tname: data.name,\r\n\t\t\t\tunique: data.unique,\r\n\t\t\t};\r\n\r\n\t\t\tthis._submitModal();\r\n\t\t} else {\r\n\t\t\tthis._rejectModal();\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=${'Rename'}>\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t<uui-form>\r\n\t\t\t\t\t\t<form id=\"RenameForm\" @submit=\"${this.#onSubmit}\">\r\n\t\t\t\t\t\t\t<uui-form-layout-item>\r\n\t\t\t\t\t\t\t\t<uui-label id=\"nameLabel\" for=\"name\" slot=\"label\" required>Name</uui-label>\r\n\t\t\t\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\t\tid=\"name\"\r\n\t\t\t\t\t\t\t\t\tname=\"name\"\r\n\t\t\t\t\t\t\t\t\tvalue=${this._name}\r\n\t\t\t\t\t\t\t\t\tplaceholder=\"Enter new name...\"\r\n\t\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\t\trequired-message=\"Name is required\"\r\n\t\t\t\t\t\t\t\t\t${umbFocus()}></uui-input>\r\n\t\t\t\t\t\t\t</uui-form-layout-item>\r\n\t\t\t\t\t\t</form>\r\n\t\t\t\t\t</uui-form>\r\n\t\t\t\t</uui-box>\r\n\r\n\t\t\t\t<uui-button slot=\"actions\" id=\"cancel\" label=\"Cancel\" @click=\"${this._rejectModal}\"></uui-button>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tform=\"RenameForm\"\r\n\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\tlabel=\"Rename\"></uui-button>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#name {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbRenameModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-rename-modal': UmbRenameModalElement;\r\n\t}\r\n}\r\n"],"names":["_itemRepository","_renameRepository","_init","_UmbRenameModalElement_instances","observeRepository_fn","onSubmit_fn","UmbRenameModalElement","UmbModalBaseElement","__privateAdd","__privateMethod","_changedProperties","__privateGet","data","html","umbFocus","__privateSet","UmbExtensionApiInitializer","umbExtensionsRegistry","permitted","ctrl","event","form","name","UmbTextStyles","css","__decorateClass","state","customElement","UmbRenameModalElement$1"],"mappings":"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"}