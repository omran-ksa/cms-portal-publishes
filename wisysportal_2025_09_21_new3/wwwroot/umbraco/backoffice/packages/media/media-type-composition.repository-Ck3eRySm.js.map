{"version":3,"file":"media-type-composition.repository-Ck3eRySm.js","sources":["../../../src/packages/media/media-types/repository/composition/media-type-composition.server.data-source.ts","../../../src/packages/media/media-types/repository/composition/media-type-composition.repository.ts"],"sourcesContent":["import type {\r\n\tUmbMediaTypeCompositionCompatibleModel,\r\n\tUmbMediaTypeCompositionReferenceModel,\r\n\tUmbMediaTypeAvailableCompositionRequestModel,\r\n} from '../../types.js';\r\nimport { type MediaTypeCompositionRequestModel, MediaTypeService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\nimport type { UmbContentTypeCompositionDataSource } from '@umbraco-cms/backoffice/content-type';\r\n\r\n/**\r\n * A data source for the Media Type Composition that fetches data from the server\r\n * @class UmbMediaTypeCompositionServerDataSource\r\n */\r\nexport class UmbMediaTypeCompositionServerDataSource\r\n\timplements\r\n\t\tUmbContentTypeCompositionDataSource<\r\n\t\t\tUmbMediaTypeCompositionReferenceModel,\r\n\t\t\tUmbMediaTypeCompositionCompatibleModel,\r\n\t\t\tUmbMediaTypeAvailableCompositionRequestModel\r\n\t\t>\r\n{\r\n\t#host: UmbControllerHost;\r\n\r\n\t/**\r\n\t * Creates an instance of UmbMediaTypeCompositionServerDataSource.\r\n\t * @param {UmbControllerHost} host - The controller host for this controller to be appended to\r\n\t * @memberof UmbMediaTypeCompositionServerDataSource\r\n\t */\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tthis.#host = host;\r\n\t}\r\n\t/**\r\n\t * Fetches the compatible compositions for a Media type from the server\r\n\t * @param {string} unique\r\n\t * @returns {*}\r\n\t * @memberof UmbMediaTypeCompositionServerDataSource\r\n\t */\r\n\tasync getReferences(unique: string) {\r\n\t\tconst response = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tMediaTypeService.getMediaTypeByIdCompositionReferences({ path: { id: unique } }),\r\n\t\t);\r\n\t\tconst error = response.error;\r\n\t\tconst data: Array<UmbMediaTypeCompositionReferenceModel> | undefined = response.data?.map((reference) => {\r\n\t\t\treturn {\r\n\t\t\t\tunique: reference.id,\r\n\t\t\t\ticon: reference.icon,\r\n\t\t\t\tname: reference.name,\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\treturn { data, error };\r\n\t}\r\n\t/**\r\n\t * Updates the compositions for a media type on the server\r\n\t * @param {MediaTypeCompositionRequestModel} body\r\n\t * @param args\r\n\t * @returns {*}\r\n\t * @memberof UmbMediaTypeCompositionServerDataSource\r\n\t */\r\n\tasync availableCompositions(args: UmbMediaTypeAvailableCompositionRequestModel) {\r\n\t\tconst body: MediaTypeCompositionRequestModel = {\r\n\t\t\tid: args.unique,\r\n\t\t\tcurrentCompositeIds: args.currentCompositeUniques,\r\n\t\t\tcurrentPropertyAliases: args.currentPropertyAliases,\r\n\t\t};\r\n\r\n\t\tconst response = await tryExecute(this.#host, MediaTypeService.postMediaTypeAvailableCompositions({ body }));\r\n\t\tconst error = response.error;\r\n\t\tconst data: Array<UmbMediaTypeCompositionCompatibleModel> | undefined = response.data?.map((composition) => {\r\n\t\t\treturn {\r\n\t\t\t\tunique: composition.id,\r\n\t\t\t\tname: composition.name,\r\n\t\t\t\ticon: composition.icon,\r\n\t\t\t\tfolderPath: composition.folderPath,\r\n\t\t\t\tisCompatible: composition.isCompatible,\r\n\t\t\t};\r\n\t\t});\r\n\r\n\t\treturn { data, error };\r\n\t}\r\n}\r\n","import type {\r\n\tUmbMediaTypeAvailableCompositionRequestModel,\r\n\tUmbMediaTypeCompositionCompatibleModel,\r\n\tUmbMediaTypeCompositionReferenceModel,\r\n} from '../../types.js';\r\nimport { UmbMediaTypeCompositionServerDataSource } from './media-type-composition.server.data-source.js';\r\nimport type { UmbContentTypeCompositionRepository } from '@umbraco-cms/backoffice/content-type';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbRepositoryBase } from '@umbraco-cms/backoffice/repository';\r\n\r\nexport class UmbMediaTypeCompositionRepository\r\n\textends UmbRepositoryBase\r\n\timplements\r\n\t\tUmbContentTypeCompositionRepository<\r\n\t\t\tUmbMediaTypeCompositionReferenceModel,\r\n\t\t\tUmbMediaTypeCompositionCompatibleModel,\r\n\t\t\tUmbMediaTypeAvailableCompositionRequestModel\r\n\t\t>\r\n{\r\n\t#compositionSource: UmbMediaTypeCompositionServerDataSource;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t\tthis.#compositionSource = new UmbMediaTypeCompositionServerDataSource(this);\r\n\t}\r\n\r\n\tasync getReferences(unique: string) {\r\n\t\treturn this.#compositionSource.getReferences(unique);\r\n\t}\r\n\r\n\tasync availableCompositions(args: UmbMediaTypeAvailableCompositionRequestModel) {\r\n\t\treturn this.#compositionSource.availableCompositions(args);\r\n\t}\r\n}\r\n\r\nexport { UmbMediaTypeCompositionRepository as api };\r\n"],"names":["UmbMediaTypeCompositionServerDataSource","#host","host","unique","response","tryExecute","MediaTypeService","error","reference","args","body","composition","UmbMediaTypeCompositionRepository","UmbRepositoryBase","#compositionSource"],"mappings":";;;AAcO,MAAMA,EAOb;AAAA,EACCC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,YAAYC,GAAyB;AACpC,SAAKD,KAAQC;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQd,MAAM,cAAcC,GAAgB;AACnC,UAAMC,IAAW,MAAMC;AAAA,MACtB,KAAKJ;AAAA,MACLK,EAAiB,sCAAsC,EAAE,MAAM,EAAE,IAAIH,EAAA,EAAU,CAAA;AAAA,IAChF,GACMI,IAAQH,EAAS;AAShB,WAAA,EAAE,MAR8DA,EAAS,MAAM,IAAI,CAACI,OACnF;AAAA,MACN,QAAQA,EAAU;AAAA,MAClB,MAAMA,EAAU;AAAA,MAChB,MAAMA,EAAU;AAAA,IACjB,EACA,GAEc,OAAAD,EAAM;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAStB,MAAM,sBAAsBE,GAAoD;AAC/E,UAAMC,IAAyC;AAAA,MAC9C,IAAID,EAAK;AAAA,MACT,qBAAqBA,EAAK;AAAA,MAC1B,wBAAwBA,EAAK;AAAA,IAC9B,GAEML,IAAW,MAAMC,EAAW,KAAKJ,IAAOK,EAAiB,mCAAmC,EAAE,MAAAI,EAAK,CAAC,CAAC,GACrGH,IAAQH,EAAS;AAWhB,WAAA,EAAE,MAV+DA,EAAS,MAAM,IAAI,CAACO,OACpF;AAAA,MACN,QAAQA,EAAY;AAAA,MACpB,MAAMA,EAAY;AAAA,MAClB,MAAMA,EAAY;AAAA,MAClB,YAAYA,EAAY;AAAA,MACxB,cAAcA,EAAY;AAAA,IAC3B,EACA,GAEc,OAAAJ,EAAM;AAAA,EAAA;AAEvB;ACxEO,MAAMK,UACJC,EAOT;AAAA,EACCC;AAAA,EAEA,YAAYZ,GAAyB;AACpC,UAAMA,CAAI,GACL,KAAAY,KAAqB,IAAId,EAAwC,IAAI;AAAA,EAAA;AAAA,EAG3E,MAAM,cAAcG,GAAgB;AAC5B,WAAA,KAAKW,GAAmB,cAAcX,CAAM;AAAA,EAAA;AAAA,EAGpD,MAAM,sBAAsBM,GAAoD;AACxE,WAAA,KAAKK,GAAmB,sBAAsBL,CAAI;AAAA,EAAA;AAE3D;"}