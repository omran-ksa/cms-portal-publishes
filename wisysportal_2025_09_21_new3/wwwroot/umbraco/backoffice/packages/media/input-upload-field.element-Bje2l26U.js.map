{"version":3,"file":"input-upload-field.element-Bje2l26U.js","sources":["../../../src/packages/media/media/components/input-image-cropper/crop-change.event.ts","../../../src/packages/media/media/components/input-image-cropper/focalpoint-change.event.ts","../../../src/packages/media/media/components/input-image-cropper/image-cropper-field.element.ts","../../../src/packages/media/media/components/input-image-cropper/image-cropper-focus-setter.element.ts","../../../src/packages/media/media/components/input-image-cropper/image-cropper-preview.element.ts","../../../src/packages/media/media/components/input-image-cropper/image-cropper.element.ts","../../../src/packages/media/media/components/input-image-cropper/input-image-cropper.element.ts","../../../src/packages/media/media/collection/media-collection.context-token.ts","../../../src/packages/media/media/entity-actions/create/media-create-options-modal.token.ts","../../../src/packages/media/media/modals/image-cropper-editor/components/image-cropper-editor-field.element.ts","../../../src/packages/media/media/modals/media-picker/media-picker-modal.token.ts","../../../src/packages/media/media/modals/image-cropper-editor/image-cropper-editor-modal.element.ts","../../../src/packages/media/media/modals/image-cropper-editor/image-cropper-editor-modal.token.ts","../../../src/packages/media/media/modals/media-caption-alt-text/media-caption-alt-text-modal.token.ts","../../../src/packages/media/media/entity.ts","../../../src/packages/media/media/repository/detail/media-detail.server.data-source.ts","../../../src/packages/media/media/repository/detail/media-detail.store.context-token.ts","../../../src/packages/media/media/repository/detail/media-detail.repository.ts","../../../src/packages/media/media/repository/item/media-item.server.data-source.ts","../../../src/packages/media/media/repository/item/media-item.store.context-token.ts","../../../src/packages/media/media/repository/item/media-item.repository.ts","../../../src/packages/media/media/tree/media-tree.server.data-source.ts","../../../src/packages/media/media/tree/media-tree.store.context-token.ts","../../../src/packages/media/media/tree/media-tree.repository.ts","../../../src/packages/media/media/modals/media-picker/components/media-picker-folder-path.element.ts","../../../src/packages/media/media/modals/media-picker/components/media-picker-create-item.element.ts","../../../src/packages/media/media/search/media-search.server.data-source.ts","../../../src/packages/media/media/search/media-search.repository.ts","../../../src/packages/media/media/search/media.search-provider.ts","../../../src/packages/media/media/modals/media-picker/media-picker-modal.element.ts","../../../src/packages/media/media-section/paths.ts","../../../src/packages/media/media/paths.ts","../../../src/packages/media/media/recycle-bin/tree/media-recycle-bin-tree.store.context-token.ts","../../../src/packages/media/media/repository/item/constants.ts","../../../src/packages/media/media/search/constants.ts","../../../src/packages/media/media/tree/media-tree-picker-modal.token.ts","../../../src/packages/media/media/workspace/media-workspace.context-token.ts","../../../src/packages/media/media/property-dataset-context/media-property-dataset-context.token.ts","../../../src/packages/media/media/modals/media-caption-alt-text/media-caption-alt-text-modal.element.ts","../../../src/packages/media/media/components/input-media/input-media.context.ts","../../../src/packages/media/media/components/input-media/input-media.element.ts","../../../src/packages/media/media/components/input-rich-media/input-rich-media.element.ts","../../../src/packages/media/media/components/input-upload-field/utils.ts","../../../src/packages/media/media/components/input-upload-field/input-upload-field.element.ts"],"sourcesContent":["export class UmbImageCropChangeEvent extends Event {\r\n\tpublic static readonly TYPE = 'imagecrop-change';\r\n\r\n\tpublic constructor(args?: EventInit) {\r\n\t\t// mimics the native change event\r\n\t\tsuper(UmbImageCropChangeEvent.TYPE, { bubbles: false, composed: false, cancelable: false, ...args });\r\n\t}\r\n}\r\n","import type { UmbFocalPointModel } from '../../types.js';\r\n\r\nexport class UmbFocalPointChangeEvent extends Event {\r\n\tpublic static readonly TYPE = 'focalpoint-change';\r\n\r\n\tpublic focalPoint: UmbFocalPointModel;\r\n\r\n\tpublic constructor(focalPoint: UmbFocalPointModel, args?: EventInit) {\r\n\t\t// mimics the native change event\r\n\t\tsuper(UmbFocalPointChangeEvent.TYPE, { bubbles: false, composed: false, cancelable: false, ...args });\r\n\t\tthis.focalPoint = focalPoint;\r\n\t}\r\n}\r\n","import type { UmbImageCropChangeEvent } from './crop-change.event.js';\r\nimport type { UmbFocalPointChangeEvent } from './focalpoint-change.event.js';\r\nimport type { UmbImageCropperElement } from './image-cropper.element.js';\r\nimport type {\r\n\tUmbImageCropperCrop,\r\n\tUmbImageCropperCrops,\r\n\tUmbImageCropperFocalPoint,\r\n\tUmbImageCropperPropertyEditorValue,\r\n} from './types.js';\r\nimport { css, customElement, html, property, repeat, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_SERVER_CONTEXT } from '@umbraco-cms/backoffice/server';\r\n\r\n@customElement('umb-image-cropper-field')\r\nexport class UmbInputImageCropperFieldElement extends UmbLitElement {\r\n\t@property({ attribute: false })\r\n\tset value(value) {\r\n\t\tif (!value) {\r\n\t\t\tthis.crops = [];\r\n\t\t\tthis.focalPoint = { left: 0.5, top: 0.5 };\r\n\t\t\tthis.src = '';\r\n\t\t\tthis.#value = undefined;\r\n\t\t} else {\r\n\t\t\tthis.crops = [...value.crops];\r\n\t\t\t// TODO: This is a temporary solution to make sure we have a focal point\r\n\t\t\tthis.focalPoint = value.focalPoint || { left: 0.5, top: 0.5 };\r\n\t\t\tthis.src = value.src;\r\n\t\t\tthis.#value = value;\r\n\t\t}\r\n\r\n\t\tthis.requestUpdate();\r\n\t}\r\n\tget value() {\r\n\t\treturn this.#value;\r\n\t}\r\n\t#value?: UmbImageCropperPropertyEditorValue;\r\n\r\n\t@state()\r\n\tcrops: UmbImageCropperCrops = [];\r\n\r\n\t@state()\r\n\tcurrentCrop?: UmbImageCropperCrop;\r\n\r\n\t@property({ attribute: false })\r\n\tset file(file: File | undefined) {\r\n\t\tthis.#file = file;\r\n\t\tif (file) {\r\n\t\t\tthis.fileDataUrl = URL.createObjectURL(file);\r\n\t\t} else if (this.fileDataUrl) {\r\n\t\t\tURL.revokeObjectURL(this.fileDataUrl);\r\n\t\t\tthis.fileDataUrl = undefined;\r\n\t\t}\r\n\t}\r\n\tget file() {\r\n\t\treturn this.#file;\r\n\t}\r\n\t#file?: File;\r\n\r\n\t@property()\r\n\tfileDataUrl?: string;\r\n\r\n\t@state()\r\n\tfocalPoint: UmbImageCropperFocalPoint = { left: 0.5, top: 0.5 };\r\n\r\n\t@property({ type: Boolean })\r\n\thideFocalPoint = false;\r\n\r\n\t@state()\r\n\tsrc = '';\r\n\r\n\t@state()\r\n\tprivate _serverUrl = '';\r\n\r\n\tget source(): string {\r\n\t\tif (this.src) {\r\n\t\t\t// Test that URL is relative:\r\n\t\t\tif (this.src.startsWith('/')) {\r\n\t\t\t\treturn `${this._serverUrl}${this.src}`;\r\n\t\t\t} else {\r\n\t\t\t\treturn this.src;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn this.fileDataUrl ?? '';\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_SERVER_CONTEXT, (context) => {\r\n\t\t\tthis._serverUrl = context?.getServerUrl() ?? '';\r\n\t\t});\r\n\t}\r\n\r\n\toverride disconnectedCallback(): void {\r\n\t\tsuper.disconnectedCallback();\r\n\t\tif (this.fileDataUrl) {\r\n\t\t\tURL.revokeObjectURL(this.fileDataUrl);\r\n\t\t}\r\n\t}\r\n\r\n\tprotected onCropClick(crop: any) {\r\n\t\tconst index = this.crops.findIndex((c) => c.alias === crop.alias);\r\n\r\n\t\tif (index === -1) return;\r\n\r\n\t\tthis.currentCrop = { ...this.crops[index] };\r\n\t}\r\n\r\n\t#onCropChange = (event: UmbImageCropChangeEvent) => {\r\n\t\tconst target = event.target as UmbImageCropperElement;\r\n\t\tconst value = target.value;\r\n\r\n\t\tif (!value) return;\r\n\r\n\t\tconst index = this.crops.findIndex((crop) => crop.alias === value.alias);\r\n\r\n\t\tif (index === undefined) return;\r\n\r\n\t\tthis.crops[index] = value;\r\n\t\tthis.currentCrop = undefined;\r\n\t\tthis.#updateValue();\r\n\t};\r\n\r\n\t#onFocalPointChange = (event: UmbFocalPointChangeEvent) => {\r\n\t\tthis.focalPoint = { top: event.focalPoint.top, left: event.focalPoint.left };\r\n\t\tthis.#updateValue();\r\n\t};\r\n\r\n\t#updateValue() {\r\n\t\tthis.#value = {\r\n\t\t\tcrops: [...this.crops],\r\n\t\t\tfocalPoint: this.focalPoint,\r\n\t\t\tsrc: this.src,\r\n\t\t};\r\n\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\tprotected onResetFocalPoint = () => {\r\n\t\tthis.focalPoint = { left: 0.5, top: 0.5 };\r\n\t\tthis.#updateValue();\r\n\t};\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<div id=\"main\">${this.renderMain()}</div>\r\n\t\t\t<div id=\"side\">${this.renderSide()}</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tprotected renderMain() {\r\n\t\tif (this.currentCrop) {\r\n\t\t\treturn html`\r\n\t\t\t\t<umb-image-cropper\r\n\t\t\t\t\t.focalPoint=${this.focalPoint}\r\n\t\t\t\t\t.src=${this.source}\r\n\t\t\t\t\t.value=${this.currentCrop}\r\n\t\t\t\t\t?hideFocalPoint=${this.hideFocalPoint}\r\n\t\t\t\t\t@imagecrop-change=${this.#onCropChange}>\r\n\t\t\t\t</umb-image-cropper>\r\n\t\t\t`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<umb-image-cropper-focus-setter\r\n\t\t\t\t.focalPoint=${this.focalPoint}\r\n\t\t\t\t.src=${this.source}\r\n\t\t\t\t?hideFocalPoint=${this.hideFocalPoint}\r\n\t\t\t\t@focalpoint-change=${this.#onFocalPointChange}>\r\n\t\t\t</umb-image-cropper-focus-setter>\r\n\t\t\t<div id=\"actions\">${this.renderActions()}</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tprotected renderActions() {\r\n\t\treturn html`\r\n\t\t\t<slot name=\"actions\"></slot>\r\n\t\t\t${when(\r\n\t\t\t\t!this.hideFocalPoint && this.focalPoint.left !== 0.5 && this.focalPoint.top !== 0.5,\r\n\t\t\t\t() => html`\r\n\t\t\t\t\t<uui-button compact label=${this.localize.term('content_resetFocalPoint')} @click=${this.onResetFocalPoint}>\r\n\t\t\t\t\t\t<uui-icon name=\"icon-axis-rotation\"></uui-icon>\r\n\t\t\t\t\t\t${this.localize.term('content_resetFocalPoint')}\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t`,\r\n\t\t\t)}\r\n\t\t`;\r\n\t}\r\n\r\n\tprotected renderSide() {\r\n\t\tif (!this.value || !this.crops) return;\r\n\t\treturn repeat(\r\n\t\t\tthis.crops,\r\n\t\t\t(crop) => crop.alias + JSON.stringify(crop.coordinates),\r\n\t\t\t(crop) => html`\r\n\t\t\t\t<umb-image-cropper-preview\r\n\t\t\t\t\t.crop=${crop}\r\n\t\t\t\t\t.focalPoint=${this.focalPoint}\r\n\t\t\t\t\t.src=${this.source}\r\n\t\t\t\t\t?active=${this.currentCrop?.alias === crop.alias}\r\n\t\t\t\t\t@click=${() => this.onCropClick(crop)}>\r\n\t\t\t\t</umb-image-cropper-preview>\r\n\t\t\t`,\r\n\t\t);\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\theight: 400px;\r\n\t\t\t}\r\n\r\n\t\t\t#main {\r\n\t\t\t\tmax-width: 500px;\r\n\t\t\t\tmin-width: 300px;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-1);\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t}\r\n\r\n\t\t\t#actions {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\tmargin-top: 0.5rem;\r\n\r\n\t\t\t\tuui-icon {\r\n\t\t\t\t\tpadding-right: var(--uui-size-1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tslot[name='actions'] {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tflex: 1;\r\n\t\t\t}\r\n\r\n\t\t\tumb-image-cropper-focus-setter {\r\n\t\t\t\theight: calc(100% - 33px - var(--uui-size-space-1)); /* Temp solution to make room for actions */\r\n\t\t\t}\r\n\r\n\t\t\t#side {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgrid-template-columns: repeat(auto-fill, minmax(100px, 1fr));\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tflex-grow: 1;\r\n\t\t\t\toverflow-y: auto;\r\n\t\t\t\theight: fit-content;\r\n\t\t\t\tmax-height: 100%;\r\n\r\n\t\t\t\tumb-image-cropper-preview[active] {\r\n\t\t\t\t\tbackground-color: var(--uui-color-current);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-image-cropper-field': UmbInputImageCropperFieldElement;\r\n\t}\r\n}\r\n","import type { UmbFocalPointModel } from '../../types.js';\r\nimport type { UmbImageCropperFocalPoint } from './types.js';\r\nimport { UmbFocalPointChangeEvent } from './focalpoint-change.event.js';\r\nimport { drag } from '@umbraco-cms/backoffice/external/uui';\r\nimport { clamp } from '@umbraco-cms/backoffice/utils';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\tclassMap,\r\n\tifDefined,\r\n\thtml,\r\n\tnothing,\r\n\tstate,\r\n\tproperty,\r\n\tquery,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\nimport type { PropertyValueMap } from '@umbraco-cms/backoffice/external/lit';\r\n\r\n@customElement('umb-image-cropper-focus-setter')\r\nexport class UmbImageCropperFocusSetterElement extends UmbLitElement {\r\n\t@query('#image')\r\n\timageElement!: HTMLImageElement;\r\n\r\n\t@query('#wrapper')\r\n\twrapperElement?: HTMLElement;\r\n\r\n\t@query('#focal-point')\r\n\tfocalPointElement!: HTMLElement;\r\n\r\n\t@state()\r\n\tprivate _isDraggingGridHandle = false;\r\n\r\n\t@state()\r\n\tprivate coords = { x: 0, y: 0 };\r\n\r\n\t@property({ attribute: false })\r\n\tset focalPoint(value) {\r\n\t\tthis.#focalPoint = value;\r\n\t\tthis.#setFocalPointStyle(this.#focalPoint.left, this.#focalPoint.top);\r\n\t\tthis.#onFocalPointUpdated();\r\n\t}\r\n\tget focalPoint() {\r\n\t\treturn this.#focalPoint;\r\n\t}\r\n\r\n\t#focalPoint: UmbImageCropperFocalPoint = { left: 0.5, top: 0.5 };\r\n\r\n\t@property({ type: Boolean })\r\n\thideFocalPoint = false;\r\n\r\n\t@property({ type: Boolean, reflect: true })\r\n\tdisabled = false;\r\n\r\n\t@property({ type: String })\r\n\tsrc?: string;\r\n\r\n\t#DOT_RADIUS = 8 as const;\r\n\r\n\tprotected override update(changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>): void {\r\n\t\tsuper.update(changedProperties);\r\n\r\n\t\tif (changedProperties.has('src')) {\r\n\t\t\tif (this.src) {\r\n\t\t\t\tthis.#initializeImage();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprotected override firstUpdated(_changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>): void {\r\n\t\tsuper.firstUpdated(_changedProperties);\r\n\r\n\t\tthis.style.setProperty('--dot-radius', `${this.#DOT_RADIUS}px`);\r\n\t}\r\n\r\n\tasync #initializeImage() {\r\n\t\tawait this.updateComplete; // Wait for the @query to be resolved\r\n\r\n\t\tif (!this.hideFocalPoint) {\r\n\t\t\tthis.#setFocalPointStyle(this.focalPoint.left, this.focalPoint.top);\r\n\t\t}\r\n\r\n\t\tthis.imageElement.onload = () => {\r\n\t\t\tif (!this.imageElement || !this.wrapperElement) return;\r\n\t\t\tconst imageAspectRatio = this.imageElement.naturalWidth / this.imageElement.naturalHeight;\r\n\t\t\tconst hostRect = this.getBoundingClientRect();\r\n\t\t\tconst image = this.imageElement.getBoundingClientRect();\r\n\r\n\t\t\tif (image.width > hostRect.width) {\r\n\t\t\t\tthis.imageElement.style.width = '100%';\r\n\t\t\t}\r\n\t\t\tif (image.height > hostRect.height) {\r\n\t\t\t\tthis.imageElement.style.height = '100%';\r\n\t\t\t}\r\n\r\n\t\t\tthis.#resetCoords();\r\n\r\n\t\t\tthis.imageElement.style.aspectRatio = `${imageAspectRatio}`;\r\n\t\t\tthis.wrapperElement.style.aspectRatio = `${imageAspectRatio}`;\r\n\t\t};\r\n\t}\r\n\r\n\t#onFocalPointUpdated() {\r\n\t\tif (this.#isCentered(this.#focalPoint)) {\r\n\t\t\tthis.#resetCoords();\r\n\t\t}\r\n\t}\r\n\r\n\t#setFocalPoint(x: number, y: number, width: number, height: number) {\r\n\t\tconst left = clamp(x / width, 0, 1);\r\n\t\tconst top = clamp(y / height, 0, 1);\r\n\r\n\t\tconst focalPoint = { left, top } as UmbFocalPointModel;\r\n\r\n\t\tthis.dispatchEvent(new UmbFocalPointChangeEvent(focalPoint));\r\n\t}\r\n\r\n\t#setFocalPointStyle(left: number, top: number) {\r\n\t\tif (!this.focalPointElement) return;\r\n\r\n\t\tthis.focalPointElement.style.left = `calc(${left * 100}% - ${this.#DOT_RADIUS}px)`;\r\n\t\tthis.focalPointElement.style.top = `calc(${top * 100}% - ${this.#DOT_RADIUS}px)`;\r\n\t}\r\n\r\n\t#isCentered(focalPoint: UmbImageCropperFocalPoint) {\r\n\t\tif (!this.focalPoint) return;\r\n\r\n\t\treturn focalPoint.left === 0.5 && focalPoint.top === 0.5;\r\n\t}\r\n\r\n\t#resetCoords() {\r\n\t\tif (!this.imageElement) return;\r\n\r\n\t\t// Init x and y coords from half of rendered image size, which is equavalient to focal point { left: 0.5, top: 0.5 }.\r\n\t\tthis.coords.x = this.imageElement?.clientWidth / 2;\r\n\t\tthis.coords.y = this.imageElement.clientHeight / 2;\r\n\t}\r\n\r\n\t#handleGridDrag(event: PointerEvent) {\r\n\t\tif (this.disabled || this.hideFocalPoint) return;\r\n\t\tif (event.button !== 0) {\r\n\t\t\t// This is not a primary mouse button click, so lets not do anything.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst grid = this.wrapperElement;\r\n\t\tconst handle = this.focalPointElement;\r\n\r\n\t\tif (!grid) return;\r\n\r\n\t\tconst { width, height } = grid.getBoundingClientRect();\r\n\r\n\t\thandle?.focus();\r\n\t\tevent.preventDefault();\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tthis._isDraggingGridHandle = true;\r\n\r\n\t\tdrag(grid, {\r\n\t\t\tonMove: (x, y) => {\r\n\t\t\t\t// check if coordinates are not NaN (can happen when dragging outside of the grid)\r\n\t\t\t\tif (isNaN(x) || isNaN(y)) return;\r\n\r\n\t\t\t\tthis.coords.x = x;\r\n\t\t\t\tthis.coords.y = y;\r\n\r\n\t\t\t\tthis.#setFocalPoint(x, y, width, height);\r\n\t\t\t},\r\n\t\t\tonStop: () => (this._isDraggingGridHandle = false),\r\n\t\t\tinitialEvent: event,\r\n\t\t});\r\n\t}\r\n\r\n\t#changeFocalPoint(event: PointerEvent) {\r\n\t\tif (this.disabled || this.hideFocalPoint) return;\r\n\t\tif (event.button !== 0) {\r\n\t\t\t// This is not a primary mouse button click, so lets not do anything.\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst grid = this.wrapperElement;\r\n\t\tconst handle = this.focalPointElement;\r\n\r\n\t\tif (!grid) return;\r\n\r\n\t\thandle?.focus();\r\n\r\n\t\tconst dims = grid.getBoundingClientRect();\r\n\t\tconst defaultView = grid.ownerDocument.defaultView!;\r\n\t\tconst { width, height } = grid.getBoundingClientRect();\r\n\t\tconst offsetX = dims.left + defaultView.scrollX;\r\n\t\tconst offsetY = dims.top + defaultView.scrollY;\r\n\r\n\t\tconst x = event.pageX - offsetX;\r\n\t\tconst y = event.pageY - offsetY;\r\n\t\tthis.#setFocalPoint(x, y, width, height);\r\n\t}\r\n\r\n\t#handleGridKeyDown(event: KeyboardEvent) {\r\n\t\tif (this.disabled || this.hideFocalPoint) return;\r\n\r\n\t\tconst increment = event.shiftKey ? 1 : 10;\r\n\r\n\t\tconst grid = this.wrapperElement;\r\n\t\tif (!grid) return;\r\n\r\n\t\tconst { width, height } = grid.getBoundingClientRect();\r\n\r\n\t\tif (event.key === 'ArrowLeft') {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.coords.x = clamp(this.coords.x - increment, 0, width);\r\n\t\t\tthis.#setFocalPoint(this.coords.x, this.coords.y, width, height);\r\n\t\t}\r\n\r\n\t\tif (event.key === 'ArrowRight') {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.coords.x = clamp(this.coords.x + increment, 0, width);\r\n\t\t\tthis.#setFocalPoint(this.coords.x, this.coords.y, width, height);\r\n\t\t}\r\n\r\n\t\tif (event.key === 'ArrowUp') {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.coords.y = clamp(this.coords.y - increment, 0, height);\r\n\t\t\tthis.#setFocalPoint(this.coords.x, this.coords.y, width, height);\r\n\t\t}\r\n\r\n\t\tif (event.key === 'ArrowDown') {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tthis.coords.y = clamp(this.coords.y + increment, 0, height);\r\n\t\t\tthis.#setFocalPoint(this.coords.x, this.coords.y, width, height);\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this.src) return nothing;\r\n\t\treturn html`\r\n\t\t\t<div\r\n\t\t\t\tid=\"wrapper\"\r\n\t\t\t\t@click=${this.#changeFocalPoint}\r\n\t\t\t\t@mousedown=${this.#handleGridDrag}\r\n\t\t\t\t@touchstart=${this.#handleGridDrag}>\r\n\t\t\t\t<img id=\"image\" @keydown=${() => nothing} src=${this.src} alt=\"\" />\r\n\t\t\t\t<span\r\n\t\t\t\t\tid=\"focal-point\"\r\n\t\t\t\t\tclass=${classMap({ 'focal-point--dragging': this._isDraggingGridHandle, hidden: this.hideFocalPoint })}\r\n\t\t\t\t\ttabindex=${ifDefined(this.disabled ? undefined : '0')}\r\n\t\t\t\t\taria-label=${this.localize.term('general_focalPoint')}\r\n\t\t\t\t\t@keydown=${this.#handleGridKeyDown}>\r\n\t\t\t\t</span>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = css`\r\n\t\t:host {\r\n\t\t\tdisplay: flex;\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100%;\r\n\t\t\tposition: relative;\r\n\t\t\tuser-select: none;\r\n\t\t\tbackground-color: var(--uui-color-surface);\r\n\t\t\toutline: 1px solid var(--uui-color-border);\r\n\t\t}\r\n\t\t/* Wrapper is used to make the focal point position responsive to the image size */\r\n\t\t#wrapper {\r\n\t\t\tposition: relative;\r\n\t\t\tdisplay: flex;\r\n\t\t\tmargin: auto;\r\n\t\t\tmax-width: 100%;\r\n\t\t\tmax-height: 100%;\r\n\t\t\tbox-sizing: border-box;\r\n\t\t\tforced-color-adjust: none;\r\n\t\t}\r\n\t\t:host(:not([hidefocalpoint])) #wrapper {\r\n\t\t\tcursor: crosshair;\r\n\t\t}\r\n\t\t#image {\r\n\t\t\tmargin: auto;\r\n\t\t\tposition: relative;\r\n\t\t}\r\n\t\t#focal-point {\r\n\t\t\tcontent: '';\r\n\t\t\tdisplay: block;\r\n\t\t\tposition: absolute;\r\n\t\t\twidth: calc(2 * var(--dot-radius));\r\n\t\t\theight: calc(2 * var(--dot-radius));\r\n\t\t\ttop: 0;\r\n\t\t\tbox-shadow:\r\n\t\t\t\trgba(0, 0, 0, 0.25) 0px 0px 0px 1px,\r\n\t\t\t\tinset rgba(0, 0, 0, 0.25) 0px 0px 0px 1px;\r\n\t\t\tborder: solid 2px white;\r\n\t\t\tborder-radius: 50%;\r\n\t\t\tpointer-events: none;\r\n\t\t\ttransition: 150ms transform;\r\n\t\t\tbox-sizing: inherit;\r\n\t\t}\r\n\t\t.focal-point--dragging {\r\n\t\t\tcursor: none;\r\n\t\t\ttransform: scale(1.5);\r\n\t\t}\r\n\t\t#focal-point.hidden {\r\n\t\t\tdisplay: none;\r\n\t\t}\r\n\t`;\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-image-cropper-focus-setter': UmbImageCropperFocusSetterElement;\r\n\t}\r\n}\r\n","import type { UmbImageCropperCrop, UmbImageCropperFocalPoint } from './index.js';\r\nimport { calculateExtrapolatedValue, clamp } from '@umbraco-cms/backoffice/utils';\r\nimport { css, html, nothing, customElement, property, query } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\n@customElement('umb-image-cropper-preview')\r\nexport class UmbImageCropperPreviewElement extends UmbLitElement {\r\n\t@query('#image') imageElement!: HTMLImageElement;\r\n\t@query('#container') imageContainerElement!: HTMLImageElement;\r\n\r\n\t@property({ type: Object, attribute: false })\r\n\tcrop?: UmbImageCropperCrop;\r\n\r\n\t@property({ type: String, attribute: false })\r\n\tsrc: string = '';\r\n\r\n\t@property({ type: String })\r\n\tlabel?: string;\r\n\r\n\t@property({ attribute: false })\r\n\tset focalPoint(value) {\r\n\t\tthis.#focalPoint = value;\r\n\t\tthis.#onFocalPointUpdated();\r\n\t}\r\n\tget focalPoint() {\r\n\t\treturn this.#focalPoint;\r\n\t}\r\n\r\n\t#focalPoint: UmbImageCropperFocalPoint = { left: 0.5, top: 0.5 };\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.#initializeCrop();\r\n\t}\r\n\r\n\tasync #initializeCrop() {\r\n\t\tif (!this.crop) return;\r\n\r\n\t\tawait this.updateComplete; // Wait for the @query to be resolved\r\n\t\tawait new Promise((resolve) => (this.imageElement.onload = () => resolve(this.imageElement)));\r\n\r\n\t\tconst container = this.imageContainerElement.getBoundingClientRect();\r\n\t\tconst cropAspectRatio = this.crop.width / this.crop.height;\r\n\t\tconst imageAspectRatio = this.imageElement.naturalWidth / this.imageElement.naturalHeight;\r\n\r\n\t\tlet imageContainerWidth = 0,\r\n\t\t\timageContainerHeight = 0,\r\n\t\t\timageWidth = 0,\r\n\t\t\timageHeight = 0,\r\n\t\t\timageLeft = 0,\r\n\t\t\timageTop = 0;\r\n\r\n\t\tif (cropAspectRatio > 1) {\r\n\t\t\timageContainerWidth = container.width;\r\n\t\t\timageContainerHeight = container.width / cropAspectRatio;\r\n\t\t} else {\r\n\t\t\timageContainerWidth = container.height * cropAspectRatio;\r\n\t\t\timageContainerHeight = container.height;\r\n\t\t}\r\n\r\n\t\tif (this.crop.coordinates) {\r\n\t\t\tif (cropAspectRatio > 1) {\r\n\t\t\t\t// Landscape-oriented cropping\r\n\t\t\t\tconst cropAmount = this.crop.coordinates.x1 + this.crop.coordinates.x2;\r\n\t\t\t\t// Use crop amount to extrapolate the image width from the container width.\r\n\t\t\t\timageWidth = calculateExtrapolatedValue(imageContainerWidth, cropAmount);\r\n\t\t\t\timageHeight = imageWidth / imageAspectRatio;\r\n\t\t\t\t// Move the image up and left from the top and left edges of the container based on the crop coordinates\r\n\t\t\t\timageTop = -imageHeight * this.crop.coordinates.y1;\r\n\t\t\t\timageLeft = -imageWidth * this.crop.coordinates.x1;\r\n\t\t\t} else {\r\n\t\t\t\t// Portrait-oriented cropping\r\n\t\t\t\tconst cropAmount = this.crop.coordinates.y1 + this.crop.coordinates.y2;\r\n\t\t\t\t// Use crop amount to extrapolate the image height from the container height.\r\n\t\t\t\timageHeight = calculateExtrapolatedValue(imageContainerHeight, cropAmount);\r\n\t\t\t\timageWidth = imageHeight * imageAspectRatio;\r\n\t\t\t\t// Move the image up and left from the top and left edges of the container based on the crop coordinates\r\n\t\t\t\timageTop = -imageHeight * this.crop.coordinates.y1;\r\n\t\t\t\timageLeft = -imageWidth * this.crop.coordinates.x1;\r\n\t\t\t}\r\n\r\n\t\t\t//convert to percentages\r\n\t\t\timageTop = (imageTop / imageContainerHeight) * 100;\r\n\t\t\timageLeft = (imageLeft / imageContainerWidth) * 100;\r\n\r\n\t\t\tthis.imageElement.style.top = `${imageTop}%`;\r\n\t\t\tthis.imageElement.style.left = `${imageLeft}%`;\r\n\t\t} else {\r\n\t\t\t// Set the image size to fill the imageContainer while preserving aspect ratio\r\n\t\t\tif (imageAspectRatio > cropAspectRatio) {\r\n\t\t\t\t// image is wider than crop\r\n\t\t\t\timageHeight = imageContainerHeight;\r\n\t\t\t\timageWidth = imageHeight * imageAspectRatio;\r\n\t\t\t} else {\r\n\t\t\t\t// image is taller than crop\r\n\t\t\t\timageWidth = imageContainerWidth;\r\n\t\t\t\timageHeight = imageWidth / imageAspectRatio;\r\n\t\t\t}\r\n\r\n\t\t\tthis.#onFocalPointUpdated(imageWidth, imageHeight, imageContainerWidth, imageContainerHeight);\r\n\t\t}\r\n\r\n\t\tthis.imageContainerElement.style.width = `${imageContainerWidth}px`;\r\n\t\t// this.imageContainerElement.style.height = `${imageContainerHeight}px`;\r\n\t\tthis.imageContainerElement.style.aspectRatio = `${cropAspectRatio}`;\r\n\r\n\t\t// convert to percentages\r\n\t\timageWidth = (imageWidth / imageContainerWidth) * 100;\r\n\t\timageHeight = (imageHeight / imageContainerHeight) * 100;\r\n\r\n\t\tthis.imageElement.style.width = `${imageWidth}%`;\r\n\t\tthis.imageElement.style.height = `${imageHeight}%`;\r\n\t}\r\n\r\n\t#onFocalPointUpdated(imageWidth?: number, imageHeight?: number, containerWidth?: number, containerHeight?: number) {\r\n\t\tif (!this.crop) return;\r\n\t\tif (!this.imageElement || !this.imageContainerElement) return;\r\n\t\tif (this.crop.coordinates) return;\r\n\r\n\t\tif (!imageWidth || !imageHeight) {\r\n\t\t\tconst image = this.imageElement.getBoundingClientRect();\r\n\t\t\timageWidth = image.width;\r\n\t\t\timageHeight = image.height;\r\n\t\t}\r\n\t\tif (!containerWidth || !containerHeight) {\r\n\t\t\tconst container = this.imageContainerElement.getBoundingClientRect();\r\n\t\t\tcontainerWidth = container.width;\r\n\t\t\tcontainerHeight = container.height;\r\n\t\t}\r\n\t\t// position image so that its center is at the focal point\r\n\t\tlet imageLeft = containerWidth / 2 - imageWidth * this.#focalPoint.left;\r\n\t\tlet imageTop = containerHeight / 2 - imageHeight * this.#focalPoint.top;\r\n\t\t// clamp\r\n\t\timageLeft = clamp(imageLeft, containerWidth - imageWidth, 0);\r\n\t\timageTop = clamp(imageTop, containerHeight - imageHeight, 0);\r\n\r\n\t\t// convert to percentages\r\n\t\timageLeft = (imageLeft / containerWidth) * 100;\r\n\t\timageTop = (imageTop / containerHeight) * 100;\r\n\r\n\t\tthis.imageElement.style.top = `${imageTop}%`;\r\n\t\tthis.imageElement.style.left = `${imageLeft}%`;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this.crop) {\r\n\t\t\treturn html`<span id=\"label\">${this.label}</span>`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<div id=\"container\">\r\n\t\t\t\t<img id=\"image\" src=${this.src} alt=\"\" />\r\n\t\t\t</div>\r\n\t\t\t<span id=\"alias\">\r\n\t\t\t\t${this.crop.label !== undefined ? this.localize.string(this.crop.label) : (this.label ?? this.crop.alias)}\r\n\t\t\t</span>\r\n\t\t\t<span id=\"dimensions\">${this.crop.width} x ${this.crop.height}</span>\r\n\t\t\t${this.crop.coordinates\r\n\t\t\t\t? html`<span id=\"user-defined\"><umb-localize key=\"imagecropper_customCrop\">User defined</umb-localize></span>`\r\n\t\t\t\t: nothing}\r\n\t\t`;\r\n\t}\r\n\tstatic override styles = css`\r\n\t\t:host {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column;\r\n\t\t\tpadding: var(--uui-size-space-4);\r\n\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\tbackground-color: var(--uui-color-surface);\r\n\t\t\tcursor: pointer;\r\n\t\t}\r\n\t\t:host(:hover) {\r\n\t\t\tbackground-color: var(--uui-color-surface-alt);\r\n\t\t}\r\n\t\t#container {\r\n\t\t\tdisplay: flex;\r\n\t\t\twidth: 100%;\r\n\t\t\taspect-ratio: 1;\r\n\t\t\toverflow: hidden;\r\n\t\t\tposition: relative;\r\n\t\t\toverflow: hidden;\r\n\t\t\tmargin: auto;\r\n\t\t\tmax-width: 100%;\r\n\t\t\tmax-height: 200px;\r\n\t\t\tuser-select: none;\r\n\t\t}\r\n\t\t#label {\r\n\t\t\tfont-weight: bold;\r\n\t\t}\r\n\t\t#alias {\r\n\t\t\tfont-weight: bold;\r\n\t\t\tmargin-top: var(--uui-size-space-3);\r\n\t\t}\r\n\t\t#dimensions,\r\n\t\t#user-defined {\r\n\t\t\tfont-size: 0.8em;\r\n\t\t}\r\n\t\t#image {\r\n\t\t\tposition: absolute;\r\n\t\t\tpointer-events: none;\r\n\t\t}\r\n\t`;\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-image-cropper-preview': UmbImageCropperPreviewElement;\r\n\t}\r\n}\r\n","import type { UmbImageCropperCrop, UmbImageCropperFocalPoint } from './types.js';\r\nimport { UmbImageCropChangeEvent } from './crop-change.event.js';\r\nimport { calculateExtrapolatedValue, clamp, inverseLerp, lerp } from '@umbraco-cms/backoffice/utils';\r\nimport type { PropertyValueMap } from '@umbraco-cms/backoffice/external/lit';\r\nimport { customElement, property, query, state, css, html } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\n@customElement('umb-image-cropper')\r\nexport class UmbImageCropperElement extends UmbLitElement {\r\n\t@query('#viewport') viewportElement!: HTMLElement;\r\n\t@query('#mask') maskElement!: HTMLElement;\r\n\t@query('#image') imageElement!: HTMLImageElement;\r\n\r\n\t@property({ type: Object, attribute: false }) value?: UmbImageCropperCrop;\r\n\t@property({ type: String }) src: string = '';\r\n\t@property({ attribute: false }) focalPoint: UmbImageCropperFocalPoint = {\r\n\t\tleft: 0.5,\r\n\t\ttop: 0.5,\r\n\t};\r\n\t@property({ type: Number })\r\n\tget zoom() {\r\n\t\treturn this._zoom;\r\n\t}\r\n\tset zoom(value) {\r\n\t\t// Calculate the delta value - the value the zoom has changed b\r\n\t\tconst delta = value - this._zoom;\r\n\t\tthis.#updateImageScale(delta);\r\n\t}\r\n\r\n\t@state() _zoom = 0;\r\n\r\n\t#VIEWPORT_PADDING = 50 as const;\r\n\t#MAX_SCALE_FACTOR = 4 as const;\r\n\t#SCROLL_ZOOM_SPEED = 0.001 as const;\r\n\r\n\t#minImageScale = 0;\r\n\t#maxImageScale = 0;\r\n\t#oldImageScale = 0;\r\n\t#isDragging = false;\r\n\t#mouseOffsetX = 0;\r\n\t#mouseOffsetY = 0;\r\n\r\n\tget #getImageScale() {\r\n\t\treturn lerp(this.#minImageScale, this.#maxImageScale, this._zoom);\r\n\t}\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.#initializeCrop();\r\n\t\tthis.#addEventListeners();\r\n\t}\r\n\r\n\toverride disconnectedCallback() {\r\n\t\tsuper.disconnectedCallback();\r\n\t\tthis.#removeEventListeners();\r\n\t}\r\n\r\n\tasync #addEventListeners() {\r\n\t\tawait this.updateComplete;\r\n\t\tthis.imageElement.addEventListener('mousedown', this.#onStartDrag);\r\n\t\tthis.addEventListener('wheel', this.#onWheel, { passive: false }); //\r\n\t}\r\n\r\n\t#removeEventListeners() {\r\n\t\tthis.imageElement.removeEventListener('mousedown', this.#onStartDrag);\r\n\t\tthis.removeEventListener('wheel', this.#onWheel);\r\n\t}\r\n\r\n\tprotected override updated(_changedProperties: PropertyValueMap<any> | Map<PropertyKey, unknown>): void {\r\n\t\tsuper.updated(_changedProperties);\r\n\r\n\t\tif (_changedProperties.has('value')) {\r\n\t\t\tthis.#initializeCrop();\r\n\t\t}\r\n\t}\r\n\r\n\tasync #initializeCrop() {\r\n\t\tif (!this.value) return;\r\n\r\n\t\tawait this.updateComplete; // Wait for the @query to be resolved\r\n\r\n\t\tif (!this.imageElement.complete) {\r\n\t\t\t// Wait for the image to load\r\n\t\t\tawait new Promise((resolve) => (this.imageElement.onload = () => resolve(this.imageElement)));\r\n\t\t}\r\n\r\n\t\tconst viewportWidth = this.viewportElement.clientWidth;\r\n\t\tconst viewportHeight = this.viewportElement.clientHeight;\r\n\r\n\t\tconst viewportAspectRatio = viewportWidth / viewportHeight;\r\n\t\tconst cropAspectRatio = this.value.width / this.value.height;\r\n\r\n\t\t// Init variables\r\n\t\tlet maskWidth = 0,\r\n\t\t\tmaskHeight = 0,\r\n\t\t\timageWidth = 0,\r\n\t\t\timageHeight = 0,\r\n\t\t\timageLeft = 0,\r\n\t\t\timageTop = 0;\r\n\r\n\t\t// NOTE {} are used to keep some variables in scope, preventing them from being used outside.\r\n\r\n\t\t{\r\n\t\t\t// Calculate mask size\r\n\t\t\tconst viewportPadding = 2 * this.#VIEWPORT_PADDING;\r\n\t\t\tconst availableWidth = viewportWidth - viewportPadding;\r\n\t\t\tconst availableHeight = viewportHeight - viewportPadding;\r\n\r\n\t\t\tconst isCropWider = cropAspectRatio > viewportAspectRatio;\r\n\r\n\t\t\tmaskWidth = isCropWider ? availableWidth : availableHeight * cropAspectRatio;\r\n\t\t\tmaskHeight = isCropWider ? availableWidth / cropAspectRatio : availableHeight;\r\n\t\t}\r\n\r\n\t\t// Center the mask within the viewport\r\n\t\tconst maskLeft = (viewportWidth - maskWidth) / 2;\r\n\t\tconst maskTop = (viewportHeight - maskHeight) / 2;\r\n\r\n\t\tthis.maskElement.style.width = `${maskWidth}px`;\r\n\t\tthis.maskElement.style.height = `${maskHeight}px`;\r\n\t\tthis.maskElement.style.left = `${maskLeft}px`;\r\n\t\tthis.maskElement.style.top = `${maskTop}px`;\r\n\r\n\t\t{\r\n\t\t\t// Calculate the scaling factors to fill the mask area while preserving aspect ratio\r\n\t\t\tconst scaleX = maskWidth / this.imageElement.naturalWidth;\r\n\t\t\tconst scaleY = maskHeight / this.imageElement.naturalHeight;\r\n\t\t\tconst scale = Math.max(scaleX, scaleY);\r\n\t\t\tthis.#minImageScale = scale;\r\n\t\t\tthis.#maxImageScale = scale * this.#MAX_SCALE_FACTOR;\r\n\t\t}\r\n\r\n\t\t// Calculate the image size and position\r\n\t\tif (this.value.coordinates) {\r\n\t\t\tconst imageAspectRatio = this.imageElement.naturalWidth / this.imageElement.naturalHeight;\r\n\r\n\t\t\tif (cropAspectRatio > 1) {\r\n\t\t\t\t// Landscape-oriented cropping\r\n\t\t\t\tconst cropAmount = this.value.coordinates.x1 + this.value.coordinates.x2;\r\n\t\t\t\t// Use crop amount to extrapolate the image width from the mask width.\r\n\t\t\t\timageWidth = calculateExtrapolatedValue(maskWidth, cropAmount);\r\n\t\t\t\timageHeight = imageWidth / imageAspectRatio;\r\n\t\t\t\t// Move the image up and left from the top and left edges of the mask based on the crop coordinates\r\n\t\t\t\timageLeft = -imageWidth * this.value.coordinates.x1 + maskLeft;\r\n\t\t\t\timageTop = -imageHeight * this.value.coordinates.y1 + maskTop;\r\n\t\t\t} else {\r\n\t\t\t\t// Portrait-oriented cropping\r\n\t\t\t\tconst cropAmount = this.value.coordinates.y1 + this.value.coordinates.y2;\r\n\t\t\t\t// Use crop amount to extrapolate the image height from the mask height.\r\n\t\t\t\timageHeight = calculateExtrapolatedValue(maskHeight, cropAmount);\r\n\t\t\t\timageWidth = imageHeight * imageAspectRatio;\r\n\t\t\t\t// Move the image up and left from the top and left edges of the mask based on the crop coordinates\r\n\t\t\t\timageLeft = -imageWidth * this.value.coordinates.x1 + maskLeft;\r\n\t\t\t\timageTop = -imageHeight * this.value.coordinates.y1 + maskTop;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Set the image size to fill the mask while preserving aspect ratio\r\n\t\t\timageWidth = this.imageElement.naturalWidth * this.#minImageScale;\r\n\t\t\timageHeight = this.imageElement.naturalHeight * this.#minImageScale;\r\n\r\n\t\t\t// position image so that its center is at the focal point\r\n\t\t\timageLeft = maskLeft + maskWidth / 2 - imageWidth * this.focalPoint.left;\r\n\t\t\timageTop = maskTop + maskHeight / 2 - imageHeight * this.focalPoint.top;\r\n\r\n\t\t\t// clamp image position so it stays within the mask\r\n\t\t\tconst minLeft = maskLeft + maskWidth - imageWidth;\r\n\t\t\tconst minTop = maskTop + maskHeight - imageHeight;\r\n\t\t\timageLeft = clamp(imageLeft, minLeft, maskLeft);\r\n\t\t\timageTop = clamp(imageTop, minTop, maskTop);\r\n\t\t}\r\n\r\n\t\tthis.imageElement.style.left = `${imageLeft}px`;\r\n\t\tthis.imageElement.style.top = `${imageTop}px`;\r\n\t\tthis.imageElement.style.width = `${imageWidth}px`;\r\n\t\tthis.imageElement.style.height = `${imageHeight}px`;\r\n\r\n\t\tconst currentScaleX = imageWidth / this.imageElement.naturalWidth;\r\n\t\tconst currentScaleY = imageHeight / this.imageElement.naturalHeight;\r\n\t\tconst currentScale = Math.max(currentScaleX, currentScaleY);\r\n\t\t// Calculate the zoom level based on the current scale\r\n\t\t// This finds the alpha value in the range of min and max scale.\r\n\t\tthis._zoom = inverseLerp(this.#minImageScale, this.#maxImageScale, currentScale);\r\n\t}\r\n\r\n\t#updateImageScale(amount: number, mouseX?: number, mouseY?: number) {\r\n\t\tthis.#oldImageScale = this.#getImageScale;\r\n\t\tthis._zoom = clamp(this._zoom + amount, 0, 1);\r\n\t\tconst newImageScale = this.#getImageScale;\r\n\r\n\t\tconst mask = this.maskElement.getBoundingClientRect();\r\n\t\tconst image = this.imageElement.getBoundingClientRect();\r\n\r\n\t\tlet fixedLocation = { left: 0, top: 0 };\r\n\r\n\t\t// If mouse position is provided, use that as the fixed location\r\n\t\t// Else use the center of the mask\r\n\t\tif (mouseX && mouseY) {\r\n\t\t\tfixedLocation = this.#toLocalPosition(mouseX, mouseY);\r\n\t\t} else {\r\n\t\t\tfixedLocation = this.#toLocalPosition(mask.left + mask.width / 2, mask.top + mask.height / 2);\r\n\t\t}\r\n\r\n\t\tconst imageLocalPosition = this.#toLocalPosition(image.left, image.top);\r\n\t\t// Calculate the new image position while keeping the fixed location in the same position\r\n\t\tconst imageLeft =\r\n\t\t\tfixedLocation.left - (fixedLocation.left - imageLocalPosition.left) * (newImageScale / this.#oldImageScale);\r\n\t\tconst imageTop =\r\n\t\t\tfixedLocation.top - (fixedLocation.top - imageLocalPosition.top) * (newImageScale / this.#oldImageScale);\r\n\r\n\t\tthis.imageElement.style.width = `${this.imageElement.naturalWidth * newImageScale}px`;\r\n\t\tthis.imageElement.style.height = `${this.imageElement.naturalHeight * newImageScale}px`;\r\n\r\n\t\tthis.#updateImagePosition(imageTop, imageLeft);\r\n\t}\r\n\r\n\t#updateImagePosition(top: number, left: number) {\r\n\t\tconst mask = this.maskElement.getBoundingClientRect();\r\n\t\tconst image = this.imageElement.getBoundingClientRect();\r\n\r\n\t\t// Calculate the minimum and maximum image positions\r\n\t\tconst minLeft = this.#toLocalPosition(mask.left + mask.width - image.width, 0).left;\r\n\t\tconst maxLeft = this.#toLocalPosition(mask.left, 0).left;\r\n\t\tconst minTop = this.#toLocalPosition(0, mask.top + mask.height - image.height).top;\r\n\t\tconst maxTop = this.#toLocalPosition(0, mask.top).top;\r\n\r\n\t\t// Clamp the image position to the min and max values\r\n\t\tleft = clamp(left, minLeft, maxLeft);\r\n\t\ttop = clamp(top, minTop, maxTop);\r\n\r\n\t\tthis.imageElement.style.left = `${left}px`;\r\n\t\tthis.imageElement.style.top = `${top}px`;\r\n\t}\r\n\r\n\t#calculateCropCoordinates(): { x1: number; x2: number; y1: number; y2: number } {\r\n\t\tconst cropCoordinates = { x1: 0, y1: 0, x2: 0, y2: 0 };\r\n\r\n\t\tconst mask = this.maskElement.getBoundingClientRect();\r\n\t\tconst image = this.imageElement.getBoundingClientRect();\r\n\r\n\t\tcropCoordinates.x1 = (mask.left - image.left) / image.width;\r\n\t\tcropCoordinates.y1 = (mask.top - image.top) / image.height;\r\n\t\tcropCoordinates.x2 = Math.abs((mask.right - image.right) / image.width);\r\n\t\tcropCoordinates.y2 = Math.abs((mask.bottom - image.bottom) / image.height);\r\n\r\n\t\treturn cropCoordinates;\r\n\t}\r\n\r\n\t#toLocalPosition(left: number, top: number) {\r\n\t\tconst viewport = this.viewportElement.getBoundingClientRect();\r\n\r\n\t\treturn {\r\n\t\t\tleft: left - viewport.left,\r\n\t\t\ttop: top - viewport.top,\r\n\t\t};\r\n\t}\r\n\r\n\t#onSave() {\r\n\t\tif (!this.value) return;\r\n\r\n\t\tconst { x1, x2, y1, y2 } = this.#calculateCropCoordinates();\r\n\t\tthis.value = {\r\n\t\t\t...this.value,\r\n\t\t\tcoordinates: { x1, x2, y1, y2 },\r\n\t\t};\r\n\r\n\t\tthis.dispatchEvent(new UmbImageCropChangeEvent());\r\n\t}\r\n\r\n\t#onCancel() {\r\n\t\t//TODO: How should we handle canceling the crop?\r\n\t\tthis.dispatchEvent(new UmbImageCropChangeEvent());\r\n\t}\r\n\r\n\t#onReset() {\r\n\t\tif (!this.value) return;\r\n\r\n\t\tdelete this.value.coordinates;\r\n\t\tthis.dispatchEvent(new UmbImageCropChangeEvent());\r\n\t}\r\n\r\n\t#onSliderUpdate(event: InputEvent) {\r\n\t\tconst target = event.target as HTMLInputElement;\r\n\t\tthis.zoom = Number(target.value);\r\n\t}\r\n\r\n\t#onStartDrag = (event: MouseEvent) => {\r\n\t\tevent.preventDefault();\r\n\r\n\t\tthis.#isDragging = true;\r\n\t\tconst image = this.imageElement.getBoundingClientRect();\r\n\t\tconst viewport = this.viewportElement.getBoundingClientRect();\r\n\t\tthis.#mouseOffsetX = event.clientX - image.left + viewport.left;\r\n\t\tthis.#mouseOffsetY = event.clientY - image.top + viewport.top;\r\n\r\n\t\twindow.addEventListener('mousemove', this.#onDrag);\r\n\t\twindow.addEventListener('mouseup', this.#onEndDrag);\r\n\t};\r\n\r\n\t#onDrag = (event: MouseEvent) => {\r\n\t\tif (this.#isDragging) {\r\n\t\t\tconst newLeft = event.clientX - this.#mouseOffsetX;\r\n\t\t\tconst newTop = event.clientY - this.#mouseOffsetY;\r\n\r\n\t\t\tthis.#updateImagePosition(newTop, newLeft);\r\n\t\t}\r\n\t};\r\n\r\n\t#onEndDrag = () => {\r\n\t\tthis.#isDragging = false;\r\n\r\n\t\twindow.removeEventListener('mousemove', this.#onDrag);\r\n\t\twindow.removeEventListener('mouseup', this.#onEndDrag);\r\n\t};\r\n\r\n\t#onWheel = (event: WheelEvent) => {\r\n\t\tevent.preventDefault();\r\n\t\tthis.#updateImageScale(event.deltaY * -this.#SCROLL_ZOOM_SPEED, event.clientX, event.clientY);\r\n\t};\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<div id=\"viewport\">\r\n\t\t\t\t<img id=\"image\" src=${this.src} alt=\"\" />\r\n\t\t\t\t<div id=\"mask\"></div>\r\n\t\t\t</div>\r\n\t\t\t<uui-slider\r\n\t\t\t\t@input=${this.#onSliderUpdate}\r\n\t\t\t\t.value=${this._zoom.toString()}\r\n\t\t\t\thide-step-values\r\n\t\t\t\tid=\"slider\"\r\n\t\t\t\ttype=\"range\"\r\n\t\t\t\tmin=\"0\"\r\n\t\t\t\tmax=\"1\"\r\n\t\t\t\tvalue=\"0\"\r\n\t\t\t\tstep=\"0.001\">\r\n\t\t\t</uui-slider>\r\n\t\t\t<div id=\"actions\">\r\n\t\t\t\t<uui-button @click=${this.#onReset} label=\"${this.localize.term('imagecropper_reset')}\"></uui-button>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t@click=${this.#onCancel}\r\n\t\t\t\t\tlabel=\"${this.localize.term('general_cancel')}\"></uui-button>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t@click=${this.#onSave}\r\n\t\t\t\t\tlabel=\"${this.localize.term('buttons_save')}\"></uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = css`\r\n\t\t:host {\r\n\t\t\tdisplay: grid;\r\n\t\t\tgrid-template-rows: 1fr auto auto;\r\n\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\theight: 100%;\r\n\t\t\twidth: 100%;\r\n\t\t}\r\n\t\t#viewport {\r\n\t\t\tbackground-color: #fff;\r\n\t\t\tbackground-image: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\" fill-opacity=\".1\"><path d=\"M50 0h50v50H50zM0 50h50v50H0z\"/></svg>');\r\n\t\t\tbackground-repeat: repeat;\r\n\t\t\tbackground-size: 10px 10px;\r\n\t\t\tcontain: strict;\r\n\t\t\toverflow: hidden;\r\n\t\t\tposition: relative;\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 100%;\r\n\t\t\toutline: 1px solid var(--uui-color-border);\r\n\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t}\r\n\t\t#actions {\r\n\t\t\tdisplay: flex;\r\n\t\t\tjustify-content: flex-end;\r\n\t\t\tgap: var(--uui-size-space-1);\r\n\t\t\tmargin-top: 0.5rem;\r\n\t\t}\r\n\r\n\t\t#mask {\r\n\t\t\tdisplay: block;\r\n\t\t\tposition: absolute;\r\n\t\t\tbox-shadow: 0 0 0 2000px hsla(0, 0%, 100%, 0.8);\r\n\t\t\tpointer-events: none;\r\n\t\t}\r\n\r\n\t\t#image {\r\n\t\t\tdisplay: block;\r\n\t\t\tposition: absolute;\r\n\t\t\tuser-select: none;\r\n\t\t}\r\n\r\n\t\t#viewport #image {\r\n\t\t\tcursor: move;\r\n\t\t}\r\n\r\n\t\t#slider {\r\n\t\t\twidth: 100%;\r\n\t\t\theight: 0px; /* TODO: FIX - This is needed to prevent the slider from taking up more space than needed */\r\n\t\t\tmin-height: 22px; /* TODO: FIX - This is needed to prevent the slider from taking up more space than needed */\r\n\t\t}\r\n\t`;\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-image-cropper': UmbImageCropperElement;\r\n\t}\r\n}\r\n","import type { UmbImageCropperPropertyEditorValue } from './types.js';\r\nimport type { UmbInputImageCropperFieldElement } from './image-cropper-field.element.js';\r\nimport { css, customElement, html, ifDefined, property, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { assignToFrozenObject } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbFileDropzoneItemStatus } from '@umbraco-cms/backoffice/dropzone';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbTemporaryFileConfigRepository } from '@umbraco-cms/backoffice/temporary-file';\r\nimport { UMB_VALIDATION_EMPTY_LOCALIZATION_KEY, UmbFormControlMixin } from '@umbraco-cms/backoffice/validation';\r\nimport type {\r\n\tUmbDropzoneChangeEvent,\r\n\tUmbInputDropzoneElement,\r\n\tUmbUploadableItem,\r\n} from '@umbraco-cms/backoffice/dropzone';\r\n\r\nimport './image-cropper-field.element.js';\r\nimport './image-cropper-focus-setter.element.js';\r\nimport './image-cropper-preview.element.js';\r\nimport './image-cropper.element.js';\r\n\r\nconst DefaultFocalPoint = { left: 0.5, top: 0.5 };\r\nconst DefaultValue: UmbImageCropperPropertyEditorValue = {\r\n\ttemporaryFileId: null,\r\n\tsrc: '',\r\n\tcrops: [],\r\n\tfocalPoint: DefaultFocalPoint,\r\n};\r\n\r\n@customElement('umb-input-image-cropper')\r\nexport class UmbInputImageCropperElement extends UmbFormControlMixin<\r\n\tUmbImageCropperPropertyEditorValue,\r\n\ttypeof UmbLitElement,\r\n\tundefined\r\n>(UmbLitElement, undefined) {\r\n\t/**\r\n\t * Sets the input to required, meaning validation will fail if the value is empty.\r\n\t * @type {boolean}\r\n\t */\r\n\t@property({ type: Boolean })\r\n\trequired?: boolean;\r\n\r\n\t@property({ type: String })\r\n\trequiredMessage?: string;\r\n\r\n\t@property({ attribute: false })\r\n\tcrops: UmbImageCropperPropertyEditorValue['crops'] = [];\r\n\r\n\t@state()\r\n\tprivate _file?: UmbUploadableItem;\r\n\r\n\t@state()\r\n\tprivate _accept?: string;\r\n\r\n\t@state()\r\n\tprivate _loading = true;\r\n\r\n\t#config = new UmbTemporaryFileConfigRepository(this);\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.addValidator(\r\n\t\t\t'valueMissing',\r\n\t\t\t() => this.requiredMessage ?? UMB_VALIDATION_EMPTY_LOCALIZATION_KEY,\r\n\t\t\t() => {\r\n\t\t\t\treturn !!this.required && (!this.value || (this.value.src === '' && this.value.temporaryFileId == null));\r\n\t\t\t},\r\n\t\t);\r\n\t}\r\n\r\n\tprotected override firstUpdated(): void {\r\n\t\tthis.#mergeCrops();\r\n\t\tthis.#observeAcceptedFileTypes();\r\n\t}\r\n\r\n\tasync #observeAcceptedFileTypes() {\r\n\t\tawait this.#config.initialized;\r\n\t\tthis.observe(\r\n\t\t\tthis.#config.part('imageFileTypes'),\r\n\t\t\t(imageFileTypes) => {\r\n\t\t\t\tthis._accept = imageFileTypes.join(',');\r\n\t\t\t\tthis._loading = false;\r\n\t\t\t},\r\n\t\t\t'_observeFileTypes',\r\n\t\t);\r\n\t}\r\n\r\n\t#onUpload(e: UmbDropzoneChangeEvent) {\r\n\t\te.stopImmediatePropagation();\r\n\r\n\t\tconst target = e.target as UmbInputDropzoneElement;\r\n\t\tconst file = target.value?.[0];\r\n\r\n\t\tif (file?.status !== UmbFileDropzoneItemStatus.COMPLETE) return;\r\n\r\n\t\tthis._file = file;\r\n\r\n\t\tthis.value = assignToFrozenObject(this.value ?? DefaultValue, {\r\n\t\t\ttemporaryFileId: file.temporaryFile?.temporaryUnique,\r\n\t\t});\r\n\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\t#onRemove = () => {\r\n\t\tthis.value = undefined;\r\n\t\tthis._file?.temporaryFile?.abortController?.abort();\r\n\t\tthis._file = undefined;\r\n\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t};\r\n\r\n\t#mergeCrops() {\r\n\t\tif (this.value) {\r\n\t\t\t// Replace crops from the value with the crops from the config while keeping the coordinates from the value if they exist.\r\n\t\t\tconst filteredCrops = this.crops.map((crop) => {\r\n\t\t\t\tconst cropFromValue = this.value!.crops.find((valueCrop) => valueCrop.alias === crop.alias);\r\n\t\t\t\tconst result = {\r\n\t\t\t\t\t...crop,\r\n\t\t\t\t\tcoordinates: cropFromValue?.coordinates ?? undefined,\r\n\t\t\t\t};\r\n\r\n\t\t\t\treturn result;\r\n\t\t\t});\r\n\r\n\t\t\tthis.value = {\r\n\t\t\t\t...this.value,\r\n\t\t\t\tcrops: filteredCrops,\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (this._loading) {\r\n\t\t\treturn html`<div id=\"loader\"><uui-loader></uui-loader></div>`;\r\n\t\t}\r\n\r\n\t\tif (this.value?.src || this._file) {\r\n\t\t\treturn this.#renderImageCropper();\r\n\t\t}\r\n\r\n\t\treturn this.#renderDropzone();\r\n\t}\r\n\r\n\t#renderDropzone() {\r\n\t\treturn html`\r\n\t\t\t<umb-input-dropzone\r\n\t\t\t\tstandalone\r\n\t\t\t\taccept=${ifDefined(this._accept)}\r\n\t\t\t\tdisable-folder-upload\r\n\t\t\t\t@change=\"${this.#onUpload}\"></umb-input-dropzone>\r\n\t\t`;\r\n\t}\r\n\r\n\t#onChange(e: CustomEvent) {\r\n\t\tconst value = (e.target as UmbInputImageCropperFieldElement).value;\r\n\r\n\t\tif (!value) {\r\n\t\t\tthis.value = undefined;\r\n\t\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (this.value && this.value.temporaryFileId) {\r\n\t\t\tvalue.temporaryFileId = this.value.temporaryFileId;\r\n\t\t}\r\n\r\n\t\tif (value.temporaryFileId || value.src !== '') {\r\n\t\t\tthis.value = value;\r\n\t\t}\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\t#renderImageCropper() {\r\n\t\treturn html`\r\n\t\t\t<umb-image-cropper-field .value=${this.value} .file=${this._file?.temporaryFile?.file} @change=${this.#onChange}>\r\n\t\t\t\t<uui-button slot=\"actions\" compact label=${this.localize.term('content_uploadClear')} @click=${this.#onRemove}>\r\n\t\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t\t<umb-localize key=\"content_uploadClear\">Remove file(s)</umb-localize>\r\n\t\t\t\t</uui-button>\r\n\t\t\t</umb-image-cropper-field>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\tumb-input-dropzone {\r\n\t\t\t\tmax-width: 500px;\r\n\t\t\t\tmin-width: 300px;\r\n\t\t\t}\r\n\r\n\t\t\t#loader {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t}\r\n\r\n\t\t\t[slot='actions'] {\r\n\t\t\t\tuui-icon {\r\n\t\t\t\t\tpadding-right: var(--uui-size-1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-input-image-cropper': UmbInputImageCropperElement;\r\n\t}\r\n}\r\n","import type { UmbMediaCollectionContext } from './media-collection.context.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_MEDIA_COLLECTION_CONTEXT = new UmbContextToken<UmbMediaCollectionContext>('UmbCollectionContext');\r\n","import type { UmbEntityModel } from '@umbraco-cms/backoffice/entity';\r\nimport { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport interface UmbMediaCreateOptionsModalData {\r\n\tparent: UmbEntityModel;\r\n\tmediaType: {\r\n\t\tunique: string;\r\n\t} | null;\r\n}\r\n\r\n// eslint-disable-next-line @typescript-eslint/no-empty-object-type\r\nexport interface UmbMediaCreateOptionsModalValue {}\r\n\r\nexport const UMB_MEDIA_CREATE_OPTIONS_MODAL = new UmbModalToken<\r\n\tUmbMediaCreateOptionsModalData,\r\n\tUmbMediaCreateOptionsModalValue\r\n>('Umb.Modal.Media.CreateOptions', {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'small',\r\n\t},\r\n});\r\n","import { UmbInputImageCropperFieldElement } from '../../../components/input-image-cropper/image-cropper-field.element.js';\r\nimport { css, customElement, html } from '@umbraco-cms/backoffice/external/lit';\r\n\r\n@customElement('umb-image-cropper-editor-field')\r\nexport class UmbImageCropperEditorFieldElement extends UmbInputImageCropperFieldElement {\r\n\t#resetCurrentCrop() {\r\n\t\tthis.currentCrop = undefined;\r\n\t}\r\n\r\n\toverride renderSide() {\r\n\t\tif (!this.value || !this.crops) return;\r\n\t\treturn html`\r\n\t\t\t<umb-image-cropper-preview\r\n\t\t\t\t.label=${this.localize.term('general_media')}\r\n\t\t\t\t?active=${!this.currentCrop}\r\n\t\t\t\t@click=${this.#resetCurrentCrop}>\r\n\t\t\t</umb-image-cropper-preview>\r\n\t\t\t${super.renderSide()}\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\t...super.styles,\r\n\t\tcss`\r\n\t\t\t#main {\r\n\t\t\t\tmax-width: unset;\r\n\t\t\t\tmin-width: unset;\r\n\t\t\t}\r\n\r\n\t\t\t#side {\r\n\t\t\t\tflex: none;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-image-cropper-editor-field': UmbImageCropperEditorFieldElement;\r\n\t}\r\n}\r\n","import type { UmbMediaItemModel } from '../../repository/types.js';\r\nimport type { UmbTreePickerModalData } from '@umbraco-cms/backoffice/tree';\r\nimport { UmbModalToken, type UmbPickerModalValue } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport type UmbMediaPickerModalData = UmbTreePickerModalData<UmbMediaItemModel>;\r\nexport type UmbMediaPickerModalValue = UmbPickerModalValue;\r\n\r\nexport const UMB_MEDIA_PICKER_MODAL = new UmbModalToken<UmbMediaPickerModalData, UmbMediaPickerModalValue>(\r\n\t'Umb.Modal.MediaPicker',\r\n\t{\r\n\t\tmodal: {\r\n\t\t\ttype: 'sidebar',\r\n\t\t\tsize: 'medium',\r\n\t\t},\r\n\t},\r\n);\r\n","import { UMB_MEDIA_PICKER_MODAL } from '../media-picker/media-picker-modal.token.js';\r\nimport { UmbMediaUrlRepository } from '../../url/index.js';\r\nimport type { UmbCropModel, UmbMediaItemModel } from '../../types.js';\r\nimport type { UmbImageCropperPropertyEditorValue } from '../../components/index.js';\r\nimport type { UmbInputImageCropperFieldElement } from '../../components/input-image-cropper/image-cropper-field.element.js';\r\nimport type {\r\n\tUmbImageCropperEditorModalData,\r\n\tUmbImageCropperEditorModalValue,\r\n} from './image-cropper-editor-modal.token.js';\r\nimport { css, customElement, html, nothing, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbModalRouteRegistrationController } from '@umbraco-cms/backoffice/router';\r\nimport { UmbTemporaryFileConfigRepository } from '@umbraco-cms/backoffice/temporary-file';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UMB_MODAL_MANAGER_CONTEXT, UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_WORKSPACE_MODAL } from '@umbraco-cms/backoffice/workspace';\r\nimport type { UmbModalManagerContext } from '@umbraco-cms/backoffice/modal';\r\n\r\n@customElement('umb-image-cropper-editor-modal')\r\nexport class UmbImageCropperEditorModalElement extends UmbModalBaseElement<\r\n\tUmbImageCropperEditorModalData<any>,\r\n\tUmbImageCropperEditorModalValue\r\n> {\r\n\t#urlRepository = new UmbMediaUrlRepository(this);\r\n\r\n\t@state()\r\n\tprivate _imageCropperValue?: UmbImageCropperPropertyEditorValue;\r\n\r\n\t@state()\r\n\tprivate _key: string = '';\r\n\r\n\t@state()\r\n\tprivate _unique: string = '';\r\n\r\n\t@state()\r\n\tprivate _hideFocalPoint = false;\r\n\r\n\t@state()\r\n\tprivate _crops: Array<UmbCropModel> = [];\r\n\r\n\t@state()\r\n\tprivate _editMediaPath = '';\r\n\r\n\t@state()\r\n\tprivate _pickableFilter?: (item: UmbMediaItemModel) => boolean;\r\n\r\n\t@state()\r\n\tprivate _isCroppable = false;\r\n\r\n\t#config = new UmbTemporaryFileConfigRepository(this);\r\n\r\n\t#imageFileTypes?: Array<string>;\r\n\r\n\t#modalManager?: UmbModalManagerContext;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (context) => {\r\n\t\t\tthis.#modalManager = context;\r\n\t\t});\r\n\r\n\t\tnew UmbModalRouteRegistrationController(this, UMB_WORKSPACE_MODAL)\r\n\t\t\t.addAdditionalPath('media')\r\n\t\t\t.onSetup(() => {\r\n\t\t\t\treturn { data: { entityType: 'media', preset: {} } };\r\n\t\t\t})\r\n\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\tthis._editMediaPath = routeBuilder({});\r\n\t\t\t});\r\n\t}\r\n\r\n\toverride connectedCallback(): void {\r\n\t\tsuper.connectedCallback();\r\n\r\n\t\tthis._key = this.data?.key ?? '';\r\n\t\tthis._unique = this.data?.unique ?? '';\r\n\r\n\t\tthis._hideFocalPoint = this.data?.hideFocalPoint ?? false;\r\n\t\tthis._crops = this.data?.cropOptions ?? [];\r\n\t\tthis._pickableFilter = this.data?.pickableFilter;\r\n\r\n\t\tthis.#observeAcceptedFileTypes();\r\n\t\tthis.#getSrc();\r\n\t}\r\n\r\n\tasync #observeAcceptedFileTypes() {\r\n\t\tawait this.#config.initialized;\r\n\t\tthis.observe(\r\n\t\t\tthis.#config.part('imageFileTypes'),\r\n\t\t\t(imageFileTypes) => (this.#imageFileTypes = imageFileTypes),\r\n\t\t\t'_observeFileTypes',\r\n\t\t);\r\n\t}\r\n\r\n\tasync #getSrc() {\r\n\t\tconst { data } = await this.#urlRepository.requestItems([this._unique]);\r\n\t\tconst item = data?.[0];\r\n\r\n\t\tif (!item?.url) {\r\n\t\t\tthis._isCroppable = false;\r\n\t\t\tthis._imageCropperValue = undefined;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (item.extension && this.#imageFileTypes?.includes(item.extension)) {\r\n\t\t\tthis._isCroppable = true;\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Combine the crops from the property editor with the stored crops and ignore any invalid crops\r\n\t\t * (e.g. crops that have been removed from the property editor)\r\n\t\t * @remark If a crop is removed from the property editor, it will be ignored and not saved\r\n\t\t */\r\n\t\tconst crops: Array<UmbCropModel> = this._crops.map((crop) => {\r\n\t\t\tconst existingCrop = this.value.crops?.find((c) => c.alias === crop.alias);\r\n\t\t\treturn existingCrop ? { ...crop, ...existingCrop } : crop;\r\n\t\t});\r\n\r\n\t\tconst value: UmbImageCropperPropertyEditorValue = {\r\n\t\t\t...this.value,\r\n\t\t\tsrc: item.url,\r\n\t\t\tcrops,\r\n\t\t\tfocalPoint: this.value.focalPoint ?? { left: 0.5, top: 0.5 },\r\n\t\t};\r\n\t\tthis._imageCropperValue = value;\r\n\t}\r\n\r\n\tasync #openMediaPicker() {\r\n\t\tconst modal = this.#modalManager?.open(this, UMB_MEDIA_PICKER_MODAL, {\r\n\t\t\tdata: { multiple: false, pickableFilter: this._pickableFilter },\r\n\t\t\tvalue: { selection: [this._unique] },\r\n\t\t});\r\n\t\tconst data = await modal?.onSubmit().catch(() => null);\r\n\t\tif (!data) return;\r\n\r\n\t\tconst selected = data.selection[0];\r\n\r\n\t\tif (!selected) {\r\n\t\t\tthrow new Error('No media selected');\r\n\t\t}\r\n\r\n\t\tthis._unique = selected;\r\n\r\n\t\tthis.value = { ...this.value, unique: this._unique };\r\n\r\n\t\tthis._isCroppable = false;\r\n\r\n\t\tthis.#getSrc();\r\n\t}\r\n\r\n\t#onChange(e: CustomEvent & { target: UmbInputImageCropperFieldElement }) {\r\n\t\tconst value = e.target.value;\r\n\t\tif (!value) return;\r\n\r\n\t\tif (this._imageCropperValue) {\r\n\t\t\tthis._imageCropperValue.crops = value.crops;\r\n\t\t\tthis._imageCropperValue.focalPoint = value.focalPoint;\r\n\t\t}\r\n\r\n\t\tthis.value = { key: this._key, unique: this._unique, crops: value.crops, focalPoint: value.focalPoint };\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=${this.localize.term('defaultdialogs_selectMedia')}>\r\n\t\t\t\t<div id=\"layout\">\r\n\t\t\t\t\t${when(\r\n\t\t\t\t\t\tthis._isCroppable,\r\n\t\t\t\t\t\t() => this.#renderImageCropper(),\r\n\t\t\t\t\t\t() => this.#renderFilePreview(),\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div slot=\"actions\">\r\n\t\t\t\t\t<uui-button label=${this.localize.term('general_close')} @click=${this._rejectModal}></uui-button>\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlabel=${this.localize.term('general_submit')}\r\n\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\t@click=${this._submitModal}></uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderActions() {\r\n\t\treturn html`\r\n\t\t\t<uui-button compact label=${this.localize.term('mediaPicker_changeMedia')} @click=${this.#openMediaPicker}>\r\n\t\t\t\t<uui-icon name=\"icon-search\"></uui-icon>\r\n\t\t\t\t<umb-localize key=\"mediaPicker_changeMedia\">Change Media Item</umb-localize>\r\n\t\t\t</uui-button>\r\n\t\t\t<uui-button\r\n\t\t\t\tcompact\r\n\t\t\t\tlabel=${this.localize.term('mediaPicker_openMedia')}\r\n\t\t\t\thref=${this._editMediaPath + 'edit/' + this._unique}>\r\n\t\t\t\t<uui-icon name=\"icon-out\"></uui-icon>\r\n\t\t\t\t<umb-localize key=\"mediaPicker_openMedia\">Open in Media Library</umb-localize>\r\n\t\t\t</uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderImageCropper() {\r\n\t\tif (!this._imageCropperValue) return nothing;\r\n\t\treturn html`\r\n\t\t\t<umb-image-cropper-editor-field\r\n\t\t\t\t.value=${this._imageCropperValue}\r\n\t\t\t\t?hideFocalPoint=${this._hideFocalPoint}\r\n\t\t\t\t@change=${this.#onChange}>\r\n\t\t\t\t<div slot=\"actions\">${this.#renderActions()}</div>\r\n\t\t\t</umb-image-cropper-editor-field>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderFilePreview() {\r\n\t\treturn html`\r\n\t\t\t<div id=\"main\">\r\n\t\t\t\t${when(\r\n\t\t\t\t\tthis._imageCropperValue?.src,\r\n\t\t\t\t\t(path) => html`<umb-file-upload-preview .path=${path}></umb-file-upload-preview>`,\r\n\t\t\t\t\t() => this.#renderFileNotFound(),\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t\t<div id=\"actions\">${this.#renderActions()}</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderFileNotFound() {\r\n\t\tconst args = [this.localize.term('general_media')];\r\n\t\treturn html`\r\n\t\t\t<div class=\"uui-text\">\r\n\t\t\t\t<h4>\r\n\t\t\t\t\t<umb-localize key=\"entityDetail_notFoundTitle\" .args=${args}>Item not found</umb-localize>\r\n\t\t\t\t</h4>\r\n\t\t\t\t<umb-localize key=\"entityDetail_notFoundDescription\">The requested item could not be found.</umb-localize>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#layout {\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t}\r\n\r\n\t\t\tumb-image-cropper-editor-field {\r\n\t\t\t\tflex: 1;\r\n\t\t\t}\r\n\r\n\t\t\t#main {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\t\t\t\toutline: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t#actions {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tmargin-top: 0.5rem;\r\n\r\n\t\t\t\tuui-icon {\r\n\t\t\t\t\tpadding-right: var(--uui-size-1);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t.uui-text {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\n/** @deprecated Should be exported as `element` only; to be removed in Umbraco 18. */\r\nexport default UmbImageCropperEditorModalElement;\r\n\r\nexport { UmbImageCropperEditorModalElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-image-cropper-editor-modal': UmbImageCropperEditorModalElement;\r\n\t}\r\n}\r\n","import type { UmbImageCropperCrop } from '../../components/index.js';\r\nimport type { UmbCropModel } from '../../property-editors/types.js';\r\nimport { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport interface UmbImageCropperEditorModalData<ItemType> {\r\n\tkey: string;\r\n\tunique: string;\r\n\thideFocalPoint: boolean;\r\n\tcropOptions: Array<UmbCropModel>;\r\n\tpickableFilter?: (item: ItemType) => boolean;\r\n}\r\n\r\nexport interface UmbImageCropperEditorModalValue {\r\n\tkey: string;\r\n\tunique: string;\r\n\tcrops: Array<UmbImageCropperCrop>;\r\n\tfocalPoint: { left: number; top: number };\r\n}\r\n\r\nexport const UMB_IMAGE_CROPPER_EDITOR_MODAL = new UmbModalToken<\r\n\tUmbImageCropperEditorModalData<any>,\r\n\tUmbImageCropperEditorModalValue\r\n>('Umb.Modal.ImageCropperEditor', {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'full',\r\n\t},\r\n});\r\n","import { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport interface UmbMediaCaptionAltTextModalData {\r\n\tmediaUnique: string;\r\n}\r\n\r\nexport type UmbMediaCaptionAltTextModalValue = {\r\n\taltText?: string;\r\n\tcaption?: string;\r\n\turl: string;\r\n};\r\n\r\nexport const UMB_MEDIA_CAPTION_ALT_TEXT_MODAL = new UmbModalToken<\r\n\tUmbMediaCaptionAltTextModalData,\r\n\tUmbMediaCaptionAltTextModalValue\r\n>('Umb.Modal.MediaCaptionAltText', {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'small',\r\n\t},\r\n});\r\n","export const UMB_MEDIA_ENTITY_TYPE = 'media';\r\nexport const UMB_MEDIA_ROOT_ENTITY_TYPE = 'media-root';\r\nexport const UMB_MEDIA_PLACEHOLDER_ENTITY_TYPE = 'umb-media-placeholder';\r\n\r\nexport type UmbMediaEntityType = typeof UMB_MEDIA_ENTITY_TYPE;\r\nexport type UmbMediaRootEntityType = typeof UMB_MEDIA_ROOT_ENTITY_TYPE;\r\n\r\nexport type UmbMediaPlaceholderEntityType = typeof UMB_MEDIA_PLACEHOLDER_ENTITY_TYPE;\r\n\r\nexport type UmbMediaEntityTypeUnion = UmbMediaEntityType | UmbMediaRootEntityType;\r\n\r\n// TODO: move this to a better location inside the media module\r\nexport const UMB_MEDIA_PROPERTY_VALUE_ENTITY_TYPE = `${UMB_MEDIA_ENTITY_TYPE}-property-value`;\r\nexport type UmbMediaPropertyValueEntityType = typeof UMB_MEDIA_PROPERTY_VALUE_ENTITY_TYPE;\r\n","import type { UmbMediaDetailModel } from '../../types.js';\r\nimport { UMB_MEDIA_ENTITY_TYPE } from '../../entity.js';\r\nimport { UmbId } from '@umbraco-cms/backoffice/id';\r\nimport type { UmbDetailDataSource } from '@umbraco-cms/backoffice/repository';\r\nimport type { CreateMediaRequestModel, UpdateMediaRequestModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { MediaService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbMediaTypeDetailServerDataSource } from '@umbraco-cms/backoffice/media-type';\r\nimport type { UmbReferenceByUnique } from '@umbraco-cms/backoffice/models';\r\nimport { umbDeepMerge, type UmbDeepPartialObject } from '@umbraco-cms/backoffice/utils';\r\n\r\n/**\r\n * A data source for the Media that fetches data from the server\r\n * @class UmbMediaServerDataSource\r\n * @implements {RepositoryDetailDataSource}\r\n */\r\nexport class UmbMediaServerDataSource extends UmbControllerBase implements UmbDetailDataSource<UmbMediaDetailModel> {\r\n\t/**\r\n\t * Creates a new Media scaffold\r\n\t * @param {UmbDeepPartialObject<UmbMediaDetailModel>} [preset]\r\n\t * @returns { UmbMediaDetailModel }\r\n\t * @memberof UmbMediaServerDataSource\r\n\t */\r\n\tasync createScaffold(preset: UmbDeepPartialObject<UmbMediaDetailModel> = {}) {\r\n\t\tlet mediaTypeIcon: string | null = null;\r\n\t\tlet mediaTypeCollection: UmbReferenceByUnique | null = null;\r\n\r\n\t\tconst mediaTypeUnique = preset.mediaType?.unique;\r\n\r\n\t\tif (!mediaTypeUnique) {\r\n\t\t\tthrow new Error('Media type unique is missing');\r\n\t\t}\r\n\r\n\t\tconst { data } = await new UmbMediaTypeDetailServerDataSource(this).read(mediaTypeUnique);\r\n\t\tmediaTypeIcon = data?.icon ?? null;\r\n\t\tmediaTypeCollection = data?.collection ?? null;\r\n\r\n\t\tconst defaultData: UmbMediaDetailModel = {\r\n\t\t\tentityType: UMB_MEDIA_ENTITY_TYPE,\r\n\t\t\tunique: UmbId.new(),\r\n\t\t\tmediaType: {\r\n\t\t\t\tunique: mediaTypeUnique,\r\n\t\t\t\tcollection: mediaTypeCollection,\r\n\t\t\t\ticon: mediaTypeIcon,\r\n\t\t\t},\r\n\t\t\tisTrashed: false,\r\n\t\t\tvalues: [],\r\n\t\t\tvariants: [\r\n\t\t\t\t{\r\n\t\t\t\t\tculture: null,\r\n\t\t\t\t\tsegment: null,\r\n\t\t\t\t\tname: '',\r\n\t\t\t\t\tcreateDate: null,\r\n\t\t\t\t\tupdateDate: null,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t};\r\n\r\n\t\tconst scaffold = umbDeepMerge(preset, defaultData);\r\n\r\n\t\treturn { data: scaffold };\r\n\t}\r\n\r\n\t/**\r\n\t * Fetches a Media with the given id from the server\r\n\t * @param {string} unique\r\n\t * @returns {*}\r\n\t * @memberof UmbMediaServerDataSource\r\n\t */\r\n\tasync read(unique: string) {\r\n\t\tif (!unique) throw new Error('Unique is missing');\r\n\r\n\t\tconst { data, error } = await tryExecute(this, MediaService.getMediaById({ path: { id: unique } }));\r\n\r\n\t\tif (error || !data) {\r\n\t\t\treturn { error };\r\n\t\t}\r\n\r\n\t\t// TODO: make data mapper to prevent errors\r\n\t\tconst media: UmbMediaDetailModel = {\r\n\t\t\tentityType: UMB_MEDIA_ENTITY_TYPE,\r\n\t\t\tunique: data.id,\r\n\t\t\tvalues: data.values as UmbMediaDetailModel['values'],\r\n\t\t\tvariants: data.variants.map((variant) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tstate: null,\r\n\t\t\t\t\tculture: variant.culture || null,\r\n\t\t\t\t\tsegment: variant.segment || null,\r\n\t\t\t\t\tname: variant.name,\r\n\t\t\t\t\tcreateDate: variant.createDate,\r\n\t\t\t\t\tupdateDate: variant.updateDate,\r\n\t\t\t\t};\r\n\t\t\t}),\r\n\t\t\tmediaType: {\r\n\t\t\t\tunique: data.mediaType.id,\r\n\t\t\t\tcollection: data.mediaType.collection ? { unique: data.mediaType.collection.id } : null,\r\n\t\t\t\ticon: data.mediaType.icon,\r\n\t\t\t},\r\n\t\t\tisTrashed: data.isTrashed,\r\n\t\t};\r\n\r\n\t\treturn { data: media };\r\n\t}\r\n\r\n\t/**\r\n\t * Inserts a new Media on the server\r\n\t * @param {UmbMediaDetailModel} model\r\n\t * @param parentUnique\r\n\t * @returns {*}\r\n\t * @memberof UmbMediaServerDataSource\r\n\t */\r\n\tasync create(model: UmbMediaDetailModel, parentUnique: string | null = null) {\r\n\t\tif (!model) throw new Error('Media is missing');\r\n\t\tif (!model.unique) throw new Error('Media unique is missing');\r\n\r\n\t\t// TODO: make data mapper to prevent errors\r\n\t\tconst body: CreateMediaRequestModel = {\r\n\t\t\tid: model.unique,\r\n\t\t\tparent: parentUnique ? { id: parentUnique } : null,\r\n\t\t\tmediaType: { id: model.mediaType.unique },\r\n\t\t\tvalues: model.values,\r\n\t\t\tvariants: model.variants.map((variant) => ({\r\n\t\t\t\tculture: variant.culture || null,\r\n\t\t\t\tsegment: variant.segment || null,\r\n\t\t\t\tname: variant.name,\r\n\t\t\t})),\r\n\t\t};\r\n\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis,\r\n\t\t\tMediaService.postMedia({\r\n\t\t\t\tbody,\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\tif (data && typeof data === 'string') {\r\n\t\t\treturn this.read(data);\r\n\t\t}\r\n\r\n\t\treturn { error };\r\n\t}\r\n\r\n\t/**\r\n\t * Updates a Media on the server\r\n\t * @param {UmbMediaDetailModel} Media\r\n\t * @param model\r\n\t * @returns {*}\r\n\t * @memberof UmbMediaServerDataSource\r\n\t */\r\n\tasync update(model: UmbMediaDetailModel) {\r\n\t\tif (!model.unique) throw new Error('Unique is missing');\r\n\r\n\t\t// TODO: make data mapper to prevent errors\r\n\t\tconst body: UpdateMediaRequestModel = {\r\n\t\t\tvalues: model.values,\r\n\t\t\tvariants: model.variants,\r\n\t\t};\r\n\r\n\t\tconst { error } = await tryExecute(\r\n\t\t\tthis,\r\n\t\t\tMediaService.putMediaById({\r\n\t\t\t\tpath: { id: model.unique },\r\n\t\t\t\tbody,\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\tif (!error) {\r\n\t\t\treturn this.read(model.unique);\r\n\t\t}\r\n\r\n\t\treturn { error };\r\n\t}\r\n\r\n\t/**\r\n\t * Deletes a Media on the server\r\n\t * @param {string} unique\r\n\t * @returns {*}\r\n\t * @memberof UmbMediaServerDataSource\r\n\t */\r\n\tasync delete(unique: string) {\r\n\t\tif (!unique) throw new Error('Unique is missing');\r\n\r\n\t\treturn tryExecute(this, MediaService.deleteMediaById({ path: { id: unique } }));\r\n\t}\r\n}\r\n","import type UmbMediaDetailStore from './media-detail.store.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_MEDIA_DETAIL_STORE_CONTEXT = new UmbContextToken<UmbMediaDetailStore>('UmbMediaDetailStore');\r\n","import type { UmbMediaDetailModel } from '../../types.js';\r\nimport { UmbMediaServerDataSource } from './media-detail.server.data-source.js';\r\nimport { UMB_MEDIA_DETAIL_STORE_CONTEXT } from './media-detail.store.context-token.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbDetailRepositoryBase } from '@umbraco-cms/backoffice/repository';\r\n\r\nexport class UmbMediaDetailRepository extends UmbDetailRepositoryBase<UmbMediaDetailModel> {\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UmbMediaServerDataSource, UMB_MEDIA_DETAIL_STORE_CONTEXT);\r\n\t}\r\n}\r\n\r\nexport { UmbMediaDetailRepository as api };\r\n\r\nexport default UmbMediaDetailRepository;\r\n","import { UMB_MEDIA_ENTITY_TYPE } from '../../entity.js';\r\nimport type { UmbMediaItemModel } from './types.js';\r\nimport type { MediaItemResponseModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { MediaService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbItemServerDataSourceBase } from '@umbraco-cms/backoffice/repository';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\nimport { UmbItemDataApiGetRequestController } from '@umbraco-cms/backoffice/entity-item';\r\n\r\n/**\r\n * A data source for Media items that fetches data from the server\r\n * @class UmbMediaItemServerDataSource\r\n * @implements {MediaTreeDataSource}\r\n */\r\nexport class UmbMediaItemServerDataSource extends UmbItemServerDataSourceBase<\r\n\tMediaItemResponseModel,\r\n\tUmbMediaItemModel\r\n> {\r\n\t/**\r\n\t * Creates an instance of UmbMediaItemServerDataSource.\r\n\t * @param {UmbControllerHost} host - The controller host for this controller to be appended to\r\n\t * @memberof UmbMediaItemServerDataSource\r\n\t */\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, {\r\n\t\t\tmapper,\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t * @deprecated - The search method will be removed in v17. Use the\r\n\t * Use the UmbMediaSearchProvider instead.\r\n\t * Get it from:\r\n\t * ```ts\r\n\t * import { UmbMediaSearchProvider } from '@umbraco-cms/backoffice/media';\r\n\t * ```\r\n\t */\r\n\tasync search({ query, skip, take }: { query: string; skip: number; take: number }) {\r\n\t\tconst { data, error } = await tryExecute(this, MediaService.getItemMediaSearch({ query: { query, skip, take } }));\r\n\t\tconst mapped = data?.items.map((item) => mapper(item));\r\n\t\treturn { data: mapped, error };\r\n\t}\r\n\r\n\toverride async getItems(uniques: Array<string>) {\r\n\t\tif (!uniques) throw new Error('Uniques are missing');\r\n\r\n\t\tconst itemRequestManager = new UmbItemDataApiGetRequestController(this, {\r\n\t\t\t// eslint-disable-next-line local-rules/no-direct-api-import\r\n\t\t\tapi: (args) => MediaService.getItemMedia({ query: { id: args.uniques } }),\r\n\t\t\tuniques,\r\n\t\t});\r\n\r\n\t\tconst { data, error } = await itemRequestManager.request();\r\n\r\n\t\treturn { data: this._getMappedItems(data), error };\r\n\t}\r\n}\r\n\r\nconst mapper = (item: MediaItemResponseModel): UmbMediaItemModel => {\r\n\treturn {\r\n\t\tentityType: UMB_MEDIA_ENTITY_TYPE,\r\n\t\thasChildren: item.hasChildren,\r\n\t\tisTrashed: item.isTrashed,\r\n\t\tunique: item.id,\r\n\t\tmediaType: {\r\n\t\t\tunique: item.mediaType.id,\r\n\t\t\ticon: item.mediaType.icon,\r\n\t\t\tcollection: item.mediaType.collection ? { unique: item.mediaType.collection.id } : null,\r\n\t\t},\r\n\t\tname: item.variants[0]?.name, // TODO: get correct variant name\r\n\t\tparent: item.parent ? { unique: item.parent.id } : null,\r\n\t\tvariants: item.variants.map((variant) => {\r\n\t\t\treturn {\r\n\t\t\t\tculture: variant.culture || null,\r\n\t\t\t\tname: variant.name,\r\n\t\t\t};\r\n\t\t}),\r\n\t};\r\n};\r\n","import type UmbMediaItemStore from './media-item.store.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_MEDIA_ITEM_STORE_CONTEXT = new UmbContextToken<UmbMediaItemStore>('UmbMediaItemStore');\r\n","import { UmbMediaItemServerDataSource } from './media-item.server.data-source.js';\r\nimport { UMB_MEDIA_ITEM_STORE_CONTEXT } from './media-item.store.context-token.js';\r\nimport type { UmbMediaItemModel } from './types.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbItemRepositoryBase } from '@umbraco-cms/backoffice/repository';\r\n\r\nexport class UmbMediaItemRepository extends UmbItemRepositoryBase<UmbMediaItemModel> {\r\n\t#dataSource: UmbMediaItemServerDataSource;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UmbMediaItemServerDataSource, UMB_MEDIA_ITEM_STORE_CONTEXT);\r\n\t\tthis.#dataSource = new UmbMediaItemServerDataSource(this);\r\n\t}\r\n\r\n\t/**\r\n\t * @param root0\r\n\t * @param root0.query\r\n\t * @param root0.skip\r\n\t * @param root0.take\r\n\t * @deprecated - The search method will be removed in v17. Use the\r\n\t * Use the UmbMediaSearchProvider instead.\r\n\t * Get it from:\r\n\t * ```ts\r\n\t * import { UmbMediaSearchProvider } from '@umbraco-cms/backoffice/media';\r\n\t */\r\n\tasync search({ query, skip, take }: { query: string; skip: number; take: number }) {\r\n\t\treturn this.#dataSource.search({ query, skip, take });\r\n\t}\r\n}\r\n\r\nexport default UmbMediaItemRepository;\r\n","import { UMB_MEDIA_ENTITY_TYPE, UMB_MEDIA_ROOT_ENTITY_TYPE } from '../entity.js';\r\nimport type {\r\n\tUmbMediaTreeChildrenOfRequestArgs,\r\n\tUmbMediaTreeItemModel,\r\n\tUmbMediaTreeRootItemsRequestArgs,\r\n} from './types.js';\r\nimport type { UmbTreeAncestorsOfRequestArgs } from '@umbraco-cms/backoffice/tree';\r\nimport { UmbTreeServerDataSourceBase } from '@umbraco-cms/backoffice/tree';\r\nimport { MediaService, type MediaTreeItemResponseModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\n/**\r\n * A data source for the Media tree that fetches data from the server\r\n * @class UmbMediaTreeServerDataSource\r\n * @augments {UmbTreeServerDataSourceBase}\r\n */\r\nexport class UmbMediaTreeServerDataSource extends UmbTreeServerDataSourceBase<\r\n\tMediaTreeItemResponseModel,\r\n\tUmbMediaTreeItemModel,\r\n\tUmbMediaTreeRootItemsRequestArgs,\r\n\tUmbMediaTreeChildrenOfRequestArgs\r\n> {\r\n\t/**\r\n\t * Creates an instance of UmbMediaTreeServerDataSource.\r\n\t * @param {UmbControllerHost} host - The controller host for this controller to be appended to\r\n\t * @memberof UmbMediaTreeServerDataSource\r\n\t */\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, {\r\n\t\t\tgetRootItems,\r\n\t\t\tgetChildrenOf,\r\n\t\t\tgetAncestorsOf,\r\n\t\t\tmapper,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nconst getRootItems = (args: UmbMediaTreeRootItemsRequestArgs) =>\r\n\t// eslint-disable-next-line local-rules/no-direct-api-import\r\n\tMediaService.getTreeMediaRoot({ query: { dataTypeId: args.dataType?.unique, skip: args.skip, take: args.take } });\r\n\r\nconst getChildrenOf = (args: UmbMediaTreeChildrenOfRequestArgs) => {\r\n\tif (args.parent.unique === null) {\r\n\t\treturn getRootItems(args);\r\n\t} else {\r\n\t\t// eslint-disable-next-line local-rules/no-direct-api-import\r\n\t\treturn MediaService.getTreeMediaChildren({\r\n\t\t\tquery: { parentId: args.parent.unique, dataTypeId: args.dataType?.unique, skip: args.skip, take: args.take },\r\n\t\t});\r\n\t}\r\n};\r\n\r\nconst getAncestorsOf = (args: UmbTreeAncestorsOfRequestArgs) =>\r\n\t// eslint-disable-next-line local-rules/no-direct-api-import\r\n\tMediaService.getTreeMediaAncestors({\r\n\t\tquery: { descendantId: args.treeItem.unique },\r\n\t});\r\n\r\nconst mapper = (item: MediaTreeItemResponseModel): UmbMediaTreeItemModel => {\r\n\treturn {\r\n\t\tunique: item.id,\r\n\t\tparent: {\r\n\t\t\tunique: item.parent ? item.parent.id : null,\r\n\t\t\tentityType: item.parent ? UMB_MEDIA_ENTITY_TYPE : UMB_MEDIA_ROOT_ENTITY_TYPE,\r\n\t\t},\r\n\t\tentityType: UMB_MEDIA_ENTITY_TYPE,\r\n\t\thasChildren: item.hasChildren,\r\n\t\tnoAccess: item.noAccess,\r\n\t\tisTrashed: item.isTrashed,\r\n\t\tisFolder: false,\r\n\t\tmediaType: {\r\n\t\t\tunique: item.mediaType.id,\r\n\t\t\ticon: item.mediaType.icon,\r\n\t\t\tcollection: item.mediaType.collection ? { unique: item.mediaType.collection.id } : null,\r\n\t\t},\r\n\t\tname: item.variants[0]?.name, // TODO: this is not correct. We need to get it from the variants. This is a temp solution.\r\n\t\tvariants: item.variants.map((variant) => {\r\n\t\t\treturn {\r\n\t\t\t\tname: variant.name,\r\n\t\t\t\tculture: variant.culture || null,\r\n\t\t\t};\r\n\t\t}),\r\n\t\tcreateDate: item.createDate,\r\n\t};\r\n};\r\n","import type UmbMediaTreeStore from './media-tree.store.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_MEDIA_TREE_STORE_CONTEXT = new UmbContextToken<UmbMediaTreeStore>('UmbMediaTreeStore');\r\n","import { UMB_MEDIA_ROOT_ENTITY_TYPE } from '../entity.js';\r\nimport { UmbMediaTreeServerDataSource } from './media-tree.server.data-source.js';\r\nimport type {\r\n\tUmbMediaTreeChildrenOfRequestArgs,\r\n\tUmbMediaTreeItemModel,\r\n\tUmbMediaTreeRootItemsRequestArgs,\r\n\tUmbMediaTreeRootModel,\r\n} from './types.js';\r\nimport { UMB_MEDIA_TREE_STORE_CONTEXT } from './media-tree.store.context-token.js';\r\nimport { UmbTreeRepositoryBase } from '@umbraco-cms/backoffice/tree';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbApi } from '@umbraco-cms/backoffice/extension-api';\r\n\r\nexport class UmbMediaTreeRepository\r\n\textends UmbTreeRepositoryBase<\r\n\t\tUmbMediaTreeItemModel,\r\n\t\tUmbMediaTreeRootModel,\r\n\t\tUmbMediaTreeRootItemsRequestArgs,\r\n\t\tUmbMediaTreeChildrenOfRequestArgs\r\n\t>\r\n\timplements UmbApi\r\n{\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UmbMediaTreeServerDataSource, UMB_MEDIA_TREE_STORE_CONTEXT);\r\n\t}\r\n\r\n\tasync requestTreeRoot() {\r\n\t\tconst { data: treeRootData } = await this._treeSource.getRootItems({ skip: 0, take: 1 });\r\n\t\tconst hasChildren = treeRootData ? treeRootData.total > 0 : false;\r\n\r\n\t\tconst data: UmbMediaTreeRootModel = {\r\n\t\t\tunique: null,\r\n\t\t\tentityType: UMB_MEDIA_ROOT_ENTITY_TYPE,\r\n\t\t\tname: '#treeHeaders_media',\r\n\t\t\thasChildren,\r\n\t\t\tisFolder: true,\r\n\t\t};\r\n\r\n\t\treturn { data };\r\n\t}\r\n}\r\n\r\nexport default UmbMediaTreeRepository;\r\n","import type { UmbMediaPathModel } from '../types.js';\r\nimport type { UmbMediaDetailModel } from '../../../types.js';\r\nimport { UmbMediaDetailRepository } from '../../../repository/index.js';\r\nimport { UmbMediaTreeRepository } from '../../../tree/index.js';\r\nimport { UMB_MEDIA_ROOT_ENTITY_TYPE } from '../../../entity.js';\r\nimport {\r\n\tcss,\r\n\thtml,\r\n\tcustomElement,\r\n\tstate,\r\n\trepeat,\r\n\tproperty,\r\n\ttype PropertyValues,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport type { UUIInputElement, UUIInputEvent } from '@umbraco-cms/backoffice/external/uui';\r\nimport { UmbId } from '@umbraco-cms/backoffice/id';\r\nimport { getUmbracoFolderUnique } from '@umbraco-cms/backoffice/media-type';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\n\r\nconst root: UmbMediaPathModel = { name: 'Media', unique: null, entityType: UMB_MEDIA_ROOT_ENTITY_TYPE };\r\n\r\n@customElement('umb-media-picker-folder-path')\r\nexport class UmbMediaPickerFolderPathElement extends UmbLitElement {\r\n\t#mediaTreeRepository = new UmbMediaTreeRepository(this); // used to get file structure\r\n\t#mediaDetailRepository = new UmbMediaDetailRepository(this); // used to create folders\r\n\r\n\t@property({ attribute: false })\r\n\tstartNode?: UmbMediaPathModel = root;\r\n\r\n\t@property({ attribute: false })\r\n\tpublic set currentMedia(value: UmbMediaPathModel) {\r\n\t\tif (value !== this._currentMedia) {\r\n\t\t\tthis._currentMedia = value;\r\n\t\t\tthis.#loadPath();\r\n\t\t}\r\n\t}\r\n\r\n\tpublic get currentMedia() {\r\n\t\treturn this._currentMedia;\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _currentMedia: UmbMediaPathModel = root;\r\n\r\n\t@state()\r\n\tprivate _paths: Array<UmbMediaPathModel> = [root];\r\n\r\n\t@state()\r\n\tprivate _typingNewFolder = false;\r\n\r\n\tprotected override firstUpdated(_changedProperties: PropertyValues): void {\r\n\t\tsuper.firstUpdated(_changedProperties);\r\n\t\tthis.#loadPath();\r\n\t}\r\n\r\n\tasync #loadPath() {\r\n\t\tconst unique = this._currentMedia.unique;\r\n\t\tconst entityType = this._currentMedia.entityType;\r\n\r\n\t\tconst items = unique\r\n\t\t\t? (\r\n\t\t\t\t\tawait this.#mediaTreeRepository.requestTreeItemAncestors({\r\n\t\t\t\t\t\ttreeItem: { unique, entityType },\r\n\t\t\t\t\t})\r\n\t\t\t\t).data || []\r\n\t\t\t: [];\r\n\r\n\t\tconst paths: Array<UmbMediaPathModel> = items.map((item) => ({\r\n\t\t\tname: item.name,\r\n\t\t\tunique: item.unique,\r\n\t\t\tentityType: item.entityType,\r\n\t\t}));\r\n\r\n\t\tif (!this.startNode) {\r\n\t\t\tpaths.unshift(root);\r\n\t\t}\r\n\r\n\t\tthis._paths = [...paths];\r\n\t}\r\n\r\n\t#goToFolder(entity: UmbMediaPathModel) {\r\n\t\tthis._paths = [...this._paths].slice(0, this._paths.findIndex((path) => path.unique === entity.unique) + 1);\r\n\t\tthis.currentMedia = entity;\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\t#focusFolderInput() {\r\n\t\tthis._typingNewFolder = true;\r\n\t\trequestAnimationFrame(() => {\r\n\t\t\tconst element = this.getHostElement().shadowRoot!.querySelector('#new-folder') as UUIInputElement;\r\n\t\t\telement.focus();\r\n\t\t\telement.select();\r\n\t\t});\r\n\t}\r\n\r\n\tasync #addFolder(e: UUIInputEvent) {\r\n\t\te.stopPropagation();\r\n\r\n\t\tconst newName = e.target.value as string;\r\n\t\tthis._typingNewFolder = false;\r\n\t\tif (!newName) return;\r\n\r\n\t\tconst newUnique = UmbId.new();\r\n\t\tconst parentUnique = this._paths[this._paths.length - 1].unique;\r\n\r\n\t\tconst preset: Partial<UmbMediaDetailModel> = {\r\n\t\t\tunique: newUnique,\r\n\t\t\tmediaType: {\r\n\t\t\t\tunique: getUmbracoFolderUnique(),\r\n\t\t\t\tcollection: null,\r\n\t\t\t},\r\n\t\t\tvariants: [\r\n\t\t\t\t{\r\n\t\t\t\t\tculture: null,\r\n\t\t\t\t\tsegment: null,\r\n\t\t\t\t\tname: newName,\r\n\t\t\t\t\tcreateDate: null,\r\n\t\t\t\t\tupdateDate: null,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t};\r\n\t\tconst { data: scaffold } = await this.#mediaDetailRepository.createScaffold(preset);\r\n\t\tif (!scaffold) return;\r\n\r\n\t\tconst { data } = await this.#mediaDetailRepository.create(scaffold, parentUnique);\r\n\t\tif (!data) return;\r\n\r\n\t\tconst name = data.variants[0].name;\r\n\t\tconst unique = data.unique;\r\n\t\tconst entityType = data.entityType;\r\n\r\n\t\tthis._paths = [...this._paths, { name, unique, entityType }];\r\n\t\tthis.currentMedia = { name, unique, entityType };\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`<div id=\"path\">\r\n\t\t\t${repeat(\r\n\t\t\t\tthis._paths,\r\n\t\t\t\t(path) => path.unique,\r\n\t\t\t\t(path) =>\r\n\t\t\t\t\thtml`<uui-button\r\n\t\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\t\t.label=${path.name}\r\n\t\t\t\t\t\t\t?disabled=${this.currentMedia.unique === path.unique}\r\n\t\t\t\t\t\t\t@click=${() => this.#goToFolder(path)}></uui-button\r\n\t\t\t\t\t\t>/`,\r\n\t\t\t)}${this._typingNewFolder\r\n\t\t\t\t? html`<uui-input\r\n\t\t\t\t\t\tid=\"new-folder\"\r\n\t\t\t\t\t\tlabel=\"enter a name\"\r\n\t\t\t\t\t\tvalue=\"new folder name\"\r\n\t\t\t\t\t\t@blur=${this.#addFolder}\r\n\t\t\t\t\t\tauto-width></uui-input>`\r\n\t\t\t\t: html`<uui-button label=\"add folder\" compact @click=${this.#focusFolderInput}>+</uui-button>`}\r\n\t\t</div>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t#path {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tmargin: 0 var(--uui-size-3);\r\n\t\t\t}\r\n\t\t\t#path uui-button {\r\n\t\t\t\tfont-weight: bold;\r\n\t\t\t}\r\n\t\t\t#path uui-input {\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbMediaPickerFolderPathElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-media-picker-folder-path': UmbMediaPickerFolderPathElement;\r\n\t}\r\n}\r\n","import { UmbMediaDetailRepository } from '../../../repository/detail/media-detail.repository.js';\r\nimport { css, html, customElement, state, repeat, property } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { type UmbAllowedMediaTypeModel, UmbMediaTypeStructureRepository } from '@umbraco-cms/backoffice/media-type';\r\n\r\n@customElement('umb-media-picker-create-item')\r\nexport class UmbMediaPickerCreateItemElement extends UmbLitElement {\r\n\t#mediaTypeStructure = new UmbMediaTypeStructureRepository(this); // used to get allowed media items\r\n\t#mediaDetailRepository = new UmbMediaDetailRepository(this); // used to get media type of node\r\n\r\n\tprivate _node: string | null = null;\r\n\r\n\t@property()\r\n\tpublic set node(value: string | null) {\r\n\t\tthis._node = value;\r\n\t\tthis.#getAllowedMediaTypes();\r\n\t}\r\n\r\n\tpublic get node() {\r\n\t\treturn this._node;\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _popoverOpen = false;\r\n\r\n\t@state()\r\n\tprivate _allowedMediaTypes: Array<UmbAllowedMediaTypeModel> = [];\r\n\r\n\tasync #getNodeMediaType() {\r\n\t\tif (!this._node) return null;\r\n\r\n\t\tconst { data } = await this.#mediaDetailRepository.requestByUnique(this.node!);\r\n\t\treturn data?.mediaType.unique ?? null;\r\n\t}\r\n\r\n\tasync #getAllowedMediaTypes() {\r\n\t\tconst mediaType = await this.#getNodeMediaType();\r\n\r\n\t\tconst { data: allowedMediaTypes } = await this.#mediaTypeStructure.requestAllowedChildrenOf(mediaType, this._node);\r\n\t\tthis._allowedMediaTypes = allowedMediaTypes?.items ?? [];\r\n\t}\r\n\r\n\t#onPopoverToggle(event: ToggleEvent) {\r\n\t\t// TODO: This ignorer is just neede for JSON SCHEMA TO WORK, As its not updated with latest TS jet.\r\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t// @ts-ignore\r\n\t\tthis._popoverOpen = event.newState === 'open';\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\tpopovertarget=\"collection-action-menu-popover\"\r\n\t\t\t\tlabel=${this.localize.term('actions_create')}\r\n\t\t\t\tcolor=\"default\"\r\n\t\t\t\tlook=\"outline\">\r\n\t\t\t\t${this.localize.term('actions_create')}\r\n\t\t\t\t<uui-symbol-expand .open=${this._popoverOpen}></uui-symbol-expand>\r\n\t\t\t</uui-button>\r\n\t\t\t<uui-popover-container\r\n\t\t\t\tid=\"collection-action-menu-popover\"\r\n\t\t\t\tplacement=\"bottom-start\"\r\n\t\t\t\t@toggle=${this.#onPopoverToggle}>\r\n\t\t\t\t<umb-popover-layout>\r\n\t\t\t\t\t<uui-scroll-container>\r\n\t\t\t\t\t\t${!this._allowedMediaTypes.length\r\n\t\t\t\t\t\t\t? html`<div id=\"not-allowed\">${this.localize.term('mediaPicker_notAllowed')}</div>`\r\n\t\t\t\t\t\t\t: repeat(\r\n\t\t\t\t\t\t\t\t\tthis._allowedMediaTypes,\r\n\t\t\t\t\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t\t\t\t\t(item) =>\r\n\t\t\t\t\t\t\t\t\t\thtml`<uui-menu-item label=${item.name}>\r\n\t\t\t\t\t\t\t\t\t\t\t<umb-icon slot=\"icon\" name=${item.icon ?? 'icon-circle-dotted'}></umb-icon>\r\n\t\t\t\t\t\t\t\t\t\t</uui-menu-item>`,\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t</uui-scroll-container>\r\n\t\t\t\t</umb-popover-layout>\r\n\t\t\t</uui-popover-container>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t#not-allowed {\r\n\t\t\t\tpadding: var(--uui-size-space-3);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbMediaPickerCreateItemElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-media-picker-create-item': UmbMediaPickerCreateItemElement;\r\n\t}\r\n}\r\n","import { UMB_MEDIA_ENTITY_TYPE } from '../entity.js';\r\nimport type { UmbMediaSearchItemModel, UmbMediaSearchRequestArgs } from './types.js';\r\nimport type { UmbSearchDataSource } from '@umbraco-cms/backoffice/search';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { MediaService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\n\r\n/**\r\n * A data source for the Rollback that fetches data from the server\r\n * @class UmbMediaSearchServerDataSource\r\n * @implements {RepositoryDetailDataSource}\r\n */\r\nexport class UmbMediaSearchServerDataSource\r\n\timplements UmbSearchDataSource<UmbMediaSearchItemModel, UmbMediaSearchRequestArgs>\r\n{\r\n\t#host: UmbControllerHost;\r\n\r\n\t/**\r\n\t * Creates an instance of UmbMediaSearchServerDataSource.\r\n\t * @param {UmbControllerHost} host - The controller host for this controller to be appended to\r\n\t * @memberof UmbMediaSearchServerDataSource\r\n\t */\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tthis.#host = host;\r\n\t}\r\n\r\n\t/**\r\n\t * Get a list of versions for a data\r\n\t * @param {UmbMediaSearchRequestArgs}args - The arguments for the search\r\n\t * @returns {*}\r\n\t * @memberof UmbMediaSearchServerDataSource\r\n\t */\r\n\tasync search(args: UmbMediaSearchRequestArgs) {\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tMediaService.getItemMediaSearch({\r\n\t\t\t\tquery: {\r\n\t\t\t\t\tallowedMediaTypes: args.allowedContentTypes?.map((mediaReference) => mediaReference.unique),\r\n\t\t\t\t\tculture: args.culture || undefined,\r\n\t\t\t\t\tparentId: args.searchFrom?.unique || undefined,\r\n\t\t\t\t\tquery: args.query,\r\n\t\t\t\t\ttrashed: args.includeTrashed,\r\n\t\t\t\t},\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\tif (data) {\r\n\t\t\tconst mappedItems: Array<UmbMediaSearchItemModel> = data.items.map((item) => {\r\n\t\t\t\treturn {\r\n\t\t\t\t\tentityType: UMB_MEDIA_ENTITY_TYPE,\r\n\t\t\t\t\thasChildren: item.hasChildren,\r\n\t\t\t\t\thref: '/section/media/workspace/media/edit/' + item.id,\r\n\t\t\t\t\tisTrashed: item.isTrashed,\r\n\t\t\t\t\tunique: item.id,\r\n\t\t\t\t\tmediaType: {\r\n\t\t\t\t\t\tcollection: item.mediaType.collection ? { unique: item.mediaType.collection.id } : null,\r\n\t\t\t\t\t\ticon: item.mediaType.icon,\r\n\t\t\t\t\t\tunique: item.mediaType.id,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tname: item.variants[0]?.name, // TODO: get correct variant name\r\n\t\t\t\t\tparent: item.parent ? { unique: item.parent.id } : null,\r\n\t\t\t\t\tvariants: item.variants.map((variant) => {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\tculture: variant.culture || null,\r\n\t\t\t\t\t\t\tname: variant.name,\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t}),\r\n\t\t\t\t};\r\n\t\t\t});\r\n\r\n\t\t\treturn { data: { items: mappedItems, total: data.total } };\r\n\t\t}\r\n\r\n\t\treturn { error };\r\n\t}\r\n}\r\n","import { UmbMediaSearchServerDataSource } from './media-search.server.data-source.js';\r\nimport type { UmbMediaSearchItemModel, UmbMediaSearchRequestArgs } from './types.js';\r\nimport type { UmbSearchRepository } from '@umbraco-cms/backoffice/search';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbApi } from '@umbraco-cms/backoffice/extension-api';\r\n\r\nexport class UmbMediaSearchRepository\r\n\textends UmbControllerBase\r\n\timplements UmbSearchRepository<UmbMediaSearchItemModel, UmbMediaSearchRequestArgs>, UmbApi\r\n{\r\n\t#dataSource: UmbMediaSearchServerDataSource;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\r\n\t\tthis.#dataSource = new UmbMediaSearchServerDataSource(this);\r\n\t}\r\n\r\n\tsearch(args: UmbMediaSearchRequestArgs) {\r\n\t\treturn this.#dataSource.search(args);\r\n\t}\r\n}\r\n","import { UmbMediaSearchRepository } from './media-search.repository.js';\r\nimport type { UmbMediaSearchItemModel, UmbMediaSearchRequestArgs } from './types.js';\r\nimport type { UmbSearchProvider } from '@umbraco-cms/backoffice/search';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\n\r\nexport class UmbMediaSearchProvider\r\n\textends UmbControllerBase\r\n\timplements UmbSearchProvider<UmbMediaSearchItemModel, UmbMediaSearchRequestArgs>\r\n{\r\n\t#repository = new UmbMediaSearchRepository(this);\r\n\r\n\tasync search(args: UmbMediaSearchRequestArgs) {\r\n\t\treturn this.#repository.search(args);\r\n\t}\r\n\r\n\toverride destroy(): void {\r\n\t\tthis.#repository.destroy();\r\n\t}\r\n}\r\n\r\nexport { UmbMediaSearchProvider as api };\r\n","import { UmbMediaItemRepository } from '../../repository/index.js';\r\nimport { UmbMediaTreeRepository } from '../../tree/media-tree.repository.js';\r\nimport { UMB_MEDIA_ROOT_ENTITY_TYPE } from '../../entity.js';\r\nimport type { UmbMediaTreeItemModel, UmbMediaSearchItemModel, UmbMediaItemModel } from '../../types.js';\r\nimport { UmbMediaSearchProvider } from '../../search/index.js';\r\nimport type { UmbDropzoneMediaElement } from '../../dropzone/index.js';\r\nimport type { UmbMediaPathModel } from './types.js';\r\nimport type { UmbMediaPickerFolderPathElement } from './components/media-picker-folder-path.element.js';\r\nimport type { UmbMediaPickerModalData, UmbMediaPickerModalValue } from './media-picker-modal.token.js';\r\nimport type { UmbDropzoneChangeEvent, UmbUploadableItem } from '@umbraco-cms/backoffice/dropzone';\r\nimport {\r\n\tcss,\r\n\thtml,\r\n\tcustomElement,\r\n\tstate,\r\n\trepeat,\r\n\tifDefined,\r\n\tquery,\r\n\ttype PropertyValues,\r\n\tnothing,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { debounce, UmbPaginationManager } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_PROPERTY_TYPE_BASED_PROPERTY_CONTEXT } from '@umbraco-cms/backoffice/content';\r\nimport type { UUIInputEvent, UUIPaginationEvent } from '@umbraco-cms/backoffice/external/uui';\r\nimport { isUmbracoFolder } from '@umbraco-cms/backoffice/media-type';\r\nimport type { UmbEntityModel } from '@umbraco-cms/backoffice/entity';\r\nimport { UMB_VARIANT_CONTEXT } from '@umbraco-cms/backoffice/variant';\r\n\r\nimport '@umbraco-cms/backoffice/imaging';\r\n\r\nconst root: UmbMediaPathModel = { name: 'Media', unique: null, entityType: UMB_MEDIA_ROOT_ENTITY_TYPE };\r\n\r\n// TODO: investigate how we can reuse the picker-search-field element, picker context etc.\r\n@customElement('umb-media-picker-modal')\r\nexport class UmbMediaPickerModalElement extends UmbModalBaseElement<UmbMediaPickerModalData, UmbMediaPickerModalValue> {\r\n\t#mediaTreeRepository = new UmbMediaTreeRepository(this);\r\n\t#mediaItemRepository = new UmbMediaItemRepository(this);\r\n\t#mediaSearchProvider = new UmbMediaSearchProvider(this);\r\n\r\n\t#dataType?: { unique: string };\r\n\r\n\t@state()\r\n\tprivate _selectableFilter: (item: UmbMediaTreeItemModel | UmbMediaSearchItemModel) => boolean = () => true;\r\n\r\n\t@state()\r\n\tprivate _currentChildren: Array<UmbMediaTreeItemModel> = [];\r\n\r\n\t@state()\r\n\tprivate _currentPage = 1;\r\n\r\n\t@state()\r\n\tprivate _currentTotalPages = 0;\r\n\r\n\t@state()\r\n\tprivate _searchResult: Array<UmbMediaSearchItemModel> = [];\r\n\r\n\t@state()\r\n\tprivate _searchFrom: UmbEntityModel | undefined;\r\n\r\n\t@state()\r\n\tprivate _searchQuery = '';\r\n\r\n\t@state()\r\n\tprivate _currentMediaEntity: UmbMediaPathModel = root;\r\n\r\n\t@state()\r\n\tprivate _isSelectionMode = false;\r\n\r\n\t@state()\r\n\tprivate _startNode: UmbMediaItemModel | undefined;\r\n\r\n\t@state()\r\n\t_searching: boolean = false;\r\n\r\n\t@query('#dropzone')\r\n\tprivate _dropzone!: UmbDropzoneMediaElement;\r\n\r\n\t#pagingMap = new Map<string, UmbPaginationManager>();\r\n\t#contextCulture?: string | null;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_PROPERTY_TYPE_BASED_PROPERTY_CONTEXT, (context) => {\r\n\t\t\tthis.observe(context?.dataType, (dataType) => {\r\n\t\t\t\tthis.#dataType = dataType;\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_VARIANT_CONTEXT, (context) => {\r\n\t\t\tthis.observe(context?.culture, (culture) => {\r\n\t\t\t\tthis.#contextCulture = culture;\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\toverride async connectedCallback(): Promise<void> {\r\n\t\tsuper.connectedCallback();\r\n\t\tif (this.data?.pickableFilter) {\r\n\t\t\tthis._selectableFilter = this.data?.pickableFilter;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected override async firstUpdated(_changedProperties: PropertyValues): Promise<void> {\r\n\t\tsuper.firstUpdated(_changedProperties);\r\n\r\n\t\tconst startNode = this.data?.startNode;\r\n\r\n\t\tif (startNode) {\r\n\t\t\tconst { data } = await this.#mediaItemRepository.requestItems([startNode.unique]);\r\n\t\t\tthis._startNode = data?.[0];\r\n\r\n\t\t\tif (this._startNode) {\r\n\t\t\t\tthis._currentMediaEntity = {\r\n\t\t\t\t\tname: this._startNode.name,\r\n\t\t\t\t\tunique: this._startNode.unique,\r\n\t\t\t\t\tentityType: this._startNode.entityType,\r\n\t\t\t\t};\r\n\r\n\t\t\t\tthis._searchFrom = { unique: this._startNode.unique, entityType: this._startNode.entityType };\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.#loadChildrenOfCurrentMediaItem();\r\n\t}\r\n\r\n\tasync #loadChildrenOfCurrentMediaItem(selectedItems?: Array<UmbUploadableItem>) {\r\n\t\tconst key = this._currentMediaEntity.entityType + this._currentMediaEntity.unique;\r\n\t\tlet paginationManager = this.#pagingMap.get(key);\r\n\r\n\t\tif (!paginationManager) {\r\n\t\t\tpaginationManager = new UmbPaginationManager();\r\n\t\t\tpaginationManager.setPageSize(100);\r\n\t\t\tthis.#pagingMap.set(key, paginationManager);\r\n\t\t}\r\n\r\n\t\tconst skip = paginationManager.getSkip();\r\n\t\tconst take = paginationManager.getPageSize();\r\n\r\n\t\tconst { data } = await this.#mediaTreeRepository.requestTreeItemsOf({\r\n\t\t\tparent: {\r\n\t\t\t\tunique: this._currentMediaEntity.unique,\r\n\t\t\t\tentityType: this._currentMediaEntity.entityType,\r\n\t\t\t},\r\n\t\t\tdataType: this.#dataType,\r\n\t\t\tskip,\r\n\t\t\ttake,\r\n\t\t});\r\n\r\n\t\tthis._currentChildren = data?.items ?? [];\r\n\t\tpaginationManager.setTotalItems(data?.total ?? 0);\r\n\t\tthis._currentPage = paginationManager.getCurrentPageNumber();\r\n\t\tthis._currentTotalPages = paginationManager.getTotalPages();\r\n\r\n\t\tif (selectedItems?.length) {\r\n\t\t\tconst selectedItem = this._currentChildren.find((x) => x.unique == selectedItems[0].unique);\r\n\t\t\tif (selectedItem) {\r\n\t\t\t\tthis.#onSelected(selectedItem);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t#onDropzoneChange(evt: UmbDropzoneChangeEvent) {\r\n\t\tconst target = evt.target as UmbDropzoneMediaElement;\r\n\t\tthis.#loadChildrenOfCurrentMediaItem(target.value);\r\n\t}\r\n\r\n\t#onOpen(item: UmbMediaTreeItemModel | UmbMediaSearchItemModel) {\r\n\t\tthis.#clearSearch();\r\n\r\n\t\tthis._currentMediaEntity = {\r\n\t\t\tname: item.name,\r\n\t\t\tunique: item.unique,\r\n\t\t\tentityType: UMB_MEDIA_ROOT_ENTITY_TYPE,\r\n\t\t};\r\n\r\n\t\t// If the user has navigated into an item, we default to search only within that item.\r\n\t\tthis._searchFrom = this._currentMediaEntity.unique\r\n\t\t\t? { unique: this._currentMediaEntity.unique, entityType: this._currentMediaEntity.entityType }\r\n\t\t\t: undefined;\r\n\r\n\t\tthis.#loadChildrenOfCurrentMediaItem();\r\n\t}\r\n\r\n\t#onSelected(item: UmbMediaTreeItemModel | UmbMediaSearchItemModel) {\r\n\t\tconst selection = this.data?.multiple ? [...this.value.selection, item.unique!] : [item.unique!];\r\n\t\tthis._isSelectionMode = selection.length > 0;\r\n\t\tthis.modalContext?.setValue({ selection });\r\n\t}\r\n\r\n\t#onDeselected(item: UmbMediaTreeItemModel | UmbMediaSearchItemModel) {\r\n\t\tconst selection = this.value.selection.filter((value) => value !== item.unique);\r\n\t\tthis._isSelectionMode = selection.length > 0;\r\n\t\tthis.modalContext?.setValue({ selection });\r\n\t}\r\n\r\n\t#clearSearch() {\r\n\t\tthis._searchQuery = '';\r\n\t\tthis._searchResult = [];\r\n\t}\r\n\r\n\tasync #searchMedia() {\r\n\t\tif (!this._searchQuery) {\r\n\t\t\tthis.#clearSearch();\r\n\t\t\tthis._searching = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconst query = this._searchQuery;\r\n\t\tconst { data } = await this.#mediaSearchProvider.search({\r\n\t\t\tquery,\r\n\t\t\tsearchFrom: this._searchFrom,\r\n\t\t\tculture: this.#contextCulture,\r\n\t\t\t...this.data?.search?.queryParams,\r\n\t\t});\r\n\r\n\t\tif (!data) {\r\n\t\t\t// No search results.\r\n\t\t\tthis._searchResult = [];\r\n\t\t\tthis._searching = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Map urls for search results as we are going to show for all folders (as long they aren't trashed).\r\n\t\tthis._searchResult = data.items;\r\n\t\tthis._searching = false;\r\n\t}\r\n\r\n\t#debouncedSearch = debounce(() => {\r\n\t\tthis.#searchMedia();\r\n\t}, 500);\r\n\r\n\t#onSearch(e: UUIInputEvent) {\r\n\t\tthis._searchQuery = (e.target.value as string).toLocaleLowerCase();\r\n\t\tthis._searching = true;\r\n\t\tthis.#debouncedSearch();\r\n\t}\r\n\r\n\t#onPathChange(e: CustomEvent) {\r\n\t\tconst newPath = e.target as UmbMediaPickerFolderPathElement;\r\n\r\n\t\tif (newPath.currentMedia) {\r\n\t\t\tthis._currentMediaEntity = newPath.currentMedia;\r\n\t\t} else if (this._startNode) {\r\n\t\t\tthis._currentMediaEntity = {\r\n\t\t\t\tname: this._startNode.name,\r\n\t\t\t\tunique: this._startNode.unique,\r\n\t\t\t\tentityType: this._startNode.entityType,\r\n\t\t\t};\r\n\t\t} else {\r\n\t\t\tthis._currentMediaEntity = root;\r\n\t\t}\r\n\r\n\t\tif (this._currentMediaEntity.unique) {\r\n\t\t\tthis._searchFrom = { unique: this._currentMediaEntity.unique, entityType: this._currentMediaEntity.entityType };\r\n\t\t} else {\r\n\t\t\tthis._searchFrom = undefined;\r\n\t\t}\r\n\r\n\t\tthis.#loadChildrenOfCurrentMediaItem();\r\n\t}\r\n\r\n\t#onPageChange(event: UUIPaginationEvent) {\r\n\t\tevent.stopPropagation();\r\n\t\tconst key = this._currentMediaEntity.entityType + this._currentMediaEntity.unique;\r\n\r\n\t\tconst paginationManager = this.#pagingMap.get(key);\r\n\r\n\t\tif (!paginationManager) {\r\n\t\t\tthrow new Error('Pagination manager not found');\r\n\t\t}\r\n\r\n\t\tpaginationManager.setCurrentPageNumber(event.target.current);\r\n\t\tthis.#pagingMap.set(key, paginationManager);\r\n\r\n\t\tthis.#loadChildrenOfCurrentMediaItem();\r\n\t}\r\n\r\n\t#allowNavigateToMedia(item: UmbMediaTreeItemModel | UmbMediaSearchItemModel): boolean {\r\n\t\treturn isUmbracoFolder(item.mediaType.unique) || item.hasChildren;\r\n\t}\r\n\r\n\t#onSearchFromChange(e: CustomEvent) {\r\n\t\tconst checked = (e.target as HTMLInputElement).checked;\r\n\r\n\t\tif (checked) {\r\n\t\t\tthis._searchFrom = { unique: this._currentMediaEntity.unique, entityType: this._currentMediaEntity.entityType };\r\n\t\t} else {\r\n\t\t\tthis._searchFrom = undefined;\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=${this.localize.term('defaultdialogs_chooseMedia')}>\r\n\t\t\t\t${this.#renderBody()} ${this.#renderBreadcrumb()}\r\n\t\t\t\t<div slot=\"actions\">\r\n\t\t\t\t\t<uui-button label=${this.localize.term('general_close')} @click=${this._rejectModal}></uui-button>\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlabel=${this.localize.term('general_choose')}\r\n\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\t@click=${this._submitModal}></uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderBody() {\r\n\t\treturn html`${this.#renderToolbar()}\r\n\t\t\t<umb-dropzone-media\r\n\t\t\t\tid=\"dropzone\"\r\n\t\t\t\tmultiple\r\n\t\t\t\t@change=${this.#onDropzoneChange}\r\n\t\t\t\t.parentUnique=${this._currentMediaEntity.unique}></umb-dropzone-media>\r\n\t\t\t${this._searchQuery ? this.#renderSearchResult() : this.#renderCurrentChildren()} `;\r\n\t}\r\n\r\n\t#renderSearchResult() {\r\n\t\treturn html`\r\n\t\t\t${!this._searchResult.length && !this._searching\r\n\t\t\t\t? html`<div class=\"container\"><p>${this.localize.term('content_listViewNoItems')}</p></div>`\r\n\t\t\t\t: html`<div id=\"media-grid\">\r\n\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\tthis._searchResult,\r\n\t\t\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t\t\t(item) => this.#renderCard(item),\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>`}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderCurrentChildren() {\r\n\t\treturn html`\r\n\t\t\t${!this._currentChildren.length\r\n\t\t\t\t? html`<div class=\"container\"><p>${this.localize.term('content_listViewNoItems')}</p></div>`\r\n\t\t\t\t: html`<div id=\"media-grid\">\r\n\t\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\t\tthis._currentChildren,\r\n\t\t\t\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t\t\t\t(item) => this.#renderCard(item),\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t${this._currentTotalPages > 1\r\n\t\t\t\t\t\t\t? html`<uui-pagination\r\n\t\t\t\t\t\t\t\t\t.current=${this._currentPage}\r\n\t\t\t\t\t\t\t\t\t.total=${this._currentTotalPages}\r\n\t\t\t\t\t\t\t\t\tfirstlabel=${this.localize.term('general_first')}\r\n                                    previouslabel=${this.localize.term('general_previous')}\r\n                                    nextlabel=${this.localize.term('general_next')}\r\n                                    lastlabel=${this.localize.term('general_last')}\r\n\t\t\t\t\t\t\t\t\t@change=${this.#onPageChange}></uui-pagination>`\r\n\t\t\t\t\t\t\t: nothing}`}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderToolbar() {\r\n\t\t/**<umb-media-picker-create-item .node=${this._currentMediaEntity.unique}></umb-media-picker-create-item>\r\n\t\t * We cannot route to a workspace without the media picker modal is a routeable. Using regular upload button for now... */\r\n\t\treturn html`\r\n\t\t\t<div id=\"toolbar\">\r\n\t\t\t\t<div id=\"search\">\r\n\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\tlabel=${this.localize.term('general_search')}\r\n\t\t\t\t\t\tplaceholder=${this.localize.term('placeholders_search')}\r\n\t\t\t\t\t\t@input=${this.#onSearch}\r\n\t\t\t\t\t\tvalue=${this._searchQuery}>\r\n\t\t\t\t\t\t<div slot=\"prepend\">\r\n\t\t\t\t\t\t\t${this._searching\r\n\t\t\t\t\t\t\t\t? html`<uui-loader-circle id=\"searching-indicator\"></uui-loader-circle>`\r\n\t\t\t\t\t\t\t\t: html`<uui-icon name=\"search\"></uui-icon>`}\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</uui-input>\r\n\r\n\t\t\t\t\t${this._currentMediaEntity.unique && this._currentMediaEntity.unique !== this._startNode?.unique\r\n\t\t\t\t\t\t? html`<uui-checkbox\r\n\t\t\t\t\t\t\t\t?checked=${this._searchFrom?.unique === this._currentMediaEntity.unique}\r\n\t\t\t\t\t\t\t\t@change=${this.#onSearchFromChange}\r\n\t\t\t\t\t\t\t\tlabel=\"Search only in ${this._currentMediaEntity.name}\"></uui-checkbox>`\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t</div>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\t@click=${() => this._dropzone.browse()}\r\n\t\t\t\t\tlabel=${this.localize.term('general_upload')}\r\n\t\t\t\t\tlook=\"outline\"\r\n\t\t\t\t\tcolor=\"default\"></uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderCard(item: UmbMediaTreeItemModel | UmbMediaSearchItemModel) {\r\n\t\tconst canNavigate = this.#allowNavigateToMedia(item);\r\n\t\tconst selectable = this._selectableFilter(item);\r\n\t\tconst disabled = !(selectable || canNavigate);\r\n\t\treturn html`\r\n\t\t\t<uui-card-media\r\n\t\t\t\tclass=${ifDefined(disabled ? 'not-allowed' : undefined)}\r\n\t\t\t\t.name=${item.name}\r\n\t\t\t\tdata-mark=\"${item.entityType}:${item.unique}\"\r\n\t\t\t\t@open=${() => this.#onOpen(item)}\r\n\t\t\t\t@selected=${() => this.#onSelected(item)}\r\n\t\t\t\t@deselected=${() => this.#onDeselected(item)}\r\n\t\t\t\t?selected=${this.value?.selection?.find((value) => value === item.unique)}\r\n\t\t\t\t?selectable=${selectable}\r\n\t\t\t\t?select-only=${this._isSelectionMode || canNavigate === false}>\r\n\t\t\t\t<umb-imaging-thumbnail\r\n\t\t\t\t\tunique=${item.unique}\r\n\t\t\t\t\talt=${item.name}\r\n\t\t\t\t\ticon=${item.mediaType.icon}></umb-imaging-thumbnail>\r\n\t\t\t</uui-card-media>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderBreadcrumb() {\r\n\t\t// hide the breadcrumb when doing a global search within another item\r\n\t\t// We do this to avoid confusion that the current search result is within the item shown in the breadcrumb.\r\n\t\tif (this._searchQuery && this._currentMediaEntity.unique && !this._searchFrom) {\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\r\n\t\tconst startNode: UmbMediaPathModel | undefined = this._startNode\r\n\t\t\t? {\r\n\t\t\t\t\tentityType: this._startNode.entityType,\r\n\t\t\t\t\tunique: this._startNode.unique,\r\n\t\t\t\t\tname: this._startNode.name,\r\n\t\t\t\t}\r\n\t\t\t: undefined;\r\n\r\n\t\treturn html`<umb-media-picker-folder-path\r\n\t\t\tslot=\"footer-info\"\r\n\t\t\t.currentMedia=${this._currentMediaEntity}\r\n\t\t\t.startNode=${startNode}\r\n\t\t\t@change=${this.#onPathChange}></umb-media-picker-folder-path>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t#toolbar {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-6);\r\n\t\t\t\talign-items: flex-start;\r\n\t\t\t\tmargin-bottom: var(--uui-size-3);\r\n\t\t\t}\r\n\t\t\t#search {\r\n\t\t\t\tflex: 1;\r\n\t\t\t}\r\n\r\n\t\t\t#search uui-input {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tmargin-bottom: var(--uui-size-3);\r\n\t\t\t}\r\n\t\t\t#search uui-input [slot='prepend'] {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t}\r\n\r\n\t\t\t#searching-indicator {\r\n\t\t\t\tmargin-left: 7px;\r\n\t\t\t\tmargin-top: 4px;\r\n\t\t\t}\r\n\r\n\t\t\t#media-grid {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgap: var(--uui-size-space-5);\r\n\t\t\t\tgrid-template-columns: repeat(auto-fill, minmax(var(--umb-card-medium-min-width), 1fr));\r\n\t\t\t\tgrid-auto-rows: var(--umb-card-medium-min-width);\r\n\t\t\t\tpadding-bottom: 5px; /** The modal is a bit jumpy due to the img card focus/hover border. This fixes the issue. */\r\n\t\t\t}\r\n\r\n\t\t\tumb-icon {\r\n\t\t\t\tfont-size: var(--uui-size-8);\r\n\t\t\t}\r\n\r\n\t\t\timg {\r\n\t\t\t\tbackground-image: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\" fill-opacity=\".1\"><path d=\"M50 0h50v50H50zM0 50h50v50H0z\"/></svg>');\r\n\t\t\t\tbackground-size: 10px 10px;\r\n\t\t\t\tbackground-repeat: repeat;\r\n\t\t\t}\r\n\r\n\t\t\t#actions {\r\n\t\t\t\tmax-width: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t.not-allowed {\r\n\t\t\t\tcursor: not-allowed;\r\n\t\t\t\topacity: 0.5;\r\n\t\t\t}\r\n\r\n\t\t\tuui-pagination {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tmargin-top: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbMediaPickerModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-media-picker-modal': UmbMediaPickerModalElement;\r\n\t}\r\n}\r\n","import { UMB_SECTION_PATH_PATTERN } from '@umbraco-cms/backoffice/section';\r\n\r\nexport const UMB_MEDIA_SECTION_PATHNAME = 'media';\r\nexport const UMB_MEDIA_SECTION_PATH = UMB_SECTION_PATH_PATTERN.generateAbsolute({\r\n\tsectionName: UMB_MEDIA_SECTION_PATHNAME,\r\n});\r\n","import { UMB_MEDIA_SECTION_PATHNAME } from '../media-section/paths.js';\r\nimport { UMB_MEDIA_ENTITY_TYPE, type UmbMediaEntityTypeUnion } from './entity.js';\r\nimport { UMB_WORKSPACE_PATH_PATTERN } from '@umbraco-cms/backoffice/workspace';\r\nimport { UmbPathPattern } from '@umbraco-cms/backoffice/router';\r\n\r\nexport const UMB_MEDIA_WORKSPACE_PATH = UMB_WORKSPACE_PATH_PATTERN.generateAbsolute({\r\n\tsectionName: UMB_MEDIA_SECTION_PATHNAME,\r\n\tentityType: UMB_MEDIA_ENTITY_TYPE,\r\n});\r\n\r\nexport const UMB_CREATE_MEDIA_WORKSPACE_PATH_PATTERN = new UmbPathPattern<{\r\n\tparentEntityType: UmbMediaEntityTypeUnion;\r\n\tparentUnique?: string | null;\r\n\tmediaTypeUnique: string;\r\n}>('create/parent/:parentEntityType/:parentUnique/:mediaTypeUnique', UMB_MEDIA_WORKSPACE_PATH);\r\n\r\nexport const UMB_EDIT_MEDIA_WORKSPACE_PATH_PATTERN = new UmbPathPattern<{ unique: string }>('edit/:unique');\r\n","import type { UmbMediaRecycleBinTreeStore } from './media-recycle-bin-tree.store.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const UMB_MEDIA_RECYCLE_BIN_TREE_STORE_CONTEXT = new UmbContextToken<UmbMediaRecycleBinTreeStore>(\r\n\t'UmbMediaRecycleBinTreeStore',\r\n);\r\n","export const UMB_MEDIA_ITEM_REPOSITORY_ALIAS = 'Umb.Repository.MediaItem';\r\nexport const UMB_MEDIA_STORE_ALIAS = 'Umb.Store.MediaItem';\r\nexport { UMB_MEDIA_ITEM_STORE_CONTEXT } from './media-item.store.context-token.js';\r\n","export * from './global-search/constants.js';\r\nexport const UMB_MEDIA_SEARCH_PROVIDER_ALIAS = 'Umb.SearchProvider.Media';\r\n","import type { UmbMediaTreeItemModel } from './types.js';\r\nimport { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\nimport {\r\n\ttype UmbTreePickerModalValue,\r\n\ttype UmbTreePickerModalData,\r\n\tUMB_TREE_PICKER_MODAL_ALIAS,\r\n} from '@umbraco-cms/backoffice/tree';\r\n\r\nexport type UmbMediaTreePickerModalData = UmbTreePickerModalData<UmbMediaTreeItemModel>;\r\nexport type UmbMediaTreePickerModalValue = UmbTreePickerModalValue;\r\n\r\nexport const UMB_MEDIA_TREE_PICKER_MODAL = new UmbModalToken<UmbMediaTreePickerModalData, UmbMediaTreePickerModalValue>(\r\n\tUMB_TREE_PICKER_MODAL_ALIAS,\r\n\t{\r\n\t\tmodal: {\r\n\t\t\ttype: 'sidebar',\r\n\t\t\tsize: 'small',\r\n\t\t},\r\n\t\tdata: {\r\n\t\t\ttreeAlias: 'Umb.Tree.Media',\r\n\t\t},\r\n\t},\r\n);\r\n","import { UMB_MEDIA_ENTITY_TYPE } from '../entity.js';\r\nimport type { UmbMediaWorkspaceContext } from './media-workspace.context.js';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\nimport type { UmbSubmittableWorkspaceContext } from '@umbraco-cms/backoffice/workspace';\r\n\r\nexport const UMB_MEDIA_WORKSPACE_CONTEXT = new UmbContextToken<\r\n\tUmbSubmittableWorkspaceContext,\r\n\tUmbMediaWorkspaceContext\r\n>(\r\n\t'UmbWorkspaceContext',\r\n\tundefined,\r\n\t(context): context is UmbMediaWorkspaceContext => context.getEntityType?.() === UMB_MEDIA_ENTITY_TYPE,\r\n);\r\n","import { UMB_MEDIA_ENTITY_TYPE } from '../entity.js';\r\nimport type { UmbMediaPropertyDatasetContext } from './media-property-dataset-context.js';\r\nimport type { UmbPropertyDatasetContext } from '@umbraco-cms/backoffice/property';\r\nimport { UmbContextToken } from '@umbraco-cms/backoffice/context-api';\r\n\r\nexport const IsMediaVariantContext = (context: UmbPropertyDatasetContext): context is UmbMediaPropertyDatasetContext =>\r\n\tcontext.getEntityType() === UMB_MEDIA_ENTITY_TYPE;\r\n\r\nexport const UMB_MEDIA_VARIANT_CONTEXT = new UmbContextToken<UmbPropertyDatasetContext, UmbMediaPropertyDatasetContext>(\r\n\t'UmbVariantContext',\r\n\tundefined,\r\n\tIsMediaVariantContext,\r\n);\r\n","import { UmbMediaDetailRepository } from '../../repository/index.js';\r\nimport type {\r\n\tUmbMediaCaptionAltTextModalData,\r\n\tUmbMediaCaptionAltTextModalValue,\r\n} from './media-caption-alt-text-modal.token.js';\r\nimport { css, html, customElement } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport type { UUIInputEvent } from '@umbraco-cms/backoffice/external/uui';\r\nimport { UmbMediaUrlRepository } from '../../url/index.js';\r\n\r\n@customElement('umb-media-caption-alt-text-modal')\r\nexport class UmbMediaCaptionAltTextModalElement extends UmbModalBaseElement<\r\n\tUmbMediaCaptionAltTextModalData,\r\n\tUmbMediaCaptionAltTextModalValue\r\n> {\r\n\t#mediaUnique?: string;\r\n\treadonly #mediaDetailRepository = new UmbMediaDetailRepository(this);\r\n\treadonly #mediaUrlRepository = new UmbMediaUrlRepository(this);\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\t\tthis.#mediaUnique = this.data?.mediaUnique;\r\n\t\tthis.#getMediaDetail();\r\n\t}\r\n\r\n\tasync #getMediaDetail() {\r\n\t\tif (!this.#mediaUnique) return;\r\n\t\tconst { data: mediaData } = await this.#mediaDetailRepository.requestByUnique(this.#mediaUnique);\r\n\t\tif (!mediaData) return;\r\n\r\n\t\tconst { data: mediaUrlData } = await this.#mediaUrlRepository.requestItems([this.#mediaUnique]);\r\n\r\n\t\tthis.value = {\r\n\t\t\t...this.value,\r\n\t\t\taltText: this.value?.altText ?? mediaData.variants[0].name,\r\n\t\t\turl: mediaUrlData?.[0].url ?? ''\r\n\t\t};\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout .headline=${this.localize.term('defaultdialogs_editSelectedMedia')}>\r\n\t\t\t\t<div id=\"wrapper\">\r\n\t\t\t\t\t<uui-label for=\"alt-text\">${this.localize.term('content_altTextOptional')}</uui-label>\r\n\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\tid=\"alt-text\"\r\n\t\t\t\t\t\tlabel=\"alt text\"\r\n\t\t\t\t\t\t.value=${this.value?.altText ?? ''}\r\n\t\t\t\t\t\t@input=${(e: UUIInputEvent) =>\r\n\t\t\t\t\t\t\t(this.value = { ...this.value, altText: e.target.value as string })}></uui-input>\r\n\r\n\t\t\t\t\t<uui-label for=\"caption\">${this.localize.term('content_captionTextOptional')}</uui-label>\r\n\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\tid=\"caption\"\r\n\t\t\t\t\t\tlabel=\"caption\"\r\n\t\t\t\t\t\t.value=${this.value?.caption ?? ''}\r\n\t\t\t\t\t\t@input=${(e: UUIInputEvent) =>\r\n\t\t\t\t\t\t\t(this.value = { ...this.value, caption: e.target.value as string })}></uui-input>\r\n\r\n\t\t\t\t\t<figure id=\"mainobject\">\r\n\t\t\t\t\t\t<img src=${this.value?.url ?? ''} alt=${this.value?.altText ?? ''} />\r\n\t\t\t\t\t\t<figcaption>${this.value?.caption ?? ''}</figcaption>\r\n\t\t\t\t\t</figure>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div slot=\"actions\">\r\n\t\t\t\t\t<uui-button label=${this.localize.term('general_close')} @click=${this._rejectModal}></uui-button>\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlabel=${this.localize.term('general_submit')}\r\n\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\t@click=${this._submitModal}></uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tcss`\r\n\t\t\tuui-input {\r\n\t\t\t\tmargin-bottom: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t#wrapper {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t}\r\n\r\n\t\t\t#mainobject {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\tmax-width: 100%;\r\n\r\n\t\t\t\timg {\r\n\t\t\t\t\tmax-width: 100%;\r\n\t\t\t\t\theight: auto;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbMediaCaptionAltTextModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-media-caption-alt-text-modal': UmbMediaCaptionAltTextModalElement;\r\n\t}\r\n}\r\n","import { UMB_MEDIA_ITEM_REPOSITORY_ALIAS } from '../../constants.js';\r\nimport { UMB_MEDIA_PICKER_MODAL } from '../../modals/index.js';\r\nimport type { UmbMediaItemModel } from '../../repository/item/types.js';\r\nimport type { UmbMediaPickerModalData, UmbMediaPickerModalValue } from '../../modals/index.js';\r\nimport { UMB_MEDIA_SEARCH_PROVIDER_ALIAS } from '../../search/constants.js';\r\nimport type { UmbMediaTreeItemModel } from '../../tree/types.js';\r\nimport { UmbPickerInputContext } from '@umbraco-cms/backoffice/picker-input';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbMediaTypeEntityType } from '@umbraco-cms/backoffice/media-type';\r\nimport { UMB_VARIANT_CONTEXT } from '@umbraco-cms/backoffice/variant';\r\n\r\ninterface UmbMediaPickerInputContextOpenArgs {\r\n\tallowedContentTypes?: Array<{ unique: string; entityType: UmbMediaTypeEntityType }>;\r\n\tincludeTrashed?: boolean;\r\n}\r\n\r\nexport class UmbMediaPickerInputContext extends UmbPickerInputContext<\r\n\tUmbMediaItemModel,\r\n\tUmbMediaTreeItemModel,\r\n\tUmbMediaPickerModalData,\r\n\tUmbMediaPickerModalValue\r\n> {\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_MEDIA_ITEM_REPOSITORY_ALIAS, UMB_MEDIA_PICKER_MODAL);\r\n\t}\r\n\r\n\toverride async openPicker(pickerData?: Partial<UmbMediaPickerModalData>, args?: UmbMediaPickerInputContextOpenArgs) {\r\n\t\tconst combinedPickerData = {\r\n\t\t\t...pickerData,\r\n\t\t};\r\n\r\n\t\t// transform allowedContentTypes to a pickable filter\r\n\t\tcombinedPickerData.pickableFilter = (item) => this.#pickableFilter(item, args?.allowedContentTypes);\r\n\r\n\t\t// set default search data\r\n\t\tif (!pickerData?.search) {\r\n\t\t\tcombinedPickerData.search = {\r\n\t\t\t\tproviderAlias: UMB_MEDIA_SEARCH_PROVIDER_ALIAS,\r\n\t\t\t\t...pickerData?.search,\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tconst variantContext = await this.getContext(UMB_VARIANT_CONTEXT);\r\n\t\tconst culture = await variantContext?.getDisplayCulture();\r\n\r\n\t\t// pass allowedContentTypes to the search request args\r\n\t\tcombinedPickerData.search!.queryParams = {\r\n\t\t\tallowedContentTypes: args?.allowedContentTypes,\r\n\t\t\tincludeTrashed: args?.includeTrashed,\r\n\t\t\tculture,\r\n\t\t\t...pickerData?.search?.queryParams,\r\n\t\t};\r\n\r\n\t\tawait super.openPicker(combinedPickerData);\r\n\t}\r\n\r\n\t#pickableFilter = (\r\n\t\titem: UmbMediaItemModel,\r\n\t\tallowedContentTypes?: Array<{ unique: string; entityType: UmbMediaTypeEntityType }>,\r\n\t): boolean => {\r\n\t\tif (allowedContentTypes && allowedContentTypes.length > 0) {\r\n\t\t\treturn allowedContentTypes\r\n\t\t\t\t.map((contentTypeReference) => contentTypeReference.unique)\r\n\t\t\t\t.includes(item.mediaType.unique);\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n}\r\n","import type { UmbMediaCardItemModel } from '../../types.js';\r\nimport { UmbMediaPickerInputContext } from './input-media.context.js';\r\nimport {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tifDefined,\r\n\tnothing,\r\n\tproperty,\r\n\trepeat,\r\n\tstate,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { splitStringToArray } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbModalRouteRegistrationController } from '@umbraco-cms/backoffice/router';\r\nimport { UmbSorterController, UmbSorterResolvePlacementAsGrid } from '@umbraco-cms/backoffice/sorter';\r\nimport { UMB_WORKSPACE_MODAL } from '@umbraco-cms/backoffice/workspace';\r\nimport { UmbFormControlMixin } from '@umbraco-cms/backoffice/validation';\r\nimport type { UmbTreeStartNode } from '@umbraco-cms/backoffice/tree';\r\nimport { UMB_MEDIA_TYPE_ENTITY_TYPE } from '@umbraco-cms/backoffice/media-type';\r\n\r\nimport '@umbraco-cms/backoffice/imaging';\r\n\r\nconst elementName = 'umb-input-media';\r\n@customElement(elementName)\r\nexport class UmbInputMediaElement extends UmbFormControlMixin<string | undefined, typeof UmbLitElement>(UmbLitElement) {\r\n\t#sorter = new UmbSorterController<string>(this, {\r\n\t\tgetUniqueOfElement: (element) => {\r\n\t\t\treturn element.getAttribute('detail');\r\n\t\t},\r\n\t\tgetUniqueOfModel: (modelEntry) => {\r\n\t\t\treturn modelEntry;\r\n\t\t},\r\n\t\tidentifier: 'Umb.SorterIdentifier.InputMedia',\r\n\t\titemSelector: 'uui-card-media',\r\n\t\tcontainerSelector: '.container',\r\n\t\tresolvePlacement: UmbSorterResolvePlacementAsGrid,\r\n\t\tonChange: ({ model }) => {\r\n\t\t\tthis.selection = model;\r\n\t\t\tthis.#sortCards(model);\r\n\t\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t\t},\r\n\t});\r\n\r\n\t#sortCards(model: Array<string>) {\r\n\t\tconst idToIndexMap: { [unique: string]: number } = {};\r\n\t\tmodel.forEach((item, index) => {\r\n\t\t\tidToIndexMap[item] = index;\r\n\t\t});\r\n\r\n\t\tconst cards = [...this._cards];\r\n\t\tthis._cards = cards.sort((a, b) => idToIndexMap[a.unique] - idToIndexMap[b.unique]);\r\n\t}\r\n\r\n\t/**\r\n\t * This is a minimum amount of selected items in this input.\r\n\t * @type {number}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Number })\r\n\tpublic set min(value: number) {\r\n\t\tthis.#pickerContext.min = value;\r\n\t}\r\n\tpublic get min(): number {\r\n\t\treturn this.#pickerContext.min;\r\n\t}\r\n\r\n\t/**\r\n\t * Min validation message.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: String, attribute: 'min-message' })\r\n\tminMessage = 'This field need more items';\r\n\r\n\t/**\r\n\t * This is a maximum amount of selected items in this input.\r\n\t * @type {number}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Number })\r\n\tpublic set max(value: number) {\r\n\t\tthis.#pickerContext.max = value;\r\n\t}\r\n\tpublic get max(): number {\r\n\t\treturn this.#pickerContext.max;\r\n\t}\r\n\r\n\t/**\r\n\t * Max validation message.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: String, attribute: 'max-message' })\r\n\tmaxMessage = 'This field exceeds the allowed amount of items';\r\n\r\n\tpublic set selection(ids: Array<string>) {\r\n\t\tthis.#pickerContext.setSelection(ids);\r\n\t\tthis.#sorter.setModel(ids);\r\n\t}\r\n\tpublic get selection(): Array<string> {\r\n\t\treturn this.#pickerContext.getSelection();\r\n\t}\r\n\r\n\t@property({ type: Array })\r\n\tallowedContentTypeIds?: Array<string> | undefined;\r\n\r\n\t@property({ type: Boolean, attribute: 'include-trashed' })\r\n\tincludeTrashed = false;\r\n\r\n\t@property({ type: Object, attribute: false })\r\n\tstartNode?: UmbTreeStartNode;\r\n\r\n\t@property({ type: String })\r\n\tpublic override set value(selectionString: string | undefined) {\r\n\t\tthis.selection = splitStringToArray(selectionString);\r\n\t}\r\n\tpublic override get value(): string | undefined {\r\n\t\treturn this.selection.length > 0 ? this.selection.join(',') : undefined;\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the input to readonly mode, meaning value cannot be changed but still able to read and select its content.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Boolean, reflect: true })\r\n\tpublic get readonly() {\r\n\t\treturn this.#readonly;\r\n\t}\r\n\tpublic set readonly(value) {\r\n\t\tthis.#readonly = value;\r\n\r\n\t\tif (this.#readonly) {\r\n\t\t\tthis.#sorter.disable();\r\n\t\t} else {\r\n\t\t\tthis.#sorter.enable();\r\n\t\t}\r\n\t}\r\n\t#readonly = false;\r\n\r\n\t@state()\r\n\tprivate _editMediaPath = '';\r\n\r\n\t@state()\r\n\tprivate _cards: Array<UmbMediaCardItemModel> = [];\r\n\r\n\t#pickerContext = new UmbMediaPickerInputContext(this);\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tnew UmbModalRouteRegistrationController(this, UMB_WORKSPACE_MODAL)\r\n\t\t\t.addAdditionalPath('media')\r\n\t\t\t.onSetup(() => {\r\n\t\t\t\treturn { data: { entityType: 'media', preset: {} } };\r\n\t\t\t})\r\n\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\tthis._editMediaPath = routeBuilder({});\r\n\t\t\t});\r\n\r\n\t\tthis.observe(this.#pickerContext.selection, (selection) => (this.value = selection.join(',')));\r\n\r\n\t\tthis.observe(this.#pickerContext.selectedItems, async (selectedItems) => {\r\n\t\t\tconst missingCards = selectedItems.filter((item) => !this._cards.find((card) => card.unique === item.unique));\r\n\t\t\tif (selectedItems?.length && !missingCards.length) return;\r\n\r\n\t\t\tthis._cards = selectedItems ?? [];\r\n\t\t});\r\n\r\n\t\tthis.addValidator(\r\n\t\t\t'rangeUnderflow',\r\n\t\t\t() => this.minMessage,\r\n\t\t\t() => !!this.min && this.selection.length < this.min,\r\n\t\t);\r\n\t\tthis.addValidator(\r\n\t\t\t'rangeOverflow',\r\n\t\t\t() => this.maxMessage,\r\n\t\t\t() => !!this.max && this.selection.length > this.max,\r\n\t\t);\r\n\t}\r\n\r\n\t#openPicker() {\r\n\t\tthis.#pickerContext.openPicker(\r\n\t\t\t{\r\n\t\t\t\tmultiple: this.max > 1,\r\n\t\t\t\tstartNode: this.startNode,\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tallowedContentTypes: this.allowedContentTypeIds?.map((id) => ({\r\n\t\t\t\t\tunique: id,\r\n\t\t\t\t\tentityType: UMB_MEDIA_TYPE_ENTITY_TYPE,\r\n\t\t\t\t})),\r\n\t\t\t\tincludeTrashed: this.includeTrashed,\r\n\t\t\t},\r\n\t\t);\r\n\t}\r\n\r\n\tasync #onRemove(item: UmbMediaCardItemModel) {\r\n\t\tawait this.#pickerContext.requestRemoveItem(item.unique);\r\n\t\tthis._cards = this._cards.filter((x) => x.unique !== item.unique);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`<div class=\"container\">${this.#renderItems()} ${this.#renderAddButton()}</div>`;\r\n\t}\r\n\r\n\t#renderItems() {\r\n\t\tif (!this._cards?.length) return nothing;\r\n\t\treturn html`\r\n\t\t\t${repeat(\r\n\t\t\t\tthis._cards,\r\n\t\t\t\t(item) => item.unique,\r\n\t\t\t\t(item) => this.#renderItem(item),\r\n\t\t\t)}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderAddButton() {\r\n\t\t// TODO: Stop preventing adding more, instead implement proper validation for user feedback. [NL]\r\n\t\tif (this._cards && this.max && this._cards.length >= this.max) return nothing;\r\n\t\tif (this.readonly && this._cards.length > 0) {\r\n\t\t\treturn nothing;\r\n\t\t} else {\r\n\t\t\treturn html`\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tid=\"btn-add\"\r\n\t\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t\t@click=${this.#openPicker}\r\n\t\t\t\t\tlabel=${this.localize.term('general_choose')}\r\n\t\t\t\t\t?disabled=${this.readonly}>\r\n\t\t\t\t\t<uui-icon name=\"icon-add\"></uui-icon>\r\n\t\t\t\t\t${this.localize.term('general_choose')}\r\n\t\t\t\t</uui-button>\r\n\t\t\t`;\r\n\t\t}\r\n\t}\r\n\r\n\t#renderItem(item: UmbMediaCardItemModel) {\r\n\t\tconst href = this.readonly ? undefined : `${this._editMediaPath}edit/${item.unique}`;\r\n\t\treturn html`\r\n\t\t\t<uui-card-media\r\n\t\t\t\tname=${ifDefined(item.name === null ? undefined : item.name)}\r\n\t\t\t\tdata-mark=\"${item.entityType}:${item.unique}\"\r\n\t\t\t\thref=\"${ifDefined(href)}\"\r\n\t\t\t\t?readonly=${this.readonly}>\r\n\t\t\t\t<umb-imaging-thumbnail\r\n\t\t\t\t\tunique=${item.unique}\r\n\t\t\t\t\talt=${item.name}\r\n\t\t\t\t\ticon=${item.mediaType.icon}></umb-imaging-thumbnail>\r\n\t\t\t\t${this.#renderIsTrashed(item)}\r\n\t\t\t\t<uui-action-bar slot=\"actions\"> ${this.#renderRemoveAction(item)}</uui-action-bar>\r\n\t\t\t</uui-card-media>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderRemoveAction(item: UmbMediaCardItemModel) {\r\n\t\tif (this.readonly) return nothing;\r\n\t\treturn html`\r\n\t\t\t<uui-button label=${this.localize.term('general_remove')} look=\"secondary\" @click=${() => this.#onRemove(item)}>\r\n\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t</uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderIsTrashed(item: UmbMediaCardItemModel) {\r\n\t\tif (!item.isTrashed) return nothing;\r\n\t\treturn html`\r\n\t\t\t<uui-tag size=\"s\" slot=\"tag\" color=\"danger\">\r\n\t\t\t\t<umb-localize key=\"mediaPicker_trashed\">Trashed</umb-localize>\r\n\t\t\t</uui-tag>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t}\r\n\t\t\t.container {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tgrid-template-columns: repeat(auto-fill, minmax(var(--umb-card-medium-min-width), 1fr));\r\n\t\t\t\tgrid-auto-rows: var(--umb-card-medium-min-width);\r\n\t\t\t}\r\n\r\n\t\t\t#btn-add {\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\tuui-icon {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tmargin: 0 auto;\r\n\t\t\t}\r\n\r\n\t\t\tuui-card-media umb-icon {\r\n\t\t\t\tfont-size: var(--uui-size-8);\r\n\t\t\t}\r\n\r\n\t\t\tuui-card-media[drag-placeholder] {\r\n\t\t\t\topacity: 0.2;\r\n\t\t\t}\r\n\t\t\timg {\r\n\t\t\t\tbackground-image: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\" fill-opacity=\".1\"><path d=\"M50 0h50v50H50zM0 50h50v50H0z\"/></svg>');\r\n\t\t\t\tbackground-size: 10px 10px;\r\n\t\t\t\tbackground-repeat: repeat;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { UmbInputMediaElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t[elementName]: UmbInputMediaElement;\r\n\t}\r\n}\r\n","import { UMB_IMAGE_CROPPER_EDITOR_MODAL, UMB_MEDIA_PICKER_MODAL } from '../../modals/index.js';\r\nimport type { UmbMediaItemModel, UmbCropModel, UmbMediaPickerPropertyValueEntry } from '../../types.js';\r\nimport { UMB_MEDIA_ITEM_REPOSITORY_ALIAS } from '../../repository/constants.js';\r\nimport type { UmbUploadableItem } from '@umbraco-cms/backoffice/dropzone';\r\nimport { css, customElement, html, nothing, property, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { umbConfirmModal, UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbId } from '@umbraco-cms/backoffice/id';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbModalRouteRegistrationController } from '@umbraco-cms/backoffice/router';\r\nimport { UmbSorterController, UmbSorterResolvePlacementAsGrid } from '@umbraco-cms/backoffice/sorter';\r\nimport type { UmbModalRouteBuilder } from '@umbraco-cms/backoffice/router';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport type { UmbTreeStartNode } from '@umbraco-cms/backoffice/tree';\r\nimport { UMB_VALIDATION_EMPTY_LOCALIZATION_KEY, UmbFormControlMixin } from '@umbraco-cms/backoffice/validation';\r\nimport { UmbRepositoryItemsManager } from '@umbraco-cms/backoffice/repository';\r\n\r\nimport '@umbraco-cms/backoffice/imaging';\r\n\r\ntype UmbRichMediaCardModel = {\r\n\tunique: string;\r\n\tmedia: string;\r\n\tname: string;\r\n\tsrc?: string;\r\n\ticon?: string;\r\n\tisTrashed?: boolean;\r\n};\r\n\r\n@customElement('umb-input-rich-media')\r\nexport class UmbInputRichMediaElement extends UmbFormControlMixin<\r\n\tArray<UmbMediaPickerPropertyValueEntry>,\r\n\ttypeof UmbLitElement,\r\n\tundefined\r\n>(UmbLitElement, undefined) {\r\n\t#sorter = new UmbSorterController<UmbMediaPickerPropertyValueEntry>(this, {\r\n\t\tgetUniqueOfElement: (element) => {\r\n\t\t\treturn element.id;\r\n\t\t},\r\n\t\tgetUniqueOfModel: (modelEntry) => {\r\n\t\t\treturn modelEntry.key;\r\n\t\t},\r\n\t\tidentifier: 'Umb.SorterIdentifier.InputRichMedia',\r\n\t\titemSelector: 'uui-card-media',\r\n\t\tcontainerSelector: '.container',\r\n\t\tresolvePlacement: UmbSorterResolvePlacementAsGrid,\r\n\t\tonChange: ({ model }) => {\r\n\t\t\tthis.value = model;\r\n\t\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t\t},\r\n\t});\r\n\r\n\t/**\r\n\t * Sets the input to required, meaning validation will fail if the value is empty.\r\n\t * @type {boolean}\r\n\t */\r\n\t@property({ type: Boolean })\r\n\trequired?: boolean;\r\n\r\n\t@property({ type: String })\r\n\trequiredMessage?: string;\r\n\r\n\t/**\r\n\t * This is a minimum amount of selected items in this input.\r\n\t * @type {number}\r\n\t * @attr\r\n\t * @default 0\r\n\t */\r\n\t@property({ type: Number })\r\n\tpublic min = 0;\r\n\r\n\t/**\r\n\t * Min validation message.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: String, attribute: 'min-message' })\r\n\tminMessage = 'This field need more items';\r\n\r\n\t/**\r\n\t * This is a maximum amount of selected items in this input.\r\n\t * @type {number}\r\n\t * @attr\r\n\t * @default Infinity\r\n\t */\r\n\t@property({ type: Number })\r\n\tpublic max = Infinity;\r\n\r\n\t/**\r\n\t * Max validation message.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: String, attribute: 'min-message' })\r\n\tmaxMessage = 'This field exceeds the allowed amount of items';\r\n\r\n\t@property({ type: Array })\r\n\tpublic override set value(value: Array<UmbMediaPickerPropertyValueEntry> | undefined) {\r\n\t\tsuper.value = value;\r\n\t\tthis.#sorter.setModel(value);\r\n\t\tthis.#itemManager.setUniques(value?.map((x) => x.mediaKey));\r\n\t\t// Maybe the new value is using an existing media, and there we need to update the cards despite no repository update.\r\n\t\tthis.#populateCards();\r\n\t}\r\n\tpublic override get value(): Array<UmbMediaPickerPropertyValueEntry> | undefined {\r\n\t\treturn super.value;\r\n\t}\r\n\r\n\t@property({ type: Array })\r\n\tallowedContentTypeIds?: string[] | undefined;\r\n\r\n\t@property({ type: Object, attribute: false })\r\n\tstartNode?: UmbTreeStartNode;\r\n\r\n\t@property({ type: Boolean })\r\n\tmultiple = false;\r\n\r\n\t@property({ type: Array })\r\n\tpublic preselectedCrops?: Array<UmbCropModel>;\r\n\r\n\t@property({ type: Boolean })\r\n\tpublic set focalPointEnabled(value: boolean) {\r\n\t\tthis.#focalPointEnabled = value;\r\n\t}\r\n\tpublic get focalPointEnabled(): boolean {\r\n\t\treturn this.#focalPointEnabled;\r\n\t}\r\n\t#focalPointEnabled: boolean = false;\r\n\r\n\t@property()\r\n\t/** @deprecated will be removed in v17 */\r\n\tpublic set alias(value: string | undefined) {\r\n\t\t//this.#modalRouter.setUniquePathValue('propertyAlias', value);\r\n\t}\r\n\tpublic get alias(): string | undefined {\r\n\t\treturn undefined; //this.#modalRouter.getUniquePathValue('propertyAlias');\r\n\t}\r\n\r\n\t@property()\r\n\t/** @deprecated will be removed in v17 */\r\n\tpublic set variantId(value: string | UmbVariantId | undefined) {\r\n\t\t//this.#modalRouter.setUniquePathValue('variantId', value?.toString());\r\n\t}\r\n\tpublic get variantId(): string | undefined {\r\n\t\treturn undefined; //this.#modalRouter.getUniquePathValue('variantId');\r\n\t}\r\n\r\n\t/**\r\n\t * Sets the input to readonly mode, meaning value cannot be changed but still able to read and select its content.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Boolean, reflect: true })\r\n\tpublic get readonly() {\r\n\t\treturn this.#readonly;\r\n\t}\r\n\tpublic set readonly(value) {\r\n\t\tthis.#readonly = value;\r\n\r\n\t\tif (this.#readonly) {\r\n\t\t\tthis.#sorter.disable();\r\n\t\t} else {\r\n\t\t\tthis.#sorter.enable();\r\n\t\t}\r\n\t}\r\n\t#readonly = false;\r\n\r\n\t@state()\r\n\tprivate _cards: Array<UmbRichMediaCardModel> = [];\r\n\r\n\t@state()\r\n\tprivate _routeBuilder?: UmbModalRouteBuilder;\r\n\r\n\treadonly #itemManager = new UmbRepositoryItemsManager<UmbMediaItemModel>(this, UMB_MEDIA_ITEM_REPOSITORY_ALIAS);\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.observe(this.#itemManager.items, () => {\r\n\t\t\tthis.#populateCards();\r\n\t\t});\r\n\r\n\t\tnew UmbModalRouteRegistrationController(this, UMB_IMAGE_CROPPER_EDITOR_MODAL)\r\n\t\t\t.addAdditionalPath(':key')\r\n\t\t\t.onSetup((params) => {\r\n\t\t\t\tconst key = params.key;\r\n\t\t\t\tif (!key) return false;\r\n\r\n\t\t\t\tconst item = this.value?.find((item) => item.key === key);\r\n\t\t\t\tif (!item) return false;\r\n\r\n\t\t\t\treturn {\r\n\t\t\t\t\tdata: {\r\n\t\t\t\t\t\tcropOptions: this.preselectedCrops,\r\n\t\t\t\t\t\thideFocalPoint: !this.focalPointEnabled,\r\n\t\t\t\t\t\tkey,\r\n\t\t\t\t\t\tunique: item.mediaKey,\r\n\t\t\t\t\t\tpickableFilter: this.#pickableFilter,\r\n\t\t\t\t\t},\r\n\t\t\t\t\tvalue: {\r\n\t\t\t\t\t\tcrops: item.crops ?? [],\r\n\t\t\t\t\t\tfocalPoint: item.focalPoint ?? { left: 0.5, top: 0.5 },\r\n\t\t\t\t\t\tsrc: '',\r\n\t\t\t\t\t\tkey,\r\n\t\t\t\t\t\tunique: item.mediaKey,\r\n\t\t\t\t\t},\r\n\t\t\t\t};\r\n\t\t\t})\r\n\t\t\t.onSubmit((value) => {\r\n\t\t\t\tthis.value = this.value?.map((item) => {\r\n\t\t\t\t\tif (item.key !== value.key) return item;\r\n\r\n\t\t\t\t\tconst focalPoint = this.focalPointEnabled ? value.focalPoint : null;\r\n\t\t\t\t\tconst crops = value.crops;\r\n\t\t\t\t\tconst mediaKey = value.unique;\r\n\r\n\t\t\t\t\t// Note: If the mediaKey changes we will change the key which causes cards to update\r\n\t\t\t\t\tconst key = mediaKey === item.mediaKey ? item.key : UmbId.new();\r\n\r\n\t\t\t\t\treturn { ...item, crops, mediaKey, focalPoint, key };\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t\t\t})\r\n\t\t\t.observeRouteBuilder((routeBuilder) => {\r\n\t\t\t\tthis._routeBuilder = routeBuilder;\r\n\t\t\t});\r\n\r\n\t\tthis.addValidator(\r\n\t\t\t'valueMissing',\r\n\t\t\t() => this.requiredMessage ?? UMB_VALIDATION_EMPTY_LOCALIZATION_KEY,\r\n\t\t\t() => {\r\n\t\t\t\treturn !this.readonly && !!this.required && (!this.value || this.value.length === 0);\r\n\t\t\t},\r\n\t\t);\r\n\r\n\t\tthis.addValidator(\r\n\t\t\t'rangeUnderflow',\r\n\t\t\t() => this.minMessage,\r\n\t\t\t() =>\r\n\t\t\t\t!this.readonly &&\r\n\t\t\t\t// Only if min is set:\r\n\t\t\t\t!!this.min &&\r\n\t\t\t\t// if the value is empty and not required, we should not validate the min:\r\n\t\t\t\t!(this.value?.length === 0 && this.required == false) &&\r\n\t\t\t\t// Validate the min:\r\n\t\t\t\t(this.value?.length ?? 0) < this.min,\r\n\t\t);\r\n\t\tthis.addValidator(\r\n\t\t\t'rangeOverflow',\r\n\t\t\t() => this.maxMessage,\r\n\t\t\t() => !this.readonly && !!this.value && !!this.max && this.value?.length > this.max,\r\n\t\t);\r\n\t}\r\n\r\n\tprotected override getFormElement() {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tasync #populateCards() {\r\n\t\tconst mediaItems = this.#itemManager.getItems();\r\n\r\n\t\tif (!mediaItems.length) {\r\n\t\t\tthis._cards = [];\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t// Check if all media items is loaded.\r\n\t\t// But notice, it would be nicer UX if we could show a loading state on the cards that are missing(loading) their items.\r\n\t\tconst missingCards = mediaItems.filter((item) => !this._cards.find((card) => card.unique === item.unique));\r\n\t\tconst removedCards = this._cards.filter((card) => !mediaItems.find((item) => card.unique === item.unique));\r\n\t\tif (missingCards.length === 0 && removedCards.length === 0) return;\r\n\r\n\t\tthis._cards =\r\n\t\t\tthis.value?.map((item) => {\r\n\t\t\t\tconst media = mediaItems.find((x) => x.unique === item.mediaKey);\r\n\t\t\t\treturn {\r\n\t\t\t\t\tunique: item.key,\r\n\t\t\t\t\tmedia: item.mediaKey,\r\n\t\t\t\t\tname: media?.name ?? '',\r\n\t\t\t\t\ticon: media?.mediaType?.icon,\r\n\t\t\t\t\tisTrashed: media?.isTrashed ?? false,\r\n\t\t\t\t};\r\n\t\t\t}) ?? [];\r\n\t}\r\n\r\n\t#pickableFilter: (item: UmbMediaItemModel) => boolean = (item) => {\r\n\t\tif (this.allowedContentTypeIds && this.allowedContentTypeIds.length > 0) {\r\n\t\t\treturn this.allowedContentTypeIds.includes(item.mediaType.unique);\r\n\t\t}\r\n\t\treturn true;\r\n\t};\r\n\r\n\t#addItems(uniques: string[]) {\r\n\t\tif (!uniques.length) return;\r\n\r\n\t\tconst additions: Array<UmbMediaPickerPropertyValueEntry> = uniques.map((unique) => ({\r\n\t\t\tkey: UmbId.new(),\r\n\t\t\tmediaKey: unique,\r\n\t\t\tmediaTypeAlias: '',\r\n\t\t\tcrops: [],\r\n\t\t\tfocalPoint: null,\r\n\t\t}));\r\n\r\n\t\tthis.value = [...(this.value ?? []), ...additions];\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\tasync #openPicker() {\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst modalHandler = modalManager?.open(this, UMB_MEDIA_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tmultiple: this.multiple,\r\n\t\t\t\tstartNode: this.startNode,\r\n\t\t\t\tpickableFilter: this.#pickableFilter,\r\n\t\t\t},\r\n\t\t\tvalue: { selection: [] },\r\n\t\t});\r\n\r\n\t\tconst data = await modalHandler?.onSubmit().catch(() => null);\r\n\t\tif (!data) return;\r\n\r\n\t\tconst selection = data.selection.filter((x) => x !== null) as string[];\r\n\t\tthis.#addItems(selection);\r\n\t}\r\n\r\n\tasync #onRemove(item: UmbRichMediaCardModel) {\r\n\t\tawait umbConfirmModal(this, {\r\n\t\t\tcolor: 'danger',\r\n\t\t\theadline: `${this.localize.term('actions_remove')} ${item.name}?`,\r\n\t\t\tcontent: `${this.localize.term('defaultdialogs_confirmremove')} ${item.name}?`,\r\n\t\t\tconfirmLabel: this.localize.term('actions_remove'),\r\n\t\t});\r\n\r\n\t\tthis.value = this.value?.filter((x) => x.key !== item.unique);\r\n\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\tasync #onUploadCompleted(e: CustomEvent) {\r\n\t\tconst completed = e.detail as Array<UmbUploadableItem>;\r\n\t\tconst uploaded = completed.map((file) => file.unique);\r\n\t\tthis.#addItems(uploaded);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t${this.#renderDropzone()}\r\n\t\t\t<div class=\"container\">${this.#renderItems()} ${this.#renderAddButton()}</div>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderDropzone() {\r\n\t\tif (this.readonly) return nothing;\r\n\t\tif (this._cards && this._cards.length >= this.max) return;\r\n\t\treturn html`<umb-dropzone-media\r\n\t\t\t?multiple=${this.max > 1}\r\n\t\t\t@complete=${this.#onUploadCompleted}></umb-dropzone-media>`;\r\n\t}\r\n\r\n\t#renderItems() {\r\n\t\tif (!this._cards.length) return;\r\n\t\treturn html`\r\n\t\t\t${repeat(\r\n\t\t\t\tthis._cards,\r\n\t\t\t\t(item) => item.unique,\r\n\t\t\t\t(item) => this.#renderItem(item),\r\n\t\t\t)}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderAddButton() {\r\n\t\tif (this._cards && this._cards.length && !this.multiple) return;\r\n\t\tif (this.readonly && this._cards.length > 0) {\r\n\t\t\treturn nothing;\r\n\t\t} else {\r\n\t\t\treturn html`\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tid=\"btn-add\"\r\n\t\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t\t@blur=${() => {\r\n\t\t\t\t\t\tthis.pristine = false;\r\n\t\t\t\t\t\tthis.checkValidity();\r\n\t\t\t\t\t}}\r\n\t\t\t\t\t@click=${this.#openPicker}\r\n\t\t\t\t\tlabel=${this.localize.term('general_choose')}\r\n\t\t\t\t\t?disabled=${this.readonly}>\r\n\t\t\t\t\t<uui-icon name=\"icon-add\"></uui-icon>\r\n\t\t\t\t\t${this.localize.term('general_choose')}\r\n\t\t\t\t</uui-button>\r\n\t\t\t`;\r\n\t\t}\r\n\t}\r\n\r\n\t#renderItem(item: UmbRichMediaCardModel) {\r\n\t\tif (!item.unique) return nothing;\r\n\t\tconst href = this.readonly ? undefined : this._routeBuilder?.({ key: item.unique });\r\n\t\treturn html`\r\n\t\t\t<uui-card-media id=${item.unique} name=${item.name} .href=${href} ?readonly=${this.readonly}>\r\n\t\t\t\t<umb-imaging-thumbnail\r\n\t\t\t\t\tunique=${item.media}\r\n\t\t\t\t\talt=${item.name}\r\n\t\t\t\t\ticon=${item.icon ?? 'icon-picture'}></umb-imaging-thumbnail>\r\n\t\t\t\t${this.#renderIsTrashed(item)} ${this.#renderActions(item)}\r\n\t\t\t</uui-card-media>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderActions(item: UmbRichMediaCardModel) {\r\n\t\tif (this.readonly) return nothing;\r\n\t\treturn html`\r\n\t\t\t<uui-action-bar slot=\"actions\">\r\n\t\t\t\t<uui-button label=${this.localize.term('general_remove')} look=\"secondary\" @click=${() => this.#onRemove(item)}>\r\n\t\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t\t\t</uui-button>\r\n\t\t\t</uui-action-bar>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderIsTrashed(item: UmbRichMediaCardModel) {\r\n\t\tif (!item.isTrashed) return;\r\n\t\treturn html`\r\n\t\t\t<uui-tag size=\"s\" slot=\"tag\" color=\"danger\">\r\n\t\t\t\t<umb-localize key=\"mediaPicker_trashed\">Trashed</umb-localize>\r\n\t\t\t</uui-tag>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t}\r\n\t\t\t.container {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgap: var(--uui-size-space-5);\r\n\t\t\t\tgrid-template-columns: repeat(auto-fill, minmax(var(--umb-card-medium-min-width), 1fr));\r\n\t\t\t\tgrid-auto-rows: var(--umb-card-medium-min-width);\r\n\t\t\t}\r\n\r\n\t\t\t#btn-add {\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\tuui-icon {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tmargin: 0 auto;\r\n\t\t\t}\r\n\r\n\t\t\tuui-card-media umb-icon {\r\n\t\t\t\tfont-size: var(--uui-size-8);\r\n\t\t\t}\r\n\r\n\t\t\tuui-card-media[drag-placeholder] {\r\n\t\t\t\topacity: 0.2;\r\n\t\t\t}\r\n\t\t\timg {\r\n\t\t\t\tbackground-image: url('data:image/svg+xml;charset=utf-8,<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100\" height=\"100\" fill-opacity=\".1\"><path d=\"M50 0h50v50H50zM0 50h50v50H0z\"/></svg>');\r\n\t\t\t\tbackground-size: 10px 10px;\r\n\t\t\t\tbackground-repeat: repeat;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbInputRichMediaElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-input-rich-media': UmbInputRichMediaElement;\r\n\t}\r\n}\r\n","/**\r\n * @param {string} extension - The file extension to convert\r\n * @returns { string | null } The MIME type or null if the mime type is not found\r\n */\r\nexport function getMimeTypeFromExtension(extension: string): string | null {\r\n\t// Define a map of file extensions to MIME types\r\n\tconst mimeTypes: { [key: string]: string } = {\r\n\t\t'.123': 'application/vnd.lotus-1-2-3',\r\n\t\t'.3dml': 'text/vnd.in3d.3dml',\r\n\t\t'.3g2': 'video/3gpp2',\r\n\t\t'.3gp': 'video/3gpp',\r\n\t\t'.a': 'application/octet-stream',\r\n\t\t'.aab': 'application/x-authorware-bin',\r\n\t\t'.aac': 'audio/x-aac',\r\n\t\t'.aam': 'application/x-authorware-map',\r\n\t\t'.aas': 'application/x-authorware-seg',\r\n\t\t'.abw': 'application/x-abiword',\r\n\t\t'.acc': 'application/vnd.americandynamics.acc',\r\n\t\t'.ace': 'application/x-ace-compressed',\r\n\t\t'.acu': 'application/vnd.acucobol',\r\n\t\t'.acutc': 'application/vnd.acucorp',\r\n\t\t'.adp': 'audio/adpcm',\r\n\t\t'.aep': 'application/vnd.audiograph',\r\n\t\t'.afm': 'application/x-font-type1',\r\n\t\t'.afp': 'application/vnd.ibm.modcap',\r\n\t\t'.ai': 'application/postscript',\r\n\t\t'.aif': 'audio/x-aiff',\r\n\t\t'.aifc': 'audio/x-aiff',\r\n\t\t'.aiff': 'audio/x-aiff',\r\n\t\t'.air': 'application/vnd.adobe.air-application-installer-package+zip',\r\n\t\t'.ami': 'application/vnd.amiga.ami',\r\n\t\t'.apk': 'application/vnd.android.package-archive',\r\n\t\t'.application': 'application/x-ms-application',\r\n\t\t'.apr': 'application/vnd.lotus-approach',\r\n\t\t'.asc': 'application/pgp-signature',\r\n\t\t'.asf': 'video/x-ms-asf',\r\n\t\t'.asm': 'text/x-asm',\r\n\t\t'.aso': 'application/vnd.accpac.simply.aso',\r\n\t\t'.asx': 'video/x-ms-asf',\r\n\t\t'.atc': 'application/vnd.acucorp',\r\n\t\t'.atom': 'application/atom+xml',\r\n\t\t'.atomcat': 'application/atomcat+xml',\r\n\t\t'.atomsvc': 'application/atomsvc+xml',\r\n\t\t'.atx': 'application/vnd.antix.game-component',\r\n\t\t'.au': 'audio/basic',\r\n\t\t'.avi': 'video/x-msvideo',\r\n\t\t'.aw': 'application/applixware',\r\n\t\t'.azf': 'application/vnd.airzip.filesecure.azf',\r\n\t\t'.azs': 'application/vnd.airzip.filesecure.azs',\r\n\t\t'.azw': 'application/vnd.amazon.ebook',\r\n\t\t'.bat': 'application/x-msdownload',\r\n\t\t'.bcpio': 'application/x-bcpio',\r\n\t\t'.bdf': 'application/x-font-bdf',\r\n\t\t'.bdm': 'application/vnd.syncml.dm+wbxml',\r\n\t\t'.bh2': 'application/vnd.fujitsu.oasysprs',\r\n\t\t'.bin': 'application/octet-stream',\r\n\t\t'.bmi': 'application/vnd.bmi',\r\n\t\t'.bmp': 'image/bmp',\r\n\t\t'.book': 'application/vnd.framemaker',\r\n\t\t'.box': 'application/vnd.previewsystems.box',\r\n\t\t'.boz': 'application/x-bzip2',\r\n\t\t'.bpk': 'application/octet-stream',\r\n\t\t'.btif': 'image/prs.btif',\r\n\t\t'.bz': 'application/x-bzip',\r\n\t\t'.bz2': 'application/x-bzip2',\r\n\t\t'.c': 'text/x-c',\r\n\t\t'.c4d': 'application/vnd.clonk.c4group',\r\n\t\t'.c4f': 'application/vnd.clonk.c4group',\r\n\t\t'.c4g': 'application/vnd.clonk.c4group',\r\n\t\t'.c4p': 'application/vnd.clonk.c4group',\r\n\t\t'.c4u': 'application/vnd.clonk.c4group',\r\n\t\t'.cab': 'application/vnd.ms-cab-compressed',\r\n\t\t'.car': 'application/vnd.curl.car',\r\n\t\t'.cat': 'application/vnd.ms-pki.seccat',\r\n\t\t'.cc': 'text/x-c',\r\n\t\t'.cct': 'application/x-director',\r\n\t\t'.ccxml': 'application/ccxml+xml',\r\n\t\t'.cdbcmsg': 'application/vnd.contact.cmsg',\r\n\t\t'.cdf': 'application/x-netcdf',\r\n\t\t'.cdkey': 'application/vnd.mediastation.cdkey',\r\n\t\t'.cdx': 'chemical/x-cdx',\r\n\t\t'.cdxml': 'application/vnd.chemdraw+xml',\r\n\t\t'.cdy': 'application/vnd.cinderella',\r\n\t\t'.cer': 'application/pkix-cert',\r\n\t\t'.cgm': 'image/cgm',\r\n\t\t'.chat': 'application/x-chat',\r\n\t\t'.chm': 'application/vnd.ms-htmlhelp',\r\n\t\t'.chrt': 'application/vnd.kde.kchart',\r\n\t\t'.cif': 'chemical/x-cif',\r\n\t\t'.cii': 'application/vnd.anser-web-certificate-issue-initiation',\r\n\t\t'.cil': 'application/vnd.ms-artgalry',\r\n\t\t'.cla': 'application/vnd.claymore',\r\n\t\t'.class': 'application/java-vm',\r\n\t\t'.clkk': 'application/vnd.crick.clicker.keyboard',\r\n\t\t'.clkp': 'application/vnd.crick.clicker.palette',\r\n\t\t'.clkt': 'application/vnd.crick.clicker.template',\r\n\t\t'.clkw': 'application/vnd.crick.clicker.wordbank',\r\n\t\t'.clkx': 'application/vnd.crick.clicker',\r\n\t\t'.clp': 'application/x-msclip',\r\n\t\t'.cmc': 'application/vnd.cosmocaller',\r\n\t\t'.cmdf': 'chemical/x-cmdf',\r\n\t\t'.cml': 'chemical/x-cml',\r\n\t\t'.cmp': 'application/vnd.yellowriver-custom-menu',\r\n\t\t'.cmx': 'image/x-cmx',\r\n\t\t'.cod': 'application/vnd.rim.cod',\r\n\t\t'.com': 'application/x-msdownload',\r\n\t\t'.conf': 'text/plain',\r\n\t\t'.cpio': 'application/x-cpio',\r\n\t\t'.cpp': 'text/x-c',\r\n\t\t'.cpt': 'application/mac-compactpro',\r\n\t\t'.crd': 'application/x-mscardfile',\r\n\t\t'.crl': 'application/pkix-crl',\r\n\t\t'.crt': 'application/x-x509-ca-cert',\r\n\t\t'.csh': 'application/x-csh',\r\n\t\t'.csml': 'chemical/x-csml',\r\n\t\t'.csp': 'application/vnd.commonspace',\r\n\t\t'.css': 'text/css',\r\n\t\t'.cst': 'application/x-director',\r\n\t\t'.csv': 'text/csv',\r\n\t\t'.cu': 'application/cu-seeme',\r\n\t\t'.curl': 'text/vnd.curl',\r\n\t\t'.cww': 'application/prs.cww',\r\n\t\t'.cxt': 'application/x-director',\r\n\t\t'.cxx': 'text/x-c',\r\n\t\t'.daf': 'application/vnd.mobius.daf',\r\n\t\t'.dataless': 'application/vnd.fdsn.seed',\r\n\t\t'.davmount': 'application/davmount+xml',\r\n\t\t'.dcr': 'application/x-director',\r\n\t\t'.dcurl': 'text/vnd.curl.dcurl',\r\n\t\t'.dd2': 'application/vnd.oma.dd2+xml',\r\n\t\t'.ddd': 'application/vnd.fujixerox.ddd',\r\n\t\t'.deb': 'application/x-debian-package',\r\n\t\t'.def': 'text/plain',\r\n\t\t'.deploy': 'application/octet-stream',\r\n\t\t'.der': 'application/x-x509-ca-cert',\r\n\t\t'.dfac': 'application/vnd.dreamfactory',\r\n\t\t'.dic': 'text/x-c',\r\n\t\t'.diff': 'text/plain',\r\n\t\t'.dir': 'application/x-director',\r\n\t\t'.dis': 'application/vnd.mobius.dis',\r\n\t\t'.dist': 'application/octet-stream',\r\n\t\t'.distz': 'application/octet-stream',\r\n\t\t'.djv': 'image/vnd.djvu',\r\n\t\t'.djvu': 'image/vnd.djvu',\r\n\t\t'.dll': 'application/x-msdownload',\r\n\t\t'.dmg': 'application/octet-stream',\r\n\t\t'.dms': 'application/octet-stream',\r\n\t\t'.dna': 'application/vnd.dna',\r\n\t\t'.doc': 'application/msword',\r\n\t\t'.docm': 'application/vnd.ms-word.document.macroenabled.12',\r\n\t\t'.docx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n\t\t'.dot': 'application/msword',\r\n\t\t'.dotm': 'application/vnd.ms-word.template.macroenabled.12',\r\n\t\t'.dotx': 'application/vnd.openxmlformats-officedocument.wordprocessingml.template',\r\n\t\t'.dp': 'application/vnd.osgi.dp',\r\n\t\t'.dpg': 'application/vnd.dpgraph',\r\n\t\t'.dsc': 'text/prs.lines.tag',\r\n\t\t'.dtb': 'application/x-dtbook+xml',\r\n\t\t'.dtd': 'application/xml-dtd',\r\n\t\t'.dts': 'audio/vnd.dts',\r\n\t\t'.dtshd': 'audio/vnd.dts.hd',\r\n\t\t'.dump': 'application/octet-stream',\r\n\t\t'.dvi': 'application/x-dvi',\r\n\t\t'.dwf': 'model/vnd.dwf',\r\n\t\t'.dwg': 'image/vnd.dwg',\r\n\t\t'.dxf': 'image/vnd.dxf',\r\n\t\t'.dxp': 'application/vnd.spotfire.dxp',\r\n\t\t'.dxr': 'application/x-director',\r\n\t\t'.ecelp4800': 'audio/vnd.nuera.ecelp4800',\r\n\t\t'.ecelp7470': 'audio/vnd.nuera.ecelp7470',\r\n\t\t'.ecelp9600': 'audio/vnd.nuera.ecelp9600',\r\n\t\t'.ecma': 'application/ecmascript',\r\n\t\t'.edm': 'application/vnd.novadigm.edm',\r\n\t\t'.edx': 'application/vnd.novadigm.edx',\r\n\t\t'.efif': 'application/vnd.picsel',\r\n\t\t'.ei6': 'application/vnd.pg.osasli',\r\n\t\t'.elc': 'application/octet-stream',\r\n\t\t'.eml': 'message/rfc822',\r\n\t\t'.emma': 'application/emma+xml',\r\n\t\t'.eol': 'audio/vnd.digital-winds',\r\n\t\t'.eot': 'application/vnd.ms-fontobject',\r\n\t\t'.eps': 'application/postscript',\r\n\t\t'.epub': 'application/epub+zip',\r\n\t\t'.es3': 'application/vnd.eszigno3+xml',\r\n\t\t'.esf': 'application/vnd.epson.esf',\r\n\t\t'.et3': 'application/vnd.eszigno3+xml',\r\n\t\t'.etx': 'text/x-setext',\r\n\t\t'.exe': 'application/x-msdownload',\r\n\t\t'.ext': 'application/vnd.novadigm.ext',\r\n\t\t'.ez': 'application/andrew-inset',\r\n\t\t'.ez2': 'application/vnd.ezpix-album',\r\n\t\t'.ez3': 'application/vnd.ezpix-package',\r\n\t\t'.f': 'text/x-fortran',\r\n\t\t'.f4v': 'video/x-f4v',\r\n\t\t'.f77': 'text/x-fortran',\r\n\t\t'.f90': 'text/x-fortran',\r\n\t\t'.fbs': 'image/vnd.fastbidsheet',\r\n\t\t'.fdf': 'application/vnd.fdf',\r\n\t\t'.fe_launch': 'application/vnd.denovo.fcselayout-link',\r\n\t\t'.fg5': 'application/vnd.fujitsu.oasysgp',\r\n\t\t'.fgd': 'application/x-director',\r\n\t\t'.fh': 'image/x-freehand',\r\n\t\t'.fh4': 'image/x-freehand',\r\n\t\t'.fh5': 'image/x-freehand',\r\n\t\t'.fh7': 'image/x-freehand',\r\n\t\t'.fhc': 'image/x-freehand',\r\n\t\t'.fig': 'application/x-xfig',\r\n\t\t'.fli': 'video/x-fli',\r\n\t\t'.flo': 'application/vnd.micrografx.flo',\r\n\t\t'.flv': 'video/x-flv',\r\n\t\t'.flw': 'application/vnd.kde.kivio',\r\n\t\t'.flx': 'text/vnd.fmi.flexstor',\r\n\t\t'.fly': 'text/vnd.fly',\r\n\t\t'.fm': 'application/vnd.framemaker',\r\n\t\t'.fnc': 'application/vnd.frogans.fnc',\r\n\t\t'.for': 'text/x-fortran',\r\n\t\t'.fpx': 'image/vnd.fpx',\r\n\t\t'.frame': 'application/vnd.framemaker',\r\n\t\t'.fsc': 'application/vnd.fsc.weblaunch',\r\n\t\t'.fst': 'image/vnd.fst',\r\n\t\t'.ftc': 'application/vnd.fluxtime.clip',\r\n\t\t'.fti': 'application/vnd.anser-web-funds-transfer-initiation',\r\n\t\t'.fvt': 'video/vnd.fvt',\r\n\t\t'.fzs': 'application/vnd.fuzzysheet',\r\n\t\t'.g3': 'image/g3fax',\r\n\t\t'.gac': 'application/vnd.groove-account',\r\n\t\t'.gdl': 'model/vnd.gdl',\r\n\t\t'.geo': 'application/vnd.dynageo',\r\n\t\t'.gex': 'application/vnd.geometry-explorer',\r\n\t\t'.ggb': 'application/vnd.geogebra.file',\r\n\t\t'.ggt': 'application/vnd.geogebra.tool',\r\n\t\t'.ghf': 'application/vnd.groove-help',\r\n\t\t'.gif': 'image/gif',\r\n\t\t'.gim': 'application/vnd.groove-identity-message',\r\n\t\t'.gmx': 'application/vnd.gmx',\r\n\t\t'.gnumeric': 'application/x-gnumeric',\r\n\t\t'.gph': 'application/vnd.flographit',\r\n\t\t'.gqf': 'application/vnd.grafeq',\r\n\t\t'.gqs': 'application/vnd.grafeq',\r\n\t\t'.gram': 'application/srgs',\r\n\t\t'.gre': 'application/vnd.geometry-explorer',\r\n\t\t'.grv': 'application/vnd.groove-injector',\r\n\t\t'.grxml': 'application/srgs+xml',\r\n\t\t'.gsf': 'application/x-font-ghostscript',\r\n\t\t'.gtar': 'application/x-gtar',\r\n\t\t'.gtm': 'application/vnd.groove-tool-message',\r\n\t\t'.gtw': 'model/vnd.gtw',\r\n\t\t'.gv': 'text/vnd.graphviz',\r\n\t\t'.gz': 'application/x-gzip',\r\n\t\t'.h': 'text/x-c',\r\n\t\t'.h261': 'video/h261',\r\n\t\t'.h263': 'video/h263',\r\n\t\t'.h264': 'video/h264',\r\n\t\t'.hbci': 'application/vnd.hbci',\r\n\t\t'.hdf': 'application/x-hdf',\r\n\t\t'.hh': 'text/x-c',\r\n\t\t'.hlp': 'application/winhlp',\r\n\t\t'.hpgl': 'application/vnd.hp-hpgl',\r\n\t\t'.hpid': 'application/vnd.hp-hpid',\r\n\t\t'.hps': 'application/vnd.hp-hps',\r\n\t\t'.hqx': 'application/mac-binhex40',\r\n\t\t'.htke': 'application/vnd.kenameaapp',\r\n\t\t'.htm': 'text/html',\r\n\t\t'.html': 'text/html',\r\n\t\t'.hvd': 'application/vnd.yamaha.hv-dic',\r\n\t\t'.hvp': 'application/vnd.yamaha.hv-voice',\r\n\t\t'.hvs': 'application/vnd.yamaha.hv-script',\r\n\t\t'.icc': 'application/vnd.iccprofile',\r\n\t\t'.ice': 'x-conference/x-cooltalk',\r\n\t\t'.icm': 'application/vnd.iccprofile',\r\n\t\t'.ico': 'image/x-icon',\r\n\t\t'.ics': 'text/calendar',\r\n\t\t'.ief': 'image/ief',\r\n\t\t'.ifb': 'text/calendar',\r\n\t\t'.ifm': 'application/vnd.shana.informed.formdata',\r\n\t\t'.iges': 'model/iges',\r\n\t\t'.igl': 'application/vnd.igloader',\r\n\t\t'.igs': 'model/iges',\r\n\t\t'.igx': 'application/vnd.micrografx.igx',\r\n\t\t'.iif': 'application/vnd.shana.informed.interchange',\r\n\t\t'.imp': 'application/vnd.accpac.simply.imp',\r\n\t\t'.ims': 'application/vnd.ms-ims',\r\n\t\t'.in': 'text/plain',\r\n\t\t'.ipk': 'application/vnd.shana.informed.package',\r\n\t\t'.irm': 'application/vnd.ibm.rights-management',\r\n\t\t'.irp': 'application/vnd.irepository.package+xml',\r\n\t\t'.iso': 'application/octet-stream',\r\n\t\t'.itp': 'application/vnd.shana.informed.formtemplate',\r\n\t\t'.ivp': 'application/vnd.immervision-ivp',\r\n\t\t'.ivu': 'application/vnd.immervision-ivu',\r\n\t\t'.jad': 'text/vnd.sun.j2me.app-descriptor',\r\n\t\t'.jam': 'application/vnd.jam',\r\n\t\t'.jar': 'application/java-archive',\r\n\t\t'.java': 'text/x-java-source',\r\n\t\t'.jisp': 'application/vnd.jisp',\r\n\t\t'.jlt': 'application/vnd.hp-jlyt',\r\n\t\t'.jnlp': 'application/x-java-jnlp-file',\r\n\t\t'.joda': 'application/vnd.joost.joda-archive',\r\n\t\t'.jpe': 'image/jpeg',\r\n\t\t'.jpeg': 'image/jpeg',\r\n\t\t'.jpg': 'image/jpeg',\r\n\t\t'.jpgm': 'video/jpm',\r\n\t\t'.jpgv': 'video/jpeg',\r\n\t\t'.jpm': 'video/jpm',\r\n\t\t'.js': 'application/javascript',\r\n\t\t'.json': 'application/json',\r\n\t\t'.kar': 'audio/midi',\r\n\t\t'.karbon': 'application/vnd.kde.karbon',\r\n\t\t'.kfo': 'application/vnd.kde.kformula',\r\n\t\t'.kia': 'application/vnd.kidspiration',\r\n\t\t'.kil': 'application/x-killustrator',\r\n\t\t'.kml': 'application/vnd.google-earth.kml+xml',\r\n\t\t'.kmz': 'application/vnd.google-earth.kmz',\r\n\t\t'.kne': 'application/vnd.kinar',\r\n\t\t'.knp': 'application/vnd.kinar',\r\n\t\t'.kon': 'application/vnd.kde.kontour',\r\n\t\t'.kpr': 'application/vnd.kde.kpresenter',\r\n\t\t'.kpt': 'application/vnd.kde.kpresenter',\r\n\t\t'.ksh': 'text/plain',\r\n\t\t'.ksp': 'application/vnd.kde.kspread',\r\n\t\t'.ktr': 'application/vnd.kahootz',\r\n\t\t'.ktz': 'application/vnd.kahootz',\r\n\t\t'.kwd': 'application/vnd.kde.kword',\r\n\t\t'.kwt': 'application/vnd.kde.kword',\r\n\t\t'.latex': 'application/x-latex',\r\n\t\t'.lbd': 'application/vnd.llamagraphics.life-balance.desktop',\r\n\t\t'.lbe': 'application/vnd.llamagraphics.life-balance.exchange+xml',\r\n\t\t'.les': 'application/vnd.hhe.lesson-player',\r\n\t\t'.lha': 'application/octet-stream',\r\n\t\t'.link66': 'application/vnd.route66.link66+xml',\r\n\t\t'.list': 'text/plain',\r\n\t\t'.list3820': 'application/vnd.ibm.modcap',\r\n\t\t'.listafp': 'application/vnd.ibm.modcap',\r\n\t\t'.log': 'text/plain',\r\n\t\t'.lostxml': 'application/lost+xml',\r\n\t\t'.lrf': 'application/octet-stream',\r\n\t\t'.lrm': 'application/vnd.ms-lrm',\r\n\t\t'.ltf': 'application/vnd.frogans.ltf',\r\n\t\t'.lvp': 'audio/vnd.lucent.voice',\r\n\t\t'.lwp': 'application/vnd.lotus-wordpro',\r\n\t\t'.lzh': 'application/octet-stream',\r\n\t\t'.m13': 'application/x-msmediaview',\r\n\t\t'.m14': 'application/x-msmediaview',\r\n\t\t'.m1v': 'video/mpeg',\r\n\t\t'.m2a': 'audio/mpeg',\r\n\t\t'.m2v': 'video/mpeg',\r\n\t\t'.m3a': 'audio/mpeg',\r\n\t\t'.m3u': 'audio/x-mpegurl',\r\n\t\t'.m4u': 'video/vnd.mpegurl',\r\n\t\t'.m4v': 'video/x-m4v',\r\n\t\t'.ma': 'application/mathematica',\r\n\t\t'.mag': 'application/vnd.ecowin.chart',\r\n\t\t'.maker': 'application/vnd.framemaker',\r\n\t\t'.man': 'text/troff',\r\n\t\t'.mathml': 'application/mathml+xml',\r\n\t\t'.mb': 'application/mathematica',\r\n\t\t'.mbk': 'application/vnd.mobius.mbk',\r\n\t\t'.mbox': 'application/mbox',\r\n\t\t'.mc1': 'application/vnd.medcalcdata',\r\n\t\t'.mcd': 'application/vnd.mcd',\r\n\t\t'.mcurl': 'text/vnd.curl.mcurl',\r\n\t\t'.mdb': 'application/x-msaccess',\r\n\t\t'.mdi': 'image/vnd.ms-modi',\r\n\t\t'.me': 'text/troff',\r\n\t\t'.mesh': 'model/mesh',\r\n\t\t'.mfm': 'application/vnd.mfmp',\r\n\t\t'.mgz': 'application/vnd.proteus.magazine',\r\n\t\t'.mht': 'message/rfc822',\r\n\t\t'.mhtml': 'message/rfc822',\r\n\t\t'.mid': 'audio/midi',\r\n\t\t'.midi': 'audio/midi',\r\n\t\t'.mif': 'application/vnd.mif',\r\n\t\t'.mime': 'message/rfc822',\r\n\t\t'.mj2': 'video/mj2',\r\n\t\t'.mjp2': 'video/mj2',\r\n\t\t'.mlp': 'application/vnd.dolby.mlp',\r\n\t\t'.mmd': 'application/vnd.chipnuts.karaoke-mmd',\r\n\t\t'.mmf': 'application/vnd.smaf',\r\n\t\t'.mmr': 'image/vnd.fujixerox.edmics-mmr',\r\n\t\t'.mny': 'application/x-msmoney',\r\n\t\t'.mobi': 'application/x-mobipocket-ebook',\r\n\t\t'.mov': 'video/quicktime',\r\n\t\t'.movie': 'video/x-sgi-movie',\r\n\t\t'.mp2': 'audio/mpeg',\r\n\t\t'.mp2a': 'audio/mpeg',\r\n\t\t'.mp3': 'audio/mpeg',\r\n\t\t'.mp4': 'video/mp4',\r\n\t\t'.mp4a': 'audio/mp4',\r\n\t\t'.mp4s': 'application/mp4',\r\n\t\t'.mp4v': 'video/mp4',\r\n\t\t'.mpa': 'video/mpeg',\r\n\t\t'.mpc': 'application/vnd.mophun.certificate',\r\n\t\t'.mpe': 'video/mpeg',\r\n\t\t'.mpeg': 'video/mpeg',\r\n\t\t'.mpg': 'video/mpeg',\r\n\t\t'.mpg4': 'video/mp4',\r\n\t\t'.mpga': 'audio/mpeg',\r\n\t\t'.mpkg': 'application/vnd.apple.installer+xml',\r\n\t\t'.mpm': 'application/vnd.blueice.multipass',\r\n\t\t'.mpn': 'application/vnd.mophun.application',\r\n\t\t'.mpp': 'application/vnd.ms-project',\r\n\t\t'.mpt': 'application/vnd.ms-project',\r\n\t\t'.mpy': 'application/vnd.ibm.minipay',\r\n\t\t'.mqy': 'application/vnd.mobius.mqy',\r\n\t\t'.mrc': 'application/marc',\r\n\t\t'.ms': 'text/troff',\r\n\t\t'.mscml': 'application/mediaservercontrol+xml',\r\n\t\t'.mseed': 'application/vnd.fdsn.mseed',\r\n\t\t'.mseq': 'application/vnd.mseq',\r\n\t\t'.msf': 'application/vnd.epson.msf',\r\n\t\t'.msh': 'model/mesh',\r\n\t\t'.msi': 'application/x-msdownload',\r\n\t\t'.msl': 'application/vnd.mobius.msl',\r\n\t\t'.msty': 'application/vnd.muvee.style',\r\n\t\t'.mts': 'model/vnd.mts',\r\n\t\t'.mus': 'application/vnd.musician',\r\n\t\t'.musicxml': 'application/vnd.recordare.musicxml+xml',\r\n\t\t'.mvb': 'application/x-msmediaview',\r\n\t\t'.mwf': 'application/vnd.mfer',\r\n\t\t'.mxf': 'application/mxf',\r\n\t\t'.mxl': 'application/vnd.recordare.musicxml',\r\n\t\t'.mxml': 'application/xv+xml',\r\n\t\t'.mxs': 'application/vnd.triscape.mxs',\r\n\t\t'.mxu': 'video/vnd.mpegurl',\r\n\t\t'.n-gage': 'application/vnd.nokia.n-gage.symbian.install',\r\n\t\t'.nb': 'application/mathematica',\r\n\t\t'.nc': 'application/x-netcdf',\r\n\t\t'.ncx': 'application/x-dtbncx+xml',\r\n\t\t'.ngdat': 'application/vnd.nokia.n-gage.data',\r\n\t\t'.nlu': 'application/vnd.neurolanguage.nlu',\r\n\t\t'.nml': 'application/vnd.enliven',\r\n\t\t'.nnd': 'application/vnd.noblenet-directory',\r\n\t\t'.nns': 'application/vnd.noblenet-sealer',\r\n\t\t'.nnw': 'application/vnd.noblenet-web',\r\n\t\t'.npx': 'image/vnd.net-fpx',\r\n\t\t'.nsf': 'application/vnd.lotus-notes',\r\n\t\t'.nws': 'message/rfc822',\r\n\t\t'.o': 'application/octet-stream',\r\n\t\t'.oa2': 'application/vnd.fujitsu.oasys2',\r\n\t\t'.oa3': 'application/vnd.fujitsu.oasys3',\r\n\t\t'.oas': 'application/vnd.fujitsu.oasys',\r\n\t\t'.obd': 'application/x-msbinder',\r\n\t\t'.obj': 'application/octet-stream',\r\n\t\t'.oda': 'application/oda',\r\n\t\t'.odb': 'application/vnd.oasis.opendocument.database',\r\n\t\t'.odc': 'application/vnd.oasis.opendocument.chart',\r\n\t\t'.odf': 'application/vnd.oasis.opendocument.formula',\r\n\t\t'.odft': 'application/vnd.oasis.opendocument.formula-template',\r\n\t\t'.odg': 'application/vnd.oasis.opendocument.graphics',\r\n\t\t'.odi': 'application/vnd.oasis.opendocument.image',\r\n\t\t'.odp': 'application/vnd.oasis.opendocument.presentation',\r\n\t\t'.ods': 'application/vnd.oasis.opendocument.spreadsheet',\r\n\t\t'.odt': 'application/vnd.oasis.opendocument.text',\r\n\t\t'.oga': 'audio/ogg',\r\n\t\t'.ogg': 'audio/ogg',\r\n\t\t'.ogv': 'video/ogg',\r\n\t\t'.ogx': 'application/ogg',\r\n\t\t'.onepkg': 'application/onenote',\r\n\t\t'.onetmp': 'application/onenote',\r\n\t\t'.onetoc': 'application/onenote',\r\n\t\t'.onetoc2': 'application/onenote',\r\n\t\t'.opf': 'application/oebps-package+xml',\r\n\t\t'.oprc': 'application/vnd.palm',\r\n\t\t'.opus': 'audio/ogg',\r\n\t\t'.org': 'application/vnd.lotus-organizer',\r\n\t\t'.osf': 'application/vnd.yamaha.openscoreformat',\r\n\t\t'.osfpvg': 'application/vnd.yamaha.openscoreformat.osfpvg+xml',\r\n\t\t'.otc': 'application/vnd.oasis.opendocument.chart-template',\r\n\t\t'.otf': 'application/x-font-otf',\r\n\t\t'.otg': 'application/vnd.oasis.opendocument.graphics-template',\r\n\t\t'.oth': 'application/vnd.oasis.opendocument.text-web',\r\n\t\t'.oti': 'application/vnd.oasis.opendocument.image-template',\r\n\t\t'.otm': 'application/vnd.oasis.opendocument.text-master',\r\n\t\t'.otp': 'application/vnd.oasis.opendocument.presentation-template',\r\n\t\t'.ots': 'application/vnd.oasis.opendocument.spreadsheet-template',\r\n\t\t'.ott': 'application/vnd.oasis.opendocument.text-template',\r\n\t\t'.oxt': 'application/vnd.openofficeorg.extension',\r\n\t\t'.p': 'text/x-pascal',\r\n\t\t'.p10': 'application/pkcs10',\r\n\t\t'.p12': 'application/x-pkcs12',\r\n\t\t'.p7b': 'application/x-pkcs7-certificates',\r\n\t\t'.p7c': 'application/pkcs7-mime',\r\n\t\t'.p7m': 'application/pkcs7-mime',\r\n\t\t'.p7r': 'application/x-pkcs7-certreqresp',\r\n\t\t'.p7s': 'application/pkcs7-signature',\r\n\t\t'.pas': 'text/x-pascal',\r\n\t\t'.pbd': 'application/vnd.powerbuilder6',\r\n\t\t'.pbm': 'image/x-portable-bitmap',\r\n\t\t'.pcf': 'application/x-font-pcf',\r\n\t\t'.pcl': 'application/vnd.hp-pcl',\r\n\t\t'.pclxl': 'application/vnd.hp-pclxl',\r\n\t\t'.pct': 'image/x-pict',\r\n\t\t'.pcurl': 'application/vnd.curl.pcurl',\r\n\t\t'.pcx': 'image/x-pcx',\r\n\t\t'.pdb': 'application/vnd.palm',\r\n\t\t'.pdf': 'application/pdf',\r\n\t\t'.pfa': 'application/x-font-type1',\r\n\t\t'.pfb': 'application/x-font-type1',\r\n\t\t'.pfm': 'application/x-font-type1',\r\n\t\t'.pfr': 'application/font-tdpfr',\r\n\t\t'.pfx': 'application/x-pkcs12',\r\n\t\t'.pgm': 'image/x-portable-graymap',\r\n\t\t'.pgn': 'application/x-chess-pgn',\r\n\t\t'.pgp': 'application/pgp-encrypted',\r\n\t\t'.pic': 'image/x-pict',\r\n\t\t'.pkg': 'application/octet-stream',\r\n\t\t'.pki': 'application/pkixcmp',\r\n\t\t'.pkipath': 'application/pkix-pkipath',\r\n\t\t'.pl': 'text/plain',\r\n\t\t'.plb': 'application/vnd.3gpp.pic-bw-large',\r\n\t\t'.plc': 'application/vnd.mobius.plc',\r\n\t\t'.plf': 'application/vnd.pocketlearn',\r\n\t\t'.pls': 'application/pls+xml',\r\n\t\t'.pml': 'application/vnd.ctc-posml',\r\n\t\t'.png': 'image/png',\r\n\t\t'.pnm': 'image/x-portable-anymap',\r\n\t\t'.portpkg': 'application/vnd.macports.portpkg',\r\n\t\t'.pot': 'application/vnd.ms-powerpoint',\r\n\t\t'.potm': 'application/vnd.ms-powerpoint.template.macroenabled.12',\r\n\t\t'.potx': 'application/vnd.openxmlformats-officedocument.presentationml.template',\r\n\t\t'.ppa': 'application/vnd.ms-powerpoint',\r\n\t\t'.ppam': 'application/vnd.ms-powerpoint.addin.macroenabled.12',\r\n\t\t'.ppd': 'application/vnd.cups-ppd',\r\n\t\t'.ppm': 'image/x-portable-pixmap',\r\n\t\t'.pps': 'application/vnd.ms-powerpoint',\r\n\t\t'.ppsm': 'application/vnd.ms-powerpoint.slideshow.macroenabled.12',\r\n\t\t'.ppsx': 'application/vnd.openxmlformats-officedocument.presentationml.slideshow',\r\n\t\t'.ppt': 'application/vnd.ms-powerpoint',\r\n\t\t'.pptm': 'application/vnd.ms-powerpoint.presentation.macroenabled.12',\r\n\t\t'.pptx': 'application/vnd.openxmlformats-officedocument.presentationml.presentation',\r\n\t\t'.pqa': 'application/vnd.palm',\r\n\t\t'.prc': 'application/x-mobipocket-ebook',\r\n\t\t'.pre': 'application/vnd.lotus-freelance',\r\n\t\t'.prf': 'application/pics-rules',\r\n\t\t'.ps': 'application/postscript',\r\n\t\t'.psb': 'application/vnd.3gpp.pic-bw-small',\r\n\t\t'.psd': 'image/vnd.adobe.photoshop',\r\n\t\t'.psf': 'application/x-font-linux-psf',\r\n\t\t'.ptid': 'application/vnd.pvi.ptid1',\r\n\t\t'.pub': 'application/x-mspublisher',\r\n\t\t'.pvb': 'application/vnd.3gpp.pic-bw-var',\r\n\t\t'.pwn': 'application/vnd.3m.post-it-notes',\r\n\t\t'.pwz': 'application/vnd.ms-powerpoint',\r\n\t\t'.py': 'text/x-python',\r\n\t\t'.pya': 'audio/vnd.ms-playready.media.pya',\r\n\t\t'.pyc': 'application/x-python-code',\r\n\t\t'.pyo': 'application/x-python-code',\r\n\t\t'.pyv': 'video/vnd.ms-playready.media.pyv',\r\n\t\t'.qam': 'application/vnd.epson.quickanime',\r\n\t\t'.qbo': 'application/vnd.intu.qbo',\r\n\t\t'.qfx': 'application/vnd.intu.qfx',\r\n\t\t'.qps': 'application/vnd.publishare-delta-tree',\r\n\t\t'.qt': 'video/quicktime',\r\n\t\t'.qwd': 'application/vnd.quark.quarkxpress',\r\n\t\t'.qwt': 'application/vnd.quark.quarkxpress',\r\n\t\t'.qxb': 'application/vnd.quark.quarkxpress',\r\n\t\t'.qxd': 'application/vnd.quark.quarkxpress',\r\n\t\t'.qxl': 'application/vnd.quark.quarkxpress',\r\n\t\t'.qxt': 'application/vnd.quark.quarkxpress',\r\n\t\t'.ra': 'audio/x-pn-realaudio',\r\n\t\t'.ram': 'audio/x-pn-realaudio',\r\n\t\t'.rar': 'application/x-rar-compressed',\r\n\t\t'.ras': 'image/x-cmu-raster',\r\n\t\t'.rcprofile': 'application/vnd.ipunplugged.rcprofile',\r\n\t\t'.rdf': 'application/rdf+xml',\r\n\t\t'.rdz': 'application/vnd.data-vision.rdz',\r\n\t\t'.rep': 'application/vnd.businessobjects',\r\n\t\t'.res': 'application/x-dtbresource+xml',\r\n\t\t'.rgb': 'image/x-rgb',\r\n\t\t'.rif': 'application/reginfo+xml',\r\n\t\t'.rl': 'application/resource-lists+xml',\r\n\t\t'.rlc': 'image/vnd.fujixerox.edmics-rlc',\r\n\t\t'.rld': 'application/resource-lists-diff+xml',\r\n\t\t'.rm': 'application/vnd.rn-realmedia',\r\n\t\t'.rmi': 'audio/midi',\r\n\t\t'.rmp': 'audio/x-pn-realaudio-plugin',\r\n\t\t'.rms': 'application/vnd.jcp.javame.midlet-rms',\r\n\t\t'.rnc': 'application/relax-ng-compact-syntax',\r\n\t\t'.roff': 'text/troff',\r\n\t\t'.rpm': 'application/x-rpm',\r\n\t\t'.rpss': 'application/vnd.nokia.radio-presets',\r\n\t\t'.rpst': 'application/vnd.nokia.radio-preset',\r\n\t\t'.rq': 'application/sparql-query',\r\n\t\t'.rs': 'application/rls-services+xml',\r\n\t\t'.rsd': 'application/rsd+xml',\r\n\t\t'.rss': 'application/rss+xml',\r\n\t\t'.rtf': 'application/rtf',\r\n\t\t'.rtx': 'text/richtext',\r\n\t\t'.s': 'text/x-asm',\r\n\t\t'.saf': 'application/vnd.yamaha.smaf-audio',\r\n\t\t'.sbml': 'application/sbml+xml',\r\n\t\t'.sc': 'application/vnd.ibm.secure-container',\r\n\t\t'.scd': 'application/x-msschedule',\r\n\t\t'.scm': 'application/vnd.lotus-screencam',\r\n\t\t'.scq': 'application/scvp-cv-request',\r\n\t\t'.scs': 'application/scvp-cv-response',\r\n\t\t'.scurl': 'text/vnd.curl.scurl',\r\n\t\t'.sda': 'application/vnd.stardivision.draw',\r\n\t\t'.sdc': 'application/vnd.stardivision.calc',\r\n\t\t'.sdd': 'application/vnd.stardivision.impress',\r\n\t\t'.sdkd': 'application/vnd.solent.sdkm+xml',\r\n\t\t'.sdkm': 'application/vnd.solent.sdkm+xml',\r\n\t\t'.sdp': 'application/sdp',\r\n\t\t'.sdw': 'application/vnd.stardivision.writer',\r\n\t\t'.see': 'application/vnd.seemail',\r\n\t\t'.seed': 'application/vnd.fdsn.seed',\r\n\t\t'.sema': 'application/vnd.sema',\r\n\t\t'.semd': 'application/vnd.semd',\r\n\t\t'.semf': 'application/vnd.semf',\r\n\t\t'.ser': 'application/java-serialized-object',\r\n\t\t'.setpay': 'application/set-payment-initiation',\r\n\t\t'.setreg': 'application/set-registration-initiation',\r\n\t\t'.sfd-hdstx': 'application/vnd.hydrostatix.sof-data',\r\n\t\t'.sfs': 'application/vnd.spotfire.sfs',\r\n\t\t'.sgl': 'application/vnd.stardivision.writer-global',\r\n\t\t'.sgm': 'text/sgml',\r\n\t\t'.sgml': 'text/sgml',\r\n\t\t'.sh': 'application/x-sh',\r\n\t\t'.shar': 'application/x-shar',\r\n\t\t'.shf': 'application/shf+xml',\r\n\t\t'.si': 'text/vnd.wap.si',\r\n\t\t'.sic': 'application/vnd.wap.sic',\r\n\t\t'.sig': 'application/pgp-signature',\r\n\t\t'.silo': 'model/mesh',\r\n\t\t'.sis': 'application/vnd.symbian.install',\r\n\t\t'.sisx': 'application/vnd.symbian.install',\r\n\t\t'.sit': 'application/x-stuffit',\r\n\t\t'.sitx': 'application/x-stuffitx',\r\n\t\t'.skd': 'application/vnd.koan',\r\n\t\t'.skm': 'application/vnd.koan',\r\n\t\t'.skp': 'application/vnd.koan',\r\n\t\t'.skt': 'application/vnd.koan',\r\n\t\t'.sl': 'text/vnd.wap.sl',\r\n\t\t'.slc': 'application/vnd.wap.slc',\r\n\t\t'.sldm': 'application/vnd.ms-powerpoint.slide.macroenabled.12',\r\n\t\t'.sldx': 'application/vnd.openxmlformats-officedocument.presentationml.slide',\r\n\t\t'.slt': 'application/vnd.epson.salt',\r\n\t\t'.smf': 'application/vnd.stardivision.math',\r\n\t\t'.smi': 'application/smil+xml',\r\n\t\t'.smil': 'application/smil+xml',\r\n\t\t'.snd': 'audio/basic',\r\n\t\t'.snf': 'application/x-font-snf',\r\n\t\t'.so': 'application/octet-stream',\r\n\t\t'.spc': 'application/x-pkcs7-certificates',\r\n\t\t'.spf': 'application/vnd.yamaha.smaf-phrase',\r\n\t\t'.spl': 'application/x-futuresplash',\r\n\t\t'.spot': 'text/vnd.in3d.spot',\r\n\t\t'.spp': 'application/scvp-vp-response',\r\n\t\t'.spq': 'application/scvp-vp-request',\r\n\t\t'.spx': 'audio/ogg',\r\n\t\t'.src': 'application/x-wais-source',\r\n\t\t'.srx': 'application/sparql-results+xml',\r\n\t\t'.sse': 'application/vnd.kodak-descriptor',\r\n\t\t'.ssf': 'application/vnd.epson.ssf',\r\n\t\t'.ssml': 'application/ssml+xml',\r\n\t\t'.stc': 'application/vnd.sun.xml.calc.template',\r\n\t\t'.std': 'application/vnd.sun.xml.draw.template',\r\n\t\t'.stf': 'application/vnd.wt.stf',\r\n\t\t'.sti': 'application/vnd.sun.xml.impress.template',\r\n\t\t'.stk': 'application/hyperstudio',\r\n\t\t'.stl': 'application/vnd.ms-pki.stl',\r\n\t\t'.str': 'application/vnd.pg.format',\r\n\t\t'.stw': 'application/vnd.sun.xml.writer.template',\r\n\t\t'.sus': 'application/vnd.sus-calendar',\r\n\t\t'.susp': 'application/vnd.sus-calendar',\r\n\t\t'.sv4cpio': 'application/x-sv4cpio',\r\n\t\t'.sv4crc': 'application/x-sv4crc',\r\n\t\t'.svd': 'application/vnd.svd',\r\n\t\t'.svg': 'image/svg+xml',\r\n\t\t'.svgz': 'image/svg+xml',\r\n\t\t'.swa': 'application/x-director',\r\n\t\t'.swf': 'application/x-shockwave-flash',\r\n\t\t'.swi': 'application/vnd.arastra.swi',\r\n\t\t'.sxc': 'application/vnd.sun.xml.calc',\r\n\t\t'.sxd': 'application/vnd.sun.xml.draw',\r\n\t\t'.sxg': 'application/vnd.sun.xml.writer.global',\r\n\t\t'.sxi': 'application/vnd.sun.xml.impress',\r\n\t\t'.sxm': 'application/vnd.sun.xml.math',\r\n\t\t'.sxw': 'application/vnd.sun.xml.writer',\r\n\t\t'.t': 'text/troff',\r\n\t\t'.tao': 'application/vnd.tao.intent-module-archive',\r\n\t\t'.tar': 'application/x-tar',\r\n\t\t'.tcap': 'application/vnd.3gpp2.tcap',\r\n\t\t'.tcl': 'application/x-tcl',\r\n\t\t'.teacher': 'application/vnd.smart.teacher',\r\n\t\t'.tex': 'application/x-tex',\r\n\t\t'.texi': 'application/x-texinfo',\r\n\t\t'.texinfo': 'application/x-texinfo',\r\n\t\t'.text': 'text/plain',\r\n\t\t'.tfm': 'application/x-tex-tfm',\r\n\t\t'.tgz': 'application/x-gzip',\r\n\t\t'.tif': 'image/tiff',\r\n\t\t'.tiff': 'image/tiff',\r\n\t\t'.tmo': 'application/vnd.tmobile-livetv',\r\n\t\t'.torrent': 'application/x-bittorrent',\r\n\t\t'.tpl': 'application/vnd.groove-tool-template',\r\n\t\t'.tpt': 'application/vnd.trid.tpt',\r\n\t\t'.tr': 'text/troff',\r\n\t\t'.tra': 'application/vnd.trueapp',\r\n\t\t'.trm': 'application/x-msterminal',\r\n\t\t'.tsv': 'text/tab-separated-values',\r\n\t\t'.ttc': 'application/x-font-ttf',\r\n\t\t'.ttf': 'application/x-font-ttf',\r\n\t\t'.twd': 'application/vnd.simtech-mindmapper',\r\n\t\t'.twds': 'application/vnd.simtech-mindmapper',\r\n\t\t'.txd': 'application/vnd.genomatix.tuxedo',\r\n\t\t'.txf': 'application/vnd.mobius.txf',\r\n\t\t'.txt': 'text/plain',\r\n\t\t'.u32': 'application/x-authorware-bin',\r\n\t\t'.udeb': 'application/x-debian-package',\r\n\t\t'.ufd': 'application/vnd.ufdl',\r\n\t\t'.ufdl': 'application/vnd.ufdl',\r\n\t\t'.umj': 'application/vnd.umajin',\r\n\t\t'.unityweb': 'application/vnd.unity',\r\n\t\t'.uoml': 'application/vnd.uoml+xml',\r\n\t\t'.uri': 'text/uri-list',\r\n\t\t'.uris': 'text/uri-list',\r\n\t\t'.urls': 'text/uri-list',\r\n\t\t'.ustar': 'application/x-ustar',\r\n\t\t'.utz': 'application/vnd.uiq.theme',\r\n\t\t'.uu': 'text/x-uuencode',\r\n\t\t'.vcd': 'application/x-cdlink',\r\n\t\t'.vcf': 'text/x-vcard',\r\n\t\t'.vcg': 'application/vnd.groove-vcard',\r\n\t\t'.vcs': 'text/x-vcalendar',\r\n\t\t'.vcx': 'application/vnd.vcx',\r\n\t\t'.vis': 'application/vnd.visionary',\r\n\t\t'.viv': 'video/vnd.vivo',\r\n\t\t'.vor': 'application/vnd.stardivision.writer',\r\n\t\t'.vox': 'application/x-authorware-bin',\r\n\t\t'.vrml': 'model/vrml',\r\n\t\t'.vsd': 'application/vnd.visio',\r\n\t\t'.vsf': 'application/vnd.vsf',\r\n\t\t'.vss': 'application/vnd.visio',\r\n\t\t'.vst': 'application/vnd.visio',\r\n\t\t'.vsw': 'application/vnd.visio',\r\n\t\t'.vtu': 'model/vnd.vtu',\r\n\t\t'.vxml': 'application/voicexml+xml',\r\n\t\t'.w3d': 'application/x-director',\r\n\t\t'.wad': 'application/x-doom',\r\n\t\t'.wav': 'audio/x-wav',\r\n\t\t'.wax': 'audio/x-ms-wax',\r\n\t\t'.wbmp': 'image/vnd.wap.wbmp',\r\n\t\t'.wbs': 'application/vnd.criticaltools.wbs+xml',\r\n\t\t'.wbxml': 'application/vnd.wap.wbxml',\r\n\t\t'.wcm': 'application/vnd.ms-works',\r\n\t\t'.wdb': 'application/vnd.ms-works',\r\n\t\t'.weba': 'audio/webm',\r\n\t\t'.webm': 'video/webm',\r\n\t\t'.webp': 'image/webp',\r\n\t\t'.wiz': 'application/msword',\r\n\t\t'.wks': 'application/vnd.ms-works',\r\n\t\t'.wm': 'video/x-ms-wm',\r\n\t\t'.wma': 'audio/x-ms-wma',\r\n\t\t'.wmd': 'application/x-ms-wmd',\r\n\t\t'.wmf': 'application/x-msmetafile',\r\n\t\t'.wml': 'text/vnd.wap.wml',\r\n\t\t'.wmlc': 'application/vnd.wap.wmlc',\r\n\t\t'.wmls': 'text/vnd.wap.wmlscript',\r\n\t\t'.wmlsc': 'application/vnd.wap.wmlscriptc',\r\n\t\t'.wmv': 'video/x-ms-wmv',\r\n\t\t'.wmx': 'video/x-ms-wmx',\r\n\t\t'.wmz': 'application/x-ms-wmz',\r\n\t\t'.wpd': 'application/vnd.wordperfect',\r\n\t\t'.wpl': 'application/vnd.ms-wpl',\r\n\t\t'.wps': 'application/vnd.ms-works',\r\n\t\t'.wqd': 'application/vnd.wqd',\r\n\t\t'.wri': 'application/x-mswrite',\r\n\t\t'.wrl': 'model/vrml',\r\n\t\t'.wsdl': 'application/wsdl+xml',\r\n\t\t'.wspolicy': 'application/wspolicy+xml',\r\n\t\t'.wtb': 'application/vnd.webturbo',\r\n\t\t'.wvx': 'video/x-ms-wvx',\r\n\t\t'.x32': 'application/x-authorware-bin',\r\n\t\t'.x3d': 'application/vnd.hzn-3d-crossword',\r\n\t\t'.xap': 'application/x-silverlight-app',\r\n\t\t'.xar': 'application/vnd.xara',\r\n\t\t'.xbap': 'application/x-ms-xbap',\r\n\t\t'.xbd': 'application/vnd.fujixerox.docuworks.binder',\r\n\t\t'.xbm': 'image/x-xbitmap',\r\n\t\t'.xdm': 'application/vnd.syncml.dm+xml',\r\n\t\t'.xdp': 'application/vnd.adobe.xdp+xml',\r\n\t\t'.xdw': 'application/vnd.fujixerox.docuworks',\r\n\t\t'.xenc': 'application/xenc+xml',\r\n\t\t'.xer': 'application/patch-ops-error+xml',\r\n\t\t'.xfdf': 'application/vnd.adobe.xfdf',\r\n\t\t'.xfdl': 'application/vnd.xfdl',\r\n\t\t'.xht': 'application/xhtml+xml',\r\n\t\t'.xhtml': 'application/xhtml+xml',\r\n\t\t'.xhvml': 'application/xv+xml',\r\n\t\t'.xif': 'image/vnd.xiff',\r\n\t\t'.xla': 'application/vnd.ms-excel',\r\n\t\t'.xlam': 'application/vnd.ms-excel.addin.macroenabled.12',\r\n\t\t'.xlb': 'application/vnd.ms-excel',\r\n\t\t'.xlc': 'application/vnd.ms-excel',\r\n\t\t'.xlm': 'application/vnd.ms-excel',\r\n\t\t'.xls': 'application/vnd.ms-excel',\r\n\t\t'.xlsb': 'application/vnd.ms-excel.sheet.binary.macroenabled.12',\r\n\t\t'.xlsm': 'application/vnd.ms-excel.sheet.macroenabled.12',\r\n\t\t'.xlsx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',\r\n\t\t'.xlt': 'application/vnd.ms-excel',\r\n\t\t'.xltm': 'application/vnd.ms-excel.template.macroenabled.12',\r\n\t\t'.xltx': 'application/vnd.openxmlformats-officedocument.spreadsheetml.template',\r\n\t\t'.xlw': 'application/vnd.ms-excel',\r\n\t\t'.xml': 'application/xml',\r\n\t\t'.xo': 'application/vnd.olpc-sugar',\r\n\t\t'.xop': 'application/xop+xml',\r\n\t\t'.xpdl': 'application/xml',\r\n\t\t'.xpi': 'application/x-xpinstall',\r\n\t\t'.xpm': 'image/x-xpixmap',\r\n\t\t'.xpr': 'application/vnd.is-xpr',\r\n\t\t'.xps': 'application/vnd.ms-xpsdocument',\r\n\t\t'.xpw': 'application/vnd.intercon.formnet',\r\n\t\t'.xpx': 'application/vnd.intercon.formnet',\r\n\t\t'.xsl': 'application/xml',\r\n\t\t'.xslt': 'application/xslt+xml',\r\n\t\t'.xsm': 'application/vnd.syncml+xml',\r\n\t\t'.xspf': 'application/xspf+xml',\r\n\t\t'.xul': 'application/vnd.mozilla.xul+xml',\r\n\t\t'.xvm': 'application/xv+xml',\r\n\t\t'.xvml': 'application/xv+xml',\r\n\t\t'.xwd': 'image/x-xwindowdump',\r\n\t\t'.xyz': 'chemical/x-xyz',\r\n\t\t'.zaz': 'application/vnd.zzazz.deck+xml',\r\n\t\t'.zip': 'application/zip',\r\n\t\t'.zir': 'application/vnd.zul',\r\n\t\t'.zirz': 'application/vnd.zul',\r\n\t\t'.zmm': 'application/vnd.handheld-entertainment+xml',\r\n\t};\r\n\r\n\t// Return the MIME type or a default value if the extension is not found\r\n\treturn mimeTypes[extension.toLowerCase()] || null;\r\n}\r\n","import type { MediaValueType } from '../../property-editors/upload-field/types.js';\r\nimport type { ManifestFileUploadPreview } from './file-upload-preview.extension.js';\r\nimport { getMimeTypeFromExtension } from './utils.js';\r\nimport { css, customElement, html, ifDefined, nothing, property, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { stringOrStringArrayContains } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbChangeEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbExtensionsManifestInitializer } from '@umbraco-cms/backoffice/extension-api';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UmbFileDropzoneItemStatus } from '@umbraco-cms/backoffice/dropzone';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type {\r\n\tUmbDropzoneChangeEvent,\r\n\tUmbInputDropzoneElement,\r\n\tUmbUploadableFile,\r\n} from '@umbraco-cms/backoffice/dropzone';\r\nimport type { UmbTemporaryFileModel } from '@umbraco-cms/backoffice/temporary-file';\r\nimport { UMB_SERVER_CONTEXT } from '@umbraco-cms/backoffice/server';\r\n\r\n@customElement('umb-input-upload-field')\r\nexport class UmbInputUploadFieldElement extends UmbLitElement {\r\n\t@property({ type: Object, attribute: false })\r\n\tset value(value: MediaValueType) {\r\n\t\tthis.#src = value?.src ?? '';\r\n\t\tthis.#setPreviewAlias();\r\n\t}\r\n\tget value(): MediaValueType {\r\n\t\treturn {\r\n\t\t\tsrc: this.#src,\r\n\t\t\ttemporaryFileId: this.temporaryFile?.temporaryUnique,\r\n\t\t};\r\n\t}\r\n\t#src = '';\r\n\r\n\t/**\r\n\t * @description Allowed file extensions. Allow all if empty.\r\n\t * @type {Array<string>}\r\n\t * @default\r\n\t */\r\n\t@property({\r\n\t\ttype: Array,\r\n\t\tattribute: 'allowed-file-extensions',\r\n\t\tconverter(value) {\r\n\t\t\tif (typeof value === 'string') {\r\n\t\t\t\treturn value.split(',').map((ext) => ext.trim());\r\n\t\t\t}\r\n\t\t\treturn value;\r\n\t\t},\r\n\t})\r\n\tallowedFileExtensions?: Array<string>;\r\n\r\n\t@state()\r\n\tpublic temporaryFile?: UmbTemporaryFileModel;\r\n\r\n\t@state()\r\n\tprivate _extensions?: string[];\r\n\r\n\t@state()\r\n\tprivate _previewAlias?: string;\r\n\r\n\t@state()\r\n\tprivate _serverUrl = '';\r\n\r\n\t#manifests: Array<ManifestFileUploadPreview> = [];\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_SERVER_CONTEXT, (context) => {\r\n\t\t\tthis._serverUrl = context?.getServerUrl() ?? '';\r\n\t\t});\r\n\t}\r\n\r\n\toverride disconnectedCallback(): void {\r\n\t\tsuper.disconnectedCallback();\r\n\t\tthis.#clearObjectUrl();\r\n\t}\r\n\r\n\tasync #getManifests() {\r\n\t\tif (this.#manifests.length) return this.#manifests;\r\n\r\n\t\tawait new UmbExtensionsManifestInitializer(this, umbExtensionsRegistry, 'fileUploadPreview', null, (exts) => {\r\n\t\t\tthis.#manifests = exts.map((exts) => exts.manifest);\r\n\t\t}).asPromise();\r\n\r\n\t\treturn this.#manifests;\r\n\t}\r\n\r\n\tasync #setPreviewAlias(): Promise<void> {\r\n\t\tthis._previewAlias = await this.#getPreviewElementAlias();\r\n\t}\r\n\r\n\tasync #getPreviewElementAlias() {\r\n\t\tif (!this.value.src) return;\r\n\t\tconst manifests = await this.#getManifests();\r\n\t\tconst fallbackAlias = manifests.find((manifest) =>\r\n\t\t\tstringOrStringArrayContains(manifest.forMimeTypes, '*/*'),\r\n\t\t)?.alias;\r\n\r\n\t\tlet mimeType: string | null = null;\r\n\t\tif (this.temporaryFile?.file) {\r\n\t\t\tmimeType = this.temporaryFile.file.type;\r\n\t\t} else {\r\n\t\t\tmimeType = this.#getMimeTypeFromPath(this.value.src);\r\n\t\t}\r\n\r\n\t\tif (!mimeType) return fallbackAlias;\r\n\r\n\t\t// Check for an exact match\r\n\t\tconst exactMatch = manifests.find((manifest) => {\r\n\t\t\treturn stringOrStringArrayContains(manifest.forMimeTypes, mimeType);\r\n\t\t});\r\n\t\tif (exactMatch) return exactMatch.alias;\r\n\r\n\t\t// Check for wildcard match (e.g. image/*)\r\n\t\tconst wildcardMatch = manifests.find((manifest) => {\r\n\t\t\tconst forMimeTypes = Array.isArray(manifest.forMimeTypes) ? manifest.forMimeTypes : [manifest.forMimeTypes];\r\n\t\t\treturn forMimeTypes.find((type) => {\r\n\t\t\t\tconst snippet = type.replace(/\\*/g, '');\r\n\t\t\t\tif (mimeType.startsWith(snippet)) return manifest.alias;\r\n\t\t\t\tif (mimeType.endsWith(snippet)) return manifest.alias;\r\n\t\t\t\treturn undefined;\r\n\t\t\t});\r\n\t\t});\r\n\t\tif (wildcardMatch) return wildcardMatch.alias;\r\n\r\n\t\t// Use fallbackAlias.\r\n\t\treturn fallbackAlias;\r\n\t}\r\n\r\n\t#getMimeTypeFromPath(path: string) {\r\n\t\t// Extract the the MIME type from the data url\r\n\t\tif (path.startsWith('data:')) {\r\n\t\t\tconst mimeType = path.substring(5, path.indexOf(';'));\r\n\t\t\treturn mimeType;\r\n\t\t}\r\n\r\n\t\t// Extract the file extension from the path\r\n\t\tconst extension = path.split('.').pop()?.toLowerCase();\r\n\t\tif (!extension) return null;\r\n\t\treturn getMimeTypeFromExtension('.' + extension);\r\n\t}\r\n\r\n\tasync #onUpload(e: UmbDropzoneChangeEvent) {\r\n\t\te.stopImmediatePropagation();\r\n\r\n\t\tconst target = e.target as UmbInputDropzoneElement;\r\n\t\tconst file = target.value?.[0];\r\n\r\n\t\tif (file?.status !== UmbFileDropzoneItemStatus.COMPLETE) return;\r\n\r\n\t\tthis.temporaryFile = (file as UmbUploadableFile).temporaryFile;\r\n\r\n\t\tthis.#clearObjectUrl();\r\n\r\n\t\tconst blobUrl = URL.createObjectURL(this.temporaryFile.file);\r\n\t\tthis.value = { src: blobUrl };\r\n\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this.temporaryFile && !this.value.src) {\r\n\t\t\treturn this.#renderDropzone();\r\n\t\t}\r\n\r\n\t\tif (this.value?.src && this._previewAlias) {\r\n\t\t\treturn this.#renderFile(this.value.src);\r\n\t\t}\r\n\r\n\t\treturn nothing;\r\n\t}\r\n\r\n\t#renderDropzone() {\r\n\t\treturn html`\r\n\t\t\t<umb-input-dropzone\r\n\t\t\t\tstandalone\r\n\t\t\t\tdisable-folder-upload\r\n\t\t\t\taccept=${ifDefined(this._extensions?.join(','))}\r\n\t\t\t\t@change=${this.#onUpload}></umb-input-dropzone>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderFile(src: string) {\r\n\t\tif (!src.startsWith('blob:')) {\r\n\t\t\tsrc = this._serverUrl + src;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<div id=\"wrapper\">\r\n\t\t\t\t<div id=\"wrapperInner\">\r\n\t\t\t\t\t<umb-extension-slot\r\n\t\t\t\t\t\ttype=\"fileUploadPreview\"\r\n\t\t\t\t\t\t.props=${{ path: src, file: this.temporaryFile?.file }}\r\n\t\t\t\t\t\t.filter=${(manifest: ManifestFileUploadPreview) => manifest.alias === this._previewAlias}>\r\n\t\t\t\t\t</umb-extension-slot>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t${this.#renderButtonRemove()}\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderButtonRemove() {\r\n\t\treturn html`\r\n\t\t\t<uui-button compact @click=${this.#handleRemove} label=${this.localize.term('content_uploadClear')}>\r\n\t\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>${this.localize.term('content_uploadClear')}\r\n\t\t\t</uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#handleRemove() {\r\n\t\t// If the upload promise happens to be in progress, cancel it.\r\n\t\tthis.temporaryFile?.abortController?.abort();\r\n\r\n\t\tthis.#clearObjectUrl();\r\n\r\n\t\tthis.value = { src: undefined };\r\n\t\tthis.temporaryFile = undefined;\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\t/**\r\n\t * If there is a former File, revoke the object URL.\r\n\t */\r\n\t#clearObjectUrl(): void {\r\n\t\tif (this.value?.src?.startsWith('blob:')) {\r\n\t\t\tURL.revokeObjectURL(this.value.src);\r\n\t\t}\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t}\r\n\t\t\tuui-icon {\r\n\t\t\t\tvertical-align: sub;\r\n\t\t\t\tmargin-right: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t#wrapper {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgrid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\r\n\t\t\t\tgap: var(--uui-size-space-4);\r\n\t\t\t\tbox-sizing: border-box;\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t#wrapper:has(umb-input-upload-field-file) {\r\n\t\t\t\tpadding: var(--uui-size-space-4);\r\n\t\t\t\tborder: 1px solid var(--uui-color-border);\r\n\t\t\t\tborder-radius: var(--uui-border-radius);\r\n\t\t\t}\r\n\r\n\t\t\t#wrapperInner {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbInputUploadFieldElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-input-upload-field': UmbInputUploadFieldElement;\r\n\t}\r\n}\r\n"],"names":["UmbImageCropChangeEvent","args","UmbFocalPointChangeEvent","focalPoint","_value","_file","_onCropChange","_onFocalPointChange","_UmbInputImageCropperFieldElement_instances","updateValue_fn","UmbInputImageCropperFieldElement","UmbLitElement","__privateAdd","event","value","index","crop","__privateMethod","UMB_SERVER_CONTEXT","context","__privateSet","__privateGet","file","c","html","when","repeat","UmbChangeEvent","css","__decorateClass","property","state","customElement","_focalPoint","_DOT_RADIUS","_UmbImageCropperFocusSetterElement_instances","initializeImage_fn","onFocalPointUpdated_fn","setFocalPoint_fn","setFocalPointStyle_fn","isCentered_fn","resetCoords_fn","handleGridDrag_fn","changeFocalPoint_fn","handleGridKeyDown_fn","UmbImageCropperFocusSetterElement","changedProperties","_changedProperties","nothing","classMap","ifDefined","imageAspectRatio","hostRect","image","x","y","width","height","left","clamp","top","grid","handle","drag","dims","defaultView","offsetX","offsetY","increment","query","_UmbImageCropperPreviewElement_instances","initializeCrop_fn","UmbImageCropperPreviewElement","resolve","container","cropAspectRatio","imageContainerWidth","imageContainerHeight","imageWidth","imageHeight","imageLeft","imageTop","cropAmount","calculateExtrapolatedValue","containerWidth","containerHeight","_VIEWPORT_PADDING","_MAX_SCALE_FACTOR","_SCROLL_ZOOM_SPEED","_minImageScale","_maxImageScale","_oldImageScale","_isDragging","_mouseOffsetX","_mouseOffsetY","_UmbImageCropperElement_instances","getImageScale_get","addEventListeners_fn","removeEventListeners_fn","updateImageScale_fn","updateImagePosition_fn","calculateCropCoordinates_fn","toLocalPosition_fn","onSave_fn","onCancel_fn","onReset_fn","onSliderUpdate_fn","_onStartDrag","_onDrag","_onEndDrag","_onWheel","UmbImageCropperElement","viewport","newLeft","newTop","delta","lerp","viewportWidth","viewportHeight","viewportAspectRatio","maskWidth","maskHeight","viewportPadding","availableWidth","availableHeight","isCropWider","maskLeft","maskTop","scaleX","scaleY","scale","minLeft","minTop","currentScaleX","currentScaleY","currentScale","inverseLerp","amount","mouseX","mouseY","newImageScale","mask","fixedLocation","imageLocalPosition","maxLeft","maxTop","cropCoordinates","x1","x2","y1","y2","target","_config","_UmbInputImageCropperElement_instances","observeAcceptedFileTypes_fn","onUpload_fn","_onRemove","mergeCrops_fn","renderDropzone_fn","onChange_fn","renderImageCropper_fn","DefaultFocalPoint","DefaultValue","UmbInputImageCropperElement","UmbFormControlMixin","UmbTemporaryFileConfigRepository","UMB_VALIDATION_EMPTY_LOCALIZATION_KEY","imageFileTypes","UmbFileDropzoneItemStatus","assignToFrozenObject","filteredCrops","cropFromValue","valueCrop","UmbTextStyles","UMB_MEDIA_COLLECTION_CONTEXT","UmbContextToken","UMB_MEDIA_CREATE_OPTIONS_MODAL","UmbModalToken","_UmbImageCropperEditorFieldElement_instances","resetCurrentCrop_fn","UmbImageCropperEditorFieldElement","__superGet","UMB_MEDIA_PICKER_MODAL","_urlRepository","_imageFileTypes","_modalManager","_UmbImageCropperEditorModalElement_instances","getSrc_fn","openMediaPicker_fn","renderActions_fn","renderFilePreview_fn","renderFileNotFound_fn","UmbImageCropperEditorModalElement","UmbModalBaseElement","UmbMediaUrlRepository","UMB_MODAL_MANAGER_CONTEXT","UmbModalRouteRegistrationController","UMB_WORKSPACE_MODAL","routeBuilder","data","item","crops","existingCrop","selected","path","UmbImageCropperEditorModalElement$1","UMB_IMAGE_CROPPER_EDITOR_MODAL","UMB_MEDIA_CAPTION_ALT_TEXT_MODAL","UMB_MEDIA_ENTITY_TYPE","UMB_MEDIA_ROOT_ENTITY_TYPE","UMB_MEDIA_PLACEHOLDER_ENTITY_TYPE","UMB_MEDIA_PROPERTY_VALUE_ENTITY_TYPE","UmbMediaServerDataSource","UmbControllerBase","preset","mediaTypeIcon","mediaTypeCollection","mediaTypeUnique","UmbMediaTypeDetailServerDataSource","defaultData","UmbId","umbDeepMerge","unique","error","tryExecute","MediaService","variant","model","parentUnique","body","UMB_MEDIA_DETAIL_STORE_CONTEXT","UmbMediaDetailRepository","UmbDetailRepositoryBase","host","UmbMediaItemServerDataSource","UmbItemServerDataSourceBase","mapper","skip","take","uniques","itemRequestManager","UmbItemDataApiGetRequestController","UMB_MEDIA_ITEM_STORE_CONTEXT","UmbMediaItemRepository","UmbItemRepositoryBase","#dataSource","UmbMediaTreeServerDataSource","UmbTreeServerDataSourceBase","getRootItems","getChildrenOf","getAncestorsOf","UMB_MEDIA_TREE_STORE_CONTEXT","UmbMediaTreeRepository","UmbTreeRepositoryBase","treeRootData","hasChildren","_mediaTreeRepository","_mediaDetailRepository","_UmbMediaPickerFolderPathElement_instances","loadPath_fn","goToFolder_fn","focusFolderInput_fn","addFolder_fn","root","UmbMediaPickerFolderPathElement","entityType","paths","entity","element","newName","newUnique","getUmbracoFolderUnique","scaffold","name","_mediaTypeStructure","_UmbMediaPickerCreateItemElement_instances","getNodeMediaType_fn","getAllowedMediaTypes_fn","onPopoverToggle_fn","UmbMediaPickerCreateItemElement","UmbMediaTypeStructureRepository","mediaType","allowedMediaTypes","UmbMediaSearchServerDataSource","#host","mediaReference","UmbMediaSearchRepository","UmbMediaSearchProvider","#repository","_mediaItemRepository","_mediaSearchProvider","_dataType","_pagingMap","_contextCulture","_UmbMediaPickerModalElement_instances","loadChildrenOfCurrentMediaItem_fn","onDropzoneChange_fn","onOpen_fn","onSelected_fn","onDeselected_fn","clearSearch_fn","searchMedia_fn","_debouncedSearch","onSearch_fn","onPathChange_fn","onPageChange_fn","allowNavigateToMedia_fn","onSearchFromChange_fn","renderBody_fn","renderSearchResult_fn","renderCurrentChildren_fn","renderToolbar_fn","renderCard_fn","renderBreadcrumb_fn","UmbMediaPickerModalElement","debounce","UMB_PROPERTY_TYPE_BASED_PROPERTY_CONTEXT","dataType","UMB_VARIANT_CONTEXT","culture","startNode","selectedItems","key","paginationManager","UmbPaginationManager","selectedItem","evt","selection","newPath","isUmbracoFolder","canNavigate","selectable","UmbMediaPickerModalElement$1","UMB_MEDIA_SECTION_PATHNAME","UMB_SECTION_PATH_PATTERN","UMB_MEDIA_WORKSPACE_PATH","UMB_WORKSPACE_PATH_PATTERN","UMB_CREATE_MEDIA_WORKSPACE_PATH_PATTERN","UmbPathPattern","UMB_EDIT_MEDIA_WORKSPACE_PATH_PATTERN","UMB_MEDIA_RECYCLE_BIN_TREE_STORE_CONTEXT","UMB_MEDIA_ITEM_REPOSITORY_ALIAS","UMB_MEDIA_STORE_ALIAS","UMB_MEDIA_SEARCH_PROVIDER_ALIAS","UMB_MEDIA_TREE_PICKER_MODAL","UMB_TREE_PICKER_MODAL_ALIAS","UMB_MEDIA_WORKSPACE_CONTEXT","IsMediaVariantContext","UMB_MEDIA_VARIANT_CONTEXT","_mediaUnique","_mediaUrlRepository","_UmbMediaCaptionAltTextModalElement_instances","getMediaDetail_fn","UmbMediaCaptionAltTextModalElement","mediaData","mediaUrlData","UmbMediaCaptionAltTextModalElement$1","UmbMediaPickerInputContext","UmbPickerInputContext","pickerData","combinedPickerData","#pickableFilter","allowedContentTypes","contentTypeReference","_sorter","_UmbInputMediaElement_instances","sortCards_fn","_readonly","_pickerContext","openPicker_fn","onRemove_fn","renderItems_fn","renderAddButton_fn","renderItem_fn","renderRemoveAction_fn","renderIsTrashed_fn","elementName","UmbInputMediaElement","UmbSorterController","modelEntry","UmbSorterResolvePlacementAsGrid","missingCards","card","ids","selectionString","splitStringToArray","idToIndexMap","cards","a","b","id","UMB_MEDIA_TYPE_ENTITY_TYPE","href","_focalPointEnabled","_itemManager","_UmbInputRichMediaElement_instances","populateCards_fn","_pickableFilter","addItems_fn","onUploadCompleted_fn","UmbInputRichMediaElement","UmbRepositoryItemsManager","params","mediaKey","mediaItems","removedCards","media","additions","umbConfirmModal","uploaded","getMimeTypeFromExtension","extension","_src","_manifests","_UmbInputUploadFieldElement_instances","getManifests_fn","setPreviewAlias_fn","getPreviewElementAlias_fn","getMimeTypeFromPath_fn","renderFile_fn","renderButtonRemove_fn","handleRemove_fn","clearObjectUrl_fn","UmbInputUploadFieldElement","UmbExtensionsManifestInitializer","umbExtensionsRegistry","exts","manifests","fallbackAlias","manifest","stringOrStringArrayContains","mimeType","exactMatch","wildcardMatch","type","snippet","blobUrl","src","ext"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAO,MAAMA,WAAgC,MAAM;AAAA,EAClD,OAAA;AAAA,SAAuB,OAAO;AAAA,EAAA;AAAA,EAEvB,YAAYC,GAAkB;AAE9B,UAAAD,GAAwB,MAAM,EAAE,SAAS,IAAO,UAAU,IAAO,YAAY,IAAO,GAAGC,EAAA,CAAM;AAAA,EAAA;AAErG;ACLO,MAAMC,WAAiC,MAAM;AAAA,EACnD,OAAA;AAAA,SAAuB,OAAO;AAAA,EAAA;AAAA,EAIvB,YAAYC,GAAgCF,GAAkB;AAE9D,UAAAC,GAAyB,MAAM,EAAE,SAAS,IAAO,UAAU,IAAO,YAAY,IAAO,GAAGD,EAAA,CAAM,GACpG,KAAK,aAAaE;AAAA,EAAA;AAEpB;;;;;;;kZCZAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC;AAea,IAAAC,IAAN,cAA+CC,EAAc;AAAA,EAwEnE,cAAc;AACP,UAAA,GAzEDC,GAAA,MAAAJ,EAAA,GAqBNI,GAAA,MAAAR,EAAA,GAGA,KAAA,QAA8B,CAAC,GAkB/BQ,GAAA,MAAAP,EAAA,GAMA,KAAA,aAAwC,EAAE,MAAM,KAAK,KAAK,IAAI,GAG7C,KAAA,iBAAA,IAGX,KAAA,MAAA,IAGN,KAAQ,aAAa,IAsCrBO,GAAA,MAAAN,IAAgB,CAACO,MAAmC;AAEnD,YAAMC,IADSD,EAAM,OACA;AAErB,UAAI,CAACC,EAAO;AAEN,YAAAC,IAAQ,KAAK,MAAM,UAAU,CAACC,MAASA,EAAK,UAAUF,EAAM,KAAK;AAEvE,MAAIC,MAAU,WAET,KAAA,MAAMA,CAAK,IAAID,GACpB,KAAK,cAAc,QACnBG,GAAA,MAAKT,IAALC,EAAA,EAAA,KAAA,IAAA;AAAA,IAAA,CACD,GAEAG,GAAA,MAAAL,IAAsB,CAACM,MAAoC;AACrD,WAAA,aAAa,EAAE,KAAKA,EAAM,WAAW,KAAK,MAAMA,EAAM,WAAW,KAAK,GAC3EI,GAAA,MAAKT,IAALC,EAAA,EAAA,KAAA,IAAA;AAAA,IAAA,CACD,GAYA,KAAU,oBAAoB,MAAM;AACnC,WAAK,aAAa,EAAE,MAAM,KAAK,KAAK,IAAI,GACxCQ,GAAA,MAAKT,IAALC,EAAA,EAAA,KAAA,IAAA;AAAA,IACD,GArDM,KAAA,eAAeS,IAAoB,CAACC,MAAY;AAC/C,WAAA,aAAaA,GAAS,aAAkB,KAAA;AAAA,IAAA,CAC7C;AAAA,EAAA;AAAA,EA3EF,IAAI,MAAML,GAAO;AAChB,IAAKA,KAMJ,KAAK,QAAQ,CAAC,GAAGA,EAAM,KAAK,GAE5B,KAAK,aAAaA,EAAM,cAAc,EAAE,MAAM,KAAK,KAAK,IAAI,GAC5D,KAAK,MAAMA,EAAM,KACjBM,GAAA,MAAKhB,IAASU,CAAA,MATd,KAAK,QAAQ,CAAC,GACd,KAAK,aAAa,EAAE,MAAM,KAAK,KAAK,IAAI,GACxC,KAAK,MAAM,IACXM,GAAA,MAAKhB,IAAS,MAAA,IASf,KAAK,cAAc;AAAA,EAAA;AAAA,EAEpB,IAAI,QAAQ;AACX,WAAOiB,GAAK,MAAAjB,EAAA;AAAA,EAAA;AAAA,EAWb,IAAI,KAAKkB,GAAwB;AAChCF,IAAAA,GAAA,MAAKf,IAAQiB,CAAA,GACTA,IACE,KAAA,cAAc,IAAI,gBAAgBA,CAAI,IACjC,KAAK,gBACX,IAAA,gBAAgB,KAAK,WAAW,GACpC,KAAK,cAAc;AAAA,EACpB;AAAA,EAED,IAAI,OAAO;AACV,WAAOD,GAAK,MAAAhB,EAAA;AAAA,EAAA;AAAA,EAmBb,IAAI,SAAiB;AACpB,WAAI,KAAK,MAEJ,KAAK,IAAI,WAAW,GAAG,IACnB,GAAG,KAAK,UAAU,GAAG,KAAK,GAAG,KAE7B,KAAK,MAIP,KAAK,eAAe;AAAA,EAAA;AAAA,EAWnB,uBAA6B;AACrC,UAAM,qBAAqB,GACvB,KAAK,eACJ,IAAA,gBAAgB,KAAK,WAAW;AAAA,EACrC;AAAA,EAGS,YAAYW,GAAW;AAC1B,UAAAD,IAAQ,KAAK,MAAM,UAAU,CAACQ,MAAMA,EAAE,UAAUP,EAAK,KAAK;AAEhE,IAAID,MAAU,OAEd,KAAK,cAAc,EAAE,GAAG,KAAK,MAAMA,CAAK,EAAE;AAAA,EAAA;AAAA,EAsClC,SAAS;AACV,WAAAS;AAAA,oBACW,KAAK,YAAY;AAAA,oBACjB,KAAK,YAAY;AAAA;AAAA,EAAA;AAAA,EAI1B,aAAa;AACtB,WAAI,KAAK,cACDA;AAAA;AAAA,mBAES,KAAK,UAAU;AAAA,YACtB,KAAK,MAAM;AAAA,cACT,KAAK,WAAW;AAAA,uBACP,KAAK,cAAc;AAAA,yBACjBH,SAAKf,EAAa,CAAA;AAAA;AAAA,OAKlCkB;AAAA;AAAA,kBAES,KAAK,UAAU;AAAA,WACtB,KAAK,MAAM;AAAA,sBACA,KAAK,cAAc;AAAA,yBAChBH,SAAKd,EAAmB,CAAA;AAAA;AAAA,uBAE1B,KAAK,eAAe;AAAA;AAAA,EAAA;AAAA,EAIhC,gBAAgB;AAClB,WAAAiB;AAAA;AAAA,KAEJC;AAAA,MACD,CAAC,KAAK,kBAAkB,KAAK,WAAW,SAAS,OAAO,KAAK,WAAW,QAAQ;AAAA,MAChF,MAAMD;AAAA,iCACuB,KAAK,SAAS,KAAK,yBAAyB,CAAC,WAAW,KAAK,iBAAiB;AAAA;AAAA,QAEvG,KAAK,SAAS,KAAK,yBAAyB,CAAC;AAAA;AAAA;AAAA,IAGjD,CAAA;AAAA;AAAA,EAAA;AAAA,EAIO,aAAa;AACtB,QAAI,GAAC,KAAK,SAAS,CAAC,KAAK;AAClB,aAAAE;AAAA,QACN,KAAK;AAAA,QACL,CAACV,MAASA,EAAK,QAAQ,KAAK,UAAUA,EAAK,WAAW;AAAA,QACtD,CAACA,MAASQ;AAAA;AAAA,aAEAR,CAAI;AAAA,mBACE,KAAK,UAAU;AAAA,YACtB,KAAK,MAAM;AAAA,eACR,KAAK,aAAa,UAAUA,EAAK,KAAK;AAAA,cACvC,MAAM,KAAK,YAAYA,CAAI,CAAC;AAAA;AAAA;AAAA,MAGxC;AAAA,EAAA;AAyDF;AAlOCZ,KAAA,oBAAA,QAAA;AAqBAC,KAAA,oBAAA,QAAA;AAqDAC,KAAA,oBAAA,QAAA;AAeAC,KAAA,oBAAA,QAAA;AA9GMC,KAAA,oBAAA,QAAA;AAmHNC,KAAY,WAAG;AACdW,EAAAA,GAAA,MAAKhB,IAAS;AAAA,IACb,OAAO,CAAC,GAAG,KAAK,KAAK;AAAA,IACrB,YAAY,KAAK;AAAA,IACjB,KAAK,KAAK;AAAA,EAAA,CACX,GAEK,KAAA,cAAc,IAAIuB,GAAgB;AACxC;AA3HYjB,EAiMI,SAAS;AAAA,EACxBkB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoDD;AApPIC,EAAA;AAAA,EADHC,EAAS,EAAE,WAAW,GAAO,CAAA;AAAA,GADlBpB,EAER,WAAA,SAAA,CAAA;AAsBJmB,EAAA;AAAA,EADCE,EAAM;AAAA,GAvBKrB,EAwBZ,WAAA,SAAA,CAAA;AAGAmB,EAAA;AAAA,EADCE,EAAM;AAAA,GA1BKrB,EA2BZ,WAAA,eAAA,CAAA;AAGImB,EAAA;AAAA,EADHC,EAAS,EAAE,WAAW,GAAO,CAAA;AAAA,GA7BlBpB,EA8BR,WAAA,QAAA,CAAA;AAeJmB,EAAA;AAAA,EADCC,EAAS;AAAA,GA5CEpB,EA6CZ,WAAA,eAAA,CAAA;AAGAmB,EAAA;AAAA,EADCE,EAAM;AAAA,GA/CKrB,EAgDZ,WAAA,cAAA,CAAA;AAGAmB,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAS,CAAA;AAAA,GAlDfpB,EAmDZ,WAAA,kBAAA,CAAA;AAGAmB,EAAA;AAAA,EADCE,EAAM;AAAA,GArDKrB,EAsDZ,WAAA,OAAA,CAAA;AAGQmB,EAAA;AAAA,EADPE,EAAM;AAAA,GAxDKrB,EAyDJ,WAAA,cAAA,CAAA;AAzDIA,IAANmB,EAAA;AAAA,EADNG,EAAc,yBAAyB;AAAA,GAC3BtB,CAAA;;;;;;;iZCfbuB,IAAAC,IAAAC,GAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC;AAqBa,IAAAC,IAAN,cAAgDlC,EAAc;AAAA,EAA9D,cAAA;AAAA,UAAA,GAAA,SAAA,GAAAC,GAAA,MAAAuB,CAAA,GAWN,KAAQ,wBAAwB,IAGhC,KAAQ,SAAS,EAAE,GAAG,GAAG,GAAG,EAAE,GAY9BvB,GAAA,MAAAqB,IAAyC,EAAE,MAAM,KAAK,KAAK,KAAI,GAG9C,KAAA,iBAAA,IAGN,KAAA,WAAA,IAKGrB,GAAA,MAAAsB,IAAA,CAAA;AAAA,EAAA;AAAA,EApBd,IAAI,WAAWpB,GAAO;AACrBM,IAAAA,GAAA,MAAKa,IAAcnB,CAAA,GACnBG,EAAA,MAAKkB,OAAL,KAAyB,MAAAd,GAAA,MAAKY,EAAY,EAAA,MAAMZ,SAAKY,EAAY,EAAA,GAAA,GACjEhB,EAAA,MAAKkB,GAALE,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EAED,IAAI,aAAa;AAChB,WAAOhB,GAAK,MAAAY,EAAA;AAAA,EAAA;AAAA,EAgBM,OAAOa,GAA4E;AACrG,UAAM,OAAOA,CAAiB,GAE1BA,EAAkB,IAAI,KAAK,KAC1B,KAAK,OACR7B,EAAA,MAAKkB,GAALC,EAAA,EAAA,KAAA,IAAA;AAAA,EAEF;AAAA,EAGkB,aAAaW,GAA6E;AAC5G,UAAM,aAAaA,CAAkB,GAErC,KAAK,MAAM,YAAY,gBAAgB,GAAG1B,GAAA,MAAKa,GAAW,IAAI;AAAA,EAAA;AAAA,EAiKtD,SAAS;AACb,WAAC,KAAK,MACHV;AAAA;AAAA;AAAA,aAGIP,QAAKkB,GAAiBQ,EAAA,CAAA;AAAA,iBAClB1B,QAAKkB,GAAeO,EAAA,CAAA;AAAA,kBACnBzB,QAAKkB,GAAeO,EAAA,CAAA;AAAA,+BACP,MAAMM,CAAO,QAAQ,KAAK,GAAG;AAAA;AAAA;AAAA,aAG/CC,GAAS,EAAE,yBAAyB,KAAK,uBAAuB,QAAQ,KAAK,gBAAgB,CAAC;AAAA,gBAC3FC,GAAU,KAAK,WAAW,SAAY,GAAG,CAAC;AAAA,kBACxC,KAAK,SAAS,KAAK,oBAAoB,CAAC;AAAA,gBAC1CjC,QAAKkB,GAAkBS,EAAA,CAAA;AAAA;AAAA;AAAA,MAbfI;AAAA,EAae;AAyDvC;AAlQCf,KAAA,oBAAA,QAAA;AAWAC,KAAA,oBAAA,QAAA;AArCMC,IAAA,oBAAA,QAAA;AAuDAC,KAAgB,iBAAG;AACxB,QAAM,KAAK,gBAEN,KAAK,kBACTnB,EAAA,MAAKkB,OAAL,KAAyB,MAAA,KAAK,WAAW,MAAM,KAAK,WAAW,GAAA,GAG3D,KAAA,aAAa,SAAS,MAAM;AAChC,QAAI,CAAC,KAAK,gBAAgB,CAAC,KAAK,eAAgB;AAChD,UAAMgB,IAAmB,KAAK,aAAa,eAAe,KAAK,aAAa,eACtEC,IAAW,KAAK,sBAAsB,GACtCC,IAAQ,KAAK,aAAa,sBAAsB;AAElD,IAAAA,EAAM,QAAQD,EAAS,UACrB,KAAA,aAAa,MAAM,QAAQ,SAE7BC,EAAM,SAASD,EAAS,WACtB,KAAA,aAAa,MAAM,SAAS,SAGlCnC,EAAA,MAAKkB,GAALM,EAAA,EAAA,KAAA,IAAA,GAEA,KAAK,aAAa,MAAM,cAAc,GAAGU,CAAgB,IACzD,KAAK,eAAe,MAAM,cAAc,GAAGA,CAAgB;AAAA,EAC5D;AACD;AAEAd,KAAoB,WAAG;AACtB,EAAIpB,EAAK,MAAAkB,GAAAK,EAAA,EAAL,KAAiB,MAAAnB,GAAA,MAAKY,EAAc,CAAA,KACvChB,EAAA,MAAKkB,GAALM,EAAA,EAAA,KAAA,IAAA;AAEF;AAEAH,KAAc,SAACgB,GAAWC,GAAWC,GAAeC,GAAgB;AACnE,QAAMC,IAAOC,EAAML,IAAIE,GAAO,GAAG,CAAC,GAC5BI,IAAMD,EAAMJ,IAAIE,GAAQ,GAAG,CAAC,GAE5BtD,IAAa,EAAE,MAAAuD,GAAM,KAAAE,EAAI;AAE/B,OAAK,cAAc,IAAI1D,GAAyBC,CAAU,CAAC;AAC5D;AAEAoC,KAAmB,SAACmB,GAAcE,GAAa;AAC1C,EAAC,KAAK,sBAEL,KAAA,kBAAkB,MAAM,OAAO,QAAQF,IAAO,GAAG,OAAOrC,SAAKa,EAAW,CAAA,OACxE,KAAA,kBAAkB,MAAM,MAAM,QAAQ0B,IAAM,GAAG,OAAOvC,SAAKa,EAAW,CAAA;AAC5E;AAEAM,KAAW,SAACrC,GAAuC;AAC9C,MAAC,KAAK;AAEV,WAAOA,EAAW,SAAS,OAAOA,EAAW,QAAQ;AACtD;AAEAsC,KAAY,WAAG;AACV,EAAC,KAAK,iBAGV,KAAK,OAAO,IAAI,KAAK,cAAc,cAAc,GACjD,KAAK,OAAO,IAAI,KAAK,aAAa,eAAe;AAClD;AAEAC,KAAe,SAAC7B,GAAqB;AAEhC,MADA,KAAK,YAAY,KAAK,kBACtBA,EAAM,WAAW;AAEpB;AAGD,QAAMgD,IAAO,KAAK,gBACZC,IAAS,KAAK;AAEpB,MAAI,CAACD,EAAM;AAEX,QAAM,EAAE,OAAAL,GAAO,QAAAC,MAAWI,EAAK,sBAAsB;AAErD,EAAAC,GAAQ,MAAM,GACdjD,EAAM,eAAe,GACrBA,EAAM,gBAAgB,GAEtB,KAAK,wBAAwB,IAE7BkD,GAAKF,GAAM;AAAA,IACV,QAAQ,CAACP,GAAGC,MAAM;AAEjB,MAAI,MAAMD,CAAC,KAAK,MAAMC,CAAC,MAEvB,KAAK,OAAO,IAAID,GAChB,KAAK,OAAO,IAAIC,GAEhBtC,EAAA,MAAKkB,GAALG,EAAA,EAAA,KAAA,MAAoBgB,GAAGC,GAAGC,GAAOC,CAAA;AAAA,IAClC;AAAA,IACA,QAAQ,MAAO,KAAK,wBAAwB;AAAA,IAC5C,cAAc5C;AAAA,EAAA,CACd;AACF;AAEA8B,KAAiB,SAAC9B,GAAqB;AAElC,MADA,KAAK,YAAY,KAAK,kBACtBA,EAAM,WAAW;AAEpB;AAGD,QAAMgD,IAAO,KAAK,gBACZC,IAAS,KAAK;AAEpB,MAAI,CAACD,EAAM;AAEX,EAAAC,GAAQ,MAAM;AAER,QAAAE,IAAOH,EAAK,sBAAsB,GAClCI,IAAcJ,EAAK,cAAc,aACjC,EAAE,OAAAL,GAAO,QAAAC,MAAWI,EAAK,sBAAsB,GAC/CK,IAAUF,EAAK,OAAOC,EAAY,SAClCE,IAAUH,EAAK,MAAMC,EAAY,SAEjCX,IAAIzC,EAAM,QAAQqD,GAClBX,KAAI1C,EAAM,QAAQsD;AACxBlD,EAAAA,EAAA,MAAKkB,GAALG,EAAA,EAAA,KAAA,MAAoBgB,GAAGC,IAAGC,GAAOC,CAAA;AAClC;AAEAb,KAAkB,SAAC/B,GAAsB;AACpC,MAAA,KAAK,YAAY,KAAK,eAAgB;AAEpC,QAAAuD,IAAYvD,EAAM,WAAW,IAAI,IAEjCgD,IAAO,KAAK;AAClB,MAAI,CAACA,EAAM;AAEX,QAAM,EAAE,OAAAL,GAAO,QAAAC,MAAWI,EAAK,sBAAsB;AAEjD,EAAAhD,EAAM,QAAQ,gBACjBA,EAAM,eAAe,GAChB,KAAA,OAAO,IAAI8C,EAAM,KAAK,OAAO,IAAIS,GAAW,GAAGZ,CAAK,GACpDvC,EAAA,MAAAkB,GAAAG,EAAA,EAAL,WAAoB,KAAK,OAAO,GAAG,KAAK,OAAO,GAAGkB,GAAOC,CAAA,IAGtD5C,EAAM,QAAQ,iBACjBA,EAAM,eAAe,GAChB,KAAA,OAAO,IAAI8C,EAAM,KAAK,OAAO,IAAIS,GAAW,GAAGZ,CAAK,GACpDvC,EAAA,MAAAkB,GAAAG,EAAA,EAAL,WAAoB,KAAK,OAAO,GAAG,KAAK,OAAO,GAAGkB,GAAOC,CAAA,IAGtD5C,EAAM,QAAQ,cACjBA,EAAM,eAAe,GAChB,KAAA,OAAO,IAAI8C,EAAM,KAAK,OAAO,IAAIS,GAAW,GAAGX,CAAM,GACrDxC,EAAA,MAAAkB,GAAAG,EAAA,EAAL,WAAoB,KAAK,OAAO,GAAG,KAAK,OAAO,GAAGkB,GAAOC,CAAA,IAGtD5C,EAAM,QAAQ,gBACjBA,EAAM,eAAe,GAChB,KAAA,OAAO,IAAI8C,EAAM,KAAK,OAAO,IAAIS,GAAW,GAAGX,CAAM,GACrDxC,EAAA,MAAAkB,GAAAG,EAAA,EAAL,WAAoB,KAAK,OAAO,GAAG,KAAK,OAAO,GAAGkB,GAAOC,CAAA;AAE3D;AAnNYZ,EAyOI,SAASjB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAvOzBC,EAAA;AAAA,EADCwC,GAAM,QAAQ;AAAA,GADHxB,EAEZ,WAAA,gBAAA,CAAA;AAGAhB,EAAA;AAAA,EADCwC,GAAM,UAAU;AAAA,GAJLxB,EAKZ,WAAA,kBAAA,CAAA;AAGAhB,EAAA;AAAA,EADCwC,GAAM,cAAc;AAAA,GAPTxB,EAQZ,WAAA,qBAAA,CAAA;AAGQhB,EAAA;AAAA,EADPE,EAAM;AAAA,GAVKc,EAWJ,WAAA,yBAAA,CAAA;AAGAhB,EAAA;AAAA,EADPE,EAAM;AAAA,GAbKc,EAcJ,WAAA,UAAA,CAAA;AAGJhB,EAAA;AAAA,EADHC,EAAS,EAAE,WAAW,GAAO,CAAA;AAAA,GAhBlBe,EAiBR,WAAA,cAAA,CAAA;AAYJhB,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAS,CAAA;AAAA,GA5Bfe,EA6BZ,WAAA,kBAAA,CAAA;AAGAhB,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,SAAS,SAAS,GAAM,CAAA;AAAA,GA/B9Be,EAgCZ,WAAA,YAAA,CAAA;AAGAhB,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,OAAQ,CAAA;AAAA,GAlCde,EAmCZ,WAAA,OAAA,CAAA;AAnCYA,IAANhB,EAAA;AAAA,EADNG,EAAc,gCAAgC;AAAA,GAClCa,CAAA;;;;;;;kZCrBbZ,IAAAqC,IAAAC,IAAAlC;AAMa,IAAAmC,KAAN,cAA4C7D,EAAc;AAAA,EAA1D,cAAA;AAAA,UAAA,GAAA,SAAA,GAAAC,GAAA,MAAA0D,EAAA,GAQQ,KAAA,MAAA,IAcd1D,GAAA,MAAAqB,IAAyC,EAAE,MAAM,KAAK,KAAK,KAAI;AAAA,EAAA;AAAA,EAR/D,IAAI,WAAWnB,GAAO;AACrBM,IAAAA,GAAA,MAAKa,IAAcnB,CAAA,GACnBG,GAAA,MAAKqD,IAALjC,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EAED,IAAI,aAAa;AAChB,WAAOhB,GAAK,MAAAY,EAAA;AAAA,EAAA;AAAA,EAKJ,oBAAoB;AAC5B,UAAM,kBAAkB,GACxBhB,GAAA,MAAKqD,IAALC,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EAgHQ,SAAS;AACb,WAAC,KAAK,OAIH/C;AAAA;AAAA,0BAEiB,KAAK,GAAG;AAAA;AAAA;AAAA,MAG5B,KAAK,KAAK,UAAU,SAAY,KAAK,SAAS,OAAO,KAAK,KAAK,KAAK,IAAK,KAAK,SAAS,KAAK,KAAK,KAAM;AAAA;AAAA,2BAElF,KAAK,KAAK,KAAK,MAAM,KAAK,KAAK,MAAM;AAAA,KAC3D,KAAK,KAAK,cACTA,4GACAwB,CAAO;AAAA,MAbHxB,qBAAwB,KAAK,KAAK;AAAA,EAa/B;AA2Cb;AA9KCS,KAAA,oBAAA,QAAA;AAtBMqC,KAAA,oBAAA,QAAA;AA6BAC,KAAe,iBAAG;AACnB,MAAA,CAAC,KAAK,KAAM;AAEhB,QAAM,KAAK,gBACL,MAAA,IAAI,QAAQ,CAACE,MAAa,KAAK,aAAa,SAAS,MAAMA,EAAQ,KAAK,YAAY,CAAE;AAEtF,QAAAC,IAAY,KAAK,sBAAsB,sBAAsB,GAC7DC,IAAkB,KAAK,KAAK,QAAQ,KAAK,KAAK,QAC9CxB,IAAmB,KAAK,aAAa,eAAe,KAAK,aAAa;AAExE,MAAAyB,IAAsB,GACzBC,IAAuB,GACvBC,IAAa,GACbC,IAAc,GACdC,IAAY,GACZC,IAAW;AAUR,MARAN,IAAkB,KACrBC,IAAsBF,EAAU,OAChCG,IAAuBH,EAAU,QAAQC,MAEzCC,IAAsBF,EAAU,SAASC,GACzCE,IAAuBH,EAAU,SAG9B,KAAK,KAAK,aAAa;AAC1B,QAAIC,IAAkB,GAAG;AAExB,YAAMO,IAAa,KAAK,KAAK,YAAY,KAAK,KAAK,KAAK,YAAY;AAEvD,MAAAJ,IAAAK,GAA2BP,GAAqBM,CAAU,GACvEH,IAAcD,IAAa3B,GAE3B8B,IAAW,CAACF,IAAc,KAAK,KAAK,YAAY,IAChDC,IAAY,CAACF,IAAa,KAAK,KAAK,YAAY;AAAA,IAAA,OAC1C;AAEN,YAAMI,IAAa,KAAK,KAAK,YAAY,KAAK,KAAK,KAAK,YAAY;AAEtD,MAAAH,IAAAI,GAA2BN,GAAsBK,CAAU,GACzEJ,IAAaC,IAAc5B,GAE3B8B,IAAW,CAACF,IAAc,KAAK,KAAK,YAAY,IAChDC,IAAY,CAACF,IAAa,KAAK,KAAK,YAAY;AAAA,IAAA;AAIjD,IAAAG,IAAYA,IAAWJ,IAAwB,KAC/CG,IAAaA,IAAYJ,IAAuB,KAEhD,KAAK,aAAa,MAAM,MAAM,GAAGK,CAAQ,KACzC,KAAK,aAAa,MAAM,OAAO,GAAGD,CAAS;AAAA,EAAA;AAG3C,IAAI7B,IAAmBwB,KAERI,IAAAF,GACdC,IAAaC,IAAc5B,MAGd2B,IAAAF,GACbG,IAAcD,IAAa3B,IAG5BlC,GAAA,MAAKqD,IAALjC,EAAA,EAAA,KAAA,MAA0ByC,GAAYC,GAAaH,GAAqBC,CAAA;AAGzE,OAAK,sBAAsB,MAAM,QAAQ,GAAGD,CAAmB,MAE/D,KAAK,sBAAsB,MAAM,cAAc,GAAGD,CAAe,IAGjEG,IAAcA,IAAaF,IAAuB,KAClDG,IAAeA,IAAcF,IAAwB,KAErD,KAAK,aAAa,MAAM,QAAQ,GAAGC,CAAU,KAC7C,KAAK,aAAa,MAAM,SAAS,GAAGC,CAAW;AAChD;AAEA1C,KAAoB,SAACyC,GAAqBC,GAAsBK,GAAyBC,GAA0B;AAG9G,MAFA,CAAC,KAAK,QACN,CAAC,KAAK,gBAAgB,CAAC,KAAK,yBAC5B,KAAK,KAAK,YAAa;AAEvB,MAAA,CAACP,KAAc,CAACC,GAAa;AAC1B,UAAA1B,IAAQ,KAAK,aAAa,sBAAsB;AACtD,IAAAyB,IAAazB,EAAM,OACnB0B,IAAc1B,EAAM;AAAA,EAAA;AAEjB,MAAA,CAAC+B,KAAkB,CAACC,GAAiB;AAClC,UAAAX,IAAY,KAAK,sBAAsB,sBAAsB;AACnE,IAAAU,IAAiBV,EAAU,OAC3BW,IAAkBX,EAAU;AAAA,EAAA;AAG7B,MAAIM,IAAYI,IAAiB,IAAIN,IAAazD,SAAKY,EAAY,EAAA,MAC/DgD,IAAWI,IAAkB,IAAIN,IAAc1D,SAAKY,EAAY,EAAA;AAEpE,EAAA+C,IAAYrB,EAAMqB,GAAWI,IAAiBN,GAAY,CAAC,GAC3DG,IAAWtB,EAAMsB,GAAUI,IAAkBN,GAAa,CAAC,GAG3DC,IAAaA,IAAYI,IAAkB,KAC3CH,IAAYA,IAAWI,IAAmB,KAE1C,KAAK,aAAa,MAAM,MAAM,GAAGJ,CAAQ,KACzC,KAAK,aAAa,MAAM,OAAO,GAAGD,CAAS;AAC5C;AAxIYR,GA4JI,SAAS5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA3JRC,GAAA;AAAA,EAAhBwC,GAAM,QAAQ;AAAA,GADHG,GACK,WAAA,gBAAA,CAAA;AACI3C,GAAA;AAAA,EAApBwC,GAAM,YAAY;AAAA,GAFPG,GAES,WAAA,yBAAA,CAAA;AAGrB3C,GAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAQ,WAAW,GAAO,CAAA;AAAA,GAJhC0C,GAKZ,WAAA,QAAA,CAAA;AAGA3C,GAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAQ,WAAW,GAAO,CAAA;AAAA,GAPhC0C,GAQZ,WAAA,OAAA,CAAA;AAGA3C,GAAA;AAAA,EADCC,EAAS,EAAE,MAAM,OAAQ,CAAA;AAAA,GAVd0C,GAWZ,WAAA,SAAA,CAAA;AAGI3C,GAAA;AAAA,EADHC,EAAS,EAAE,WAAW,GAAO,CAAA;AAAA,GAblB0C,GAcR,WAAA,cAAA,CAAA;AAdQA,KAAN3C,GAAA;AAAA,EADNG,EAAc,2BAA2B;AAAA,GAC7BwC,EAAA;;;;;;;+YCNbc,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,GAAAC,IAAAC,IAAAC,IAAA3B,IAAA4B,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC;AAQa,IAAAC,IAAN,cAAqCpG,EAAc;AAAA,EAAnD,cAAA;AAAA,UAAA,GAAA,SAAA,GAAAC,EAAA,MAAAmF,CAAA,GAMoC,KAAA,MAAA,IAC8B,KAAA,aAAA;AAAA,MACvE,MAAM;AAAA,MACN,KAAK;AAAA,IACN,GAWiB,KAAA,QAAA,GAEGnF,EAAA,MAAA0E,IAAA,EAAA,GACA1E,EAAA,MAAA2E,IAAA,CAAA,GACC3E,EAAA,MAAA4E,IAAA,IAAA,GAEJ5E,EAAA,MAAA6E,IAAA,CAAA,GACA7E,EAAA,MAAA8E,IAAA,CAAA,GACA9E,EAAA,MAAA+E,IAAA,CAAA,GACH/E,EAAA,MAAAgF,IAAA,EAAA,GACEhF,EAAA,MAAAiF,IAAA,CAAA,GACAjF,EAAA,MAAAkF,IAAA,CAAA,GAqPhBlF,EAAA,MAAA+F,IAAe,CAAC9F,MAAsB;AACrC,MAAAA,EAAM,eAAe,GAErBO,GAAA,MAAKwE,IAAc,EAAA;AACb,YAAAvC,IAAQ,KAAK,aAAa,sBAAsB,GAChD2D,IAAW,KAAK,gBAAgB,sBAAsB;AAC5D5F,MAAAA,GAAA,MAAKyE,IAAgBhF,EAAM,UAAUwC,EAAM,OAAO2D,EAAS,IAAA,GAC3D5F,GAAA,MAAK0E,IAAgBjF,EAAM,UAAUwC,EAAM,MAAM2D,EAAS,GAAA,GAEnD,OAAA,iBAAiB,aAAa3F,EAAA,MAAKuF,EAAO,CAAA,GAC1C,OAAA,iBAAiB,WAAWvF,EAAA,MAAKwF,EAAU,CAAA;AAAA,IAAA,CACnD,GAEAjG,EAAA,MAAAgG,IAAU,CAAC/F,MAAsB;AAChC,UAAIQ,QAAKuE,EAAa,GAAA;AACf,cAAAqB,IAAUpG,EAAM,UAAUQ,EAAK,MAAAwE,EAAA,GAC/BqB,IAASrG,EAAM,UAAUQ,EAAK,MAAAyE,EAAA;AAE/B7E,QAAAA,EAAA,MAAA8E,GAAAK,EAAA,EAAL,WAA0Bc,GAAQD,CAAA;AAAA,MAAA;AAAA,IACnC,CACD,GAEArG,EAAA,MAAAiG,IAAa,MAAM;AAClBzF,MAAAA,GAAA,MAAKwE,IAAc,EAAA,GAEZ,OAAA,oBAAoB,aAAavE,EAAA,MAAKuF,EAAO,CAAA,GAC7C,OAAA,oBAAoB,WAAWvF,EAAA,MAAKwF,EAAU,CAAA;AAAA,IAAA,CACtD,GAEAjG,EAAA,MAAAkG,IAAW,CAACjG,MAAsB;AACjC,MAAAA,EAAM,eAAe,GAChBI,EAAA,MAAA8E,GAAAI,EAAA,EAAL,WAAuBtF,EAAM,SAAS,CAACQ,EAAK,MAAAmE,EAAA,GAAoB3E,EAAM,SAASA,EAAM,OAAA;AAAA,IAAA,CACtF;AAAA,EAAA;AAAA,EAzSA,IAAI,OAAO;AACV,WAAO,KAAK;AAAA,EAAA;AAAA,EAEb,IAAI,KAAKC,GAAO;AAET,UAAAqG,IAAQrG,IAAQ,KAAK;AAC3BG,IAAAA,EAAA,MAAK8E,OAAL,KAAuB,MAAAoB,CAAA;AAAA,EAAA;AAAA,EAoBf,oBAAoB;AAC5B,UAAM,kBAAkB,GACxBlG,EAAA,MAAK8E,GAALxB,EAAA,EAAA,KAAA,IAAA,GACAtD,EAAA,MAAK8E,GAALE,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EAGQ,uBAAuB;AAC/B,UAAM,qBAAqB,GAC3BhF,EAAA,MAAK8E,GAALG,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EAckB,QAAQnD,GAA6E;AACvG,UAAM,QAAQA,CAAkB,GAE5BA,EAAmB,IAAI,OAAO,KACjC9B,EAAA,MAAK8E,GAALxB,EAAA,EAAA,KAAA,IAAA;AAAA,EACD;AAAA,EAsPQ,SAAS;AACV,WAAA/C;AAAA;AAAA,0BAEiB,KAAK,GAAG;AAAA;AAAA;AAAA;AAAA,aAIrBP,QAAK8E,GAAeW,EAAA,CAAA;AAAA,aACpB,KAAK,MAAM,SAAU,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAUTzF,QAAK8E,GAAQU,EAAA,CAAA,WAAW,KAAK,SAAS,KAAK,oBAAoB,CAAC;AAAA;AAAA;AAAA,cAG3ExF,QAAK8E,GAASS,EAAA,CAAA;AAAA,cACd,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAAA;AAAA,cAIpCvF,QAAK8E,GAAOQ,EAAA,CAAA;AAAA,cACZ,KAAK,SAAS,KAAK,cAAc,CAAC;AAAA;AAAA;AAAA,EAAA;AAwDhD;AAnXCjB,KAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AAEAC,KAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AAhCMC,IAAA,oBAAA,QAAA;AAkCFC,KAAc,WAAG;AACpB,SAAOoB,GAAK/F,EAAK,MAAAoE,EAAA,GAAgBpE,EAAK,MAAAqE,EAAA,GAAgB,KAAK,KAAK;AACjE;AAaMO,KAAkB,iBAAG;AAC1B,QAAM,KAAK,gBACX,KAAK,aAAa,iBAAiB,aAAa5E,EAAA,MAAKsF,EAAY,CAAA,GACjE,KAAK,iBAAiB,SAAStF,EAAA,MAAKyF,KAAU,EAAE,SAAS,IAAO;AACjE;AAEAZ,KAAqB,WAAG;AACvB,OAAK,aAAa,oBAAoB,aAAa7E,EAAA,MAAKsF,EAAY,CAAA,GAC/D,KAAA,oBAAoB,SAAStF,EAAA,MAAKyF,EAAQ,CAAA;AAChD;AAUMvC,KAAe,iBAAG;AACnB,MAAA,CAAC,KAAK,MAAO;AAEjB,QAAM,KAAK,gBAEN,KAAK,aAAa,YAEhB,MAAA,IAAI,QAAQ,CAACE,MAAa,KAAK,aAAa,SAAS,MAAMA,EAAQ,KAAK,YAAY,CAAE;AAGvF,QAAA4C,IAAgB,KAAK,gBAAgB,aACrCC,IAAiB,KAAK,gBAAgB,cAEtCC,IAAsBF,IAAgBC,GACtC3C,IAAkB,KAAK,MAAM,QAAQ,KAAK,MAAM;AAGlD,MAAA6C,IAAY,GACfC,IAAa,GACb3C,IAAa,GACbC,IAAc,GACdC,IAAY,GACZC,IAAW;AAIZ;AAEO,UAAAyC,IAAkB,IAAIrG,EAAK,MAAAiE,EAAA,GAC3BqC,IAAiBN,IAAgBK,GACjCE,KAAkBN,IAAiBI,GAEnCG,KAAclD,IAAkB4C;AAE1B,IAAAC,IAAAK,KAAcF,IAAiBC,KAAkBjD,GAChD8C,IAAAI,KAAcF,IAAiBhD,IAAkBiD;AAAA,EAAA;AAIzD,QAAAE,MAAYT,IAAgBG,KAAa,GACzCO,MAAWT,IAAiBG,KAAc;AAEhD,OAAK,YAAY,MAAM,QAAQ,GAAGD,CAAS,MAC3C,KAAK,YAAY,MAAM,SAAS,GAAGC,CAAU,MAC7C,KAAK,YAAY,MAAM,OAAO,GAAGK,EAAQ,MACzC,KAAK,YAAY,MAAM,MAAM,GAAGC,EAAO;AAEvC;AAEO,UAAAC,IAASR,IAAY,KAAK,aAAa,cACvCS,IAASR,IAAa,KAAK,aAAa,eACxCS,KAAQ,KAAK,IAAIF,GAAQC,CAAM;AACrC7G,IAAAA,GAAA,MAAKqE,IAAiByC,EAAA,GACjB9G,GAAA,MAAAsE,IAAiBwC,KAAQ7G,EAAK,MAAAkE,EAAA,CAAA;AAAA,EAAA;AAIhC,MAAA,KAAK,MAAM,aAAa;AAC3B,UAAMpC,IAAmB,KAAK,aAAa,eAAe,KAAK,aAAa;AAE5E,QAAIwB,IAAkB,GAAG;AAExB,YAAMO,IAAa,KAAK,MAAM,YAAY,KAAK,KAAK,MAAM,YAAY;AAEzD,MAAAJ,IAAAK,GAA2BqC,GAAWtC,CAAU,GAC7DH,IAAcD,IAAa3B,GAE3B6B,IAAY,CAACF,IAAa,KAAK,MAAM,YAAY,KAAKgD,IACtD7C,IAAW,CAACF,IAAc,KAAK,MAAM,YAAY,KAAKgD;AAAA,IAAA,OAChD;AAEN,YAAM7C,IAAa,KAAK,MAAM,YAAY,KAAK,KAAK,MAAM,YAAY;AAExD,MAAAH,IAAAI,GAA2BsC,GAAYvC,CAAU,GAC/DJ,IAAaC,IAAc5B,GAE3B6B,IAAY,CAACF,IAAa,KAAK,MAAM,YAAY,KAAKgD,IACtD7C,IAAW,CAACF,IAAc,KAAK,MAAM,YAAY,KAAKgD;AAAA,IAAA;AAAA,EACvD,OACM;AAEO,IAAAjD,IAAA,KAAK,aAAa,eAAezD,EAAK,MAAAoE,EAAA,GACrCV,IAAA,KAAK,aAAa,gBAAgB1D,EAAK,MAAAoE,EAAA,GAGrDT,IAAY8C,KAAWN,IAAY,IAAI1C,IAAa,KAAK,WAAW,MACpEG,IAAW8C,KAAUN,IAAa,IAAI1C,IAAc,KAAK,WAAW;AAG9D,UAAAoD,IAAUL,KAAWN,IAAY1C,GACjCsD,IAASL,KAAUN,IAAa1C;AAC1B,IAAAC,IAAArB,EAAMqB,GAAWmD,GAASL,EAAQ,GACnC7C,IAAAtB,EAAMsB,GAAUmD,GAAQL,EAAO;AAAA,EAAA;AAG3C,OAAK,aAAa,MAAM,OAAO,GAAG/C,CAAS,MAC3C,KAAK,aAAa,MAAM,MAAM,GAAGC,CAAQ,MACzC,KAAK,aAAa,MAAM,QAAQ,GAAGH,CAAU,MAC7C,KAAK,aAAa,MAAM,SAAS,GAAGC,CAAW;AAEzC,QAAAsD,KAAgBvD,IAAa,KAAK,aAAa,cAC/CwD,KAAgBvD,IAAc,KAAK,aAAa,eAChDwD,KAAe,KAAK,IAAIF,IAAeC,EAAa;AAG1D,OAAK,QAAQE,GAAYnH,EAAA,MAAKoE,EAAgB,GAAApE,EAAA,MAAKqE,KAAgB6C,EAAY;AAChF;AAEApC,KAAiB,SAACsC,GAAgBC,GAAiBC,GAAiB;AACnEvH,EAAAA,GAAA,MAAKuE,IAAiBtE,EAAK,MAAA0E,GAAAC,EAAA,CAAA,GAC3B,KAAK,QAAQrC,EAAM,KAAK,QAAQ8E,GAAQ,GAAG,CAAC;AAC5C,QAAMG,IAAgBvH,EAAK,MAAA0E,GAAAC,EAAA,GAErB6C,IAAO,KAAK,YAAY,sBAAsB,GAC9CxF,IAAQ,KAAK,aAAa,sBAAsB;AAEtD,MAAIyF,IAAgB,EAAE,MAAM,GAAG,KAAK,EAAE;AAItC,EAAIJ,KAAUC,IACGG,IAAA7H,EAAA,MAAK8E,GAALO,EAAA,EAAA,KAAA,MAAsBoC,GAAQC,CAAA,IAE9BG,IAAA7H,EAAA,MAAK8E,GAALO,EAAA,EAAA,KAAA,MAAsBuC,EAAK,OAAOA,EAAK,QAAQ,GAAGA,EAAK,MAAMA,EAAK,SAAS,CAAA;AAG5F,QAAME,IAAqB9H,EAAK,MAAA8E,GAAAO,EAAA,EAAL,KAAsB,MAAAjD,EAAM,MAAMA,EAAM,GAAA,GAE7D2B,IACL8D,EAAc,QAAQA,EAAc,OAAOC,EAAmB,SAASH,IAAgBvH,EAAK,MAAAsE,EAAA,IACvFV,IACL6D,EAAc,OAAOA,EAAc,MAAMC,EAAmB,QAAQH,IAAgBvH,EAAK,MAAAsE,EAAA;AAE1F,OAAK,aAAa,MAAM,QAAQ,GAAG,KAAK,aAAa,eAAeiD,CAAa,MACjF,KAAK,aAAa,MAAM,SAAS,GAAG,KAAK,aAAa,gBAAgBA,CAAa,MAE9E3H,EAAA,MAAA8E,GAAAK,EAAA,EAAL,WAA0BnB,GAAUD,CAAA;AACrC;AAEAoB,KAAoB,SAACxC,GAAaF,GAAc;AACzC,QAAAmF,IAAO,KAAK,YAAY,sBAAsB,GAC9CxF,IAAQ,KAAK,aAAa,sBAAsB,GAGhD8E,IAAUlH,EAAK,MAAA8E,GAAAO,EAAA,EAAL,KAAsB,MAAAuC,EAAK,OAAOA,EAAK,QAAQxF,EAAM,OAAO,CAAG,EAAA,MACzE2F,IAAU/H,EAAK,MAAA8E,GAAAO,EAAA,EAAL,KAAsB,MAAAuC,EAAK,MAAM,CAAG,EAAA,MAC9CT,IAASnH,EAAK,MAAA8E,GAAAO,EAAA,EAAL,KAAsB,MAAA,GAAGuC,EAAK,MAAMA,EAAK,SAASxF,EAAM,MAAQ,EAAA,KACzE4F,IAAShI,EAAK,MAAA8E,GAAAO,EAAA,EAAL,KAAsB,MAAA,GAAGuC,EAAK,GAAK,EAAA;AAG3C,EAAAnF,IAAAC,EAAMD,GAAMyE,GAASa,CAAO,GAC7BpF,IAAAD,EAAMC,GAAKwE,GAAQa,CAAM,GAE/B,KAAK,aAAa,MAAM,OAAO,GAAGvF,CAAI,MACtC,KAAK,aAAa,MAAM,MAAM,GAAGE,CAAG;AACrC;AAEAyC,KAAyB,WAAuD;AACzE,QAAA6C,IAAkB,EAAE,IAAI,GAAG,IAAI,GAAG,IAAI,GAAG,IAAI,EAAE,GAE/CL,IAAO,KAAK,YAAY,sBAAsB,GAC9CxF,IAAQ,KAAK,aAAa,sBAAsB;AAEtD,SAAA6F,EAAgB,MAAML,EAAK,OAAOxF,EAAM,QAAQA,EAAM,OACtD6F,EAAgB,MAAML,EAAK,MAAMxF,EAAM,OAAOA,EAAM,QACpC6F,EAAA,KAAK,KAAK,KAAKL,EAAK,QAAQxF,EAAM,SAASA,EAAM,KAAK,GACtD6F,EAAA,KAAK,KAAK,KAAKL,EAAK,SAASxF,EAAM,UAAUA,EAAM,MAAM,GAElE6F;AACR;AAEA5C,KAAgB,SAAC5C,GAAcE,GAAa;AACrC,QAAAoD,IAAW,KAAK,gBAAgB,sBAAsB;AAErD,SAAA;AAAA,IACN,MAAMtD,IAAOsD,EAAS;AAAA,IACtB,KAAKpD,IAAMoD,EAAS;AAAA,EACrB;AACD;AAEAT,KAAO,WAAG;AACL,MAAA,CAAC,KAAK,MAAO;AAEjB,QAAM,EAAE,IAAA4C,GAAI,IAAAC,GAAI,IAAAC,GAAI,IAAAC,EAAG,IAAIrI,QAAK8E,GAALM,EAAA,EAAA,KAAA,IAAA;AAC3B,OAAK,QAAQ;AAAA,IACZ,GAAG,KAAK;AAAA,IACR,aAAa,EAAE,IAAA8C,GAAI,IAAAC,GAAI,IAAAC,GAAI,IAAAC,EAAG;AAAA,EAC/B,GAEK,KAAA,cAAc,IAAItJ,IAAyB;AACjD;AAEAwG,KAAS,WAAG;AAEN,OAAA,cAAc,IAAIxG,IAAyB;AACjD;AAEAyG,KAAQ,WAAG;AACN,EAAC,KAAK,UAEV,OAAO,KAAK,MAAM,aACb,KAAA,cAAc,IAAIzG,IAAyB;AACjD;AAEA0G,KAAe,SAAC7F,GAAmB;AAClC,QAAM0I,IAAS1I,EAAM;AAChB,OAAA,OAAO,OAAO0I,EAAO,KAAK;AAChC;AAEA5C,KAAA,oBAAA,QAAA;AAaAC,KAAA,oBAAA,QAAA;AASAC,KAAA,oBAAA,QAAA;AAOAC,KAAA,oBAAA,QAAA;AAlTYC,EAuVI,SAASnF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAtVLC,GAAA;AAAA,EAAnBwC,GAAM,WAAW;AAAA,GADN0C,EACQ,WAAA,mBAAA,CAAA;AACJlF,GAAA;AAAA,EAAfwC,GAAM,OAAO;AAAA,GAFF0C,EAEI,WAAA,eAAA,CAAA;AACClF,GAAA;AAAA,EAAhBwC,GAAM,QAAQ;AAAA,GAHH0C,EAGK,WAAA,gBAAA,CAAA;AAE6BlF,GAAA;AAAA,EAA7CC,EAAS,EAAE,MAAM,QAAQ,WAAW,GAAO,CAAA;AAAA,GALhCiF,EAKkC,WAAA,SAAA,CAAA;AAClBlF,GAAA;AAAA,EAA3BC,EAAS,EAAE,MAAM,OAAQ,CAAA;AAAA,GANdiF,EAMgB,WAAA,OAAA,CAAA;AACIlF,GAAA;AAAA,EAA/BC,EAAS,EAAE,WAAW,GAAO,CAAA;AAAA,GAPlBiF,EAOoB,WAAA,cAAA,CAAA;AAK5BlF,GAAA;AAAA,EADHC,EAAS,EAAE,MAAM,OAAQ,CAAA;AAAA,GAXdiF,EAYR,WAAA,QAAA,CAAA;AASKlF,GAAA;AAAA,EAARE,EAAM;AAAA,GArBKgF,EAqBH,WAAA,SAAA,CAAA;AArBGA,IAANlF,GAAA;AAAA,EADNG,EAAc,mBAAmB;AAAA,GACrB+E,CAAA;;;;;;;uUCRbyC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC;AAqBA,MAAMC,KAAoB,EAAE,MAAM,KAAK,KAAK,IAAI,GAC1CC,KAAmD;AAAA,EACxD,iBAAiB;AAAA,EACjB,KAAK;AAAA,EACL,OAAO,CAAC;AAAA,EACR,YAAYD;AACb;AAGO,IAAME,KAAN,cAA0CC,GAI/CzJ,GAAe,MAAS,EAAE;AAAA,EAyB3B,cAAc;AACP,UAAA,GA9BDC,GAAA,MAAA6I,EAAA,GAgBN,KAAA,QAAqD,CAAC,GAStD,KAAQ,WAAW,IAET7I,GAAA,MAAA4I,IAAA,IAAIa,GAAiC,IAAI,CAAA,GAgDnDzJ,GAAA,MAAAgJ,IAAY,MAAM;AACjB,WAAK,QAAQ,QACR,KAAA,OAAO,eAAe,iBAAiB,MAAM,GAClD,KAAK,QAAQ,QAER,KAAA,cAAc,IAAIjI,GAAgB;AAAA,IAAA,CACxC,GAjDM,KAAA;AAAA,MACJ;AAAA,MACA,MAAM,KAAK,mBAAmB2I;AAAA,MAC9B,MACQ,CAAC,CAAC,KAAK,aAAa,CAAC,KAAK,SAAU,KAAK,MAAM,QAAQ,MAAM,KAAK,MAAM,mBAAmB;AAAA,IAEpG;AAAA,EAAA;AAAA,EAGkB,eAAqB;AACvCrJ,IAAAA,GAAA,MAAKwI,IAALI,EAAA,EAAA,KAAA,IAAA,GACA5I,GAAA,MAAKwI,IAALC,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EA4DQ,SAAS;AACjB,WAAI,KAAK,WACDlI,sDAGJ,KAAK,OAAO,OAAO,KAAK,QACpBP,SAAKwI,IAALO,EAAA,EAAA,KAAA,IAAA,IAGD/I,SAAKwI,IAALK,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AA+DT;AApJCN,KAAA,oBAAA,QAAA;AA3BMC,KAAA,oBAAA,QAAA;AA8CAC,KAAyB,iBAAG;AACjC,QAAMrI,SAAKmI,EAAQ,EAAA,aACd,KAAA;AAAA,IACJnI,GAAA,MAAKmI,EAAQ,EAAA,KAAK,gBAAgB;AAAA,IAClC,CAACe,MAAmB;AACd,WAAA,UAAUA,EAAe,KAAK,GAAG,GACtC,KAAK,WAAW;AAAA,IACjB;AAAA,IACA;AAAA,EACD;AACD;AAEAZ,KAAS,SAAC,GAA2B;AACpC,IAAE,yBAAyB;AAGrB,QAAArI,IADS,EAAE,OACG,QAAQ,CAAC;AAEzB,EAAAA,GAAM,WAAWkJ,GAA0B,aAE/C,KAAK,QAAQlJ,GAEb,KAAK,QAAQmJ,GAAqB,KAAK,SAASP,IAAc;AAAA,IAC7D,iBAAiB5I,EAAK,eAAe;AAAA,EAAA,CACrC,GAEI,KAAA,cAAc,IAAIK,GAAgB;AACxC;AAEAiI,KAAA,oBAAA,QAAA;AAQAC,KAAW,WAAG;AACb,MAAI,KAAK,OAAO;AAEf,UAAMa,IAAgB,KAAK,MAAM,IAAI,CAAC1J,MAAS;AACxC,YAAA2J,IAAgB,KAAK,MAAO,MAAM,KAAK,CAACC,MAAcA,EAAU,UAAU5J,EAAK,KAAK;AAMnF,aALQ;AAAA,QACd,GAAGA;AAAA,QACH,aAAa2J,GAAe,eAAe;AAAA,MAC5C;AAAA,IAEO,CACP;AAED,SAAK,QAAQ;AAAA,MACZ,GAAG,KAAK;AAAA,MACR,OAAOD;AAAA,IACR;AAAA,EAAA;AAEF;AAcAZ,KAAe,WAAG;AACV,SAAAtI;AAAA;AAAA;AAAA,aAGI0B,GAAU,KAAK,OAAO,CAAC;AAAA;AAAA,eAErBjC,SAAKwI,IAASE,EAAA,CAAA;AAAA;AAE5B;AAEAI,KAAS,SAAC,GAAgB;AACnB,QAAAjJ,IAAS,EAAE,OAA4C;AAE7D,MAAI,CAACA,GAAO;AACX,SAAK,QAAQ,QACR,KAAA,cAAc,IAAIa,GAAgB;AACvC;AAAA,EAAA;AAGD,EAAI,KAAK,SAAS,KAAK,MAAM,oBACtBb,EAAA,kBAAkB,KAAK,MAAM,mBAGhCA,EAAM,mBAAmBA,EAAM,QAAQ,QAC1C,KAAK,QAAQA,IAET,KAAA,cAAc,IAAIa,GAAgB;AACxC;AAEAqI,KAAmB,WAAG;AACd,SAAAxI;AAAA,qCAC4B,KAAK,KAAK,UAAU,KAAK,OAAO,eAAe,IAAI,YAAYP,GAAA,MAAKwI,IAASM,EAAA,CAAA;AAAA,+CACnE,KAAK,SAAS,KAAK,qBAAqB,CAAC,WAAW1I,SAAKuI,EAAS,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMhH;AAzJYO,GA2Ja,SAAS;AAAA,EACjCU;AAAA,EACAjJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAiBD;AApKAC,GAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAS,CAAA;AAAA,GATfqI,GAUZ,WAAA,YAAA,CAAA;AAGAtI,GAAA;AAAA,EADCC,EAAS,EAAE,MAAM,OAAQ,CAAA;AAAA,GAZdqI,GAaZ,WAAA,mBAAA,CAAA;AAGAtI,GAAA;AAAA,EADCC,EAAS,EAAE,WAAW,GAAO,CAAA;AAAA,GAflBqI,GAgBZ,WAAA,SAAA,CAAA;AAGQtI,GAAA;AAAA,EADPE,EAAM;AAAA,GAlBKoI,GAmBJ,WAAA,SAAA,CAAA;AAGAtI,GAAA;AAAA,EADPE,EAAM;AAAA,GArBKoI,GAsBJ,WAAA,WAAA,CAAA;AAGAtI,GAAA;AAAA,EADPE,EAAM;AAAA,GAxBKoI,GAyBJ,WAAA,YAAA,CAAA;AAzBIA,KAANtI,GAAA;AAAA,EADNG,EAAc,yBAAyB;AAAA,GAC3BmI,EAAA;AC3BA,MAAAW,KAA+B,IAAIC,GAA2C,sBAAsB,GCUpGC,KAAiC,IAAIC,GAGhD,iCAAiC;AAAA,EAClC,OAAO;AAAA,IACN,MAAM;AAAA,IACN,MAAM;AAAA,EAAA;AAER,CAAC;;;;;;;uRCrBDC,IAAAC;AAIa,IAAAC,KAAN,cAAgD1K,EAAiC;AAAA,EAAjF,cAAA;AAAA,UAAA,GAAA,SAAA,GAAAE,GAAA,MAAAsK,EAAA;AAAA,EAAA;AAAA,EAKG,aAAa;AACrB,QAAI,GAAC,KAAK,SAAS,CAAC,KAAK;AAClB,aAAA1J;AAAA;AAAA,aAEI,KAAK,SAAS,KAAK,eAAe,CAAC;AAAA,cAClC,CAAC,KAAK,WAAW;AAAA,aAClBP,SAAKiK,IAAiBC,EAAA,CAAA;AAAA;AAAA,KAE9B,MAAM,WAAY,CAAA;AAAA;AAAA,EAAA;AAiBvB;AA9BOD,KAAA,oBAAA,QAAA;AACNC,KAAiB,WAAG;AACnB,OAAK,cAAc;AACpB;AAHYC,GAiBI,SAAS;AAAA,EACxB,GAAGC,GAAMD,IAAAA,IAAA,QAAA;AAAA,EACTxJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAUD;AA7BYwJ,KAANvJ,GAAA;AAAA,EADNG,EAAc,gCAAgC;AAAA,GAClCoJ,EAAA;ACGN,MAAME,KAAyB,IAAIL;AAAA,EACzC;AAAA,EACA;AAAA,IACC,OAAO;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,IAAA;AAAA,EACP;AAEF;;;;;;;iZCfAM,IAAA/B,IAAAgC,IAAAC,IAAAC,GAAAhC,IAAAiC,IAAAC,IAAA7B,IAAA8B,IAAA7B,IAAA8B,IAAAC;AAkBa,IAAAC,IAAN,cAAgDC,GAGrD;AAAA,EAiCD,cAAc;AACP,UAAA,GArCDrL,GAAA,MAAA8K,CAAA,GAIW9K,GAAA,MAAA2K,IAAA,IAAIW,GAAsB,IAAI,CAAA,GAM/C,KAAQ,OAAe,IAGvB,KAAQ,UAAkB,IAG1B,KAAQ,kBAAkB,IAG1B,KAAQ,SAA8B,CAAC,GAGvC,KAAQ,iBAAiB,IAMzB,KAAQ,eAAe,IAEbtL,GAAA,MAAA4I,IAAA,IAAIa,GAAiC,IAAI,CAAA,GAEnDzJ,GAAA,MAAA4K,EAAA,GAEA5K,GAAA,MAAA6K,EAAA,GAIM,KAAA,eAAeU,IAA2B,CAAChL,MAAY;AAC3DC,MAAAA,GAAA,MAAKqK,IAAgBtK,CAAA;AAAA,IAAA,CACrB,GAEG,IAAAiL,GAAoC,MAAMC,EAAmB,EAC/D,kBAAkB,OAAO,EACzB,QAAQ,OACD,EAAE,MAAM,EAAE,YAAY,SAAS,QAAQ,CAAA,IAAK,EACnD,EACA,oBAAoB,CAACC,MAAiB;AACjC,WAAA,iBAAiBA,EAAa,EAAE;AAAA,IAAA,CACrC;AAAA,EAAA;AAAA,EAGM,oBAA0B;AAClC,UAAM,kBAAkB,GAEnB,KAAA,OAAO,KAAK,MAAM,OAAO,IACzB,KAAA,UAAU,KAAK,MAAM,UAAU,IAE/B,KAAA,kBAAkB,KAAK,MAAM,kBAAkB,IACpD,KAAK,SAAS,KAAK,MAAM,eAAe,CAAC,GACpC,KAAA,kBAAkB,KAAK,MAAM,gBAElCrL,EAAA,MAAKyK,GAALhC,EAAA,EAAA,KAAA,IAAA,GACAzI,EAAA,MAAKyK,GAALC,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EAgFQ,SAAS;AACV,WAAAnK;AAAA,+BACsB,KAAK,SAAS,KAAK,4BAA4B,CAAC;AAAA;AAAA,OAExEC;AAAA,MACD,KAAK;AAAA,MACL,MAAMR,QAAKyK,GAAL1B,EAAA,EAAA,KAAA,IAAA;AAAA,MACN,MAAM/I,QAAKyK,GAALI,EAAA,EAAA,KAAA,IAAA;AAAA,IACN,CAAA;AAAA;AAAA;AAAA,yBAGmB,KAAK,SAAS,KAAK,eAAe,CAAC,WAAW,KAAK,YAAY;AAAA;AAAA,cAE1E,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAAA,eAGnC,KAAK,YAAY;AAAA;AAAA;AAAA;AAAA,EAAA;AAiGhC;AA5PCP,KAAA,oBAAA,QAAA;AA0BA/B,KAAA,oBAAA,QAAA;AAEAgC,KAAA,oBAAA,QAAA;AAEAC,KAAA,oBAAA,QAAA;AAlCMC,IAAA,oBAAA,QAAA;AAkEAhC,KAAyB,iBAAG;AACjC,QAAMrI,SAAKmI,EAAQ,EAAA,aACd,KAAA;AAAA,IACJnI,GAAA,MAAKmI,EAAQ,EAAA,KAAK,gBAAgB;AAAA,IAClC,CAACe,MAAoBnJ,GAAA,MAAKoK,IAAkBjB,CAAA;AAAA,IAC5C;AAAA,EACD;AACD;AAEMoB,KAAO,iBAAG;AACT,QAAA,EAAE,MAAAY,EAAK,IAAI,MAAMlL,GAAA,MAAKkK,IAAe,aAAa,CAAC,KAAK,OAAO,CAAC,GAChEiB,IAAOD,IAAO,CAAC;AAEjB,MAAA,CAACC,GAAM,KAAK;AACf,SAAK,eAAe,IACpB,KAAK,qBAAqB;AAC1B;AAAA,EAAA;AAGD,EAAIA,EAAK,aAAanL,GAAA,MAAKmK,KAAiB,SAASgB,EAAK,SAAS,MAClE,KAAK,eAAe;AAQrB,QAAMC,IAA6B,KAAK,OAAO,IAAI,CAACzL,MAAS;AACtD,UAAA0L,IAAe,KAAK,MAAM,OAAO,KAAK,CAACnL,MAAMA,EAAE,UAAUP,EAAK,KAAK;AACzE,WAAO0L,IAAe,EAAE,GAAG1L,GAAM,GAAG0L,EAAiB,IAAA1L;AAAA,EAAA,CACrD,GAEKF,IAA4C;AAAA,IACjD,GAAG,KAAK;AAAA,IACR,KAAK0L,EAAK;AAAA,IACV,OAAAC;AAAA,IACA,YAAY,KAAK,MAAM,cAAc,EAAE,MAAM,KAAK,KAAK,IAAI;AAAA,EAC5D;AACA,OAAK,qBAAqB3L;AAC3B;AAEM8K,KAAgB,iBAAG;AAKxB,QAAMW,IAAO,MAJClL,GAAA,MAAKoK,EAAe,GAAA,KAAK,MAAMH,IAAwB;AAAA,IACpE,MAAM,EAAE,UAAU,IAAO,gBAAgB,KAAK,gBAAgB;AAAA,IAC9D,OAAO,EAAE,WAAW,CAAC,KAAK,OAAO,EAAE;AAAA,EAAA,CACnC,GACyB,WAAW,MAAM,MAAM,IAAI;AACrD,MAAI,CAACiB,EAAM;AAEL,QAAAI,IAAWJ,EAAK,UAAU,CAAC;AAEjC,MAAI,CAACI;AACE,UAAA,IAAI,MAAM,mBAAmB;AAGpC,OAAK,UAAUA,GAEf,KAAK,QAAQ,EAAE,GAAG,KAAK,OAAO,QAAQ,KAAK,QAAQ,GAEnD,KAAK,eAAe,IAEpB1L,EAAA,MAAKyK,GAALC,EAAA,EAAA,KAAA,IAAA;AACD;AAEA5B,KAAS,SAAC,GAA+D;AAClE,QAAAjJ,IAAQ,EAAE,OAAO;AACvB,EAAKA,MAED,KAAK,uBACH,KAAA,mBAAmB,QAAQA,EAAM,OACjC,KAAA,mBAAmB,aAAaA,EAAM,aAG5C,KAAK,QAAQ,EAAE,KAAK,KAAK,MAAM,QAAQ,KAAK,SAAS,OAAOA,EAAM,OAAO,YAAYA,EAAM,WAAW;AACvG;AAwBA+K,KAAc,WAAG;AACT,SAAArK;AAAA,+BACsB,KAAK,SAAS,KAAK,yBAAyB,CAAC,WAAWP,QAAKyK,GAAgBE,EAAA,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAMhG,KAAK,SAAS,KAAK,uBAAuB,CAAC;AAAA,WAC5C,KAAK,iBAAiB,UAAU,KAAK,OAAO;AAAA;AAAA;AAAA;AAAA;AAKtD;AAEA5B,KAAmB,WAAG;AACjB,SAAC,KAAK,qBACHxI;AAAA;AAAA,aAEI,KAAK,kBAAkB;AAAA,sBACd,KAAK,eAAe;AAAA,cAC5BP,QAAKyK,GAAS3B,EAAA,CAAA;AAAA,0BACF9I,EAAA,MAAKyK,OAAL,KAAqB,IAAA,CAAA;AAAA;AAAA,MANR1I;AAStC;AAEA8I,KAAkB,WAAG;AACb,SAAAtK;AAAA;AAAA,MAEHC;AAAA,IACD,KAAK,oBAAoB;AAAA,IACzB,CAACmL,MAASpL,mCAAsCoL,CAAI;AAAA,IACpD,MAAM3L,QAAKyK,GAALK,EAAA,EAAA,KAAA,IAAA;AAAA,EACN,CAAA;AAAA;AAAA,uBAEkB9K,EAAA,MAAKyK,OAAL,KAAqB,IAAA,CAAA;AAAA;AAE3C;AAEAK,KAAmB,WAAG;AACrB,QAAM9L,IAAO,CAAC,KAAK,SAAS,KAAK,eAAe,CAAC;AAC1C,SAAAuB;AAAA;AAAA;AAAA,4DAGmDvB,CAAI;AAAA;AAAA;AAAA;AAAA;AAK/D;AAxNY+L,EA0NI,SAAS;AAAA,EACxBnB;AAAA,EACAjJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAmCD;AAxPQC,GAAA;AAAA,EADPE,EAAM;AAAA,GANKiK,EAOJ,WAAA,sBAAA,CAAA;AAGAnK,GAAA;AAAA,EADPE,EAAM;AAAA,GATKiK,EAUJ,WAAA,QAAA,CAAA;AAGAnK,GAAA;AAAA,EADPE,EAAM;AAAA,GAZKiK,EAaJ,WAAA,WAAA,CAAA;AAGAnK,GAAA;AAAA,EADPE,EAAM;AAAA,GAfKiK,EAgBJ,WAAA,mBAAA,CAAA;AAGAnK,GAAA;AAAA,EADPE,EAAM;AAAA,GAlBKiK,EAmBJ,WAAA,UAAA,CAAA;AAGAnK,GAAA;AAAA,EADPE,EAAM;AAAA,GArBKiK,EAsBJ,WAAA,kBAAA,CAAA;AAGAnK,GAAA;AAAA,EADPE,EAAM;AAAA,GAxBKiK,EAyBJ,WAAA,mBAAA,CAAA;AAGAnK,GAAA;AAAA,EADPE,EAAM;AAAA,GA3BKiK,EA4BJ,WAAA,gBAAA,CAAA;AA5BIA,IAANnK,GAAA;AAAA,EADNG,EAAc,gCAAgC;AAAA,GAClCgK,CAAA;AAmQb,MAAAa,KAAeb;;;;;;;;;8CClQFc,KAAiC,IAAI7B,GAGhD,gCAAgC;AAAA,EACjC,OAAO;AAAA,IACN,MAAM;AAAA,IACN,MAAM;AAAA,EAAA;AAER,CAAC,GCfY8B,KAAmC,IAAI9B,GAGlD,iCAAiC;AAAA,EAClC,OAAO;AAAA,IACN,MAAM;AAAA,IACN,MAAM;AAAA,EAAA;AAER,CAAC,GCpBY+B,IAAwB,SACxBC,KAA6B,cAC7BC,KAAoC,yBAUpCC,KAAuC,GAAGH,CAAqB;ACKrE,MAAMI,WAAiCC,GAAsE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOnH,MAAM,eAAeC,IAAoD,IAAI;AAC5E,QAAIC,IAA+B,MAC/BC,IAAmD;AAEjD,UAAAC,IAAkBH,EAAO,WAAW;AAE1C,QAAI,CAACG;AACE,YAAA,IAAI,MAAM,8BAA8B;AAGzC,UAAA,EAAE,MAAAlB,MAAS,MAAM,IAAImB,GAAmC,IAAI,EAAE,KAAKD,CAAe;AACxF,IAAAF,IAAgBhB,GAAM,QAAQ,MAC9BiB,IAAsBjB,GAAM,cAAc;AAE1C,UAAMoB,IAAmC;AAAA,MACxC,YAAYX;AAAA,MACZ,QAAQY,GAAM,IAAI;AAAA,MAClB,WAAW;AAAA,QACV,QAAQH;AAAA,QACR,YAAYD;AAAA,QACZ,MAAMD;AAAA,MACP;AAAA,MACA,WAAW;AAAA,MACX,QAAQ,CAAC;AAAA,MACT,UAAU;AAAA,QACT;AAAA,UACC,SAAS;AAAA,UACT,SAAS;AAAA,UACT,MAAM;AAAA,UACN,YAAY;AAAA,UACZ,YAAY;AAAA,QAAA;AAAA,MACb;AAAA,IAEF;AAIO,WAAA,EAAE,MAFQM,GAAaP,GAAQK,CAAW,EAEzB;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASzB,MAAM,KAAKG,GAAgB;AAC1B,QAAI,CAACA,EAAc,OAAA,IAAI,MAAM,mBAAmB;AAEhD,UAAM,EAAE,MAAAvB,GAAM,OAAAwB,EAAU,IAAA,MAAMC,GAAW,MAAMC,EAAa,aAAa,EAAE,MAAM,EAAE,IAAIH,EAAO,EAAG,CAAA,CAAC;AAE9F,WAAAC,KAAS,CAACxB,IACN,EAAE,OAAAwB,EAAM,IA0BT,EAAE,MAtB0B;AAAA,MAClC,YAAYf;AAAA,MACZ,QAAQT,EAAK;AAAA,MACb,QAAQA,EAAK;AAAA,MACb,UAAUA,EAAK,SAAS,IAAI,CAAC2B,OACrB;AAAA,QACN,OAAO;AAAA,QACP,SAASA,EAAQ,WAAW;AAAA,QAC5B,SAASA,EAAQ,WAAW;AAAA,QAC5B,MAAMA,EAAQ;AAAA,QACd,YAAYA,EAAQ;AAAA,QACpB,YAAYA,EAAQ;AAAA,MACrB,EACA;AAAA,MACD,WAAW;AAAA,QACV,QAAQ3B,EAAK,UAAU;AAAA,QACvB,YAAYA,EAAK,UAAU,aAAa,EAAE,QAAQA,EAAK,UAAU,WAAW,GAAA,IAAO;AAAA,QACnF,MAAMA,EAAK,UAAU;AAAA,MACtB;AAAA,MACA,WAAWA,EAAK;AAAA,IACjB,EAEqB;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUtB,MAAM,OAAO4B,GAA4BC,IAA8B,MAAM;AAC5E,QAAI,CAACD,EAAa,OAAA,IAAI,MAAM,kBAAkB;AAC9C,QAAI,CAACA,EAAM,OAAc,OAAA,IAAI,MAAM,yBAAyB;AAG5D,UAAME,IAAgC;AAAA,MACrC,IAAIF,EAAM;AAAA,MACV,QAAQC,IAAe,EAAE,IAAIA,EAAiB,IAAA;AAAA,MAC9C,WAAW,EAAE,IAAID,EAAM,UAAU,OAAO;AAAA,MACxC,QAAQA,EAAM;AAAA,MACd,UAAUA,EAAM,SAAS,IAAI,CAACD,OAAa;AAAA,QAC1C,SAASA,EAAQ,WAAW;AAAA,QAC5B,SAASA,EAAQ,WAAW;AAAA,QAC5B,MAAMA,EAAQ;AAAA,MAAA,EACb;AAAA,IACH,GAEM,EAAE,MAAA3B,GAAM,OAAAwB,EAAM,IAAI,MAAMC;AAAA,MAC7B;AAAA,MACAC,EAAa,UAAU;AAAA,QACtB,MAAAI;AAAA,MACA,CAAA;AAAA,IACF;AAEI,WAAA9B,KAAQ,OAAOA,KAAS,WACpB,KAAK,KAAKA,CAAI,IAGf,EAAE,OAAAwB,EAAM;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUhB,MAAM,OAAOI,GAA4B;AACxC,QAAI,CAACA,EAAM,OAAc,OAAA,IAAI,MAAM,mBAAmB;AAGtD,UAAME,IAAgC;AAAA,MACrC,QAAQF,EAAM;AAAA,MACd,UAAUA,EAAM;AAAA,IACjB,GAEM,EAAE,OAAAJ,EAAM,IAAI,MAAMC;AAAA,MACvB;AAAA,MACAC,EAAa,aAAa;AAAA,QACzB,MAAM,EAAE,IAAIE,EAAM,OAAO;AAAA,QACzB,MAAAE;AAAA,MACA,CAAA;AAAA,IACF;AAEA,WAAKN,IAIE,EAAE,OAAAA,EAAM,IAHP,KAAK,KAAKI,EAAM,MAAM;AAAA,EAGf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAShB,MAAM,OAAOL,GAAgB;AAC5B,QAAI,CAACA,EAAc,OAAA,IAAI,MAAM,mBAAmB;AAEzC,WAAAE,GAAW,MAAMC,EAAa,gBAAgB,EAAE,MAAM,EAAE,IAAIH,EAAS,EAAA,CAAC,CAAC;AAAA,EAAA;AAEhF;ACtLa,MAAAQ,KAAiC,IAAIvD,GAAqC,qBAAqB;ACGrG,MAAMwD,WAAiCC,GAA6C;AAAA,EAC1F,YAAYC,GAAyB;AAC9B,UAAAA,GAAMrB,IAA0BkB,EAA8B;AAAA,EAAA;AAEtE;;;;;;;ACIO,MAAMI,WAAqCC,GAGhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMD,YAAYF,GAAyB;AACpC,UAAMA,GAAM;AAAA,MACXG,QAAAA;AAAAA,IAAA,CACA;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWF,MAAM,OAAO,EAAE,OAAAvK,GAAO,MAAAwK,GAAM,MAAAC,KAAuD;AAClF,UAAM,EAAE,MAAAvC,GAAM,OAAAwB,EAAA,IAAU,MAAMC,GAAW,MAAMC,EAAa,mBAAmB,EAAE,OAAO,EAAE,OAAA5J,GAAO,MAAAwK,GAAM,MAAAC,EAAK,EAAG,CAAA,CAAC;AAEzG,WAAA,EAAE,MADMvC,GAAM,MAAM,IAAI,CAACC,MAASoC,GAAOpC,CAAI,CAAC,GAC9B,OAAAuB,EAAM;AAAA,EAAA;AAAA,EAG9B,MAAe,SAASgB,GAAwB;AAC/C,QAAI,CAACA,EAAe,OAAA,IAAI,MAAM,qBAAqB;AAE7C,UAAAC,IAAqB,IAAIC,GAAmC,MAAM;AAAA;AAAA,MAEvE,KAAK,CAAChP,MAASgO,EAAa,aAAa,EAAE,OAAO,EAAE,IAAIhO,EAAK,QAAQ,GAAG;AAAA,MACxE,SAAA8O;AAAA,IAAA,CACA,GAEK,EAAE,MAAAxC,GAAM,OAAAwB,EAAU,IAAA,MAAMiB,EAAmB,QAAQ;AAEzD,WAAO,EAAE,MAAM,KAAK,gBAAgBzC,CAAI,GAAG,OAAAwB,EAAM;AAAA,EAAA;AAEnD;AAEA,MAAMa,KAAS,CAACpC,OACR;AAAA,EACN,YAAYQ;AAAA,EACZ,aAAaR,EAAK;AAAA,EAClB,WAAWA,EAAK;AAAA,EAChB,QAAQA,EAAK;AAAA,EACb,WAAW;AAAA,IACV,QAAQA,EAAK,UAAU;AAAA,IACvB,MAAMA,EAAK,UAAU;AAAA,IACrB,YAAYA,EAAK,UAAU,aAAa,EAAE,QAAQA,EAAK,UAAU,WAAW,OAAO;AAAA,EACpF;AAAA,EACA,MAAMA,EAAK,SAAS,CAAC,GAAG;AAAA;AAAA,EACxB,QAAQA,EAAK,SAAS,EAAE,QAAQA,EAAK,OAAO,OAAO;AAAA,EACnD,UAAUA,EAAK,SAAS,IAAI,CAAC0B,OACrB;AAAA,IACN,SAASA,EAAQ,WAAW;AAAA,IAC5B,MAAMA,EAAQ;AAAA,EACf,EACA;AACF,IC1EYgB,KAA+B,IAAInE,GAAmC,mBAAmB;ACG/F,MAAMoE,WAA+BC,GAAyC;AAAA,EACpFC;AAAA,EAEA,YAAYZ,GAAyB;AAC9B,UAAAA,GAAMC,IAA8BQ,EAA4B,GACjE,KAAAG,KAAc,IAAIX,GAA6B,IAAI;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAczD,MAAM,OAAO,EAAE,OAAArK,GAAO,MAAAwK,GAAM,MAAAC,KAAuD;AAClF,WAAO,KAAKO,GAAY,OAAO,EAAE,OAAAhL,GAAO,MAAAwK,GAAM,MAAAC,GAAM;AAAA,EAAA;AAEtD;;;;;;ACZO,MAAMQ,WAAqCC,GAKhD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMD,YAAYd,GAAyB;AACpC,UAAMA,GAAM;AAAA,MACX,cAAAe;AAAA,MACA,eAAAC;AAAA,MACA,gBAAAC;AAAA,MACA,QAAAd;AAAA,IAAA,CACA;AAAA,EAAA;AAEH;AAEA,MAAMY,KAAe,CAACvP;AAAA;AAAA,EAErBgO,EAAa,iBAAiB,EAAE,OAAO,EAAE,YAAYhO,EAAK,UAAU,QAAQ,MAAMA,EAAK,MAAM,MAAMA,EAAK,KAAA,EAAQ,CAAA;AAAA,GAE3GwP,KAAgB,CAACxP,MAClBA,EAAK,OAAO,WAAW,OACnBuP,GAAavP,CAAI,IAGjBgO,EAAa,qBAAqB;AAAA,EACxC,OAAO,EAAE,UAAUhO,EAAK,OAAO,QAAQ,YAAYA,EAAK,UAAU,QAAQ,MAAMA,EAAK,MAAM,MAAMA,EAAK,KAAK;AAAA,CAC3G,GAIGyP,KAAiB,CAACzP;AAAA;AAAA,EAEvBgO,EAAa,sBAAsB;AAAA,IAClC,OAAO,EAAE,cAAchO,EAAK,SAAS,OAAO;AAAA,EAC5C,CAAA;AAAA,GAEI2O,KAAS,CAACpC,OACR;AAAA,EACN,QAAQA,EAAK;AAAA,EACb,QAAQ;AAAA,IACP,QAAQA,EAAK,SAASA,EAAK,OAAO,KAAK;AAAA,IACvC,YAAYA,EAAK,SAASQ,IAAwBC;AAAA,EACnD;AAAA,EACA,YAAYD;AAAA,EACZ,aAAaR,EAAK;AAAA,EAClB,UAAUA,EAAK;AAAA,EACf,WAAWA,EAAK;AAAA,EAChB,UAAU;AAAA,EACV,WAAW;AAAA,IACV,QAAQA,EAAK,UAAU;AAAA,IACvB,MAAMA,EAAK,UAAU;AAAA,IACrB,YAAYA,EAAK,UAAU,aAAa,EAAE,QAAQA,EAAK,UAAU,WAAW,OAAO;AAAA,EACpF;AAAA,EACA,MAAMA,EAAK,SAAS,CAAC,GAAG;AAAA;AAAA,EACxB,UAAUA,EAAK,SAAS,IAAI,CAAC0B,OACrB;AAAA,IACN,MAAMA,EAAQ;AAAA,IACd,SAASA,EAAQ,WAAW;AAAA,EAC7B,EACA;AAAA,EACD,YAAY1B,EAAK;AAClB,IChFYmD,KAA+B,IAAI5E,GAAmC,mBAAmB;ACU/F,MAAM6E,WACJC,GAOT;AAAA,EACC,YAAYpB,GAAyB;AAC9B,UAAAA,GAAMa,IAA8BK,EAA4B;AAAA,EAAA;AAAA,EAGvE,MAAM,kBAAkB;AACvB,UAAM,EAAE,MAAMG,EAAa,IAAI,MAAM,KAAK,YAAY,aAAa,EAAE,MAAM,GAAG,MAAM,GAAG,GACjFC,IAAcD,IAAeA,EAAa,QAAQ,IAAI;AAU5D,WAAO,EAAE,MAR2B;AAAA,MACnC,QAAQ;AAAA,MACR,YAAY7C;AAAA,MACZ,MAAM;AAAA,MACN,aAAA8C;AAAA,MACA,UAAU;AAAA,IACX,EAEc;AAAA,EAAA;AAEhB;;;;;;;;;;;;uUCxCAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC;AAoBA,MAAMC,KAA0B,EAAE,MAAM,SAAS,QAAQ,MAAM,YAAYtD,GAA2B;AAGzF,IAAAuD,KAAN,cAA8C7P,EAAc;AAAA,EAA5D,cAAA;AAAA,UAAA,GAAA,SAAA,GAAAC,GAAA,MAAAsP,EAAA,GACiBtP,GAAA,MAAAoP,IAAA,IAAIJ,GAAuB,IAAI,CAAA,GAC7BhP,GAAA,MAAAqP,IAAA,IAAI1B,GAAyB,IAAI,CAAA,GAG1B,KAAA,YAAAgC,IAehC,KAAQ,gBAAmCA,IAGnC,KAAA,SAAmC,CAACA,EAAI,GAGhD,KAAQ,mBAAmB;AAAA,EAAA;AAAA,EAlB3B,IAAW,aAAazP,GAA0B;AAC7C,IAAAA,MAAU,KAAK,kBAClB,KAAK,gBAAgBA,GACrBG,GAAA,MAAKiP,IAALC,EAAA,EAAA,KAAA,IAAA;AAAA,EACD;AAAA,EAGD,IAAW,eAAe;AACzB,WAAO,KAAK;AAAA,EAAA;AAAA,EAYM,aAAapN,GAA0C;AACzE,UAAM,aAAaA,CAAkB,GACrC9B,GAAA,MAAKiP,IAALC,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EAoFQ,SAAS;AACV,WAAA3O;AAAA,KACJE;AAAA,MACD,KAAK;AAAA,MACL,CAACkL,MAASA,EAAK;AAAA,MACf,CAACA,MACApL;AAAA;AAAA,gBAEWoL,EAAK,IAAI;AAAA,mBACN,KAAK,aAAa,WAAWA,EAAK,MAAM;AAAA,gBAC3C,MAAM3L,GAAA,MAAKiP,IAALE,EAAA,EAAA,KAAA,MAAiBxD,CAAK,CAAA;AAAA;AAAA,IAAA,CAExC,GAAG,KAAK,mBACNpL;AAAA;AAAA;AAAA;AAAA,cAIQP,SAAKiP,IAAUI,EAAA,CAAA;AAAA,iCAEvB9O,kDAAqDP,GAAK,MAAAiP,IAAAG,EAAA,CAAiB,iBAAiB;AAAA;AAAA,EAAA;AAmBlG;AAvJCL,KAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AAFMC,KAAA,oBAAA,QAAA;AAiCAC,KAAS,iBAAG;AACX,QAAArC,IAAS,KAAK,cAAc,QAC5B2C,IAAa,KAAK,cAAc,YAUhCC,KARQ5C,KAEX,MAAMzM,GAAA,MAAK2O,IAAqB,yBAAyB;AAAA,IACxD,UAAU,EAAE,QAAAlC,GAAQ,YAAA2C,EAAW;AAAA,EAAA,CAC/B,GACA,QAAQ,CAAA,IACT,CAAC,GAE0C,IAAI,CAACjE,OAAU;AAAA,IAC5D,MAAMA,EAAK;AAAA,IACX,QAAQA,EAAK;AAAA,IACb,YAAYA,EAAK;AAAA,EAAA,EAChB;AAEE,EAAC,KAAK,aACTkE,EAAM,QAAQH,EAAI,GAGd,KAAA,SAAS,CAAC,GAAGG,CAAK;AACxB;AAEAN,KAAW,SAACO,GAA2B;AACtC,OAAK,SAAS,CAAC,GAAG,KAAK,MAAM,EAAE,MAAM,GAAG,KAAK,OAAO,UAAU,CAAC/D,MAASA,EAAK,WAAW+D,EAAO,MAAM,IAAI,CAAC,GAC1G,KAAK,eAAeA,GACf,KAAA,cAAc,IAAIhP,GAAgB;AACxC;AAEA0O,KAAiB,WAAG;AACnB,OAAK,mBAAmB,IACxB,sBAAsB,MAAM;AAC3B,UAAMO,IAAU,KAAK,eAAiB,EAAA,WAAY,cAAc,aAAa;AAC7E,IAAAA,EAAQ,MAAM,GACdA,EAAQ,OAAO;AAAA,EAAA,CACf;AACF;AAEMN,KAAU,eAAC,GAAkB;AAClC,IAAE,gBAAgB;AAEZ,QAAAO,IAAU,EAAE,OAAO;AAEzB,MADA,KAAK,mBAAmB,IACpB,CAACA,EAAS;AAER,QAAAC,IAAYlD,GAAM,IAAI,GACtBQ,IAAe,KAAK,OAAO,KAAK,OAAO,SAAS,CAAC,EAAE,QAEnDd,IAAuC;AAAA,IAC5C,QAAQwD;AAAA,IACR,WAAW;AAAA,MACV,QAAQC,GAAuB;AAAA,MAC/B,YAAY;AAAA,IACb;AAAA,IACA,UAAU;AAAA,MACT;AAAA,QACC,SAAS;AAAA,QACT,SAAS;AAAA,QACT,MAAMF;AAAA,QACN,YAAY;AAAA,QACZ,YAAY;AAAA,MAAA;AAAA,IACb;AAAA,EAEF,GACM,EAAE,MAAMG,EAAS,IAAI,MAAM3P,GAAK,MAAA4O,EAAA,EAAuB,eAAe3C,CAAM;AAClF,MAAI,CAAC0D,EAAU;AAET,QAAA,EAAE,MAAAzE,MAAS,MAAMlL,SAAK4O,EAAuB,EAAA,OAAOe,GAAU5C,CAAY;AAChF,MAAI,CAAC7B,EAAM;AAEX,QAAM0E,IAAO1E,EAAK,SAAS,CAAC,EAAE,MACxBuB,IAASvB,EAAK,QACdkE,IAAalE,EAAK;AAEnB,OAAA,SAAS,CAAC,GAAG,KAAK,QAAQ,EAAE,MAAA0E,GAAM,QAAAnD,GAAQ,YAAA2C,GAAY,GAC3D,KAAK,eAAe,EAAE,MAAAQ,GAAM,QAAAnD,GAAQ,YAAA2C,EAAW,GAC1C,KAAA,cAAc,IAAI9O,GAAgB;AACxC;AAhHY6O,GAyII,SAAS;AAAA,EACxB5O;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAaD;AAlJAC,GAAA;AAAA,EADCC,EAAS,EAAE,WAAW,GAAO,CAAA;AAAA,GAJlB0O,GAKZ,WAAA,aAAA,CAAA;AAGW3O,GAAA;AAAA,EADVC,EAAS,EAAE,WAAW,GAAO,CAAA;AAAA,GAPlB0O,GAQD,WAAA,gBAAA,CAAA;AAYH3O,GAAA;AAAA,EADPE,EAAM;AAAA,GAnBKyO,GAoBJ,WAAA,iBAAA,CAAA;AAGA3O,GAAA;AAAA,EADPE,EAAM;AAAA,GAtBKyO,GAuBJ,WAAA,UAAA,CAAA;AAGA3O,GAAA;AAAA,EADPE,EAAM;AAAA,GAzBKyO,GA0BJ,WAAA,oBAAA,CAAA;AA1BIA,KAAN3O,GAAA;AAAA,EADNG,EAAc,8BAA8B;AAAA,GAChCwO,EAAA;;;;;;;uUCvBbU,IAAAjB,IAAAkB,IAAAC,IAAAC,IAAAC;AAMa,IAAAC,KAAN,cAA8C5Q,EAAc;AAAA,EAA5D,cAAA;AAAA,UAAA,GAAA,SAAA,GAAAC,GAAA,MAAAuQ,EAAA,GACgBvQ,GAAA,MAAAsQ,IAAA,IAAIM,GAAgC,IAAI,CAAA,GACrC5Q,GAAA,MAAAqP,IAAA,IAAI1B,GAAyB,IAAI,CAAA,GAE1D,KAAQ,QAAuB,MAa/B,KAAQ,eAAe,IAGvB,KAAQ,qBAAsD,CAAC;AAAA,EAAA;AAAA,EAb/D,IAAW,KAAKzN,GAAsB;AACrC,SAAK,QAAQA,GACbG,GAAA,MAAKkQ,IAALE,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EAGD,IAAW,OAAO;AACjB,WAAO,KAAK;AAAA,EAAA;AAAA,EA8BJ,SAAS;AACV,WAAA7P;AAAA;AAAA;AAAA,YAGG,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAAA,MAG1C,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA,+BACX,KAAK,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA,cAKlCP,SAAKkQ,IAAgBG,EAAA,CAAA;AAAA;AAAA;AAAA,QAG1B,KAAK,mBAAmB,SAExB5P;AAAA,MACA,KAAK;AAAA,MACL,CAAC8K,MAASA,EAAK;AAAA,MACf,CAACA,MACAhL,yBAA4BgL,EAAK,IAAI;AAAA,wCACPA,EAAK,QAAQ,oBAAoB;AAAA;AAAA,IAEhE,IARAhL,0BAA6B,KAAK,SAAS,KAAK,wBAAwB,CAAC,QAQzE;AAAA;AAAA;AAAA;AAAA;AAAA,EAAA;AAcT;AAjFC0P,KAAA,oBAAA,QAAA;AACAjB,KAAA,oBAAA,QAAA;AAFMkB,KAAA,oBAAA,QAAA;AAsBAC,KAAiB,iBAAG;AACrB,MAAA,CAAC,KAAK,MAAc,QAAA;AAElB,QAAA,EAAE,MAAA7E,MAAS,MAAMlL,SAAK4O,EAAuB,EAAA,gBAAgB,KAAK,IAAK;AACtE,SAAA1D,GAAM,UAAU,UAAU;AAClC;AAEM8E,KAAqB,iBAAG;AACvB,QAAAI,IAAY,MAAMxQ,GAAA,MAAKkQ,IAALC,EAAA,EAAA,KAAA,IAAA,GAElB,EAAE,MAAMM,EAAsB,IAAA,MAAMrQ,SAAK6P,EAAoB,EAAA,yBAAyBO,GAAW,KAAK,KAAK;AAC5G,OAAA,qBAAqBC,GAAmB,SAAS,CAAC;AACxD;AAEAJ,KAAgB,SAACzQ,GAAoB;AAI/B,OAAA,eAAeA,EAAM,aAAa;AACxC;AAzCY0Q,GA2EI,SAAS;AAAA,EACxB3P;AAAA;AAAA;AAAA;AAAA;AAKD;AA1EWC,GAAA;AAAA,EADVC,EAAS;AAAA,GANEyP,GAOD,WAAA,QAAA,CAAA;AAUH1P,GAAA;AAAA,EADPE,EAAM;AAAA,GAhBKwP,GAiBJ,WAAA,gBAAA,CAAA;AAGA1P,GAAA;AAAA,EADPE,EAAM;AAAA,GAnBKwP,GAoBJ,WAAA,sBAAA,CAAA;AApBIA,KAAN1P,GAAA;AAAA,EADNG,EAAc,8BAA8B;AAAA,GAChCuP,EAAA;ACMN,MAAMI,GAEb;AAAA,EACCC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,YAAYnD,GAAyB;AACpC,SAAKmD,KAAQnD;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASd,MAAM,OAAOxO,GAAiC;AAC7C,UAAM,EAAE,MAAAsM,GAAM,OAAAwB,EAAM,IAAI,MAAMC;AAAA,MAC7B,KAAK4D;AAAA,MACL3D,EAAa,mBAAmB;AAAA,QAC/B,OAAO;AAAA,UACN,mBAAmBhO,EAAK,qBAAqB,IAAI,CAAC4R,MAAmBA,EAAe,MAAM;AAAA,UAC1F,SAAS5R,EAAK,WAAW;AAAA,UACzB,UAAUA,EAAK,YAAY,UAAU;AAAA,UACrC,OAAOA,EAAK;AAAA,UACZ,SAASA,EAAK;AAAA,QAAA;AAAA,MAEf,CAAA;AAAA,IACF;AAEA,WAAIsM,IAwBI,EAAE,MAAM,EAAE,OAvBmCA,EAAK,MAAM,IAAI,CAACC,OAC5D;AAAA,MACN,YAAYQ;AAAA,MACZ,aAAaR,EAAK;AAAA,MAClB,MAAM,yCAAyCA,EAAK;AAAA,MACpD,WAAWA,EAAK;AAAA,MAChB,QAAQA,EAAK;AAAA,MACb,WAAW;AAAA,QACV,YAAYA,EAAK,UAAU,aAAa,EAAE,QAAQA,EAAK,UAAU,WAAW,GAAA,IAAO;AAAA,QACnF,MAAMA,EAAK,UAAU;AAAA,QACrB,QAAQA,EAAK,UAAU;AAAA,MACxB;AAAA,MACA,MAAMA,EAAK,SAAS,CAAC,GAAG;AAAA;AAAA,MACxB,QAAQA,EAAK,SAAS,EAAE,QAAQA,EAAK,OAAO,OAAO;AAAA,MACnD,UAAUA,EAAK,SAAS,IAAI,CAAC0B,OACrB;AAAA,QACN,SAASA,EAAQ,WAAW;AAAA,QAC5B,MAAMA,EAAQ;AAAA,MACf,EACA;AAAA,IACF,EACA,GAEoC,OAAO3B,EAAK,QAAQ,IAGnD,EAAE,OAAAwB,EAAM;AAAA,EAAA;AAEjB;ACpEO,MAAM+D,WACJzE,GAET;AAAA,EACCgC;AAAA,EAEA,YAAYZ,GAAyB;AACpC,UAAMA,CAAI,GAEL,KAAAY,KAAc,IAAIsC,GAA+B,IAAI;AAAA,EAAA;AAAA,EAG3D,OAAO1R,GAAiC;AAChC,WAAA,KAAKoP,GAAY,OAAOpP,CAAI;AAAA,EAAA;AAErC;ACjBO,MAAM8R,WACJ1E,GAET;AAAA,EACC2E,KAAc,IAAIF,GAAyB,IAAI;AAAA,EAE/C,MAAM,OAAO7R,GAAiC;AACtC,WAAA,KAAK+R,GAAY,OAAO/R,CAAI;AAAA,EAAA;AAAA,EAG3B,UAAgB;AACxB,SAAK+R,GAAY,QAAQ;AAAA,EAAA;AAE3B;;;;;;;;;;;;gZClBAhC,IAAAiC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,GAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC;AA+BA,MAAMlD,KAA0B,EAAE,MAAM,SAAS,QAAQ,MAAM,YAAYtD,GAA2B;AAIzF,IAAAyG,IAAN,cAAyCzH,GAAuE;AAAA,EA8CtH,cAAc;AACP,UAAA,GA/CDrL,GAAA,MAAA0R,CAAA,GACiB1R,GAAA,MAAAoP,IAAA,IAAIJ,GAAuB,IAAI,CAAA,GAC/BhP,GAAA,MAAAqR,IAAA,IAAI9C,GAAuB,IAAI,CAAA,GAC/BvO,GAAA,MAAAsR,IAAA,IAAIH,GAAuB,IAAI,CAAA,GAEtDnR,GAAA,MAAAuR,EAAA,GAGA,KAAQ,oBAAwF,MAAM,IAGtG,KAAQ,mBAAiD,CAAC,GAG1D,KAAQ,eAAe,GAGvB,KAAQ,qBAAqB,GAG7B,KAAQ,gBAAgD,CAAC,GAMzD,KAAQ,eAAe,IAGvB,KAAQ,sBAAyC5B,IAGjD,KAAQ,mBAAmB,IAML,KAAA,aAAA,IAKtB3P,GAAA,MAAAwR,wBAAiB,IAAkC,CAAA,GACnDxR,GAAA,MAAAyR,EAAA,GAsJAzR,GAAA,MAAAkS,IAAmBa,GAAS,MAAM;AACjC1S,MAAAA,EAAA,MAAKqR,GAALO,EAAA,EAAA,KAAA,IAAA;AAAA,OACE,GAAG,CAAA,GAnJA,KAAA,eAAee,IAA0C,CAACzS,MAAY;AAC1E,WAAK,QAAQA,GAAS,UAAU,CAAC0S,MAAa;AAC7CzS,QAAAA,GAAA,MAAK+Q,IAAY0B,CAAA;AAAA,MAAA,CACjB;AAAA,IAAA,CACD,GAEI,KAAA,eAAeC,IAAqB,CAAC3S,MAAY;AACrD,WAAK,QAAQA,GAAS,SAAS,CAAC4S,MAAY;AAC3C3S,QAAAA,GAAA,MAAKiR,IAAkB0B,CAAA;AAAA,MAAA,CACvB;AAAA,IAAA,CACD;AAAA,EAAA;AAAA,EAGF,MAAe,oBAAmC;AACjD,UAAM,kBAAkB,GACpB,KAAK,MAAM,mBACT,KAAA,oBAAoB,KAAK,MAAM;AAAA,EACrC;AAAA,EAGD,MAAyB,aAAahR,GAAmD;AACxF,UAAM,aAAaA,CAAkB;AAE/B,UAAAiR,IAAY,KAAK,MAAM;AAE7B,QAAIA,GAAW;AACR,YAAA,EAAE,MAAAzH,EAAK,IAAI,MAAMlL,EAAA,MAAK4Q,IAAqB,aAAa,CAAC+B,EAAU,MAAM,CAAC;AAC3E,WAAA,aAAazH,IAAO,CAAC,GAEtB,KAAK,eACR,KAAK,sBAAsB;AAAA,QAC1B,MAAM,KAAK,WAAW;AAAA,QACtB,QAAQ,KAAK,WAAW;AAAA,QACxB,YAAY,KAAK,WAAW;AAAA,MAC7B,GAEK,KAAA,cAAc,EAAE,QAAQ,KAAK,WAAW,QAAQ,YAAY,KAAK,WAAW,WAAW;AAAA,IAC7F;AAGDtL,IAAAA,EAAA,MAAKqR,GAALC,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EAyKQ,SAAS;AACV,WAAA/Q;AAAA,+BACsB,KAAK,SAAS,KAAK,4BAA4B,CAAC;AAAA,MACzEP,QAAKqR,GAALc,EAAA,EAAA,KAAA,IAAA,CAAkB,IAAInS,EAAA,MAAKqR,OAAL,KAAwB,IAAA,CAAA;AAAA;AAAA,yBAE3B,KAAK,SAAS,KAAK,eAAe,CAAC,WAAW,KAAK,YAAY;AAAA;AAAA,cAE1E,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAAA,eAGnC,KAAK,YAAY;AAAA;AAAA;AAAA;AAAA,EAAA;AAgMhC;AA3cCtC,KAAA,oBAAA,QAAA;AACAiC,KAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AAEAC,KAAA,oBAAA,QAAA;AAsCAC,KAAA,oBAAA,QAAA;AACAC,KAAA,oBAAA,QAAA;AA5CMC,IAAA,oBAAA,QAAA;AA4FAC,KAA+B,eAAC0B,GAA0C;AAC/E,QAAMC,IAAM,KAAK,oBAAoB,aAAa,KAAK,oBAAoB;AAC3E,MAAIC,IAAoB9S,EAAA,MAAK+Q,EAAW,EAAA,IAAI8B,CAAG;AAE/C,EAAKC,MACJA,IAAoB,IAAIC,GAAqB,GAC7CD,EAAkB,YAAY,GAAG,GAC5B9S,EAAA,MAAA+Q,EAAA,EAAW,IAAI8B,GAAKC,CAAiB;AAGrC,QAAAtF,IAAOsF,EAAkB,QAAQ,GACjCrF,IAAOqF,EAAkB,YAAY,GAErC,EAAE,MAAA5H,EAAK,IAAI,MAAMlL,EAAA,MAAK2O,IAAqB,mBAAmB;AAAA,IACnE,QAAQ;AAAA,MACP,QAAQ,KAAK,oBAAoB;AAAA,MACjC,YAAY,KAAK,oBAAoB;AAAA,IACtC;AAAA,IACA,UAAU3O,EAAK,MAAA8Q,EAAA;AAAA,IACf,MAAAtD;AAAA,IACA,MAAAC;AAAA,EAAA,CACA;AAOD,MALK,KAAA,mBAAmBvC,GAAM,SAAS,CAAC,GACtB4H,EAAA,cAAc5H,GAAM,SAAS,CAAC,GAC3C,KAAA,eAAe4H,EAAkB,qBAAqB,GACtD,KAAA,qBAAqBA,EAAkB,cAAc,GAEtDF,GAAe,QAAQ;AACpB,UAAAI,IAAe,KAAK,iBAAiB,KAAK,CAAC/Q,MAAMA,EAAE,UAAU2Q,EAAc,CAAC,EAAE,MAAM;AAC1F,IAAII,KACHpT,EAAA,MAAKqR,OAAL,KAAiB,MAAA+B,CAAA;AAAA,EAClB;AAEF;AAEA7B,KAAiB,SAAC8B,GAA6B;AAC9C,QAAM/K,IAAS+K,EAAI;AACdrT,EAAAA,EAAA,MAAAqR,GAAAC,EAAA,EAAL,WAAqChJ,EAAO,KAAA;AAC7C;AAEAkJ,KAAO,SAACjG,GAAuD;AAC9DvL,EAAAA,EAAA,MAAKqR,GAALM,EAAA,EAAA,KAAA,IAAA,GAEA,KAAK,sBAAsB;AAAA,IAC1B,MAAMpG,EAAK;AAAA,IACX,QAAQA,EAAK;AAAA,IACb,YAAYS;AAAA,EACb,GAGA,KAAK,cAAc,KAAK,oBAAoB,SACzC,EAAE,QAAQ,KAAK,oBAAoB,QAAQ,YAAY,KAAK,oBAAoB,WAChF,IAAA,QAEHhM,EAAA,MAAKqR,GAALC,EAAA,EAAA,KAAA,IAAA;AACD;AAEAG,KAAW,SAAClG,GAAuD;AAClE,QAAM+H,IAAY,KAAK,MAAM,WAAW,CAAC,GAAG,KAAK,MAAM,WAAW/H,EAAK,MAAO,IAAI,CAACA,EAAK,MAAO;AAC1F,OAAA,mBAAmB+H,EAAU,SAAS,GAC3C,KAAK,cAAc,SAAS,EAAE,WAAAA,EAAA,CAAW;AAC1C;AAEA5B,KAAa,SAACnG,GAAuD;AAC9D,QAAA+H,IAAY,KAAK,MAAM,UAAU,OAAO,CAACzT,MAAUA,MAAU0L,EAAK,MAAM;AACzE,OAAA,mBAAmB+H,EAAU,SAAS,GAC3C,KAAK,cAAc,SAAS,EAAE,WAAAA,EAAA,CAAW;AAC1C;AAEA3B,KAAY,WAAG;AACd,OAAK,eAAe,IACpB,KAAK,gBAAgB,CAAC;AACvB;AAEMC,KAAY,iBAAG;AAChB,MAAA,CAAC,KAAK,cAAc;AACvB5R,IAAAA,EAAA,MAAKqR,GAALM,EAAA,EAAA,KAAA,IAAA,GACA,KAAK,aAAa;AAClB;AAAA,EAAA;AAGD,QAAMvO,IAAQ,KAAK,cACb,EAAE,MAAAkI,EAAK,IAAI,MAAMlL,EAAA,MAAK6Q,IAAqB,OAAO;AAAA,IACvD,OAAA7N;AAAAA,IACA,YAAY,KAAK;AAAA,IACjB,SAAShD,EAAK,MAAAgR,EAAA;AAAA,IACd,GAAG,KAAK,MAAM,QAAQ;AAAA,EAAA,CACtB;AAED,MAAI,CAAC9F,GAAM;AAEV,SAAK,gBAAgB,CAAC,GACtB,KAAK,aAAa;AAClB;AAAA,EAAA;AAID,OAAK,gBAAgBA,EAAK,OAC1B,KAAK,aAAa;AACnB;AAEAuG,KAAA,oBAAA,QAAA;AAIAC,KAAS,SAAC,GAAkB;AAC3B,OAAK,eAAgB,EAAE,OAAO,MAAiB,kBAAkB,GACjE,KAAK,aAAa,IAClB1R,EAAA,MAAKyR,EAAL,EAAA,KAAA,IAAA;AACD;AAEAE,KAAa,SAAC,GAAgB;AAC7B,QAAMwB,IAAU,EAAE;AAElB,EAAIA,EAAQ,eACX,KAAK,sBAAsBA,EAAQ,eACzB,KAAK,aACf,KAAK,sBAAsB;AAAA,IAC1B,MAAM,KAAK,WAAW;AAAA,IACtB,QAAQ,KAAK,WAAW;AAAA,IACxB,YAAY,KAAK,WAAW;AAAA,EAC7B,IAEA,KAAK,sBAAsBjE,IAGxB,KAAK,oBAAoB,SACvB,KAAA,cAAc,EAAE,QAAQ,KAAK,oBAAoB,QAAQ,YAAY,KAAK,oBAAoB,WAAW,IAE9G,KAAK,cAAc,QAGpBtP,EAAA,MAAKqR,GAALC,EAAA,EAAA,KAAA,IAAA;AACD;AAEAU,KAAa,SAACpS,GAA2B;AACxC,EAAAA,EAAM,gBAAgB;AACtB,QAAMqT,IAAM,KAAK,oBAAoB,aAAa,KAAK,oBAAoB,QAErEC,IAAoB9S,EAAA,MAAK+Q,EAAW,EAAA,IAAI8B,CAAG;AAEjD,MAAI,CAACC;AACE,UAAA,IAAI,MAAM,8BAA8B;AAG7B,EAAAA,EAAA,qBAAqBtT,EAAM,OAAO,OAAO,GACtDQ,EAAA,MAAA+Q,EAAA,EAAW,IAAI8B,GAAKC,CAAiB,GAE1ClT,EAAA,MAAKqR,GAALC,EAAA,EAAA,KAAA,IAAA;AACD;AAEAW,KAAqB,SAAC1G,GAAgE;AACrF,SAAOiI,GAAgBjI,EAAK,UAAU,MAAM,KAAKA,EAAK;AACvD;AAEA2G,KAAmB,SAAC,GAAgB;AAGnC,EAFiB,EAAE,OAA4B,UAGzC,KAAA,cAAc,EAAE,QAAQ,KAAK,oBAAoB,QAAQ,YAAY,KAAK,oBAAoB,WAAW,IAE9G,KAAK,cAAc;AAErB;AAkBAC,KAAW,WAAG;AACN,SAAA5R,IAAOP,EAAK,MAAAqR,GAAAiB,EAAA,EAAL,KAAqB,IAAA,CAAA;AAAA;AAAA;AAAA;AAAA,cAIvBtS,QAAKqR,GAAiBE,EAAA,CAAA;AAAA,oBAChB,KAAK,oBAAoB,MAAM;AAAA,KAC9C,KAAK,eAAevR,EAAA,MAAKqR,OAAL,KAA6B,IAAA,IAAArR,EAAA,MAAKqR,OAAL,KAA6B,IAAA,CAAA;AAClF;AAEAe,KAAmB,WAAG;AACd,SAAA7R;AAAA,KACJ,CAAC,KAAK,cAAc,UAAU,CAAC,KAAK,aACnCA,8BAAiC,KAAK,SAAS,KAAK,yBAAyB,CAAC,eAC9EA;AAAA,QACEE;AAAA,IACD,KAAK;AAAA,IACL,CAAC8K,MAASA,EAAK;AAAA,IACf,CAACA,MAASvL,EAAK,MAAAqR,GAAAkB,EAAA,EAAL,KAAiB,MAAAhH,CAAA;AAAA,EAC3B,CAAA;AAAA,YACK;AAAA;AAEX;AAEA8G,KAAsB,WAAG;AACjB,SAAA9R;AAAA,KACH,KAAK,iBAAiB,SAEtBA;AAAA,SACGE;AAAA,IACD,KAAK;AAAA,IACL,CAAC8K,MAASA,EAAK;AAAA,IACf,CAACA,MAASvL,EAAK,MAAAqR,GAAAkB,EAAA,EAAL,KAAiB,MAAAhH,CAAA;AAAA,EAC3B,CAAA;AAAA;AAAA,QAEA,KAAK,qBAAqB,IACzBhL;AAAA,oBACW,KAAK,YAAY;AAAA,kBACnB,KAAK,kBAAkB;AAAA,sBACnB,KAAK,SAAS,KAAK,eAAe,CAAC;AAAA,oDACL,KAAK,SAAS,KAAK,kBAAkB,CAAC;AAAA,gDAC1C,KAAK,SAAS,KAAK,cAAc,CAAC;AAAA,gDAClC,KAAK,SAAS,KAAK,cAAc,CAAC;AAAA,mBAC/DP,EAAK,MAAAqR,GAAAW,EAAA,CAAa,uBAC5BjQ,CAAO,KAjBVxB,8BAAiC,KAAK,SAAS,KAAK,yBAAyB,CAAC,YAiBlE;AAAA;AAEjB;AAEA+R,KAAc,WAAG;AAGT,SAAA/R;AAAA;AAAA;AAAA;AAAA,cAIK,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA,oBAC9B,KAAK,SAAS,KAAK,qBAAqB,CAAC;AAAA,eAC9CP,QAAKqR,GAASS,EAAA,CAAA;AAAA,cACf,KAAK,YAAY;AAAA;AAAA,SAEtB,KAAK,aACJvR,sEACAA,sCAAyC;AAAA;AAAA;AAAA;AAAA,OAI5C,KAAK,oBAAoB,UAAU,KAAK,oBAAoB,WAAW,KAAK,YAAY,SACvFA;AAAA,mBACW,KAAK,aAAa,WAAW,KAAK,oBAAoB,MAAM;AAAA,kBAC7DP,QAAKqR,GAAmBa,EAAA,CAAA;AAAA,gCACV,KAAK,oBAAoB,IAAI,sBACrDnQ,CAAO;AAAA;AAAA;AAAA,cAGD,MAAM,KAAK,UAAU,OAAQ,CAAA;AAAA,aAC9B,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAAA;AAAA;AAKhD;AAEAwQ,KAAW,SAAChH,GAAuD;AAC5D,QAAAkI,IAAczT,EAAK,MAAAqR,GAAAY,EAAA,EAAL,KAA2B,MAAA1G,CAAA,GACzCmI,IAAa,KAAK,kBAAkBnI,CAAI;AAEvC,SAAAhL;AAAA;AAAA,YAEG0B,GAHO,EAAEyR,KAAcD,KAGF,gBAAgB,MAAS,CAAC;AAAA,YAC/ClI,EAAK,IAAI;AAAA,iBACJA,EAAK,UAAU,IAAIA,EAAK,MAAM;AAAA,YACnC,MAAMvL,EAAA,MAAKqR,GAALG,EAAA,EAAA,KAAA,MAAajG,CAAK,CAAA;AAAA,gBACpB,MAAMvL,EAAA,MAAKqR,GAALI,EAAA,EAAA,KAAA,MAAiBlG,CAAK,CAAA;AAAA,kBAC1B,MAAMvL,EAAA,MAAKqR,GAALK,EAAA,EAAA,KAAA,MAAmBnG,CAAK,CAAA;AAAA,gBAChC,KAAK,OAAO,WAAW,KAAK,CAAC1L,MAAUA,MAAU0L,EAAK,MAAM,CAAC;AAAA,kBAC3DmI,CAAU;AAAA,mBACT,KAAK,oBAAoBD,MAAgB,EAAK;AAAA;AAAA,cAEnDlI,EAAK,MAAM;AAAA,WACdA,EAAK,IAAI;AAAA,YACRA,EAAK,UAAU,IAAI;AAAA;AAAA;AAG9B;AAEAiH,KAAiB,WAAG;AAGnB,MAAI,KAAK,gBAAgB,KAAK,oBAAoB,UAAU,CAAC,KAAK;AAC1D,WAAAzQ;AAGF,QAAAgR,IAA2C,KAAK,aACnD;AAAA,IACA,YAAY,KAAK,WAAW;AAAA,IAC5B,QAAQ,KAAK,WAAW;AAAA,IACxB,MAAM,KAAK,WAAW;AAAA,EAAA,IAEtB;AAEI,SAAAxS;AAAA;AAAA,mBAEU,KAAK,mBAAmB;AAAA,gBAC3BwS,CAAS;AAAA,aACZ/S,QAAKqR,GAAaU,EAAA,CAAA;AAC9B;AA/YYU,EAiZI,SAAS;AAAA,EACxB9R;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAyDD;AAncQC,EAAA;AAAA,EADPE,EAAM;AAAA,GAPK2R,EAQJ,WAAA,qBAAA,CAAA;AAGA7R,EAAA;AAAA,EADPE,EAAM;AAAA,GAVK2R,EAWJ,WAAA,oBAAA,CAAA;AAGA7R,EAAA;AAAA,EADPE,EAAM;AAAA,GAbK2R,EAcJ,WAAA,gBAAA,CAAA;AAGA7R,EAAA;AAAA,EADPE,EAAM;AAAA,GAhBK2R,EAiBJ,WAAA,sBAAA,CAAA;AAGA7R,EAAA;AAAA,EADPE,EAAM;AAAA,GAnBK2R,EAoBJ,WAAA,iBAAA,CAAA;AAGA7R,EAAA;AAAA,EADPE,EAAM;AAAA,GAtBK2R,EAuBJ,WAAA,eAAA,CAAA;AAGA7R,EAAA;AAAA,EADPE,EAAM;AAAA,GAzBK2R,EA0BJ,WAAA,gBAAA,CAAA;AAGA7R,EAAA;AAAA,EADPE,EAAM;AAAA,GA5BK2R,EA6BJ,WAAA,uBAAA,CAAA;AAGA7R,EAAA;AAAA,EADPE,EAAM;AAAA,GA/BK2R,EAgCJ,WAAA,oBAAA,CAAA;AAGA7R,EAAA;AAAA,EADPE,EAAM;AAAA,GAlCK2R,EAmCJ,WAAA,cAAA,CAAA;AAGR7R,EAAA;AAAA,EADCE,EAAM;AAAA,GArCK2R,EAsCZ,WAAA,cAAA,CAAA;AAGQ7R,EAAA;AAAA,EADPwC,GAAM,WAAW;AAAA,GAxCNqP,EAyCJ,WAAA,aAAA,CAAA;AAzCIA,IAAN7R,EAAA;AAAA,EADNG,EAAc,wBAAwB;AAAA,GAC1B0R,CAAA;AA8cb,MAAAkB,KAAelB;;;;;;8CC/eFmB,KAA6B;AACJC,GAAyB,iBAAiB;AAAA,EAC/E,aAAaD;AACd,CAAC;ACAY,MAAAE,KAA2BC,GAA2B,iBAAiB;AAAA,EACnF,aAAaH;AAAA,EACb,YAAY7H;AACb,CAAC,GAEYiI,KAA0C,IAAIC,GAIxD,kEAAkEH,EAAwB,GAEhFI,KAAwC,IAAID,GAAmC,cAAc,GCb7FE,KAA2C,IAAIrK;AAAA,EAC3D;AACD,GCLasK,KAAkC,4BAClCC,KAAwB,uBCAxBC,KAAkC,4BCUlCC,KAA8B,IAAIvK;AAAA,EAC9CwK;AAAA,EACA;AAAA,IACC,OAAO;AAAA,MACN,MAAM;AAAA,MACN,MAAM;AAAA,IACP;AAAA,IACA,MAAM;AAAA,MACL,WAAW;AAAA,IAAA;AAAA,EACZ;AAEF,GCjBaC,KAA8B,IAAI3K;AAAA,EAI9C;AAAA,EACA;AAAA,EACA,CAAC5J,MAAiDA,EAAQ,sBAAsB6L;AACjF,GCPa2I,KAAwB,CAACxU,MACrCA,EAAQ,cAAoB,MAAA6L,GAEhB4I,KAA4B,IAAI7K;AAAA,EAC5C;AAAA,EACA;AAAA,EACA4K;AACD;;;;;;;kYCZAE,IAAA5F,IAAA6F,IAAAC,IAAAC;AAWa,IAAAC,KAAN,cAAiDhK,GAGtD;AAAA,EAHK,cAAA;AAAA,UAAA,GAAA,SAAA,GAAArL,GAAA,MAAAmV,EAAA,GAINnV,GAAA,MAAAiV,EAAA,GACSjV,GAAA,MAAAqP,IAAyB,IAAI1B,GAAyB,IAAI,CAAA,GAC1D3N,GAAA,MAAAkV,IAAsB,IAAI5J,GAAsB,IAAI,CAAA;AAAA,EAAA;AAAA,EAEpD,oBAAoB;AAC5B,UAAM,kBAAkB,GACnB9K,GAAA,MAAAyU,IAAe,KAAK,MAAM,WAAA,GAC/B5U,GAAA,MAAK8U,IAALC,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EAiBQ,SAAS;AACV,WAAAxU;AAAA,gCACuB,KAAK,SAAS,KAAK,kCAAkC,CAAC;AAAA;AAAA,iCAErD,KAAK,SAAS,KAAK,yBAAyB,CAAC;AAAA;AAAA;AAAA;AAAA,eAI/D,KAAK,OAAO,WAAW,EAAE;AAAA,eACzB,CAAC,MACR,KAAK,QAAQ,EAAE,GAAG,KAAK,OAAO,SAAS,EAAE,OAAO,MAAA,CAAkB;AAAA;AAAA,gCAE1C,KAAK,SAAS,KAAK,6BAA6B,CAAC;AAAA;AAAA;AAAA;AAAA,eAIlE,KAAK,OAAO,WAAW,EAAE;AAAA,eACzB,CAAC,MACR,KAAK,QAAQ,EAAE,GAAG,KAAK,OAAO,SAAS,EAAE,OAAO,MAAA,CAAkB;AAAA;AAAA;AAAA,iBAGzD,KAAK,OAAO,OAAO,EAAE,QAAQ,KAAK,OAAO,WAAW,EAAE;AAAA,oBACnD,KAAK,OAAO,WAAW,EAAE;AAAA;AAAA;AAAA;AAAA,yBAIpB,KAAK,SAAS,KAAK,eAAe,CAAC,WAAW,KAAK,YAAY;AAAA;AAAA,cAE1E,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAAA,eAGnC,KAAK,YAAY;AAAA;AAAA;AAAA;AAAA,EAAA;AA6BhC;AApFCqU,KAAA,oBAAA,QAAA;AACS5F,KAAA,oBAAA,QAAA;AACA6F,KAAA,oBAAA,QAAA;AANHC,KAAA,oBAAA,QAAA;AAcAC,KAAe,iBAAG;AACnB,MAAA,CAAC3U,SAAKwU,EAAc,EAAA;AAClB,QAAA,EAAE,MAAMK,EAAU,IAAI,MAAM7U,GAAK,MAAA4O,EAAA,EAAuB,gBAAgB5O,GAAA,MAAKwU,EAAY,CAAA;AAC/F,MAAI,CAACK,EAAW;AAEV,QAAA,EAAE,MAAMC,MAAiB,MAAM9U,GAAK,MAAAyU,EAAA,EAAoB,aAAa,CAACzU,GAAK,MAAAwU,EAAA,CAAY,CAAC;AAE9F,OAAK,QAAQ;AAAA,IACZ,GAAG,KAAK;AAAA,IACR,SAAS,KAAK,OAAO,WAAWK,EAAU,SAAS,CAAC,EAAE;AAAA,IACtD,KAAKC,IAAe,CAAC,EAAE,OAAO;AAAA,EAC/B;AACD;AA1BYF,GAiEa,SAAS;AAAA,EACjCrU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAqBD;AAvFYqU,KAANpU,GAAA;AAAA,EADNG,EAAc,kCAAkC;AAAA,GACpCiU,EAAA;AA0Fb,MAAAG,KAAeH;;;;;;;ACrFR,MAAMI,WAAmCC,GAK9C;AAAA,EACD,YAAY7H,GAAyB;AAC9B,UAAAA,GAAM4G,IAAiC/J,EAAsB;AAAA,EAAA;AAAA,EAGpE,MAAe,WAAWiL,GAA+CtW,GAA2C;AACnH,UAAMuW,IAAqB;AAAA,MAC1B,GAAGD;AAAA,IACJ;AAGA,IAAAC,EAAmB,iBAAiB,CAAChK,MAAS,KAAKiK,GAAgBjK,GAAMvM,GAAM,mBAAmB,GAG7FsW,GAAY,WAChBC,EAAmB,SAAS;AAAA,MAC3B,eAAejB;AAAA,MACf,GAAGgB,GAAY;AAAA,IAChB;AAIK,UAAAxC,IAAU,OADO,MAAM,KAAK,WAAWD,EAAmB,IAC1B,kBAAkB;AAGxD,IAAA0C,EAAmB,OAAQ,cAAc;AAAA,MACxC,qBAAqBvW,GAAM;AAAA,MAC3B,gBAAgBA,GAAM;AAAA,MACtB,SAAA8T;AAAA,MACA,GAAGwC,GAAY,QAAQ;AAAA,IACxB,GAEM,MAAA,MAAM,WAAWC,CAAkB;AAAA,EAAA;AAAA,EAG1CC,KAAkB,CACjBjK,GACAkK,MAEIA,KAAuBA,EAAoB,SAAS,IAChDA,EACL,IAAI,CAACC,MAAyBA,EAAqB,MAAM,EACzD,SAASnK,EAAK,UAAU,MAAM,IAE1B;AAET;;;;;;;iZCnEAoK,IAAAC,GAAAC,IAAAC,IAAAC,GAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC,IAAAC;AAwBA,MAAMC,KAAc;AAEb,IAAMC,IAAN,cAAmCrN,GAA8DzJ,CAAa,EAAE;AAAA,EAiItH,cAAc;AACP,UAAA,GAlIDC,GAAA,MAAAiW,CAAA,GACIjW,GAAA,MAAAgW,IAAA,IAAIc,GAA4B,MAAM;AAAA,MAC/C,oBAAoB,CAAC9G,MACbA,EAAQ,aAAa,QAAQ;AAAA,MAErC,kBAAkB,CAAC+G,MACXA;AAAA,MAER,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,mBAAmB;AAAA,MACnB,kBAAkBC;AAAA,MAClB,UAAU,CAAC,EAAE,OAAAzJ,QAAY;AACxB,aAAK,YAAYA,GACjBlN,GAAA,MAAK4V,OAAL,KAAgB,MAAA1I,CAAA,GACX,KAAA,cAAc,IAAIxM,GAAgB;AAAA,MAAA;AAAA,IACxC,CACA,CAAA,GAiCY,KAAA,aAAA,8BAuBA,KAAA,aAAA,kDAcI,KAAA,iBAAA,IAgCLf,GAAA,MAAAmW,IAAA,EAAA,GAGZ,KAAQ,iBAAiB,IAGzB,KAAQ,SAAuC,CAAC,GAE/BnW,GAAA,MAAAoW,GAAA,IAAIX,GAA2B,IAAI,CAAA,GAK/C,IAAAjK,GAAoC,MAAMC,EAAmB,EAC/D,kBAAkB,OAAO,EACzB,QAAQ,OACD,EAAE,MAAM,EAAE,YAAY,SAAS,QAAQ,CAAA,IAAK,EACnD,EACA,oBAAoB,CAACC,MAAiB;AACjC,WAAA,iBAAiBA,EAAa,EAAE;AAAA,IAAA,CACrC,GAEG,KAAA,QAAQjL,EAAK,MAAA2V,CAAA,EAAe,WAAW,CAACzC,MAAe,KAAK,QAAQA,EAAU,KAAK,GAAG,CAAE,GAE7F,KAAK,QAAQlT,EAAA,MAAK2V,CAAe,EAAA,eAAe,OAAO/C,MAAkB;AACxE,YAAM4D,IAAe5D,EAAc,OAAO,CAACzH,MAAS,CAAC,KAAK,OAAO,KAAK,CAACsL,MAASA,EAAK,WAAWtL,EAAK,MAAM,CAAC;AAC5G,MAAIyH,GAAe,UAAU,CAAC4D,EAAa,WAEtC,KAAA,SAAS5D,KAAiB,CAAC;AAAA,IAAA,CAChC,GAEI,KAAA;AAAA,MACJ;AAAA,MACA,MAAM,KAAK;AAAA,MACX,MAAM,CAAC,CAAC,KAAK,OAAO,KAAK,UAAU,SAAS,KAAK;AAAA,IAClD,GACK,KAAA;AAAA,MACJ;AAAA,MACA,MAAM,KAAK;AAAA,MACX,MAAM,CAAC,CAAC,KAAK,OAAO,KAAK,UAAU,SAAS,KAAK;AAAA,IAClD;AAAA,EAAA;AAAA,EA3HD,IAAW,IAAInT,GAAe;AAC7BO,IAAAA,EAAA,MAAK2V,GAAe,MAAMlW;AAAA,EAAA;AAAA,EAE3B,IAAW,MAAc;AACxB,WAAOO,QAAK2V,CAAe,EAAA;AAAA,EAAA;AAAA,EAmB5B,IAAW,IAAIlW,GAAe;AAC7BO,IAAAA,EAAA,MAAK2V,GAAe,MAAMlW;AAAA,EAAA;AAAA,EAE3B,IAAW,MAAc;AACxB,WAAOO,QAAK2V,CAAe,EAAA;AAAA,EAAA;AAAA,EAY5B,IAAW,UAAUe,GAAoB;AACnC1W,IAAAA,EAAA,MAAA2V,CAAA,EAAe,aAAae,CAAG,GAC/B1W,EAAA,MAAAuV,EAAA,EAAQ,SAASmB,CAAG;AAAA,EAAA;AAAA,EAE1B,IAAW,YAA2B;AAC9B,WAAA1W,EAAA,MAAK2V,GAAe,aAAa;AAAA,EAAA;AAAA,EAazC,IAAoB,MAAMgB,GAAqC;AACzD,SAAA,YAAYC,GAAmBD,CAAe;AAAA,EAAA;AAAA,EAEpD,IAAoB,QAA4B;AACxC,WAAA,KAAK,UAAU,SAAS,IAAI,KAAK,UAAU,KAAK,GAAG,IAAI;AAAA,EAAA;AAAA,EAU/D,IAAW,WAAW;AACrB,WAAO3W,EAAK,MAAA0V,EAAA;AAAA,EAAA;AAAA,EAEb,IAAW,SAASjW,GAAO;AAC1BM,IAAAA,GAAA,MAAK2V,IAAYjW,CAAA,GAEbO,QAAK0V,EAAW,IACnB1V,EAAA,MAAKuV,IAAQ,QAAQ,IAErBvV,EAAA,MAAKuV,IAAQ,OAAO;AAAA,EACrB;AAAA,EAkEQ,SAAS;AACjB,WAAOpV,2BAA8BP,GAAK,MAAA4V,GAAAM,EAAA,EAAL,UAAmB,IAAIlW,GAAA,MAAK4V,OAAL,KAAuB,IAAA,CAAA;AAAA,EAAA;AA0GrF;AAjSCD,KAAA,oBAAA,QAAA;AADMC,IAAA,oBAAA,QAAA;AAmBNC,KAAU,SAAC3I,GAAsB;AAChC,QAAM+J,IAA6C,CAAC;AAC9C,EAAA/J,EAAA,QAAQ,CAAC3B,GAAMzL,MAAU;AAC9B,IAAAmX,EAAa1L,CAAI,IAAIzL;AAAA,EAAA,CACrB;AAED,QAAMoX,IAAQ,CAAC,GAAG,KAAK,MAAM;AAC7B,OAAK,SAASA,EAAM,KAAK,CAACC,GAAGC,MAAMH,EAAaE,EAAE,MAAM,IAAIF,EAAaG,EAAE,MAAM,CAAC;AACnF;AA4FAtB,KAAA,oBAAA,QAAA;AAQAC,IAAA,oBAAA,QAAA;AAmCAC,KAAW,WAAG;AACb5V,EAAAA,EAAA,MAAK2V,CAAe,EAAA;AAAA,IACnB;AAAA,MACC,UAAU,KAAK,MAAM;AAAA,MACrB,WAAW,KAAK;AAAA,IACjB;AAAA,IACA;AAAA,MACC,qBAAqB,KAAK,uBAAuB,IAAI,CAACsB,OAAQ;AAAA,QAC7D,QAAQA;AAAA,QACR,YAAYC;AAAA,MAAA,EACX;AAAA,MACF,gBAAgB,KAAK;AAAA,IAAA;AAAA,EAEvB;AACD;AAEMrB,KAAS,eAAC1K,GAA6B;AAC5C,QAAMnL,EAAK,MAAA2V,CAAA,EAAe,kBAAkBxK,EAAK,MAAM,GAClD,KAAA,SAAS,KAAK,OAAO,OAAO,CAAClJ,MAAMA,EAAE,WAAWkJ,EAAK,MAAM;AACjE;AAMA2K,KAAY,WAAG;AACd,SAAK,KAAK,QAAQ,SACX3V;AAAA,KACJE;AAAA,IACD,KAAK;AAAA,IACL,CAAC8K,MAASA,EAAK;AAAA,IACf,CAACA,MAASvL,GAAK,MAAA4V,GAAAQ,EAAA,EAAL,KAAiB,MAAA7K,CAAA;AAAA,EAC3B,CAAA;AAAA,MAN+BxJ;AAQlC;AAEAoU,KAAgB,WAAG;AAEd,SAAA,KAAK,UAAU,KAAK,OAAO,KAAK,OAAO,UAAU,KAAK,MAAYpU,IAClE,KAAK,YAAY,KAAK,OAAO,SAAS,IAClCA,IAEAxB;AAAA;AAAA;AAAA;AAAA,cAIIP,SAAK4V,GAAWI,EAAA,CAAA;AAAA,aACjB,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA,iBAChC,KAAK,QAAQ;AAAA;AAAA,OAEvB,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAI1C;AAEAI,KAAW,SAAC7K,GAA6B;AAClC,QAAAgM,IAAO,KAAK,WAAW,SAAY,GAAG,KAAK,cAAc,QAAQhM,EAAK,MAAM;AAC3E,SAAAhL;AAAA;AAAA,WAEE0B,GAAUsJ,EAAK,SAAS,OAAO,SAAYA,EAAK,IAAI,CAAC;AAAA,iBAC/CA,EAAK,UAAU,IAAIA,EAAK,MAAM;AAAA,YACnCtJ,GAAUsV,CAAI,CAAC;AAAA,gBACX,KAAK,QAAQ;AAAA;AAAA,cAEfhM,EAAK,MAAM;AAAA,WACdA,EAAK,IAAI;AAAA,YACRA,EAAK,UAAU,IAAI;AAAA,MACzBvL,GAAA,MAAK4V,GAALU,EAAA,EAAA,KAAA,MAAsB/K,CAAK,CAAA;AAAA,sCACKvL,GAAA,MAAK4V,GAALS,EAAA,EAAA,KAAA,MAAyB9K,CAAK,CAAA;AAAA;AAAA;AAGnE;AAEA8K,KAAmB,SAAC9K,GAA6B;AAC5C,SAAA,KAAK,WAAiBxJ,IACnBxB;AAAA,uBACc,KAAK,SAAS,KAAK,gBAAgB,CAAC,4BAA4B,MAAMP,GAAA,MAAK4V,GAALK,EAAA,EAAA,KAAA,MAAe1K,CAAK,CAAA;AAAA;AAAA;AAAA;AAIhH;AAEA+K,KAAgB,SAAC/K,GAA6B;AACzC,SAACA,EAAK,YACHhL;AAAA;AAAA;AAAA;AAAA,MADqBwB;AAM7B;AA5PYyU,EA8PI,SAAS;AAAA,EACxB7V;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkCD;AA7PWC,EAAA;AAAA,EADVC,EAAS,EAAE,MAAM,OAAQ,CAAA;AAAA,GAnCd2V,EAoCD,WAAA,OAAA,CAAA;AAcX5V,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAQ,WAAW,cAAe,CAAA;AAAA,GAjDxC2V,EAkDZ,WAAA,cAAA,CAAA;AASW5V,EAAA;AAAA,EADVC,EAAS,EAAE,MAAM,OAAQ,CAAA;AAAA,GA1Dd2V,EA2DD,WAAA,OAAA,CAAA;AAcX5V,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAQ,WAAW,cAAe,CAAA;AAAA,GAxExC2V,EAyEZ,WAAA,cAAA,CAAA;AAWA5V,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,MAAO,CAAA;AAAA,GAnFb2V,EAoFZ,WAAA,yBAAA,CAAA;AAGA5V,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,SAAS,WAAW,kBAAmB,CAAA;AAAA,GAtF7C2V,EAuFZ,WAAA,kBAAA,CAAA;AAGA5V,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAQ,WAAW,GAAO,CAAA;AAAA,GAzFhC2V,EA0FZ,WAAA,aAAA,CAAA;AAGoB5V,EAAA;AAAA,EADnBC,EAAS,EAAE,MAAM,OAAQ,CAAA;AAAA,GA5Fd2V,EA6FQ,WAAA,SAAA,CAAA;AAcT5V,EAAA;AAAA,EADVC,EAAS,EAAE,MAAM,SAAS,SAAS,GAAM,CAAA;AAAA,GA1G9B2V,EA2GD,WAAA,YAAA,CAAA;AAeH5V,EAAA;AAAA,EADPE,EAAM;AAAA,GAzHK0V,EA0HJ,WAAA,kBAAA,CAAA;AAGA5V,EAAA;AAAA,EADPE,EAAM;AAAA,GA5HK0V,EA6HJ,WAAA,UAAA,CAAA;AA7HIA,IAAN5V,EAAA;AAAA,EADNG,EAAcwV,EAAW;AAAA,GACbC,CAAA;;;;;;;gZC1Bbb,IAAA6B,IAAA1B,IAAA2B,IAAAC,GAAAC,IAAAC,IAAAC,IAAA7B,IAAAC,IAAA6B,IAAAjP,IAAAqN,IAAAC,IAAAC,IAAAxL,IAAA0L;AA6BO,IAAMyB,IAAN,cAAuC5O,GAI5CzJ,GAAe,MAAS,EAAE;AAAA,EAgJ3B,cAAc;AACP,UAAA,GArJDC,GAAA,MAAA+X,CAAA,GAKI/X,GAAA,MAAAgW,IAAA,IAAIc,GAAsD,MAAM;AAAA,MACzE,oBAAoB,CAAC9G,MACbA,EAAQ;AAAA,MAEhB,kBAAkB,CAAC+G,MACXA,EAAW;AAAA,MAEnB,YAAY;AAAA,MACZ,cAAc;AAAA,MACd,mBAAmB;AAAA,MACnB,kBAAkBC;AAAA,MAClB,UAAU,CAAC,EAAE,OAAAzJ,QAAY;AACxB,aAAK,QAAQA,GACR,KAAA,cAAc,IAAIxM,GAAgB;AAAA,MAAA;AAAA,IACxC,CACA,CAAA,GAmBD,KAAO,MAAM,GASA,KAAA,aAAA,8BASb,KAAO,MAAM,OASA,KAAA,aAAA,kDAqBF,KAAA,WAAA,IAYmBf,GAAA,MAAA6X,IAAA,EAAA,GAuClB7X,GAAA,MAAAmW,IAAA,EAAA,GAGZ,KAAQ,SAAuC,CAAC,GAKhDnW,GAAA,MAAS8X,IAAe,IAAIO,GAA6C,MAAM5D,EAA+B,CAAA,GAgH9GzU,GAAA,MAAAiY,IAAwD,CAACrM,MACpD,KAAK,yBAAyB,KAAK,sBAAsB,SAAS,IAC9D,KAAK,sBAAsB,SAASA,EAAK,UAAU,MAAM,IAE1D,EACR,GAhHC,KAAK,QAAQnL,EAAA,MAAKqX,EAAa,EAAA,OAAO,MAAM;AAC3CzX,MAAAA,EAAA,MAAK0X,GAALC,EAAA,EAAA,KAAA,IAAA;AAAA,IAAA,CACA,GAEG,IAAAxM,GAAoC,MAAMU,EAA8B,EAC1E,kBAAkB,MAAM,EACxB,QAAQ,CAACoM,MAAW;AACpB,YAAMhF,IAAMgF,EAAO;AACf,UAAA,CAAChF,EAAY,QAAA;AAEX,YAAA1H,IAAO,KAAK,OAAO,KAAK,CAACA,MAASA,EAAK,QAAQ0H,CAAG;AACpD,aAAC1H,IAEE;AAAA,QACN,MAAM;AAAA,UACL,aAAa,KAAK;AAAA,UAClB,gBAAgB,CAAC,KAAK;AAAA,UACtB,KAAA0H;AAAA,UACA,QAAQ1H,EAAK;AAAA,UACb,gBAAgBnL,EAAK,MAAAwX,EAAA;AAAA,QACtB;AAAA,QACA,OAAO;AAAA,UACN,OAAOrM,EAAK,SAAS,CAAC;AAAA,UACtB,YAAYA,EAAK,cAAc,EAAE,MAAM,KAAK,KAAK,IAAI;AAAA,UACrD,KAAK;AAAA,UACL,KAAA0H;AAAA,UACA,QAAQ1H,EAAK;AAAA,QAAA;AAAA,MAEf,IAjBkB;AAAA,IAiBlB,CACA,EACA,SAAS,CAAC1L,MAAU;AACpB,WAAK,QAAQ,KAAK,OAAO,IAAI,CAAC0L,MAAS;AACtC,YAAIA,EAAK,QAAQ1L,EAAM,IAAY,QAAA0L;AAEnC,cAAMrM,IAAa,KAAK,oBAAoBW,EAAM,aAAa,MACzD2L,IAAQ3L,EAAM,OACdqY,IAAWrY,EAAM,QAGjBoT,IAAMiF,MAAa3M,EAAK,WAAWA,EAAK,MAAMoB,GAAM,IAAI;AAE9D,eAAO,EAAE,GAAGpB,GAAM,OAAAC,GAAO,UAAA0M,GAAU,YAAAhZ,GAAY,KAAA+T,EAAI;AAAA,MAAA,CACnD,GAEI,KAAA,cAAc,IAAIvS,GAAgB;AAAA,IAAA,CACvC,EACA,oBAAoB,CAAC2K,MAAiB;AACtC,WAAK,gBAAgBA;AAAA,IAAA,CACrB,GAEG,KAAA;AAAA,MACJ;AAAA,MACA,MAAM,KAAK,mBAAmBhC;AAAA,MAC9B,MACQ,CAAC,KAAK,YAAY,CAAC,CAAC,KAAK,aAAa,CAAC,KAAK,SAAS,KAAK,MAAM,WAAW;AAAA,IAEpF,GAEK,KAAA;AAAA,MACJ;AAAA,MACA,MAAM,KAAK;AAAA,MACX,MACC,CAAC,KAAK;AAAA,MAEN,CAAC,CAAC,KAAK;AAAA,MAEP,EAAE,KAAK,OAAO,WAAW,KAAK,KAAK,YAAY;AAAA,OAE9C,KAAK,OAAO,UAAU,KAAK,KAAK;AAAA,IACnC,GACK,KAAA;AAAA,MACJ;AAAA,MACA,MAAM,KAAK;AAAA,MACX,MAAM,CAAC,KAAK,YAAY,CAAC,CAAC,KAAK,SAAS,CAAC,CAAC,KAAK,OAAO,KAAK,OAAO,SAAS,KAAK;AAAA,IACjF;AAAA,EAAA;AAAA,EA5JD,IAAoB,MAAMxJ,GAA4D;AACrF,UAAM,QAAQA,GACTO,EAAA,MAAAuV,EAAA,EAAQ,SAAS9V,CAAK,GACtBO,EAAA,MAAAqX,EAAA,EAAa,WAAW5X,GAAO,IAAI,CAACwC,MAAMA,EAAE,QAAQ,CAAC,GAE1DrC,EAAA,MAAK0X,GAALC,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EAED,IAAoB,QAA6D;AAChF,WAAO,MAAM;AAAA,EAAA;AAAA,EAgBd,IAAW,kBAAkB9X,GAAgB;AAC5CM,IAAAA,GAAA,MAAKqX,IAAqB3X,CAAA;AAAA,EAAA;AAAA,EAE3B,IAAW,oBAA6B;AACvC,WAAOO,EAAK,MAAAoX,EAAA;AAAA,EAAA;AAAA;AAAA,EAMb,IAAW,MAAM3X,GAA2B;AAAA,EAAA;AAAA,EAG5C,IAAW,QAA4B;AAAA,EAC/B;AAAA;AAAA,EAKR,IAAW,UAAUA,GAA0C;AAAA,EAAA;AAAA,EAG/D,IAAW,YAAgC;AAAA,EACnC;AAAA,EAUR,IAAW,WAAW;AACrB,WAAOO,EAAK,MAAA0V,EAAA;AAAA,EAAA;AAAA,EAEb,IAAW,SAASjW,GAAO;AAC1BM,IAAAA,GAAA,MAAK2V,IAAYjW,CAAA,GAEbO,QAAK0V,EAAW,IACnB1V,EAAA,MAAKuV,IAAQ,QAAQ,IAErBvV,EAAA,MAAKuV,IAAQ,OAAO;AAAA,EACrB;AAAA,EA4FkB,iBAAiB;AAAA,EAC5B;AAAA,EAwFC,SAAS;AACV,WAAApV;AAAA,KACJP,EAAA,MAAK0X,OAAL,KAAsB,IAAA,CAAA;AAAA,4BACC1X,QAAK0X,GAALxB,EAAA,EAAA,KAAA,IAAA,CAAmB,IAAIlW,EAAA,MAAK0X,OAAL,KAAuB,IAAA,CAAA;AAAA;AAAA,EAAA;AAoH1E;AA/aC/B,KAAA,oBAAA,QAAA;AA8FA6B,KAAA,oBAAA,QAAA;AAuCA1B,KAAA,oBAAA,QAAA;AAQS2B,KAAA,oBAAA,QAAA;AAlJHC,IAAA,oBAAA,QAAA;AAwOAC,KAAc,iBAAG;AAChB,QAAAQ,IAAa/X,EAAK,MAAAqX,EAAA,EAAa,SAAS;AAE1C,MAAA,CAACU,EAAW,QAAQ;AACvB,SAAK,SAAS,CAAC;AACf;AAAA,EAAA;AAID,QAAMvB,IAAeuB,EAAW,OAAO,CAAC5M,MAAS,CAAC,KAAK,OAAO,KAAK,CAACsL,MAASA,EAAK,WAAWtL,EAAK,MAAM,CAAC,GACnG6M,IAAe,KAAK,OAAO,OAAO,CAACvB,MAAS,CAACsB,EAAW,KAAK,CAAC5M,MAASsL,EAAK,WAAWtL,EAAK,MAAM,CAAC;AACzG,EAAIqL,EAAa,WAAW,KAAKwB,EAAa,WAAW,MAEzD,KAAK,SACJ,KAAK,OAAO,IAAI,CAAC7M,MAAS;AACnB,UAAA8M,IAAQF,EAAW,KAAK,CAAC9V,MAAMA,EAAE,WAAWkJ,EAAK,QAAQ;AACxD,WAAA;AAAA,MACN,QAAQA,EAAK;AAAA,MACb,OAAOA,EAAK;AAAA,MACZ,MAAM8M,GAAO,QAAQ;AAAA,MACrB,MAAMA,GAAO,WAAW;AAAA,MACxB,WAAWA,GAAO,aAAa;AAAA,IAChC;AAAA,EACA,CAAA,KAAK,CAAC;AACT;AAEAT,KAAA,oBAAA,QAAA;AAOAC,KAAS,SAAC/J,GAAmB;AACxB,MAAA,CAACA,EAAQ,OAAQ;AAErB,QAAMwK,IAAqDxK,EAAQ,IAAI,CAACjB,OAAY;AAAA,IACnF,KAAKF,GAAM,IAAI;AAAA,IACf,UAAUE;AAAA,IACV,gBAAgB;AAAA,IAChB,OAAO,CAAC;AAAA,IACR,YAAY;AAAA,EAAA,EACX;AAEG,OAAA,QAAQ,CAAC,GAAI,KAAK,SAAS,CAAA,GAAK,GAAGyL,CAAS,GAC5C,KAAA,cAAc,IAAI5X,GAAgB;AACxC;AAEMsV,KAAW,iBAAG;AAWnB,QAAM1K,IAAO,OAVQ,MAAM,KAAK,WAAWJ,EAAyB,IACjC,KAAK,MAAMb,IAAwB;AAAA,IACrE,MAAM;AAAA,MACL,UAAU,KAAK;AAAA,MACf,WAAW,KAAK;AAAA,MAChB,gBAAgBjK,EAAK,MAAAwX,EAAA;AAAA,IACtB;AAAA,IACA,OAAO,EAAE,WAAW,CAAG,EAAA;AAAA,EAAA,CACvB,GAEgC,WAAW,MAAM,MAAM,IAAI;AAC5D,MAAI,CAACtM,EAAM;AAEX,QAAMgI,IAAYhI,EAAK,UAAU,OAAO,CAACjJ,MAAMA,MAAM,IAAI;AACzDrC,EAAAA,EAAA,MAAK0X,OAAL,KAAe,MAAApE,CAAA;AAChB;AAEM2C,KAAS,eAAC1K,GAA6B;AAC5C,QAAMgN,GAAgB,MAAM;AAAA,IAC3B,OAAO;AAAA,IACP,UAAU,GAAG,KAAK,SAAS,KAAK,gBAAgB,CAAC,IAAIhN,EAAK,IAAI;AAAA,IAC9D,SAAS,GAAG,KAAK,SAAS,KAAK,8BAA8B,CAAC,IAAIA,EAAK,IAAI;AAAA,IAC3E,cAAc,KAAK,SAAS,KAAK,gBAAgB;AAAA,EAAA,CACjD,GAEI,KAAA,QAAQ,KAAK,OAAO,OAAO,CAAClJ,MAAMA,EAAE,QAAQkJ,EAAK,MAAM,GAEvD,KAAA,cAAc,IAAI7K,GAAgB;AACxC;AAEMoX,KAAkB,eAAC,GAAgB;AAExC,QAAMU,IADY,EAAE,OACO,IAAI,CAACnY,MAASA,EAAK,MAAM;AACpDL,EAAAA,EAAA,MAAK0X,OAAL,KAAe,MAAAc,CAAA;AAChB;AASA3P,KAAe,WAAG;AACb,MAAA,KAAK,SAAiB,QAAA9G;AAC1B,MAAI,OAAK,UAAU,KAAK,OAAO,UAAU,KAAK;AACvC,WAAAxB;AAAA,eACM,KAAK,MAAM,CAAC;AAAA,eACZP,QAAK0X,GAAkBI,EAAA,CAAA;AACrC;AAEA5B,KAAY,WAAG;AACV,MAAC,KAAK,OAAO;AACV,WAAA3V;AAAA,KACJE;AAAA,MACD,KAAK;AAAA,MACL,CAAC8K,MAASA,EAAK;AAAA,MACf,CAACA,MAASvL,EAAK,MAAA0X,GAAAtB,EAAA,EAAL,KAAiB,MAAA7K,CAAA;AAAA,IAC3B,CAAA;AAAA;AAEH;AAEA4K,KAAgB,WAAG;AAClB,MAAI,OAAK,UAAU,KAAK,OAAO,UAAU,CAAC,KAAK;AAC/C,WAAI,KAAK,YAAY,KAAK,OAAO,SAAS,IAClCpU,IAEAxB;AAAA;AAAA;AAAA;AAAA,aAIG,MAAM;AACb,WAAK,WAAW,IAChB,KAAK,cAAc;AAAA,IACnB,CAAA;AAAA,cACQP,QAAK0X,GAAW1B,EAAA,CAAA;AAAA,aACjB,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA,iBAChC,KAAK,QAAQ;AAAA;AAAA,OAEvB,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA;AAAA;AAI1C;AAEAI,KAAW,SAAC7K,GAA6B;AACpC,MAAA,CAACA,EAAK,OAAe,QAAAxJ;AACnB,QAAAwV,IAAO,KAAK,WAAW,SAAY,KAAK,gBAAgB,EAAE,KAAKhM,EAAK,QAAQ;AAC3E,SAAAhL;AAAA,wBACegL,EAAK,MAAM,SAASA,EAAK,IAAI,UAAUgM,CAAI,cAAc,KAAK,QAAQ;AAAA;AAAA,cAEhFhM,EAAK,KAAK;AAAA,WACbA,EAAK,IAAI;AAAA,YACRA,EAAK,QAAQ,cAAc;AAAA,MACjCvL,EAAA,MAAK0X,OAAL,KAAsB,MAAAnM,CAAA,CAAK,IAAIvL,EAAK,MAAA0X,GAAA9M,EAAA,EAAL,WAAoBW,CAAK,CAAA;AAAA;AAAA;AAG7D;AAEAX,KAAc,SAACW,GAA6B;AACvC,SAAA,KAAK,WAAiBxJ,IACnBxB;AAAA;AAAA,wBAEe,KAAK,SAAS,KAAK,gBAAgB,CAAC,4BAA4B,MAAMP,EAAA,MAAK0X,GAALzB,EAAA,EAAA,KAAA,MAAe1K,CAAK,CAAA;AAAA;AAAA;AAAA;AAAA;AAKjH;AAEA+K,KAAgB,SAAC/K,GAA6B;AACzC,MAACA,EAAK;AACH,WAAAhL;AAAA;AAAA;AAAA;AAAA;AAKR;AA9YYwX,EAgZI,SAAS;AAAA,EACxBpX;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAkCD;AAxZAC,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAS,CAAA;AAAA,GA1BfkX,EA2BZ,WAAA,YAAA,CAAA;AAGAnX,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,OAAQ,CAAA;AAAA,GA7BdkX,EA8BZ,WAAA,mBAAA,CAAA;AASOnX,EAAA;AAAA,EADNC,EAAS,EAAE,MAAM,OAAQ,CAAA;AAAA,GAtCdkX,EAuCL,WAAA,OAAA,CAAA;AASPnX,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAQ,WAAW,cAAe,CAAA;AAAA,GA/CxCkX,EAgDZ,WAAA,cAAA,CAAA;AASOnX,EAAA;AAAA,EADNC,EAAS,EAAE,MAAM,OAAQ,CAAA;AAAA,GAxDdkX,EAyDL,WAAA,OAAA,CAAA;AASPnX,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAQ,WAAW,cAAe,CAAA;AAAA,GAjExCkX,EAkEZ,WAAA,cAAA,CAAA;AAGoBnX,EAAA;AAAA,EADnBC,EAAS,EAAE,MAAM,MAAO,CAAA;AAAA,GApEbkX,EAqEQ,WAAA,SAAA,CAAA;AAYpBnX,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,MAAO,CAAA;AAAA,GAhFbkX,EAiFZ,WAAA,yBAAA,CAAA;AAGAnX,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAQ,WAAW,GAAO,CAAA;AAAA,GAnFhCkX,EAoFZ,WAAA,aAAA,CAAA;AAGAnX,EAAA;AAAA,EADCC,EAAS,EAAE,MAAM,QAAS,CAAA;AAAA,GAtFfkX,EAuFZ,WAAA,YAAA,CAAA;AAGOnX,EAAA;AAAA,EADNC,EAAS,EAAE,MAAM,MAAO,CAAA;AAAA,GAzFbkX,EA0FL,WAAA,oBAAA,CAAA;AAGInX,EAAA;AAAA,EADVC,EAAS,EAAE,MAAM,QAAS,CAAA;AAAA,GA5FfkX,EA6FD,WAAA,qBAAA,CAAA;AAUAnX,EAAA;AAAA,EAFVC,EAAS;AAAA,GArGEkX,EAuGD,WAAA,SAAA,CAAA;AASAnX,EAAA;AAAA,EAFVC,EAAS;AAAA,GA9GEkX,EAgHD,WAAA,aAAA,CAAA;AAcAnX,EAAA;AAAA,EADVC,EAAS,EAAE,MAAM,SAAS,SAAS,GAAM,CAAA;AAAA,GA7H9BkX,EA8HD,WAAA,YAAA,CAAA;AAeHnX,EAAA;AAAA,EADPE,EAAM;AAAA,GA5IKiX,EA6IJ,WAAA,UAAA,CAAA;AAGAnX,EAAA;AAAA,EADPE,EAAM;AAAA,GA/IKiX,EAgJJ,WAAA,iBAAA,CAAA;AAhJIA,IAANnX,EAAA;AAAA,EADNG,EAAc,sBAAsB;AAAA,GACxBgX,CAAA;ACzBN,SAASU,GAAyBC,GAAkC;AA2zB1E,SAzzB6C;AAAA,IAC5C,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,gBAAgB;AAAA,IAChB,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,SAAS;AAAA,IACT,SAAS;AAAA,IACT,SAAS;AAAA,IACT,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,aAAa;AAAA,IACb,aAAa;AAAA,IACb,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,cAAc;AAAA,IACd,cAAc;AAAA,IACd,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,aAAa;AAAA,IACb,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,OAAO;AAAA,IACP,MAAM;AAAA,IACN,SAAS;AAAA,IACT,SAAS;AAAA,IACT,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,SAAS;AAAA,IACT,aAAa;AAAA,IACb,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,UAAU;AAAA,IACV,UAAU;AAAA,IACV,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,aAAa;AAAA,IACb,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,OAAO;AAAA,IACP,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,WAAW;AAAA,IACX,WAAW;AAAA,IACX,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,cAAc;AAAA,IACd,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,OAAO;AAAA,IACP,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,WAAW;AAAA,IACX,WAAW;AAAA,IACX,cAAc;AAAA,IACd,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,OAAO;AAAA,IACP,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,WAAW;AAAA,IACX,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,YAAY;AAAA,IACZ,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,YAAY;AAAA,IACZ,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,aAAa;AAAA,IACb,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,aAAa;AAAA,IACb,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,UAAU;AAAA,IACV,UAAU;AAAA,IACV,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,QAAQ;AAAA,IACR,SAAS;AAAA,IACT,QAAQ;AAAA,EACT,EAGiBA,EAAU,YAAY,CAAC,KAAK;AAC9C;;;;;;;iZCh0BAC,IAAAC,IAAAC,GAAAC,IAAAC,IAAAC,IAAAC,IAAAvQ,IAAAG,IAAAqQ,IAAAC,IAAAC,IAAAC;AAoBa,IAAAC,KAAN,cAAyC5Z,EAAc;AAAA,EA6C7D,cAAc;AACP,UAAA,GA9CDC,GAAA,MAAAkZ,CAAA,GAYClZ,GAAA,MAAAgZ,IAAA,EAAA,GA6BP,KAAQ,aAAa,IAErBhZ,GAAA,MAAAiZ,IAA+C,EAAC,GAK1C,KAAA,eAAe3Y,IAAoB,CAACC,MAAY;AAC/C,WAAA,aAAaA,GAAS,aAAkB,KAAA;AAAA,IAAA,CAC7C;AAAA,EAAA;AAAA,EAhDF,IAAI,MAAML,GAAuB;AAC3B,IAAAM,GAAA,MAAAwY,IAAO9Y,GAAO,OAAO,EAAA,GAC1BG,EAAA,MAAK6Y,GAALE,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EAED,IAAI,QAAwB;AACpB,WAAA;AAAA,MACN,KAAK3Y,GAAK,MAAAuY,EAAA;AAAA,MACV,iBAAiB,KAAK,eAAe;AAAA,IACtC;AAAA,EAAA;AAAA,EA2CQ,uBAA6B;AACrC,UAAM,qBAAqB,GAC3B3Y,EAAA,MAAK6Y,GAALQ,EAAA,EAAA,KAAA,IAAA;AAAA,EAAA;AAAA,EAsFQ,SAAS;AACjB,WAAI,CAAC,KAAK,iBAAiB,CAAC,KAAK,MAAM,MAC/BrZ,QAAK6Y,GAALhQ,EAAA,EAAA,KAAA,IAAA,IAGJ,KAAK,OAAO,OAAO,KAAK,gBACpB7I,EAAK,MAAA6Y,GAAAK,EAAA,EAAL,KAAiB,MAAA,KAAK,MAAM,GAAA,IAG7BnX;AAAA,EAAA;AA4FT;AAtOC4W,KAAA,oBAAA,QAAA;AA+BAC,KAAA,oBAAA,QAAA;AA3CMC,IAAA,oBAAA,QAAA;AA0DAC,KAAa,iBAAG;AACrB,SAAI1Y,GAAK,MAAAwY,EAAA,EAAW,SAAexY,GAAK,MAAAwY,EAAA,KAExC,MAAM,IAAIW,GAAiC,MAAMC,IAAuB,qBAAqB,MAAM,CAACC,MAAS;AAC5G,IAAAtZ,GAAA,MAAKyY,IAAaa,EAAK,IAAI,CAACA,MAASA,EAAK,QAAQ,CAAA;AAAA,EAClD,CAAA,EAAE,UAAU,GAENrZ,GAAK,MAAAwY,EAAA;AACb;AAEMG,KAAgB,iBAAkB;AAClC,OAAA,gBAAgB,MAAM/Y,EAAA,MAAK6Y,GAALG,EAAA,EAAA,KAAA,IAAA;AAC5B;AAEMA,KAAuB,iBAAG;AAC3B,MAAA,CAAC,KAAK,MAAM,IAAK;AACf,QAAAU,IAAY,MAAM1Z,EAAA,MAAK6Y,GAALC,EAAA,EAAA,KAAA,IAAA,GAClBa,IAAgBD,EAAU;AAAA,IAAK,CAACE,MACrCC,GAA4BD,EAAS,cAAc,KAAK;AAAA,EAAA,GACtD;AAEH,MAAIE,IAA0B;AAO1B,MANA,KAAK,eAAe,OACZA,IAAA,KAAK,cAAc,KAAK,OAEnCA,IAAW9Z,EAAK,MAAA6Y,GAAAI,EAAA,EAAL,KAA0B,MAAA,KAAK,MAAM,GAAA,GAG7C,CAACa,EAAiB,QAAAH;AAGtB,QAAMI,IAAaL,EAAU,KAAK,CAACE,MAC3BC,GAA4BD,EAAS,cAAcE,CAAQ,CAClE;AACG,MAAAC,UAAmBA,EAAW;AAGlC,QAAMC,IAAgBN,EAAU,KAAK,CAACE,OAChB,MAAM,QAAQA,EAAS,YAAY,IAAIA,EAAS,eAAe,CAACA,EAAS,YAAY,GACtF,KAAK,CAACK,MAAS;AAClC,UAAMC,IAAUD,EAAK,QAAQ,OAAO,EAAE;AAEtC,QADIH,EAAS,WAAWI,CAAO,KAC3BJ,EAAS,SAASI,CAAO,UAAUN,EAAS;AAAA,EACzC,CACP,CACD;AACG,SAAAI,IAAsBA,EAAc,QAGjCL;AACR;AAEAV,KAAoB,SAACtN,GAAc;AAE9B,MAAAA,EAAK,WAAW,OAAO;AAEnB,WADUA,EAAK,UAAU,GAAGA,EAAK,QAAQ,GAAG,CAAC;AAKrD,QAAM+M,IAAY/M,EAAK,MAAM,GAAG,EAAE,OAAO,YAAY;AACjD,SAAC+M,IACED,GAAyB,MAAMC,CAAS,IADxB;AAExB;AAEMhQ,KAAS,eAAC,GAA2B;AAC1C,IAAE,yBAAyB;AAGrB,QAAArI,IADS,EAAE,OACG,QAAQ,CAAC;AAEzB,MAAAA,GAAM,WAAWkJ,GAA0B,SAAU;AAEzD,OAAK,gBAAiBlJ,EAA2B,eAEjDL,EAAA,MAAK6Y,GAALQ,EAAA,EAAA,KAAA,IAAA;AAEA,QAAMc,IAAU,IAAI,gBAAgB,KAAK,cAAc,IAAI;AACtD,OAAA,QAAQ,EAAE,KAAKA,EAAQ,GAEvB,KAAA,cAAc,IAAIzZ,GAAgB;AACxC;AAcAmI,KAAe,WAAG;AACV,SAAAtI;AAAA;AAAA;AAAA;AAAA,aAII0B,GAAU,KAAK,aAAa,KAAK,GAAG,CAAC,CAAC;AAAA,cACrCjC,QAAK6Y,GAASnQ,EAAA,CAAA;AAAA;AAE3B;AAEAwQ,KAAW,SAACkB,GAAa;AACxB,SAAKA,EAAI,WAAW,OAAO,MAC1BA,IAAM,KAAK,aAAaA,IAGlB7Z;AAAA;AAAA;AAAA;AAAA;AAAA,eAKM,EAAE,MAAM6Z,GAAK,MAAM,KAAK,eAAe,KAAM,CAAA;AAAA,gBAC5C,CAACR,MAAwCA,EAAS,UAAU,KAAK,aAAa;AAAA;AAAA;AAAA;AAAA,KAIzF5Z,EAAA,MAAK6Y,OAAL,KAA0B,IAAA,CAAA;AAAA;AAE9B;AAEAM,KAAmB,WAAG;AACd,SAAA5Y;AAAA,gCACuBP,QAAK6Y,GAAaO,EAAA,CAAA,UAAU,KAAK,SAAS,KAAK,qBAAqB,CAAC;AAAA,6CACxD,KAAK,SAAS,KAAK,qBAAqB,CAAC;AAAA;AAAA;AAGrF;AAEAA,KAAa,WAAG;AAEV,OAAA,eAAe,iBAAiB,MAAM,GAE3CpZ,EAAA,MAAK6Y,GAALQ,EAAA,EAAA,KAAA,IAAA,GAEK,KAAA,QAAQ,EAAE,KAAK,OAAU,GAC9B,KAAK,gBAAgB,QAChB,KAAA,cAAc,IAAI3Y,GAAgB;AACxC;AAKA2Y,KAAe,WAAS;AACvB,EAAI,KAAK,OAAO,KAAK,WAAW,OAAO,KAClC,IAAA,gBAAgB,KAAK,MAAM,GAAG;AAEpC;AAhNYC,GAkNa,SAAS;AAAA,EACjC1P;AAAA,EACAjJ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA6BD;AA/OIC,GAAA;AAAA,EADHC,EAAS,EAAE,MAAM,QAAQ,WAAW,GAAO,CAAA;AAAA,GADhCyY,GAER,WAAA,SAAA,CAAA;AA2BJ1Y,GAAA;AAAA,EAVCC,EAAS;AAAA,IACT,MAAM;AAAA,IACN,WAAW;AAAA,IACX,UAAUhB,GAAO;AACZ,aAAA,OAAOA,KAAU,WACbA,EAAM,MAAM,GAAG,EAAE,IAAI,CAACwa,MAAQA,EAAI,MAAM,IAEzCxa;AAAA,IAAA;AAAA,EAER,CAAA;AAAA,GA5BWyZ,GA6BZ,WAAA,yBAAA,CAAA;AAGO1Y,GAAA;AAAA,EADNE,EAAM;AAAA,GA/BKwY,GAgCL,WAAA,iBAAA,CAAA;AAGC1Y,GAAA;AAAA,EADPE,EAAM;AAAA,GAlCKwY,GAmCJ,WAAA,eAAA,CAAA;AAGA1Y,GAAA;AAAA,EADPE,EAAM;AAAA,GArCKwY,GAsCJ,WAAA,iBAAA,CAAA;AAGA1Y,GAAA;AAAA,EADPE,EAAM;AAAA,GAxCKwY,GAyCJ,WAAA,cAAA,CAAA;AAzCIA,KAAN1Y,GAAA;AAAA,EADNG,EAAc,wBAAwB;AAAA,GAC1BuY,EAAA;"}