{"version":3,"file":"media-history-workspace-info-app.element-Bue9-iQl.js","sources":["../../../src/packages/media/media/audit-log/info-app/media-history-workspace-info-app.element.ts"],"sourcesContent":["import { UMB_MEDIA_WORKSPACE_CONTEXT } from '../../workspace/constants.js';\r\nimport type { UmbMediaAuditLogModel } from '../types.js';\r\nimport { UmbMediaAuditLogRepository } from '../repository/index.js';\r\nimport { getMediaHistoryTagStyleAndText, TimeOptions } from './utils.js';\r\nimport { css, html, customElement, state, nothing, repeat, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbPaginationManager } from '@umbraco-cms/backoffice/utils';\r\nimport type { UUIPaginationEvent } from '@umbraco-cms/backoffice/external/uui';\r\nimport type { UmbUserItemModel } from '@umbraco-cms/backoffice/user';\r\nimport { UmbUserItemRepository } from '@umbraco-cms/backoffice/user';\r\n\r\n@customElement('umb-media-history-workspace-info-app')\r\nexport class UmbMediaHistoryWorkspaceInfoAppElement extends UmbLitElement {\r\n\t@state()\r\n\t_currentPageNumber = 1;\r\n\r\n\t@state()\r\n\t_totalPages = 1;\r\n\r\n\t@state()\r\n\tprivate _items: Array<UmbMediaAuditLogModel> = [];\r\n\r\n\t#workspaceContext?: typeof UMB_MEDIA_WORKSPACE_CONTEXT.TYPE;\r\n\t#auditLogRepository = new UmbMediaAuditLogRepository(this);\r\n\t#pagination = new UmbPaginationManager();\r\n\t#userItemRepository = new UmbUserItemRepository(this);\r\n\r\n\t#userMap = new Map<string, UmbUserItemModel>();\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.#pagination.setPageSize(10);\r\n\t\tthis.observe(this.#pagination.currentPage, (number) => (this._currentPageNumber = number));\r\n\t\tthis.observe(this.#pagination.totalPages, (number) => (this._totalPages = number));\r\n\r\n\t\tthis.consumeContext(UMB_MEDIA_WORKSPACE_CONTEXT, (instance) => {\r\n\t\t\tthis.#workspaceContext = instance;\r\n\t\t\tthis.#requestAuditLogs();\r\n\t\t});\r\n\t}\r\n\r\n\tasync #requestAuditLogs() {\r\n\t\tconst unique = this.#workspaceContext?.getUnique();\r\n\t\tif (!unique) throw new Error('Media unique is required');\r\n\r\n\t\tconst { data } = await this.#auditLogRepository.requestAuditLog({\r\n\t\t\tunique,\r\n\t\t\tskip: this.#pagination.getSkip(),\r\n\t\t\ttake: this.#pagination.getPageSize(),\r\n\t\t});\r\n\r\n\t\tif (data) {\r\n\t\t\tthis._items = data.items;\r\n\t\t\tthis.#pagination.setTotalItems(data.total);\r\n\t\t\tthis.#requestAndCacheUserItems();\r\n\t\t}\r\n\t}\r\n\r\n\t#onPageChange(event: UUIPaginationEvent) {\r\n\t\tthis.#pagination.setCurrentPageNumber(event.target?.current);\r\n\t\tthis.#requestAuditLogs();\r\n\t}\r\n\r\n\tasync #requestAndCacheUserItems() {\r\n\t\tconst allUsers = this._items?.map((item) => item.user.unique).filter(Boolean) as string[];\r\n\t\tconst uniqueUsers = [...new Set(allUsers)];\r\n\t\tconst uncachedUsers = uniqueUsers.filter((unique) => !this.#userMap.has(unique));\r\n\r\n\t\t// If there are no uncached user items, we don't need to make a request\r\n\t\tif (uncachedUsers.length === 0) return;\r\n\r\n\t\tconst { data: items } = await this.#userItemRepository.requestItems(uncachedUsers);\r\n\r\n\t\tif (items) {\r\n\t\t\titems.forEach((item) => {\r\n\t\t\t\t// cache the user item\r\n\t\t\t\tthis.#userMap.set(item.unique, item);\r\n\t\t\t\tthis.requestUpdate('_items');\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-workspace-info-app-layout headline=\"#general_history\">\r\n\t\t\t\t<div id=\"content\">\r\n\t\t\t\t\t${when(\r\n\t\t\t\t\t\tthis._items,\r\n\t\t\t\t\t\t() => this.#renderHistory(),\r\n\t\t\t\t\t\t() => html`<div id=\"loader\"><uui-loader></uui-loader></div>`,\r\n\t\t\t\t\t)}\r\n\t\t\t\t\t${this.#renderPagination()}\r\n\t\t\t\t</div>\r\n\t\t\t</umb-workspace-info-app-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderHistory() {\r\n\t\tif (this._items && this._items.length) {\r\n\t\t\treturn html`\r\n\t\t\t\t<umb-history-list>\r\n\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\tthis._items,\r\n\t\t\t\t\t\t(item) => item.timestamp,\r\n\t\t\t\t\t\t(item) => {\r\n\t\t\t\t\t\t\tconst { text, style } = getMediaHistoryTagStyleAndText(item.logType);\r\n\t\t\t\t\t\t\tconst user = this.#userMap.get(item.user.unique);\r\n\r\n\t\t\t\t\t\t\treturn html`<umb-history-item\r\n\t\t\t\t\t\t\t\t.name=${user?.name ?? 'Unknown'}\r\n\t\t\t\t\t\t\t\t.detail=${this.localize.date(item.timestamp, TimeOptions)}>\r\n\t\t\t\t\t\t\t\t<umb-user-avatar\r\n\t\t\t\t\t\t\t\t\tslot=\"avatar\"\r\n\t\t\t\t\t\t\t\t\t.name=${user?.name}\r\n\t\t\t\t\t\t\t\t\t.kind=${user?.kind}\r\n\t\t\t\t\t\t\t\t\t.imgUrls=${user?.avatarUrls ?? []}></umb-user-avatar>\r\n\r\n\t\t\t\t\t\t\t\t<span class=\"log-type\">\r\n\t\t\t\t\t\t\t\t\t<uui-tag look=${style.look} color=${style.color}>\r\n\t\t\t\t\t\t\t\t\t\t${this.localize.term(text.label, item.parameters)}\r\n\t\t\t\t\t\t\t\t\t</uui-tag>\r\n\t\t\t\t\t\t\t\t\t${this.localize.term(text.desc, item.parameters)}\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</umb-history-item>`;\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t)}\r\n\t\t\t\t</umb-history-list>\r\n\t\t\t`;\r\n\t\t} else {\r\n\t\t\treturn html`${this.localize.term('content_noItemsToShow')}`;\r\n\t\t}\r\n\t}\r\n\r\n\t#renderPagination() {\r\n\t\treturn html`\r\n\t\t\t${this._totalPages > 1\r\n\t\t\t\t? html`\r\n\t\t\t\t\t\t<uui-pagination\r\n\t\t\t\t\t\t\tclass=\"pagination\"\r\n\t\t\t\t\t\t\t.current=${this._currentPageNumber}\r\n\t\t\t\t\t\t\t.total=${this._totalPages}\r\n\t\t\t\t\t\t\tfirstlabel=${this.localize.term('general_first')}\r\n                            previouslabel=${this.localize.term('general_previous')}\r\n                            nextlabel=${this.localize.term('general_next')}\r\n                            lastlabel=${this.localize.term('general_last')}\r\n\t\t\t\t\t\t\t@change=${this.#onPageChange}></uui-pagination>\r\n\t\t\t\t\t`\r\n\t\t\t\t: nothing}\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#content {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tpadding: var(--uui-size-space-4) var(--uui-size-space-5);\r\n\t\t\t}\r\n\r\n\t\t\t#loader {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t}\r\n\r\n\t\t\t.log-type {\r\n\t\t\t\tdisplay: grid;\r\n\t\t\t\tgrid-template-columns: var(--uui-size-40) auto;\r\n\t\t\t\tgap: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.log-type uui-tag {\r\n\t\t\t\theight: fit-content;\r\n\t\t\t\tmargin-top: auto;\r\n\t\t\t\tmargin-bottom: auto;\r\n\t\t\t}\r\n\r\n\t\t\tuui-pagination {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\tmargin-top: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbMediaHistoryWorkspaceInfoAppElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-media-workspace-view-info-history': UmbMediaHistoryWorkspaceInfoAppElement;\r\n\t}\r\n}\r\n"],"names":["_workspaceContext","_auditLogRepository","_pagination","_userItemRepository","_userMap","_UmbMediaHistoryWorkspaceInfoAppElement_instances","requestAuditLogs_fn","onPageChange_fn","requestAndCacheUserItems_fn","renderHistory_fn","renderPagination_fn","UmbMediaHistoryWorkspaceInfoAppElement","UmbLitElement","__privateAdd","UmbMediaAuditLogRepository","UmbPaginationManager","UmbUserItemRepository","__privateGet","number","UMB_MEDIA_WORKSPACE_CONTEXT","instance","__privateSet","__privateMethod","html","when","unique","data","event","allUsers","item","uncachedUsers","items","repeat","text","style","getMediaHistoryTagStyleAndText","user","TimeOptions","nothing","UmbTextStyles","css","__decorateClass","state","customElement","UmbMediaHistoryWorkspaceInfoAppElement$1"],"mappings":"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"}