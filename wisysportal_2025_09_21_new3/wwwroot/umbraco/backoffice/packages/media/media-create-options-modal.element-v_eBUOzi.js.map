{"version":3,"file":"media-create-options-modal.element-v_eBUOzi.js","sources":["../../../src/packages/media/media/entity-actions/create/media-create-options-modal.element.ts"],"sourcesContent":["import { UmbMediaItemRepository } from '../../repository/index.js';\r\nimport type {\r\n\tUmbMediaCreateOptionsModalData,\r\n\tUmbMediaCreateOptionsModalValue,\r\n} from './media-create-options-modal.token.js';\r\nimport { html, nothing, customElement, state, repeat, css, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbMediaTypeStructureRepository, type UmbAllowedMediaTypeModel } from '@umbraco-cms/backoffice/media-type';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\n\r\n@customElement('umb-media-create-options-modal')\r\nexport class UmbMediaCreateOptionsModalElement extends UmbModalBaseElement<\r\n\tUmbMediaCreateOptionsModalData,\r\n\tUmbMediaCreateOptionsModalValue\r\n> {\r\n\t#mediaTypeStructureRepository = new UmbMediaTypeStructureRepository(this);\r\n\t#mediaItemRepository = new UmbMediaItemRepository(this);\r\n\r\n\t@state()\r\n\tprivate _allowedMediaTypes: UmbAllowedMediaTypeModel[] = [];\r\n\r\n\t@state()\r\n\tprivate _headline: string = this.localize.term('general_create');\r\n\r\n\toverride async firstUpdated() {\r\n\t\tconst mediaUnique = this.data?.parent.unique;\r\n\t\tconst mediaTypeUnique = this.data?.mediaType?.unique || null;\r\n\r\n\t\tthis.#retrieveAllowedMediaTypesOf(mediaTypeUnique, mediaUnique || null);\r\n\r\n\t\tif (mediaUnique) {\r\n\t\t\tthis.#retrieveHeadline(mediaUnique);\r\n\t\t}\r\n\t}\r\n\r\n\tasync #retrieveAllowedMediaTypesOf(unique: string | null, parentContentUnique: string | null) {\r\n\t\tconst { data } = await this.#mediaTypeStructureRepository.requestAllowedChildrenOf(unique, parentContentUnique);\r\n\r\n\t\tif (data) {\r\n\t\t\t// TODO: implement pagination, or get 1000?\r\n\t\t\tthis._allowedMediaTypes = data.items;\r\n\t\t}\r\n\t}\r\n\r\n\tasync #retrieveHeadline(unique: string) {\r\n\t\tif (!unique) return;\r\n\t\tconst { data } = await this.#mediaItemRepository.requestItems([unique]);\r\n\t\tif (data) {\r\n\t\t\t// TODO: we need to get the correct variant context here\r\n\t\t\tthis._headline = this.localize.term('create_createUnder') + ' ' + data[0].variants?.[0].name;\r\n\t\t}\r\n\t}\r\n\r\n\t// close the modal when navigating to media\r\n\t#onNavigate(mediaType: UmbAllowedMediaTypeModel) {\r\n\t\t// TODO: Use a URL builder instead of hardcoding the URL. [NL]\r\n\t\tconst url = `section/media/workspace/media/create/parent/${this.data?.parent.entityType}/${\r\n\t\t\tthis.data?.parent.unique ?? 'null'\r\n\t\t}/${mediaType.unique}`;\r\n\t\thistory.pushState({}, '', url);\r\n\t\tthis._submitModal();\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=${this._headline ?? ''}>\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t${when(\r\n\t\t\t\t\t\tthis._allowedMediaTypes.length === 0,\r\n\t\t\t\t\t\t() => this.#renderNotAllowed(),\r\n\t\t\t\t\t\t() => this.#renderAllowedMediaTypes(),\r\n\t\t\t\t\t)}\r\n\t\t\t\t</uui-box>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\tid=\"cancel\"\r\n\t\t\t\t\tlabel=${this.localize.term('general_cancel')}\r\n\t\t\t\t\t@click=\"${this._rejectModal}\"></uui-button>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderNotAllowed() {\r\n\t\treturn html`\r\n\t\t\t<umb-localize key=\"create_noMediaTypes\">\r\n\t\t\t\tThere are no allowed Media Types available for creating media here. You must enable these in\r\n\t\t\t\t<strong>Media Types</strong> within the <strong>Settings</strong> section, by editing the\r\n\t\t\t\t<strong>Allowed child node types</strong> under <strong>Permissions</strong>. </umb-localize\r\n\t\t\t><br />\r\n\t\t\t<uui-button\r\n\t\t\t\tid=\"edit-permissions\"\r\n\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t@click=${() => this._rejectModal()}\r\n\t\t\t\thref=${`/section/settings/workspace/media-type/edit/${this.data?.mediaType?.unique}/view/structure`}\r\n\t\t\t\tlabel=${this.localize.term('create_noMediaTypesEditPermissions')}></uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderAllowedMediaTypes() {\r\n\t\treturn repeat(\r\n\t\t\tthis._allowedMediaTypes,\r\n\t\t\t(mediaType) => mediaType.unique,\r\n\t\t\t(mediaType) => html`\r\n\t\t\t\t<uui-ref-node-document-type\r\n\t\t\t\t\t.name=${this.localize.string(mediaType.name)}\r\n\t\t\t\t\t.alias=${this.localize.string(mediaType.description ?? '')}\r\n\t\t\t\t\tselect-only\r\n\t\t\t\t\tselectable\r\n\t\t\t\t\t@selected=${() => this.#onNavigate(mediaType)}>\r\n\t\t\t\t\t${mediaType.icon ? html`<umb-icon slot=\"icon\" name=${mediaType.icon}></umb-icon>` : nothing}\r\n\t\t\t\t</uui-ref-node-document-type>\r\n\t\t\t`,\r\n\t\t);\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#edit-permissions {\r\n\t\t\t\tmargin-top: var(--uui-size-6);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbMediaCreateOptionsModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-media-create-options-modal': UmbMediaCreateOptionsModalElement;\r\n\t}\r\n}\r\n"],"names":["_mediaTypeStructureRepository","_mediaItemRepository","_UmbMediaCreateOptionsModalElement_instances","retrieveAllowedMediaTypesOf_fn","retrieveHeadline_fn","onNavigate_fn","renderNotAllowed_fn","renderAllowedMediaTypes_fn","UmbMediaCreateOptionsModalElement","UmbModalBaseElement","__privateAdd","UmbMediaTypeStructureRepository","UmbMediaItemRepository","mediaUnique","mediaTypeUnique","__privateMethod","html","when","unique","parentContentUnique","data","__privateGet","mediaType","url","repeat","nothing","UmbTextStyles","css","__decorateClass","state","customElement","UmbMediaCreateOptionsModalElement$1"],"mappings":";;;;;;;;;;;;;;;;;+TAAAA,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC;AAWa,IAAAC,IAAN,cAAgDC,EAGrD;AAAA,EAHK,cAAA;AAAA,UAAA,GAAA,SAAA,GAAAC,EAAA,MAAAR,CAAA,GAI0BQ,EAAA,MAAAV,GAAA,IAAIW,EAAgC,IAAI,CAAA,GACjDD,EAAA,MAAAT,GAAA,IAAIW,EAAuB,IAAI,CAAA,GAGtD,KAAQ,qBAAiD,CAAC,GAG1D,KAAQ,YAAoB,KAAK,SAAS,KAAK,gBAAgB;AAAA,EAAA;AAAA,EAE/D,MAAe,eAAe;AACvB,UAAAC,IAAc,KAAK,MAAM,OAAO,QAChCC,IAAkB,KAAK,MAAM,WAAW,UAAU;AAEnD,IAAAC,EAAA,MAAAb,GAAAC,CAAA,EAAL,KAAkC,MAAAW,GAAiBD,KAAe,IAAA,GAE9DA,KACHE,EAAA,MAAKb,MAAL,KAAuB,MAAAW,CAAA;AAAA,EACxB;AAAA,EA+BQ,SAAS;AACV,WAAAG;AAAA,+BACsB,KAAK,aAAa,EAAE;AAAA;AAAA,OAE5CC;AAAA,MACD,KAAK,mBAAmB,WAAW;AAAA,MACnC,MAAMF,QAAKb,GAALI,CAAA,EAAA,KAAA,IAAA;AAAA,MACN,MAAMS,QAAKb,GAALK,CAAA,EAAA,KAAA,IAAA;AAAA,IACN,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aAKO,KAAK,SAAS,KAAK,gBAAgB,CAAC;AAAA,eAClC,KAAK,YAAY;AAAA;AAAA;AAAA,EAAA;AA8ChC;AA5GCP,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AALMC,IAAA,oBAAA,QAAA;AAwBAC,IAA4B,eAACe,GAAuBC,GAAoC;AACvF,QAAA,EAAE,MAAAC,MAAS,MAAMC,QAAKrB,CAA8B,EAAA,yBAAyBkB,GAAQC,CAAmB;AAE9G,EAAIC,MAEH,KAAK,qBAAqBA,EAAK;AAEjC;AAEMhB,IAAiB,eAACc,GAAgB;AACvC,MAAI,CAACA,EAAQ;AACP,QAAA,EAAE,MAAAE,MAAS,MAAMC,QAAKpB,CAAqB,EAAA,aAAa,CAACiB,CAAM,CAAC;AACtE,EAAIE,MAEH,KAAK,YAAY,KAAK,SAAS,KAAK,oBAAoB,IAAI,MAAMA,EAAK,CAAC,EAAE,WAAW,CAAC,EAAE;AAE1F;AAGAf,IAAW,SAACiB,GAAqC;AAEhD,QAAMC,IAAM,+CAA+C,KAAK,MAAM,OAAO,UAAU,IACtF,KAAK,MAAM,OAAO,UAAU,MAC7B,IAAID,EAAU,MAAM;AACpB,UAAQ,UAAU,IAAI,IAAIC,CAAG,GAC7B,KAAK,aAAa;AACnB;AAqBAjB,IAAiB,WAAG;AACZ,SAAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,aASI,MAAM,KAAK,aAAc,CAAA;AAAA,WAC3B,+CAA+C,KAAK,MAAM,WAAW,MAAM,iBAAiB;AAAA,YAC3F,KAAK,SAAS,KAAK,oCAAoC,CAAC;AAAA;AAEnE;AAEAT,IAAwB,WAAG;AACnB,SAAAiB;AAAA,IACN,KAAK;AAAA,IACL,CAACF,MAAcA,EAAU;AAAA,IACzB,CAACA,MAAcN;AAAA;AAAA,aAEL,KAAK,SAAS,OAAOM,EAAU,IAAI,CAAC;AAAA,cACnC,KAAK,SAAS,OAAOA,EAAU,eAAe,EAAE,CAAC;AAAA;AAAA;AAAA,iBAG9C,MAAMP,EAAA,MAAKb,GAALG,CAAA,EAAA,KAAA,MAAiBiB,CAAU,CAAA;AAAA,OAC3CA,EAAU,OAAON,+BAAkCM,EAAU,IAAI,iBAAiBG,CAAO;AAAA;AAAA;AAAA,EAG9F;AACD;AAtGYjB,EAwGI,SAAS;AAAA,EACxBkB;AAAA,EACAC;AAAA;AAAA;AAAA;AAAA;AAKD;AAvGQC,EAAA;AAAA,EADPC,EAAM;AAAA,GAPKrB,EAQJ,WAAA,sBAAA,CAAA;AAGAoB,EAAA;AAAA,EADPC,EAAM;AAAA,GAVKrB,EAWJ,WAAA,aAAA,CAAA;AAXIA,IAANoB,EAAA;AAAA,EADNE,EAAc,gCAAgC;AAAA,GAClCtB,CAAA;AAkHb,MAAAuB,IAAevB;"}