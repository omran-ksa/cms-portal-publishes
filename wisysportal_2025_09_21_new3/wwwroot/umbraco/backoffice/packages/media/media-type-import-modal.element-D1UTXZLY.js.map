{"version":3,"file":"media-type-import-modal.element-D1UTXZLY.js","sources":["../../../src/packages/media/media-types/entity-actions/import/modal/media-type-import-modal.element.ts"],"sourcesContent":["import { UmbMediaTypeImportRepository } from '../repository/media-type-import.repository.js';\r\nimport type { UmbMediaTypeImportModalData, UmbMediaTypeImportModalValue } from './media-type-import-modal.token.js';\r\nimport { css, html, customElement, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbDropzoneMediaElement } from '@umbraco-cms/backoffice/media';\r\nimport type { UmbDropzoneChangeEvent } from '@umbraco-cms/backoffice/dropzone';\r\n\r\ninterface UmbMediaTypePreview {\r\n\tunique: string;\r\n\tname: string;\r\n\talias: string;\r\n\ticon: string;\r\n}\r\n\r\n@customElement('umb-media-type-import-modal')\r\nexport class UmbMediaTypeImportModalLayout extends UmbModalBaseElement<\r\n\tUmbMediaTypeImportModalData,\r\n\tUmbMediaTypeImportModalValue\r\n> {\r\n\t#MediaTypeImportRepository = new UmbMediaTypeImportRepository(this);\r\n\t#temporaryUnique?: string;\r\n\t#fileReader;\r\n\r\n\t@state()\r\n\tprivate _fileContent: Array<UmbMediaTypePreview> = [];\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.#fileReader = new FileReader();\r\n\t\tthis.#fileReader.onload = (e) => {\r\n\t\t\tif (typeof e.target?.result === 'string') {\r\n\t\t\t\tconst fileContent = e.target.result;\r\n\t\t\t\tthis.#mediaTypePreviewBuilder(fileContent);\r\n\t\t\t} else {\r\n\t\t\t\tthis.#requestReset();\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\t#onUploadComplete(evt: UmbDropzoneChangeEvent) {\r\n\t\tevt.preventDefault();\r\n\t\tconst target = evt.target as UmbDropzoneMediaElement;\r\n\t\tconst data = target.value;\r\n\t\tif (!data?.length) return;\r\n\r\n\t\tconst file = data[0];\r\n\r\n\t\tif (file.temporaryFile) {\r\n\t\t\tthis.#temporaryUnique = file.temporaryFile.temporaryUnique;\r\n\t\t\tthis.#fileReader.readAsText(file.temporaryFile.file);\r\n\t\t}\r\n\t}\r\n\r\n\tasync #onFileImport() {\r\n\t\tif (!this.#temporaryUnique) return;\r\n\t\tconst { error } = await this.#MediaTypeImportRepository.requestImport(this.#temporaryUnique);\r\n\t\tif (error) return;\r\n\t\tthis._submitModal();\r\n\t}\r\n\r\n\t#mediaTypePreviewBuilder(htmlString: string) {\r\n\t\tconst parser = new DOMParser();\r\n\t\tconst doc = parser.parseFromString(htmlString, 'text/xml');\r\n\t\tconst childNodes = doc.childNodes;\r\n\r\n\t\tconst elements: Array<Element> = [];\r\n\r\n\t\tchildNodes.forEach((node) => {\r\n\t\t\tif (node.nodeType === Node.ELEMENT_NODE && node.nodeName === 'MediaType') {\r\n\t\t\t\telements.push(node as Element);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tthis._fileContent = this.#mediaTypePreviewItemBuilder(elements);\r\n\t}\r\n\r\n\t#mediaTypePreviewItemBuilder(elements: Array<Element>) {\r\n\t\tconst mediaTypes: Array<UmbMediaTypePreview> = [];\r\n\t\telements.forEach((MediaType) => {\r\n\t\t\tconst info = MediaType.getElementsByTagName('Info')[0];\r\n\t\t\tconst unique = info.getElementsByTagName('Key')[0].textContent ?? '';\r\n\t\t\tconst name = info.getElementsByTagName('Name')[0].textContent ?? '';\r\n\t\t\tconst alias = info.getElementsByTagName('Alias')[0].textContent ?? '';\r\n\t\t\tconst icon = info.getElementsByTagName('Icon')[0].textContent ?? '';\r\n\r\n\t\t\tmediaTypes.push({ unique, name, alias, icon });\r\n\t\t});\r\n\t\treturn mediaTypes;\r\n\t}\r\n\r\n\t#requestReset() {\r\n\t\tthis._fileContent = [];\r\n\t\tthis.#temporaryUnique = undefined;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html` <umb-body-layout headline=${this.localize.term('general_import')}>\r\n\t\t\t<uui-box> ${this.#renderUploadZone()} </uui-box>\r\n\t\t\t<uui-button\r\n\t\t\t\tslot=\"actions\"\r\n\t\t\t\ttype=\"button\"\r\n\t\t\t\tlabel=${this.localize.term('general_cancel')}\r\n\t\t\t\t@click=${this._rejectModal}></uui-button>\r\n\t\t\t<uui-button\r\n\t\t\t\tslot=\"actions\"\r\n\t\t\t\ttype=\"button\"\r\n\t\t\t\tlook=\"primary\"\r\n\t\t\t\t?disabled=${!this.#temporaryUnique}\r\n\t\t\t\tlabel=${this.localize.term('actions_import')}\r\n\t\t\t\t@click=${this.#onFileImport}></uui-button>\r\n\t\t</umb-body-layout>`;\r\n\t}\r\n\r\n\t#renderUploadZone() {\r\n\t\treturn html`\r\n\t\t\t${when(\r\n\t\t\t\tthis._fileContent.length,\r\n\t\t\t\t() =>\r\n\t\t\t\t\thtml`<uui-ref-node name=${this._fileContent[0].name} alias=${this._fileContent[0].alias} readonly standalone>\r\n\t\t\t\t\t\t<umb-icon slot=\"icon\" name=${this._fileContent[0].icon}></umb-icon>\r\n\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\t\t\t@click=${this.#requestReset}\r\n\t\t\t\t\t\t\tlabel=${this.localize.term('general_remove')}></uui-button>\r\n\t\t\t\t\t</uui-ref-node>`,\r\n\t\t\t\t() =>\r\n\t\t\t\t\thtml`<div id=\"wrapper\">\r\n\t\t\t\t\t\t<umb-input-dropzone id=\"dropzone\" accept=\".udt\" @change=${this.#onUploadComplete}\r\n\t\t\t\t\t\t\t><umb-localize slot=\"text\" key=\"media_dragAndDropYourFilesIntoTheArea\"\r\n\t\t\t\t\t\t\t\t>Drag and drop your file(s) into the area\r\n\t\t\t\t\t\t\t</umb-localize></umb-input-dropzone\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t</div>`,\r\n\t\t\t)}\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#wrapper {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\ttext-align: center;\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\tborder: 2px dashed var(--uui-color-divider-standalone);\r\n\t\t\t\tbackground-color: var(--uui-color-surface-alt);\r\n\t\t\t\tpadding: var(--uui-size-space-6);\r\n\t\t\t}\r\n\r\n\t\t\t#dropzone {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#import {\r\n\t\t\t\tmargin-top: var(--uui-size-space-6);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbMediaTypeImportModalLayout;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-media-type-import-modal': UmbMediaTypeImportModalLayout;\r\n\t}\r\n}\r\n"],"names":["_MediaTypeImportRepository","_temporaryUnique","_fileReader","_UmbMediaTypeImportModalLayout_instances","onUploadComplete_fn","onFileImport_fn","mediaTypePreviewBuilder_fn","mediaTypePreviewItemBuilder_fn","requestReset_fn","renderUploadZone_fn","UmbMediaTypeImportModalLayout","UmbModalBaseElement","__privateAdd","UmbMediaTypeImportRepository","__privateSet","__privateGet","fileContent","__privateMethod","html","evt","data","file","error","htmlString","childNodes","elements","node","mediaTypes","MediaType","info","unique","name","alias","icon","when","UmbTextStyles","css","__decorateClass","state","customElement","UmbMediaTypeImportModalLayout$1"],"mappings":"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"}