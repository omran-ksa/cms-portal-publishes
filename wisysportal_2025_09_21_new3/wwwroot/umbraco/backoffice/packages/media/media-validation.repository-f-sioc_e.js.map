{"version":3,"file":"media-validation.repository-f-sioc_e.js","sources":["../../../src/packages/media/media/repository/validation/media-validation.server.data-source.ts","../../../src/packages/media/media/repository/validation/media-validation.repository.ts"],"sourcesContent":["import type { UmbMediaDetailModel } from '../../types.js';\r\nimport {\r\n\ttype CreateMediaRequestModel,\r\n\tMediaService,\r\n\ttype UpdateMediaRequestModel,\r\n} from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport type { UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\nimport type { UmbDataSourceResponse } from '@umbraco-cms/backoffice/repository';\r\n\r\n/**\r\n * A server data source for Media Validation\r\n */\r\nexport class UmbMediaValidationServerDataSource {\r\n\t#host: UmbControllerHost;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tthis.#host = host;\r\n\t}\r\n\r\n\t/**\r\n\t * Validate a new Media on the server\r\n\t * @param {UmbMediaDetailModel} model - Media Model\r\n\t * @param {UmbEntityUnique} parentUnique - Parent Unique\r\n\t * @returns {*}\r\n\t */\r\n\tasync validateCreate(\r\n\t\tmodel: UmbMediaDetailModel,\r\n\t\tparentUnique: UmbEntityUnique = null,\r\n\t): Promise<UmbDataSourceResponse<string>> {\r\n\t\tif (!model) throw new Error('Media is missing');\r\n\t\tif (!model.unique) throw new Error('Media unique is missing');\r\n\t\tif (parentUnique === undefined) throw new Error('Parent unique is missing');\r\n\r\n\t\t// TODO: make data mapper to prevent errors\r\n\t\tconst body: CreateMediaRequestModel = {\r\n\t\t\tid: model.unique,\r\n\t\t\tparent: parentUnique ? { id: parentUnique } : null,\r\n\t\t\tmediaType: { id: model.mediaType.unique },\r\n\t\t\tvalues: model.values,\r\n\t\t\tvariants: model.variants,\r\n\t\t};\r\n\r\n\t\t// Maybe use: tryExecuteAndNotify\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tMediaService.postMediaValidate({\r\n\t\t\t\tbody,\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\tif (data && typeof data === 'string') {\r\n\t\t\treturn { data };\r\n\t\t}\r\n\r\n\t\treturn { error };\r\n\t}\r\n\r\n\t/**\r\n\t * Validate a existing Media\r\n\t * @param {UmbMediaDetailModel} model - Media Model\r\n\t * @param {Array<UmbVariantId>} variantIds - Variant Ids\r\n\t * @returns {Promise<*>} - The response from the server\r\n\t */\r\n\tasync validateUpdate(\r\n\t\tmodel: UmbMediaDetailModel,\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tvariantIds: Array<UmbVariantId>,\r\n\t): Promise<UmbDataSourceResponse<string>> {\r\n\t\tif (!model.unique) throw new Error('Unique is missing');\r\n\r\n\t\t//const cultures = variantIds.map((id) => id.culture).filter((culture) => culture !== null) as Array<string>;\r\n\r\n\t\t// TODO: make data mapper to prevent errors\r\n\t\tconst body: UpdateMediaRequestModel = {\r\n\t\t\tvalues: model.values,\r\n\t\t\tvariants: model.variants,\r\n\t\t};\r\n\r\n\t\t// Maybe use: tryExecuteAndNotify\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tMediaService.putMediaByIdValidate({\r\n\t\t\t\tpath: { id: model.unique },\r\n\t\t\t\tbody,\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\tif (data && typeof data === 'string') {\r\n\t\t\treturn { data };\r\n\t\t}\r\n\r\n\t\treturn { error };\r\n\t}\r\n}\r\n","import type { UmbMediaDetailModel } from '../../types.js';\r\nimport { UmbMediaValidationServerDataSource } from './media-validation.server.data-source.js';\r\nimport type { UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbRepositoryBase } from '@umbraco-cms/backoffice/repository';\r\nimport type { UmbContentValidationRepository } from '@umbraco-cms/backoffice/content';\r\n\r\ntype DetailModelType = UmbMediaDetailModel;\r\n\r\nexport class UmbMediaValidationRepository\r\n\textends UmbRepositoryBase\r\n\timplements UmbContentValidationRepository<DetailModelType>\r\n{\r\n\t#validationDataSource: UmbMediaValidationServerDataSource;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\r\n\t\tthis.#validationDataSource = new UmbMediaValidationServerDataSource(this);\r\n\t}\r\n\r\n\t/**\r\n\t * Returns a promise with an observable of the detail for the given unique\r\n\t * @param {DetailModelType} model - The model to validate\r\n\t * @param {string | null} [parentUnique] - The parent unique\r\n\t * @returns {*}\r\n\t */\r\n\tasync validateCreate(model: DetailModelType, parentUnique: string | null) {\r\n\t\tif (!model) throw new Error('Data is missing');\r\n\r\n\t\treturn this.#validationDataSource.validateCreate(model, parentUnique);\r\n\t}\r\n\r\n\t/**\r\n\t * Saves the given data\r\n\t * @param {DetailModelType} model - The model to save\r\n\t * @param {Array<UmbVariantId>} variantIds - The variant ids to save\r\n\t * @returns {*}\r\n\t */\r\n\tasync validateSave(model: DetailModelType, variantIds: Array<UmbVariantId>) {\r\n\t\tif (!model) throw new Error('Data is missing');\r\n\t\tif (!model.unique) throw new Error('Unique is missing');\r\n\r\n\t\treturn this.#validationDataSource.validateUpdate(model, variantIds);\r\n\t}\r\n}\r\n\r\nexport { UmbMediaValidationRepository as api };\r\n"],"names":["UmbMediaValidationServerDataSource","#host","host","model","parentUnique","body","data","error","tryExecute","MediaService","variantIds","UmbMediaValidationRepository","UmbRepositoryBase","#validationDataSource"],"mappings":";;;AAeO,MAAMA,EAAmC;AAAA,EAC/CC;AAAA,EAEA,YAAYC,GAAyB;AACpC,SAAKD,KAAQC;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASd,MAAM,eACLC,GACAC,IAAgC,MACS;AACzC,QAAI,CAACD,EAAa,OAAA,IAAI,MAAM,kBAAkB;AAC9C,QAAI,CAACA,EAAM,OAAc,OAAA,IAAI,MAAM,yBAAyB;AAC5D,QAAIC,MAAiB,OAAiB,OAAA,IAAI,MAAM,0BAA0B;AAG1E,UAAMC,IAAgC;AAAA,MACrC,IAAIF,EAAM;AAAA,MACV,QAAQC,IAAe,EAAE,IAAIA,EAAiB,IAAA;AAAA,MAC9C,WAAW,EAAE,IAAID,EAAM,UAAU,OAAO;AAAA,MACxC,QAAQA,EAAM;AAAA,MACd,UAAUA,EAAM;AAAA,IACjB,GAGM,EAAE,MAAAG,GAAM,OAAAC,EAAM,IAAI,MAAMC;AAAA,MAC7B,KAAKP;AAAA,MACLQ,EAAa,kBAAkB;AAAA,QAC9B,MAAAJ;AAAA,MACA,CAAA;AAAA,IACF;AAEI,WAAAC,KAAQ,OAAOA,KAAS,WACpB,EAAE,MAAAA,EAAK,IAGR,EAAE,OAAAC,EAAM;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAShB,MAAM,eACLJ,GAEAO,GACyC;AACzC,QAAI,CAACP,EAAM,OAAc,OAAA,IAAI,MAAM,mBAAmB;AAKtD,UAAME,IAAgC;AAAA,MACrC,QAAQF,EAAM;AAAA,MACd,UAAUA,EAAM;AAAA,IACjB,GAGM,EAAE,MAAAG,GAAM,OAAAC,EAAM,IAAI,MAAMC;AAAA,MAC7B,KAAKP;AAAA,MACLQ,EAAa,qBAAqB;AAAA,QACjC,MAAM,EAAE,IAAIN,EAAM,OAAO;AAAA,QACzB,MAAAE;AAAA,MACA,CAAA;AAAA,IACF;AAEI,WAAAC,KAAQ,OAAOA,KAAS,WACpB,EAAE,MAAAA,EAAK,IAGR,EAAE,OAAAC,EAAM;AAAA,EAAA;AAEjB;ACvFO,MAAMI,UACJC,EAET;AAAA,EACCC;AAAA,EAEA,YAAYX,GAAyB;AACpC,UAAMA,CAAI,GAEL,KAAAW,KAAwB,IAAIb,EAAmC,IAAI;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASzE,MAAM,eAAeG,GAAwBC,GAA6B;AACzE,QAAI,CAACD,EAAa,OAAA,IAAI,MAAM,iBAAiB;AAE7C,WAAO,KAAKU,GAAsB,eAAeV,GAAOC,CAAY;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASrE,MAAM,aAAaD,GAAwBO,GAAiC;AAC3E,QAAI,CAACP,EAAa,OAAA,IAAI,MAAM,iBAAiB;AAC7C,QAAI,CAACA,EAAM,OAAc,OAAA,IAAI,MAAM,mBAAmB;AAEtD,WAAO,KAAKU,GAAsB,eAAeV,GAAOO,CAAU;AAAA,EAAA;AAEpE;"}