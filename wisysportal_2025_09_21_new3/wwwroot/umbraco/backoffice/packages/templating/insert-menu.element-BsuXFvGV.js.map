{"version":3,"file":"insert-menu.element-BsuXFvGV.js","sources":["../../../src/packages/templating/modals/templating-item-picker/templating-item-picker-modal.token.ts","../../../src/packages/templating/local-components/insert-menu/insert-menu.element.ts"],"sourcesContent":["import type { CodeSnippetType } from '../../types.js';\r\nimport { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport interface UmbTemplatingItemPickerModalData {\r\n\thidePartialViews?: boolean;\r\n}\r\n\r\nexport type UmbTemplatingItemPickerModalValue = {\r\n\tvalue: string;\r\n\ttype: CodeSnippetType;\r\n};\r\n\r\nexport const UMB_TEMPLATING_ITEM_PICKER_MODAL = new UmbModalToken<\r\n\tUmbTemplatingItemPickerModalData,\r\n\tUmbTemplatingItemPickerModalValue\r\n>('Umb.Modal.TemplatingItemPicker', {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'small',\r\n\t},\r\n});\r\n","import { getInsertDictionarySnippet, getInsertPartialSnippet } from '../../utils/index.js';\r\nimport {\r\n\tUMB_TEMPLATING_ITEM_PICKER_MODAL,\r\n\ttype UmbTemplatingItemPickerModalValue,\r\n} from '../../modals/templating-item-picker/templating-item-picker-modal.token.js';\r\nimport { CodeSnippetType } from '../../types.js';\r\nimport { UMB_TEMPLATING_PAGE_FIELD_BUILDER_MODAL } from '../../modals/templating-page-field-builder/templating-page-field-builder-modal.token.js';\r\nimport { UmbDictionaryDetailRepository, UMB_DICTIONARY_PICKER_MODAL } from '@umbraco-cms/backoffice/dictionary';\r\nimport { customElement, property, css, html } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { UmbModalManagerContext } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UMB_PARTIAL_VIEW_PICKER_MODAL } from '@umbraco-cms/backoffice/partial-view';\r\n\r\n@customElement('umb-templating-insert-menu')\r\nexport class UmbTemplatingInsertMenuElement extends UmbLitElement {\r\n\t@property()\r\n\tvalue = '';\r\n\r\n\t@property({ type: Boolean })\r\n\thidePartialViews = false;\r\n\r\n\t#modalContext?: UmbModalManagerContext;\r\n\r\n\t#dictionaryDetailRepository = new UmbDictionaryDetailRepository(this);\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (instance) => {\r\n\t\t\tthis.#modalContext = instance;\r\n\t\t});\r\n\t}\r\n\r\n\tasync determineInsertValue(modalValue: UmbTemplatingItemPickerModalValue) {\r\n\t\tconst { type, value } = modalValue;\r\n\r\n\t\tswitch (type) {\r\n\t\t\tcase CodeSnippetType.partialView: {\r\n\t\t\t\tconst regex = /^%2F|%25dot%25cshtml$/g;\r\n\t\t\t\tconst prettyPath = value.replace(regex, '').replace(/%2F/g, '/');\r\n\t\t\t\tthis.value = getInsertPartialSnippet(prettyPath);\r\n\t\t\t\tthis.#dispatchInsertEvent();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase CodeSnippetType.dictionaryItem: {\r\n\t\t\t\tawait this.#getDictionaryItemSnippet(value);\r\n\t\t\t\tthis.#dispatchInsertEvent();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\tcase CodeSnippetType.pageField: {\r\n\t\t\t\tthis.value = value;\r\n\t\t\t\tthis.#dispatchInsertEvent();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync #getDictionaryItemSnippet(unique: string) {\r\n\t\tif (unique === null) return;\r\n\t\tconst { data } = await this.#dictionaryDetailRepository.requestByUnique(unique);\r\n\t\tthis.value = getInsertDictionarySnippet(data?.name ?? '');\r\n\t}\r\n\r\n\tasync #openTemplatingItemPickerModal() {\r\n\t\tconst itemPickerContext = this.#modalContext?.open(this, UMB_TEMPLATING_ITEM_PICKER_MODAL, {\r\n\t\t\tdata: { hidePartialViews: this.hidePartialViews },\r\n\t\t});\r\n\t\tconst result = await itemPickerContext?.onSubmit().catch(() => undefined);\r\n\r\n\t\tif (result === undefined) return;\r\n\r\n\t\tconst value = itemPickerContext?.getValue();\r\n\r\n\t\tif (!value) return;\r\n\r\n\t\tthis.determineInsertValue(value);\r\n\t}\r\n\r\n\tasync #openPartialViewPickerModal() {\r\n\t\tconst partialViewPickerContext = this.#modalContext?.open(this, UMB_PARTIAL_VIEW_PICKER_MODAL);\r\n\t\tconst result = await partialViewPickerContext?.onSubmit().catch(() => undefined);\r\n\r\n\t\tif (result === undefined) return;\r\n\r\n\t\tconst value = partialViewPickerContext?.getValue().selection[0];\r\n\r\n\t\tif (!value) return;\r\n\r\n\t\tthis.determineInsertValue({ type: CodeSnippetType.partialView, value });\r\n\t}\r\n\r\n\tasync #openDictionaryItemPickerModal() {\r\n\t\tconst dictionaryItemPickerContext = this.#modalContext?.open(this, UMB_DICTIONARY_PICKER_MODAL);\r\n\t\tconst result = await dictionaryItemPickerContext?.onSubmit().catch(() => undefined);\r\n\r\n\t\tif (result === undefined) return;\r\n\r\n\t\tconst value = dictionaryItemPickerContext?.getValue().selection[0];\r\n\r\n\t\tif (!value) return;\r\n\r\n\t\tthis.determineInsertValue({ type: CodeSnippetType.dictionaryItem, value });\r\n\t}\r\n\r\n\tasync #openPageFieldBuilderModal() {\r\n\t\tconst pageFieldBuilderContext = this.#modalContext?.open(this, UMB_TEMPLATING_PAGE_FIELD_BUILDER_MODAL);\r\n\t\tconst result = await pageFieldBuilderContext?.onSubmit().catch(() => undefined);\r\n\r\n\t\tif (result === undefined) return;\r\n\r\n\t\tconst value = pageFieldBuilderContext?.getValue().output;\r\n\r\n\t\tif (!value) return;\r\n\r\n\t\t// The output is already built due to the preview in the modal. Can insert it directly now.\r\n\t\tthis.value = value;\r\n\t\tthis.#dispatchInsertEvent();\r\n\t}\r\n\r\n\t#dispatchInsertEvent() {\r\n\t\tthis.dispatchEvent(new CustomEvent('insert', { bubbles: false, cancelable: true, composed: false }));\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<uui-button-group>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t@click=${this.#openTemplatingItemPickerModal}\r\n\t\t\t\t\tlabel=${this.localize.term('template_insert')}>\r\n\t\t\t\t\t<uui-icon name=\"icon-add\"></uui-icon>${this.localize.term('template_insert')}\r\n\t\t\t\t</uui-button>\r\n\t\t\t\t<umb-dropdown\r\n\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\tcompact\r\n\t\t\t\t\tplacement=\"bottom-end\"\r\n\t\t\t\t\tid=\"insert-button\"\r\n\t\t\t\t\tlabel=${this.localize.term('template_insert')}>\r\n\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\tclass=\"insert-menu-item\"\r\n\t\t\t\t\t\tlabel=${this.localize.term('template_insertPageField')}\r\n\t\t\t\t\t\ttitle=${this.localize.term('template_insertPageField')}\r\n\t\t\t\t\t\t@click=${this.#openPageFieldBuilderModal}></uui-menu-item>\r\n\t\t\t\t\t${!this.hidePartialViews\r\n\t\t\t\t\t\t? html`<uui-menu-item\r\n\t\t\t\t\t\t\t\tclass=\"insert-menu-item\"\r\n\t\t\t\t\t\t\t\tlabel=${this.localize.term('template_insertPartialView')}\r\n\t\t\t\t\t\t\t\ttitle=${this.localize.term('template_insertPartialView')}\r\n\t\t\t\t\t\t\t\t@click=${this.#openPartialViewPickerModal}>\r\n\t\t\t\t\t\t\t</uui-menu-item>`\r\n\t\t\t\t\t\t: ''}\r\n\t\t\t\t\t<uui-menu-item\r\n\t\t\t\t\t\tclass=\"insert-menu-item\"\r\n\t\t\t\t\t\tlabel=${this.localize.term('template_insertDictionaryItem')}\r\n\t\t\t\t\t\ttitle=${this.localize.term('template_insertDictionaryItem')}\r\n\t\t\t\t\t\t@click=${this.#openDictionaryItemPickerModal}>\r\n\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t</umb-dropdown>\r\n\t\t\t</uui-button-group>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\t--umb-header-layout-height: 70px;\r\n\t\t\t}\r\n\r\n\t\t\t.insert-menu-item {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\tuui-icon[name='icon-add'] {\r\n\t\t\t\tmargin-right: var(--uui-size-4);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-templating-insert-menu': UmbTemplatingInsertMenuElement;\r\n\t}\r\n}\r\n"],"names":["UMB_TEMPLATING_ITEM_PICKER_MODAL","UmbModalToken","_modalContext","_dictionaryDetailRepository","_UmbTemplatingInsertMenuElement_instances","getDictionaryItemSnippet_fn","openTemplatingItemPickerModal_fn","openPartialViewPickerModal_fn","openDictionaryItemPickerModal_fn","openPageFieldBuilderModal_fn","dispatchInsertEvent_fn","UmbTemplatingInsertMenuElement","UmbLitElement","__privateAdd","UmbDictionaryDetailRepository","UMB_MODAL_MANAGER_CONTEXT","instance","__privateSet","modalValue","type","value","CodeSnippetType","regex","prettyPath","getInsertPartialSnippet","__privateMethod","html","unique","data","__privateGet","getInsertDictionarySnippet","itemPickerContext","partialViewPickerContext","UMB_PARTIAL_VIEW_PICKER_MODAL","dictionaryItemPickerContext","UMB_DICTIONARY_PICKER_MODAL","pageFieldBuilderContext","UMB_TEMPLATING_PAGE_FIELD_BUILDER_MODAL","UmbTextStyles","css","__decorateClass","property","customElement"],"mappings":"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"}