{"version":3,"file":"partial-view-detail.server.data-source-BsxBZMC4.js","sources":["../../../src/packages/templating/partial-views/repository/partial-view-detail.server.data-source.ts"],"sourcesContent":["import type { UmbPartialViewDetailModel } from '../types.js';\r\nimport { UMB_PARTIAL_VIEW_ENTITY_TYPE } from '../entity.js';\r\nimport {\r\n\tUmbServerFilePathUniqueSerializer,\r\n\tappendFileExtensionIfNeeded,\r\n} from '@umbraco-cms/backoffice/server-file-system';\r\nimport type {\r\n\tCreatePartialViewRequestModel,\r\n\tUpdatePartialViewRequestModel,\r\n} from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { PartialViewService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbDetailDataSource } from '@umbraco-cms/backoffice/repository';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\n\r\nexport class UmbPartialViewDetailServerDataSource implements UmbDetailDataSource<UmbPartialViewDetailModel> {\r\n\t#host: UmbControllerHost;\r\n\t#serverFilePathUniqueSerializer = new UmbServerFilePathUniqueSerializer();\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tthis.#host = host;\r\n\t}\r\n\r\n\tasync createScaffold(preset: Partial<UmbPartialViewDetailModel> = {}) {\r\n\t\tconst data: UmbPartialViewDetailModel = {\r\n\t\t\tentityType: UMB_PARTIAL_VIEW_ENTITY_TYPE,\r\n\t\t\tunique: '',\r\n\t\t\tname: '',\r\n\t\t\tcontent: '',\r\n\t\t\t...preset,\r\n\t\t};\r\n\r\n\t\treturn { data };\r\n\t}\r\n\r\n\tasync create(model: UmbPartialViewDetailModel, parentUnique: string | null = null) {\r\n\t\tif (!model) throw new Error('Data is missing');\r\n\t\tif (!model.name) throw new Error('Name is missing');\r\n\r\n\t\tconst parentPath = this.#serverFilePathUniqueSerializer.toServerPath(parentUnique);\r\n\r\n\t\t// TODO: make data mapper to prevent errors\r\n\t\tconst body: CreatePartialViewRequestModel = {\r\n\t\t\tparent: parentPath ? { path: parentPath } : null,\r\n\t\t\tname: appendFileExtensionIfNeeded(model.name, '.cshtml'),\r\n\t\t\tcontent: model.content,\r\n\t\t};\r\n\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tPartialViewService.postPartialView({\r\n\t\t\t\tbody,\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\tif (data && typeof data === 'string') {\r\n\t\t\tconst newPath = decodeURIComponent(data);\r\n\t\t\tconst newPathUnique = this.#serverFilePathUniqueSerializer.toUnique(newPath);\r\n\t\t\treturn this.read(newPathUnique);\r\n\t\t}\r\n\r\n\t\treturn { error };\r\n\t}\r\n\r\n\tasync read(unique: string) {\r\n\t\tif (!unique) throw new Error('Unique is missing');\r\n\r\n\t\tconst path = this.#serverFilePathUniqueSerializer.toServerPath(unique);\r\n\t\tif (!path) throw new Error('Path is missing');\r\n\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tPartialViewService.getPartialViewByPath({ path: { path } }),\r\n\t\t);\r\n\r\n\t\tif (error || !data) {\r\n\t\t\treturn { error };\r\n\t\t}\r\n\r\n\t\tconst partialView: UmbPartialViewDetailModel = {\r\n\t\t\tentityType: UMB_PARTIAL_VIEW_ENTITY_TYPE,\r\n\t\t\tunique: this.#serverFilePathUniqueSerializer.toUnique(data.path),\r\n\t\t\tname: data.name,\r\n\t\t\tcontent: data.content,\r\n\t\t};\r\n\r\n\t\treturn { data: partialView };\r\n\t}\r\n\r\n\tasync update(model: UmbPartialViewDetailModel) {\r\n\t\tif (!model.unique) throw new Error('Unique is missing');\r\n\r\n\t\tconst path = this.#serverFilePathUniqueSerializer.toServerPath(model.unique);\r\n\t\tif (!path) throw new Error('Path is missing');\r\n\r\n\t\tconst body: UpdatePartialViewRequestModel = {\r\n\t\t\tcontent: model.content,\r\n\t\t};\r\n\r\n\t\tconst { error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tPartialViewService.putPartialViewByPath({\r\n\t\t\t\tpath: { path },\r\n\t\t\t\tbody,\r\n\t\t\t}),\r\n\t\t);\r\n\r\n\t\tif (!error) {\r\n\t\t\treturn this.read(model.unique);\r\n\t\t}\r\n\r\n\t\treturn { error };\r\n\t}\r\n\r\n\tasync delete(unique: string) {\r\n\t\tif (!unique) throw new Error('Unique is missing');\r\n\r\n\t\tconst path = this.#serverFilePathUniqueSerializer.toServerPath(unique);\r\n\t\tif (!path) throw new Error('Path is missing');\r\n\r\n\t\treturn tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tPartialViewService.deletePartialViewByPath({\r\n\t\t\t\tpath: { path },\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n}\r\n"],"names":["UmbPartialViewDetailServerDataSource","#host","#serverFilePathUniqueSerializer","UmbServerFilePathUniqueSerializer","host","preset","UMB_PARTIAL_VIEW_ENTITY_TYPE","model","parentUnique","parentPath","body","appendFileExtensionIfNeeded","data","error","tryExecute","PartialViewService","newPath","newPathUnique","unique","path"],"mappings":"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"}