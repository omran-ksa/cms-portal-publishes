{"version":3,"file":"script-tree.repository-BooOpjiH.js","sources":["../../../src/packages/templating/scripts/tree/script-tree.server.data-source.ts","../../../src/packages/templating/scripts/tree/script-tree.repository.ts"],"sourcesContent":["import { UMB_SCRIPT_ENTITY_TYPE, UMB_SCRIPT_FOLDER_ENTITY_TYPE, UMB_SCRIPT_ROOT_ENTITY_TYPE } from '../entity.js';\r\nimport type { UmbScriptTreeItemModel } from './types.js';\r\nimport { UmbServerFilePathUniqueSerializer } from '@umbraco-cms/backoffice/server-file-system';\r\nimport type {\r\n\tUmbTreeAncestorsOfRequestArgs,\r\n\tUmbTreeChildrenOfRequestArgs,\r\n\tUmbTreeRootItemsRequestArgs,\r\n} from '@umbraco-cms/backoffice/tree';\r\nimport { UmbTreeServerDataSourceBase } from '@umbraco-cms/backoffice/tree';\r\nimport type { FileSystemTreeItemPresentationModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { ScriptService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\n/**\r\n * A data source for the Script tree that fetches data from the server\r\n * @class UmbScriptTreeServerDataSource\r\n * @implements {UmbTreeDataSource}\r\n */\r\nexport class UmbScriptTreeServerDataSource extends UmbTreeServerDataSourceBase<\r\n\tFileSystemTreeItemPresentationModel,\r\n\tUmbScriptTreeItemModel\r\n> {\r\n\t/**\r\n\t * Creates an instance of UmbScriptTreeServerDataSource.\r\n\t * @param {UmbControllerHost} host - The controller host for this controller to be appended to\r\n\t * @memberof UmbScriptTreeServerDataSource\r\n\t */\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, {\r\n\t\t\tgetRootItems,\r\n\t\t\tgetChildrenOf,\r\n\t\t\tgetAncestorsOf,\r\n\t\t\tmapper,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nconst getRootItems = (args: UmbTreeRootItemsRequestArgs) =>\r\n\t// eslint-disable-next-line local-rules/no-direct-api-import\r\n\tScriptService.getTreeScriptRoot({ query: { skip: args.skip, take: args.take } });\r\n\r\nconst getChildrenOf = (args: UmbTreeChildrenOfRequestArgs) => {\r\n\tconst parentPath = new UmbServerFilePathUniqueSerializer().toServerPath(args.parent.unique);\r\n\r\n\tif (parentPath === null) {\r\n\t\treturn getRootItems(args);\r\n\t} else {\r\n\t\t// eslint-disable-next-line local-rules/no-direct-api-import\r\n\t\treturn ScriptService.getTreeScriptChildren({\r\n\t\t\tquery: { parentPath, skip: args.skip, take: args.take },\r\n\t\t});\r\n\t}\r\n};\r\n\r\nconst getAncestorsOf = (args: UmbTreeAncestorsOfRequestArgs) => {\r\n\tconst descendantPath = new UmbServerFilePathUniqueSerializer().toServerPath(args.treeItem.unique);\r\n\tif (!descendantPath) throw new Error('Descendant path is not available');\r\n\r\n\t// eslint-disable-next-line local-rules/no-direct-api-import\r\n\treturn ScriptService.getTreeScriptAncestors({\r\n\t\tquery: { descendantPath },\r\n\t});\r\n};\r\n\r\nconst mapper = (item: FileSystemTreeItemPresentationModel): UmbScriptTreeItemModel => {\r\n\tconst serializer = new UmbServerFilePathUniqueSerializer();\r\n\r\n\treturn {\r\n\t\tunique: serializer.toUnique(item.path),\r\n\t\tparent: {\r\n\t\t\tunique: item.parent ? serializer.toUnique(item.parent.path) : null,\r\n\t\t\tentityType: item.parent ? UMB_SCRIPT_ENTITY_TYPE : UMB_SCRIPT_ROOT_ENTITY_TYPE,\r\n\t\t},\r\n\t\tentityType: item.isFolder ? UMB_SCRIPT_FOLDER_ENTITY_TYPE : UMB_SCRIPT_ENTITY_TYPE,\r\n\t\tname: item.name,\r\n\t\tisFolder: item.isFolder,\r\n\t\thasChildren: item.hasChildren,\r\n\t\ticon: item.isFolder ? undefined : 'icon-document-js',\r\n\t};\r\n};\r\n","import { UMB_SCRIPT_ROOT_ENTITY_TYPE } from '../entity.js';\r\nimport { UmbScriptTreeServerDataSource } from './script-tree.server.data-source.js';\r\nimport type { UmbScriptTreeItemModel, UmbScriptTreeRootModel } from './types.js';\r\nimport { UMB_SCRIPT_TREE_STORE_CONTEXT } from './script-tree.store.context-token.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbTreeRepositoryBase } from '@umbraco-cms/backoffice/tree';\r\n\r\n// TODO: TREE STORE TYPE PROBLEM:\r\nexport class UmbScriptTreeRepository extends UmbTreeRepositoryBase<UmbScriptTreeItemModel, UmbScriptTreeRootModel> {\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UmbScriptTreeServerDataSource, UMB_SCRIPT_TREE_STORE_CONTEXT);\r\n\t}\r\n\r\n\tasync requestTreeRoot() {\r\n\t\tconst { data: treeRootData } = await this._treeSource.getRootItems({ skip: 0, take: 1 });\r\n\t\tconst hasChildren = treeRootData ? treeRootData.total > 0 : false;\r\n\r\n\t\tconst data: UmbScriptTreeRootModel = {\r\n\t\t\tunique: null,\r\n\t\t\tentityType: UMB_SCRIPT_ROOT_ENTITY_TYPE,\r\n\t\t\tname: '#treeHeaders_scripts',\r\n\t\t\thasChildren,\r\n\t\t\tisFolder: true,\r\n\t\t};\r\n\r\n\t\treturn { data };\r\n\t}\r\n}\r\n\r\nexport default UmbScriptTreeRepository;\r\n"],"names":["UmbScriptTreeServerDataSource","UmbTreeServerDataSourceBase","host","getRootItems","getChildrenOf","getAncestorsOf","mapper","args","ScriptService","parentPath","UmbServerFilePathUniqueSerializer","descendantPath","item","serializer","UMB_SCRIPT_ENTITY_TYPE","UMB_SCRIPT_ROOT_ENTITY_TYPE","UMB_SCRIPT_FOLDER_ENTITY_TYPE","UmbScriptTreeRepository","UmbTreeRepositoryBase","UMB_SCRIPT_TREE_STORE_CONTEXT","treeRootData","hasChildren"],"mappings":";;;;AAkBO,MAAMA,UAAsCC,EAGjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMD,YAAYC,GAAyB;AACpC,UAAMA,GAAM;AAAA,MACX,cAAAC;AAAA,MACA,eAAAC;AAAA,MACA,gBAAAC;AAAA,MACA,QAAAC;AAAA,IAAA,CACA;AAAA,EAAA;AAEH;AAEA,MAAMH,IAAe,CAACI;AAAA;AAAA,EAErBC,EAAc,kBAAkB,EAAE,OAAO,EAAE,MAAMD,EAAK,MAAM,MAAMA,EAAK,OAAQ,CAAA;AAAA,GAE1EH,IAAgB,CAACG,MAAuC;AAC7D,QAAME,IAAa,IAAIC,IAAoC,aAAaH,EAAK,OAAO,MAAM;AAE1F,SAAIE,MAAe,OACXN,EAAaI,CAAI,IAGjBC,EAAc,sBAAsB;AAAA,IAC1C,OAAO,EAAE,YAAAC,GAAY,MAAMF,EAAK,MAAM,MAAMA,EAAK,KAAK;AAAA,EAAA,CACtD;AAEH,GAEMF,IAAiB,CAACE,MAAwC;AAC/D,QAAMI,IAAiB,IAAID,IAAoC,aAAaH,EAAK,SAAS,MAAM;AAChG,MAAI,CAACI,EAAsB,OAAA,IAAI,MAAM,kCAAkC;AAGvE,SAAOH,EAAc,uBAAuB;AAAA,IAC3C,OAAO,EAAE,gBAAAG,EAAe;AAAA,EAAA,CACxB;AACF,GAEML,IAAS,CAACM,MAAsE;AAC/E,QAAAC,IAAa,IAAIH,EAAkC;AAElD,SAAA;AAAA,IACN,QAAQG,EAAW,SAASD,EAAK,IAAI;AAAA,IACrC,QAAQ;AAAA,MACP,QAAQA,EAAK,SAASC,EAAW,SAASD,EAAK,OAAO,IAAI,IAAI;AAAA,MAC9D,YAAYA,EAAK,SAASE,IAAyBC;AAAA,IACpD;AAAA,IACA,YAAYH,EAAK,WAAWI,IAAgCF;AAAA,IAC5D,MAAMF,EAAK;AAAA,IACX,UAAUA,EAAK;AAAA,IACf,aAAaA,EAAK;AAAA,IAClB,MAAMA,EAAK,WAAW,SAAY;AAAA,EACnC;AACD;ACvEO,MAAMK,UAAgCC,EAAsE;AAAA,EAClH,YAAYhB,GAAyB;AAC9B,UAAAA,GAAMF,GAA+BmB,CAA6B;AAAA,EAAA;AAAA,EAGzE,MAAM,kBAAkB;AACvB,UAAM,EAAE,MAAMC,EAAa,IAAI,MAAM,KAAK,YAAY,aAAa,EAAE,MAAM,GAAG,MAAM,GAAG,GACjFC,IAAcD,IAAeA,EAAa,QAAQ,IAAI;AAU5D,WAAO,EAAE,MAR4B;AAAA,MACpC,QAAQ;AAAA,MACR,YAAYL;AAAA,MACZ,MAAM;AAAA,MACN,aAAAM;AAAA,MACA,UAAU;AAAA,IACX,EAEc;AAAA,EAAA;AAEhB;"}