{"version":3,"file":"partial-view-workspace.context-Dgyg25f6.js","sources":["../../../src/packages/templating/partial-views/workspace/partial-view-workspace-editor.element.ts","../../../src/packages/templating/partial-views/workspace/partial-view-workspace.context.ts"],"sourcesContent":["import { getQuerySnippet } from '../../utils/index.js';\r\nimport type { UmbTemplatingInsertMenuElement } from '../../local-components/insert-menu/index.js';\r\nimport { UMB_PARTIAL_VIEW_WORKSPACE_CONTEXT } from './partial-view-workspace.context-token.js';\r\nimport { css, customElement, html, nothing, query, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { umbOpenModal } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_TEMPLATE_QUERY_BUILDER_MODAL } from '@umbraco-cms/backoffice/template';\r\nimport type { UmbCodeEditorElement } from '@umbraco-cms/backoffice/code-editor';\r\n\r\nimport '@umbraco-cms/backoffice/code-editor';\r\nimport '../../local-components/insert-menu/index.js';\r\n\r\n@customElement('umb-partial-view-workspace-editor')\r\nexport class UmbPartialViewWorkspaceEditorElement extends UmbLitElement {\r\n\t@state()\r\n\tprivate _content?: string | null = '';\r\n\r\n\t@state()\r\n\tprivate _isNew?: boolean;\r\n\r\n\t@query('umb-code-editor')\r\n\tprivate _codeEditor?: UmbCodeEditorElement;\r\n\r\n\t#workspaceContext?: typeof UMB_PARTIAL_VIEW_WORKSPACE_CONTEXT.TYPE;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_PARTIAL_VIEW_WORKSPACE_CONTEXT, (workspaceContext) => {\r\n\t\t\tthis.#workspaceContext = workspaceContext;\r\n\r\n\t\t\tthis.observe(this.#workspaceContext?.content, (content) => {\r\n\t\t\t\tthis._content = content;\r\n\t\t\t});\r\n\r\n\t\t\tthis.observe(this.#workspaceContext?.isNew, (isNew) => {\r\n\t\t\t\tthis._isNew = isNew;\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t#onCodeEditorInput(event: Event) {\r\n\t\tconst target = event.target as UmbCodeEditorElement;\r\n\t\tconst value = target.code as string;\r\n\t\tthis.#workspaceContext?.setContent(value);\r\n\t}\r\n\r\n\t#insertSnippet(event: Event) {\r\n\t\tconst target = event.target as UmbTemplatingInsertMenuElement;\r\n\t\tconst value = target.value as string;\r\n\t\tthis._codeEditor?.insert(value);\r\n\t}\r\n\r\n\tasync #openQueryBuilder() {\r\n\t\tconst queryBuilderModalValue = await umbOpenModal(this, UMB_TEMPLATE_QUERY_BUILDER_MODAL).catch(() => undefined);\r\n\r\n\t\tif (queryBuilderModalValue?.value) {\r\n\t\t\tthis._codeEditor?.insert(getQuerySnippet(queryBuilderModalValue.value));\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-entity-detail-workspace-editor>\r\n\t\t\t\t<umb-workspace-header-name-editable\r\n\t\t\t\t\tslot=\"header\"\r\n\t\t\t\t\t?readonly=${this._isNew === false}></umb-workspace-header-name-editable>\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t<div slot=\"header\" id=\"code-editor-menu-container\">\r\n\t\t\t\t\t\t<umb-templating-insert-menu @insert=${this.#insertSnippet} hidePartialViews></umb-templating-insert-menu>\r\n\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\t\tid=\"query-builder-button\"\r\n\t\t\t\t\t\t\tlabel=${this.localize.term('template_queryBuilder')}\r\n\t\t\t\t\t\t\t@click=${this.#openQueryBuilder}>\r\n\t\t\t\t\t\t\t<uui-icon name=\"icon-wand\"></uui-icon>\r\n\t\t\t\t\t\t\t<umb-localize key=\"template_queryBuilder\">Query builder</umb-localize>\r\n\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t${this.#renderCodeEditor()}\r\n\t\t\t\t</uui-box>\r\n\t\t\t</umb-entity-detail-workspace-editor>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderCodeEditor() {\r\n\t\tif (this._content === undefined) {\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<umb-code-editor\r\n\t\t\t\tid=\"content\"\r\n\t\t\t\tlanguage=\"razor\"\r\n\t\t\t\t.code=${this._content ?? ''}\r\n\t\t\t\t@input=${this.#onCodeEditorInput}></umb-code-editor>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\tumb-code-editor {\r\n\t\t\t\t--editor-height: calc(100dvh - 300px);\r\n\t\t\t}\r\n\r\n\t\t\tuui-box {\r\n\t\t\t\tmin-height: calc(100dvh - 300px);\r\n\t\t\t\tmargin: var(--uui-size-layout-1);\r\n\t\t\t\t--uui-box-default-padding: 0;\r\n\t\t\t\t/* remove header border bottom as code editor looks better in this box */\r\n\t\t\t\t--uui-color-divider-standalone: transparent;\r\n\t\t\t}\r\n\r\n\t\t\t#code-editor-menu-container uui-icon:not([name='icon-delete']) {\r\n\t\t\t\tmargin-right: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t#insert-menu {\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tpadding: 0;\r\n\t\t\t\tmargin-top: var(--uui-size-space-3);\r\n\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\t\t\t\tbox-shadow: var(--uui-shadow-depth-3);\r\n\t\t\t\tmin-width: calc(100% + var(--uui-size-8, 24px));\r\n\t\t\t}\r\n\r\n\t\t\t#insert-menu > li,\r\n\t\t\tul {\r\n\t\t\t\tpadding: 0;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tlist-style: none;\r\n\t\t\t}\r\n\r\n\t\t\t.insert-menu-item {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#code-editor-menu-container {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: flex-end;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbPartialViewWorkspaceEditorElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-partial-view-workspace-editor': UmbPartialViewWorkspaceEditorElement;\r\n\t}\r\n}\r\n","import type { UmbPartialViewDetailModel } from '../types.js';\r\nimport { UMB_PARTIAL_VIEW_ENTITY_TYPE } from '../entity.js';\r\nimport type { UmbPartialViewDetailRepository } from '../repository/index.js';\r\nimport { UMB_PARTIAL_VIEW_DETAIL_REPOSITORY_ALIAS } from '../constants.js';\r\nimport { UmbPartialViewWorkspaceEditorElement } from './partial-view-workspace-editor.element.js';\r\nimport { UMB_PARTIAL_VIEW_WORKSPACE_ALIAS } from './manifests.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type {\r\n\tUmbEntityDetailWorkspaceContextCreateArgs,\r\n\tUmbRoutableWorkspaceContext,\r\n\tUmbSubmittableWorkspaceContext,\r\n} from '@umbraco-cms/backoffice/workspace';\r\nimport {\r\n\tUmbEntityNamedDetailWorkspaceContextBase,\r\n\tUmbWorkspaceIsNewRedirectController,\r\n} from '@umbraco-cms/backoffice/workspace';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\nimport { PartialViewService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { IRoutingInfo, PageComponent } from '@umbraco-cms/backoffice/router';\r\nimport { UmbServerFileRenameWorkspaceRedirectController } from '@umbraco-cms/backoffice/server-file-system';\r\n\r\nexport interface UmbPartialViewWorkspaceContextCreateArgs\r\n\textends UmbEntityDetailWorkspaceContextCreateArgs<UmbPartialViewDetailModel> {\r\n\tsnippet: { unique: string } | null;\r\n}\r\n\r\nexport class UmbPartialViewWorkspaceContext\r\n\textends UmbEntityNamedDetailWorkspaceContextBase<\r\n\t\tUmbPartialViewDetailModel,\r\n\t\tUmbPartialViewDetailRepository,\r\n\t\tUmbPartialViewWorkspaceContextCreateArgs\r\n\t>\r\n\timplements UmbSubmittableWorkspaceContext, UmbRoutableWorkspaceContext\r\n{\r\n\tpublic readonly content = this._data.createObservablePartOfCurrent((data) => data?.content);\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, {\r\n\t\t\tworkspaceAlias: UMB_PARTIAL_VIEW_WORKSPACE_ALIAS,\r\n\t\t\tentityType: UMB_PARTIAL_VIEW_ENTITY_TYPE,\r\n\t\t\tdetailRepositoryAlias: UMB_PARTIAL_VIEW_DETAIL_REPOSITORY_ALIAS,\r\n\t\t});\r\n\r\n\t\tthis.routes.setRoutes([\r\n\t\t\t{\r\n\t\t\t\tpath: 'create/parent/:entityType/:parentUnique/snippet/:snippetId',\r\n\t\t\t\tcomponent: UmbPartialViewWorkspaceEditorElement,\r\n\t\t\t\tsetup: async (component: PageComponent, info: IRoutingInfo) => {\r\n\t\t\t\t\tconst parentEntityType = info.match.params.entityType;\r\n\t\t\t\t\tconst parentUnique = info.match.params.parentUnique === 'null' ? null : info.match.params.parentUnique;\r\n\t\t\t\t\tconst snippetId = info.match.params.snippetId;\r\n\t\t\t\t\tthis.#onCreate({\r\n\t\t\t\t\t\tparent: { entityType: parentEntityType, unique: parentUnique },\r\n\t\t\t\t\t\tsnippet: { unique: snippetId },\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tpath: 'create/parent/:entityType/:parentUnique',\r\n\t\t\t\tcomponent: UmbPartialViewWorkspaceEditorElement,\r\n\t\t\t\tsetup: async (component: PageComponent, info: IRoutingInfo) => {\r\n\t\t\t\t\tconst parentEntityType = info.match.params.entityType;\r\n\t\t\t\t\tconst parentUnique = info.match.params.parentUnique === 'null' ? null : info.match.params.parentUnique;\r\n\t\t\t\t\tthis.#onCreate({\r\n\t\t\t\t\t\tparent: { entityType: parentEntityType, unique: parentUnique },\r\n\t\t\t\t\t\tsnippet: null,\r\n\t\t\t\t\t});\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tpath: 'edit/:unique',\r\n\t\t\t\tcomponent: UmbPartialViewWorkspaceEditorElement,\r\n\t\t\t\tsetup: (component: PageComponent, info: IRoutingInfo) => {\r\n\t\t\t\t\tconst unique = info.match.params.unique;\r\n\t\t\t\t\tthis.load(unique);\r\n\r\n\t\t\t\t\tnew UmbServerFileRenameWorkspaceRedirectController(\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis.getHostElement().shadowRoot!.querySelector('umb-router-slot')!,\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t]);\r\n\t}\r\n\r\n\t#onCreate = async (args: UmbPartialViewWorkspaceContextCreateArgs) => {\r\n\t\tawait this.createScaffold(args);\r\n\r\n\t\tnew UmbWorkspaceIsNewRedirectController(\r\n\t\t\tthis,\r\n\t\t\tthis,\r\n\t\t\tthis.getHostElement().shadowRoot!.querySelector('umb-router-slot')!,\r\n\t\t);\r\n\t};\r\n\r\n\tsetContent(value: string) {\r\n\t\tthis._data.updateCurrent({ content: value });\r\n\t}\r\n\r\n\toverride async createScaffold(args: UmbPartialViewWorkspaceContextCreateArgs) {\r\n\t\tlet snippetContent = '';\r\n\r\n\t\tif (args.snippet?.unique) {\r\n\t\t\tconst { data: snippet } = await this.#getSnippet(args.snippet.unique);\r\n\t\t\tsnippetContent = snippet?.content || '';\r\n\t\t}\r\n\r\n\t\tconst argsWithPreset = { ...args, preset: { content: snippetContent } };\r\n\r\n\t\treturn super.createScaffold(argsWithPreset);\r\n\t}\r\n\r\n\t#getSnippet(unique: string) {\r\n\t\treturn tryExecute(\r\n\t\t\tthis,\r\n\t\t\tPartialViewService.getPartialViewSnippetById({\r\n\t\t\t\tpath: { id: unique },\r\n\t\t\t}),\r\n\t\t);\r\n\t}\r\n}\r\n\r\nexport { UmbPartialViewWorkspaceContext as api };\r\n"],"names":["_workspaceContext","_UmbPartialViewWorkspaceEditorElement_instances","onCodeEditorInput_fn","insertSnippet_fn","openQueryBuilder_fn","renderCodeEditor_fn","UmbPartialViewWorkspaceEditorElement","UmbLitElement","__privateAdd","UMB_PARTIAL_VIEW_WORKSPACE_CONTEXT","workspaceContext","__privateSet","__privateGet","content","isNew","html","__privateMethod","event","value","queryBuilderModalValue","umbOpenModal","UMB_TEMPLATE_QUERY_BUILDER_MODAL","getQuerySnippet","nothing","css","__decorateClass","state","query","customElement","UmbPartialViewWorkspaceContext","UmbEntityNamedDetailWorkspaceContextBase","host","UMB_PARTIAL_VIEW_WORKSPACE_ALIAS","UMB_PARTIAL_VIEW_ENTITY_TYPE","UMB_PARTIAL_VIEW_DETAIL_REPOSITORY_ALIAS","data","#onCreate","args","UmbWorkspaceIsNewRedirectController","component","info","parentEntityType","parentUnique","snippetId","unique","UmbServerFileRenameWorkspaceRedirectController","snippetContent","snippet","#getSnippet","argsWithPreset","tryExecute","PartialViewService"],"mappings":"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"}