{"version":3,"file":"script-workspace.context-DfeKd3uS.js","sources":["../../../src/packages/templating/scripts/workspace/script-workspace-editor.element.ts","../../../src/packages/templating/scripts/workspace/script-workspace.context.ts"],"sourcesContent":["import { UMB_SCRIPT_WORKSPACE_CONTEXT } from './script-workspace.context-token.js';\r\nimport { css, html, customElement, state, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { UmbCodeEditorElement } from '@umbraco-cms/backoffice/code-editor';\r\n\r\nimport '@umbraco-cms/backoffice/code-editor';\r\n\r\n@customElement('umb-script-workspace-editor')\r\nexport class UmbScriptWorkspaceEditorElement extends UmbLitElement {\r\n\t@state()\r\n\tprivate _content?: string | null = '';\r\n\r\n\t@state()\r\n\tprivate _isNew?: boolean;\r\n\r\n\t#context?: typeof UMB_SCRIPT_WORKSPACE_CONTEXT.TYPE;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_SCRIPT_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tthis.#context = context;\r\n\t\t\tthis.observe(this.#context?.content, (content) => (this._content = content));\r\n\t\t\tthis.observe(this.#context?.isNew, (isNew) => (this._isNew = isNew));\r\n\t\t});\r\n\t}\r\n\r\n\t#onCodeEditorInput(event: Event) {\r\n\t\tconst target = event.target as UmbCodeEditorElement;\r\n\t\tconst value = target.code as string;\r\n\t\tthis.#context?.setContent(value);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-entity-detail-workspace-editor>\r\n\t\t\t\t<umb-workspace-header-name-editable\r\n\t\t\t\t\tslot=\"header\"\r\n\t\t\t\t\t?readonly=${this._isNew === false}></umb-workspace-header-name-editable>\r\n\t\t\t\t${this.#renderBody()}\r\n\t\t\t</umb-entity-detail-workspace-editor>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderBody() {\r\n\t\treturn html`\r\n\t\t\t<uui-box>\r\n\t\t\t\t<!-- the div below in the header is to make the box display nicely with code editor -->\r\n\t\t\t\t<div slot=\"header\"></div>\r\n\t\t\t\t${this.#renderCodeEditor()}\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderCodeEditor() {\r\n\t\tif (this._content === undefined) {\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<umb-code-editor\r\n\t\t\t\tid=\"content\"\r\n\t\t\t\tlanguage=\"javascript\"\r\n\t\t\t\t.code=${this._content ?? ''}\r\n\t\t\t\t@input=${this.#onCodeEditorInput}></umb-code-editor>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\tumb-code-editor {\r\n\t\t\t\t--editor-height: calc(100dvh - 260px);\r\n\t\t\t}\r\n\r\n\t\t\tuui-box {\r\n\t\t\t\tmin-height: calc(100dvh - 260px);\r\n\t\t\t\tmargin: var(--uui-size-layout-1);\r\n\t\t\t\t--uui-box-default-padding: 0;\r\n\t\t\t\t/* remove header border bottom as code editor looks better in this box */\r\n\t\t\t\t--uui-color-divider-standalone: transparent;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbScriptWorkspaceEditorElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-script-workspace-editor': UmbScriptWorkspaceEditorElement;\r\n\t}\r\n}\r\n","import type { UmbScriptDetailModel } from '../types.js';\r\nimport { UMB_SCRIPT_ENTITY_TYPE } from '../entity.js';\r\nimport type { UmbScriptDetailRepository } from '../repository/index.js';\r\nimport { UMB_SCRIPT_DETAIL_REPOSITORY_ALIAS } from '../constants.js';\r\nimport { UMB_SCRIPT_WORKSPACE_ALIAS } from './manifests.js';\r\nimport { UmbScriptWorkspaceEditorElement } from './script-workspace-editor.element.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport {\r\n\tUmbEntityNamedDetailWorkspaceContextBase,\r\n\ttype UmbRoutableWorkspaceContext,\r\n\ttype UmbSubmittableWorkspaceContext,\r\n\tUmbWorkspaceIsNewRedirectController,\r\n} from '@umbraco-cms/backoffice/workspace';\r\nimport type { IRoutingInfo, PageComponent } from '@umbraco-cms/backoffice/router';\r\nimport { UmbServerFileRenameWorkspaceRedirectController } from '@umbraco-cms/backoffice/server-file-system';\r\n\r\nexport class UmbScriptWorkspaceContext\r\n\textends UmbEntityNamedDetailWorkspaceContextBase<UmbScriptDetailModel, UmbScriptDetailRepository>\r\n\timplements UmbSubmittableWorkspaceContext, UmbRoutableWorkspaceContext\r\n{\r\n\tpublic readonly content = this._data.createObservablePartOfCurrent((data) => data?.content);\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, {\r\n\t\t\tworkspaceAlias: UMB_SCRIPT_WORKSPACE_ALIAS,\r\n\t\t\tentityType: UMB_SCRIPT_ENTITY_TYPE,\r\n\t\t\tdetailRepositoryAlias: UMB_SCRIPT_DETAIL_REPOSITORY_ALIAS,\r\n\t\t});\r\n\r\n\t\tthis.routes.setRoutes([\r\n\t\t\t{\r\n\t\t\t\tpath: 'create/parent/:entityType/:parentUnique',\r\n\t\t\t\tcomponent: UmbScriptWorkspaceEditorElement,\r\n\t\t\t\tsetup: async (component: PageComponent, info: IRoutingInfo) => {\r\n\t\t\t\t\tconst parentEntityType = info.match.params.entityType;\r\n\t\t\t\t\tconst parentUnique = info.match.params.parentUnique === 'null' ? null : info.match.params.parentUnique;\r\n\t\t\t\t\tawait this.createScaffold({ parent: { entityType: parentEntityType, unique: parentUnique } });\r\n\r\n\t\t\t\t\tnew UmbWorkspaceIsNewRedirectController(\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis.getHostElement().shadowRoot!.querySelector('umb-router-slot')!,\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\t{\r\n\t\t\t\tpath: 'edit/:unique',\r\n\t\t\t\tcomponent: UmbScriptWorkspaceEditorElement,\r\n\t\t\t\tsetup: (component: PageComponent, info: IRoutingInfo) => {\r\n\t\t\t\t\tconst unique = info.match.params.unique;\r\n\t\t\t\t\tthis.load(unique);\r\n\r\n\t\t\t\t\tnew UmbServerFileRenameWorkspaceRedirectController(\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis,\r\n\t\t\t\t\t\tthis.getHostElement().shadowRoot!.querySelector('umb-router-slot')!,\r\n\t\t\t\t\t);\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t]);\r\n\t}\r\n\r\n\t/**\r\n\t * @description Set the content of the script\r\n\t * @param {string} value The content of the script\r\n\t * @memberof UmbScriptWorkspaceContext\r\n\t */\r\n\tpublic setContent(value: string) {\r\n\t\tthis._data.updateCurrent({ content: value });\r\n\t}\r\n}\r\n\r\nexport { UmbScriptWorkspaceContext as api };\r\n"],"names":["_context","_UmbScriptWorkspaceEditorElement_instances","onCodeEditorInput_fn","renderBody_fn","renderCodeEditor_fn","UmbScriptWorkspaceEditorElement","UmbLitElement","__privateAdd","UMB_SCRIPT_WORKSPACE_CONTEXT","context","__privateSet","__privateGet","content","isNew","html","__privateMethod","event","value","nothing","css","__decorateClass","state","customElement","UmbScriptWorkspaceContext","UmbEntityNamedDetailWorkspaceContextBase","host","UMB_SCRIPT_WORKSPACE_ALIAS","UMB_SCRIPT_ENTITY_TYPE","UMB_SCRIPT_DETAIL_REPOSITORY_ALIAS","data","component","info","parentEntityType","parentUnique","UmbWorkspaceIsNewRedirectController","unique","UmbServerFileRenameWorkspaceRedirectController"],"mappings":"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"}