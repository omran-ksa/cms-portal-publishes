{"version":3,"file":"models-builder-dashboard.element-BqquPtBN.js","sources":["../../../src/packages/models-builder/models-builder-dashboard.element.ts"],"sourcesContent":["import type { UUIButtonState } from '@umbraco-cms/backoffice/external/uui';\r\nimport { css, html, nothing, customElement, state } from '@umbraco-cms/backoffice/external/lit';\r\n\r\nimport type { ModelsBuilderResponseModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { ModelsBuilderService, ModelsModeModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\n\r\n@customElement('umb-models-builder-dashboard')\r\nexport class UmbModelsBuilderDashboardElement extends UmbLitElement {\r\n\t@state()\r\n\tprivate _modelsBuilder?: ModelsBuilderResponseModel;\r\n\r\n\t@state()\r\n\tprivate _buttonStateBuild: UUIButtonState = undefined;\r\n\r\n\t@state()\r\n\tprivate _buttonStateReload: UUIButtonState = undefined;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis._getDashboardData();\r\n\t}\r\n\r\n\tprivate async _getDashboardData() {\r\n\t\tconst { data } = await tryExecute(this, ModelsBuilderService.getModelsBuilderDashboard());\r\n\t\tif (data) {\r\n\t\t\tthis._modelsBuilder = data;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tprivate async _onGenerateModels() {\r\n\t\tthis._buttonStateBuild = 'waiting';\r\n\t\tconst status = await this._postGenerateModels();\r\n\t\tthis._buttonStateBuild = status ? 'success' : 'failed';\r\n\t}\r\n\r\n\tprivate async _postGenerateModels() {\r\n\t\tconst { error } = await tryExecute(this, ModelsBuilderService.postModelsBuilderBuild());\r\n\t\tif (error) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\r\n\t\tthis._getDashboardData();\r\n\t\treturn true;\r\n\t}\r\n\r\n\tprivate async _onDashboardReload() {\r\n\t\tthis._buttonStateReload = 'waiting';\r\n\t\tconst status = await this._getDashboardData();\r\n\t\tthis._buttonStateReload = status ? 'success' : 'failed';\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<uui-box headline=\"Models Builder\" class=\"overview\">\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tslot=\"header-actions\"\r\n\t\t\t\t\t.state=\"${this._buttonStateReload}\"\r\n\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\tlabel=\"Reload\"\r\n\t\t\t\t\t@click=\"${this._onDashboardReload}\">\r\n\t\t\t\t\tReload\r\n\t\t\t\t</uui-button>\r\n\t\t\t\t<p>Version: ${this._modelsBuilder?.version}</p>\r\n\t\t\t\t<div class=\"models-description\">\r\n\t\t\t\t\t<p>ModelsBuilder is enabled with the following configuration:</p>\r\n\t\t\t\t\t<ul>\r\n\t\t\t\t\t\t${this._modelsBuilder?.mode\r\n\t\t\t\t\t\t\t? html`<li>\r\n\t\t\t\t\t\t\t\t\tThe <strong>ModelsMode</strong> is '${this._modelsBuilder.mode}'. ${this.renderModelsMode()}\r\n\t\t\t\t\t\t\t\t</li> `\r\n\t\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t\t${this.renderList()}\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</div>\r\n\t\t\t\t<p class=\"models-actions\">\r\n\t\t\t\t\t${this._modelsBuilder?.outOfDateModels\r\n\t\t\t\t\t\t? html`<span class=\"out-of-date\">Models are <strong>out-of-date</strong></span>`\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t\t${this._modelsBuilder?.canGenerate\r\n\t\t\t\t\t\t? html` <uui-button\r\n\t\t\t\t\t\t\t\t.state=\"${this._buttonStateBuild}\"\r\n\t\t\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\t\t\tlabel=\"Generate models\"\r\n\t\t\t\t\t\t\t\t@click=\"${this._onGenerateModels}\">\r\n\t\t\t\t\t\t\t\tGenerate models\r\n\t\t\t\t\t\t\t</uui-button>`\r\n\t\t\t\t\t\t: nothing}\r\n\t\t\t\t</p>\r\n\t\t\t\t${this._modelsBuilder?.lastError\r\n\t\t\t\t\t? html`<p class=\"error\">Last generation failed with the following error:</p>\r\n\t\t\t\t\t\t\t<umb-code-block style=\"max-height:500px;\">${this._modelsBuilder.lastError}</umb-code-block>`\r\n\t\t\t\t\t: nothing}\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\tprivate renderList() {\r\n\t\tif (this._modelsBuilder?.mode !== ModelsModeModel.NOTHING) {\r\n\t\t\treturn html`${this._modelsBuilder?.modelsNamespace\r\n\t\t\t\t? html`<li>The <strong>models namespace</strong> is ${this._modelsBuilder.modelsNamespace}.</li>`\r\n\t\t\t\t: nothing}\r\n\t\t\t${this._modelsBuilder?.trackingOutOfDateModels === true\r\n\t\t\t\t? html`<li>Tracking of <strong>out-of-date models</strong> is enabled.</li>`\r\n\t\t\t\t: this._modelsBuilder?.trackingOutOfDateModels === false\r\n\t\t\t\t\t? html`<li>Tracking of <strong>out-of-date models</strong> is not enabled.</li>`\r\n\t\t\t\t\t: nothing}`;\r\n\t\t}\r\n\t\treturn nothing;\r\n\t}\r\n\r\n\trenderModelsMode() {\r\n\t\tswitch (this._modelsBuilder?.mode) {\r\n\t\t\tcase ModelsModeModel.IN_MEMORY_AUTO:\r\n\t\t\t\treturn 'Strongly typed models are re-generated on startup and anytime schema changes (i.e. Content Type) are made. No recompilation necessary but the generated models are not available to code outside of Razor.';\r\n\t\t\tcase ModelsModeModel.SOURCE_CODE_MANUAL:\r\n\t\t\t\treturn 'Strongly typed models are generated on demand. Recompilation is necessary and models are available to all CSharp code.';\r\n\t\t\tcase ModelsModeModel.SOURCE_CODE_AUTO:\r\n\t\t\t\treturn 'Strong typed models are generated on demand and anytime schema changes (i.e. Content Type) are made. Recompilation is necessary and models are available to all CSharp code.';\r\n\t\t\tcase ModelsModeModel.NOTHING:\r\n\t\t\t\treturn 'Strongly typed models are not generated. All content and cache will operate from instance of IPublishedContent only.';\r\n\t\t\tdefault:\r\n\t\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tpadding: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\t.models-description ul {\r\n\t\t\t\tlist-style-type: square;\r\n\t\t\t\tmargin: 0;\r\n\t\t\t\tpadding-left: var(--uui-size-layout-1);\r\n\t\t\t}\r\n\r\n\t\t\tspan.out-of-date {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tpadding-block-end: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t.error {\r\n\t\t\t\tfont-weight: bold;\r\n\t\t\t\tcolor: var(--uui-color-danger);\r\n\t\t\t}\r\n\r\n\t\t\tp.models-actions {\r\n\t\t\t\tmargin-bottom: 0;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbModelsBuilderDashboardElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-models-builder-dashboard': UmbModelsBuilderDashboardElement;\r\n\t}\r\n}\r\n"],"names":["UmbModelsBuilderDashboardElement","UmbLitElement","data","tryExecute","ModelsBuilderService","status","error","html","nothing","ModelsModeModel","UmbTextStyles","css","__decorateClass","state","customElement","UmbModelsBuilderDashboardElement$1"],"mappings":";;;;;;;;;;AAUa,IAAAA,IAAN,cAA+CC,EAAc;AAAA,EAUnE,cAAc;AACP,UAAA,GANP,KAAQ,oBAAoC,QAG5C,KAAQ,qBAAqC,QAI5C,KAAK,kBAAkB;AAAA,EAAA;AAAA,EAGxB,MAAc,oBAAoB;AAC3B,UAAA,EAAE,MAAAC,MAAS,MAAMC,EAAW,MAAMC,EAAqB,2BAA2B;AACxF,WAAIF,KACH,KAAK,iBAAiBA,GACf,MAED;AAAA,EAAA;AAAA,EAGR,MAAc,oBAAoB;AACjC,SAAK,oBAAoB;AACnB,UAAAG,IAAS,MAAM,KAAK,oBAAoB;AACzC,SAAA,oBAAoBA,IAAS,YAAY;AAAA,EAAA;AAAA,EAG/C,MAAc,sBAAsB;AAC7B,UAAA,EAAE,OAAAC,MAAU,MAAMH,EAAW,MAAMC,EAAqB,wBAAwB;AACtF,WAAIE,IACI,MAGR,KAAK,kBAAkB,GAChB;AAAA,EAAA;AAAA,EAGR,MAAc,qBAAqB;AAClC,SAAK,qBAAqB;AACpB,UAAAD,IAAS,MAAM,KAAK,kBAAkB;AACvC,SAAA,qBAAqBA,IAAS,YAAY;AAAA,EAAA;AAAA,EAGvC,SAAS;AACV,WAAAE;AAAA;AAAA;AAAA;AAAA,eAIM,KAAK,kBAAkB;AAAA;AAAA;AAAA,eAGvB,KAAK,kBAAkB;AAAA;AAAA;AAAA,kBAGpB,KAAK,gBAAgB,OAAO;AAAA;AAAA;AAAA;AAAA,QAItC,KAAK,gBAAgB,OACpBA;AAAA,+CACsC,KAAK,eAAe,IAAI,MAAM,KAAK,iBAAkB,CAAA;AAAA,kBAE3FC,CAAO;AAAA,QACR,KAAK,WAAY,CAAA;AAAA;AAAA;AAAA;AAAA,OAIlB,KAAK,gBAAgB,kBACpBD,8EACAC,CAAO;AAAA,OACR,KAAK,gBAAgB,cACpBD;AAAA,kBACU,KAAK,iBAAiB;AAAA;AAAA;AAAA,kBAGtB,KAAK,iBAAiB;AAAA;AAAA,wBAGhCC,CAAO;AAAA;AAAA,MAET,KAAK,gBAAgB,YACpBD;AAAA,mDAC4C,KAAK,eAAe,SAAS,sBACzEC,CAAO;AAAA;AAAA;AAAA,EAAA;AAAA,EAKL,aAAa;AACpB,WAAI,KAAK,gBAAgB,SAASC,EAAgB,UAC1CF,IAAO,KAAK,gBAAgB,kBAChCA,iDAAoD,KAAK,eAAe,eAAe,WACvFC,CAAO;AAAA,KACR,KAAK,gBAAgB,4BAA4B,KAChDD,0EACA,KAAK,gBAAgB,4BAA4B,KAChDA,8EACAC,CAAO,KAELA;AAAA,EAAA;AAAA,EAGR,mBAAmB;AACV,YAAA,KAAK,gBAAgB,MAAM;AAAA,MAClC,KAAKC,EAAgB;AACb,eAAA;AAAA,MACR,KAAKA,EAAgB;AACb,eAAA;AAAA,MACR,KAAKA,EAAgB;AACb,eAAA;AAAA,MACR,KAAKA,EAAgB;AACb,eAAA;AAAA,MACR;AACC;AAAA,IAAA;AAAA,EACF;AAgCF;AArJaT,EAwHI,SAAS;AAAA,EACxBU;AAAA,EACAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0BD;AAlJQC,EAAA;AAAA,EADPC,EAAM;AAAA,GADKb,EAEJ,WAAA,kBAAA,CAAA;AAGAY,EAAA;AAAA,EADPC,EAAM;AAAA,GAJKb,EAKJ,WAAA,qBAAA,CAAA;AAGAY,EAAA;AAAA,EADPC,EAAM;AAAA,GAPKb,EAQJ,WAAA,sBAAA,CAAA;AARIA,IAANY,EAAA;AAAA,EADNE,EAAc,8BAA8B;AAAA,GAChCd,CAAA;AAuJb,MAAAe,IAAef;"}