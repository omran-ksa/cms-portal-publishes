{"version":3,"file":"url-picker-monaco-markdown-editor-action-3fddidQp.js","sources":["../../../src/packages/multi-url-picker/monaco-markdown-editor-action/url-picker-monaco-markdown-editor-action.ts"],"sourcesContent":["import { UMB_LINK_PICKER_MODAL } from '../link-picker-modal/link-picker-modal.token.js';\r\nimport { monaco } from '@umbraco-cms/backoffice/external/monaco-editor';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbLocalizationController } from '@umbraco-cms/backoffice/localization-api';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UUIModalSidebarSize } from '@umbraco-cms/backoffice/external/uui';\r\n\r\nexport class UmbUrlPickerMonacoMarkdownEditorAction extends UmbControllerBase {\r\n\t#localize = new UmbLocalizationController(this);\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t}\r\n\r\n\tgetUnique() {\r\n\t\treturn 'Umb.MonacoMarkdownEditorAction.UrlPicker';\r\n\t}\r\n\r\n\tgetLabel() {\r\n\t\treturn this.#localize.term('general_insertLink');\r\n\t}\r\n\r\n\tgetKeybindings() {\r\n\t\treturn [monaco.KeyMod.CtrlCmd | monaco.KeyCode.KeyK];\r\n\t}\r\n\r\n\tasync execute({ editor, overlaySize }: { editor: any; overlaySize: UUIModalSidebarSize }) {\r\n\t\tif (!editor) throw new Error('Editor not found');\r\n\t\tconst modalManager = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tif (!modalManager) throw new Error('Modal manager not found');\r\n\r\n\t\tconst selection = editor?.getSelections()[0];\r\n\t\tif (!selection) return;\r\n\r\n\t\tconst selectedValue = editor?.getValueInRange(selection);\r\n\t\teditor.monacoEditor?.focus();\r\n\r\n\t\tconst modalContext = modalManager.open(this, UMB_LINK_PICKER_MODAL, {\r\n\t\t\tmodal: { size: overlaySize },\r\n\t\t\tdata: {\r\n\t\t\t\tindex: null,\r\n\t\t\t\tisNew: selectedValue === '',\r\n\t\t\t\tconfig: {},\r\n\t\t\t},\r\n\t\t\tvalue: {\r\n\t\t\t\tlink: { name: selectedValue },\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tmodalContext\r\n\t\t\t?.onSubmit()\r\n\t\t\t.then((value) => {\r\n\t\t\t\tif (!value) return;\r\n\r\n\t\t\t\tconst name = this.#localize.term('general_name');\r\n\t\t\t\tconst url = this.#localize.term('general_url');\r\n\r\n\t\t\t\teditor.monacoEditor?.executeEdits('', [\r\n\t\t\t\t\t{ range: selection, text: `[${value.link.name || name}](${value.link.url || url})` },\r\n\t\t\t\t]);\r\n\r\n\t\t\t\tif (!value.link.name) {\r\n\t\t\t\t\teditor.select({\r\n\t\t\t\t\t\tstartColumn: selection.startColumn + 1,\r\n\t\t\t\t\t\tendColumn: selection.startColumn + 1 + name.length,\r\n\t\t\t\t\t\tendLineNumber: selection.startLineNumber,\r\n\t\t\t\t\t\tstartLineNumber: selection.startLineNumber,\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (!value.link.url) {\r\n\t\t\t\t\teditor.select({\r\n\t\t\t\t\t\tstartColumn: selection.startColumn + 3 + value.link.name.length,\r\n\t\t\t\t\t\tendColumn: selection.startColumn + 3 + value.link.name.length + url.length,\r\n\t\t\t\t\t\tendLineNumber: selection.startLineNumber,\r\n\t\t\t\t\t\tstartLineNumber: selection.startLineNumber,\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(() => undefined)\r\n\t\t\t.finally(() => editor.monacoEditor?.focus());\r\n\t}\r\n}\r\n\r\nexport { UmbUrlPickerMonacoMarkdownEditorAction as api };\r\n"],"names":["UmbUrlPickerMonacoMarkdownEditorAction","UmbControllerBase","#localize","UmbLocalizationController","host","monaco","editor","overlaySize","modalManager","UMB_MODAL_MANAGER_CONTEXT","selection","selectedValue","UMB_LINK_PICKER_MODAL","value","name","url"],"mappings":";;;;;AAQO,MAAMA,UAA+CC,EAAkB;AAAA,EAC7EC,KAAY,IAAIC,EAA0B,IAAI;AAAA,EAE9C,YAAYC,GAAyB;AACpC,UAAMA,CAAI;AAAA,EAAA;AAAA,EAGX,YAAY;AACJ,WAAA;AAAA,EAAA;AAAA,EAGR,WAAW;AACH,WAAA,KAAKF,GAAU,KAAK,oBAAoB;AAAA,EAAA;AAAA,EAGhD,iBAAiB;AAChB,WAAO,CAACG,EAAO,OAAO,UAAUA,EAAO,QAAQ,IAAI;AAAA,EAAA;AAAA,EAGpD,MAAM,QAAQ,EAAE,QAAAC,GAAQ,aAAAC,KAAkE;AACzF,QAAI,CAACD,EAAc,OAAA,IAAI,MAAM,kBAAkB;AAC/C,UAAME,IAAe,MAAM,KAAK,WAAWC,CAAyB;AACpE,QAAI,CAACD,EAAoB,OAAA,IAAI,MAAM,yBAAyB;AAE5D,UAAME,IAAYJ,GAAQ,cAAc,EAAE,CAAC;AAC3C,QAAI,CAACI,EAAW;AAEV,UAAAC,IAAgBL,GAAQ,gBAAgBI,CAAS;AACvD,IAAAJ,EAAO,cAAc,MAAM,GAENE,EAAa,KAAK,MAAMI,GAAuB;AAAA,MACnE,OAAO,EAAE,MAAML,EAAY;AAAA,MAC3B,MAAM;AAAA,QACL,OAAO;AAAA,QACP,OAAOI,MAAkB;AAAA,QACzB,QAAQ,CAAA;AAAA,MACT;AAAA,MACA,OAAO;AAAA,QACN,MAAM,EAAE,MAAMA,EAAc;AAAA,MAAA;AAAA,IAC7B,CACA,GAGE,SAAS,EACV,KAAK,CAACE,MAAU;AAChB,UAAI,CAACA,EAAO;AAEZ,YAAMC,IAAO,KAAKZ,GAAU,KAAK,cAAc,GACzCa,IAAM,KAAKb,GAAU,KAAK,aAAa;AAEtC,MAAAI,EAAA,cAAc,aAAa,IAAI;AAAA,QACrC,EAAE,OAAOI,GAAW,MAAM,IAAIG,EAAM,KAAK,QAAQC,CAAI,KAAKD,EAAM,KAAK,OAAOE,CAAG,IAAI;AAAA,MAAA,CACnF,GAEIF,EAAM,KAAK,OAOJA,EAAM,KAAK,OACtBP,EAAO,OAAO;AAAA,QACb,aAAaI,EAAU,cAAc,IAAIG,EAAM,KAAK,KAAK;AAAA,QACzD,WAAWH,EAAU,cAAc,IAAIG,EAAM,KAAK,KAAK,SAASE,EAAI;AAAA,QACpE,eAAeL,EAAU;AAAA,QACzB,iBAAiBA,EAAU;AAAA,MAAA,CAC3B,IAZDJ,EAAO,OAAO;AAAA,QACb,aAAaI,EAAU,cAAc;AAAA,QACrC,WAAWA,EAAU,cAAc,IAAII,EAAK;AAAA,QAC5C,eAAeJ,EAAU;AAAA,QACzB,iBAAiBA,EAAU;AAAA,MAAA,CAC3B;AAAA,IAQF,CACA,EACA,MAAM,MAAA;AAAA,KAAe,EACrB,QAAQ,MAAMJ,EAAO,cAAc,OAAO;AAAA,EAAA;AAE9C;"}