{"version":3,"file":"tiptap-toolbar-menu.element-DCnviBSV.js","sources":["../../../src/packages/tiptap/components/toolbar/tiptap-toolbar-menu.element.ts"],"sourcesContent":["import type {\r\n\tManifestTiptapToolbarExtensionMenuKind,\r\n\tMetaTiptapToolbarMenuItem,\r\n\tUmbTiptapToolbarElementApi,\r\n} from '../../extensions/index.js';\r\nimport type { UmbCascadingMenuItem } from '../../components/cascading-menu-popover/cascading-menu-popover.element.js';\r\nimport { css, customElement, html, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { Editor } from '@umbraco-cms/backoffice/external/tiptap';\r\n\r\nimport '../../components/cascading-menu-popover/cascading-menu-popover.element.js';\r\n\r\n@customElement('umb-tiptap-toolbar-menu-element')\r\nexport class UmbTiptapToolbarMenuElement extends UmbLitElement {\r\n\t#menu: Array<UmbCascadingMenuItem> = [];\r\n\r\n\t@state()\r\n\tprotected isActive = false;\r\n\r\n\tpublic api?: UmbTiptapToolbarElementApi;\r\n\r\n\tpublic editor?: Editor;\r\n\r\n\tpublic set manifest(value: ManifestTiptapToolbarExtensionMenuKind | undefined) {\r\n\t\tthis.#manifest = value;\r\n\t\tthis.#setMenu();\r\n\t}\r\n\tpublic get manifest(): ManifestTiptapToolbarExtensionMenuKind | undefined {\r\n\t\treturn this.#manifest;\r\n\t}\r\n\t#manifest?: ManifestTiptapToolbarExtensionMenuKind | undefined;\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\r\n\t\tif (this.editor) {\r\n\t\t\tthis.editor.on('selectionUpdate', this.#onEditorUpdate);\r\n\t\t\tthis.editor.on('update', this.#onEditorUpdate);\r\n\t\t}\r\n\t}\r\n\r\n\toverride disconnectedCallback() {\r\n\t\tsuper.disconnectedCallback();\r\n\r\n\t\tif (this.editor) {\r\n\t\t\tthis.editor.off('selectionUpdate', this.#onEditorUpdate);\r\n\t\t\tthis.editor.off('update', this.#onEditorUpdate);\r\n\t\t}\r\n\t}\r\n\r\n\tasync #setMenu() {\r\n\t\tconst items = this.#manifest?.items ?? this.#manifest?.meta.items;\r\n\t\tif (!items) return;\r\n\t\tthis.#menu = await this.#getMenuItems(items);\r\n\t}\r\n\r\n\tasync #getMenuItems(items: Array<MetaTiptapToolbarMenuItem>): Promise<Array<UmbCascadingMenuItem>> {\r\n\t\tconst menu = [];\r\n\r\n\t\tfor (const item of items) {\r\n\t\t\tconst menuItem = await this.#getMenuItem(item);\r\n\t\t\tmenu.push(menuItem);\r\n\t\t}\r\n\r\n\t\treturn menu;\r\n\t}\r\n\r\n\tasync #getMenuItem(item: MetaTiptapToolbarMenuItem): Promise<UmbCascadingMenuItem> {\r\n\t\tlet element;\r\n\r\n\t\t// TODO: Commented out as needs review of how async/await is being handled here. [LK]\r\n\t\t// if (item.element) {\r\n\t\t// \tconst elementConstructor = await loadManifestElement(item.element);\r\n\t\t// \tif (elementConstructor) {\r\n\t\t// \t\telement = new elementConstructor();\r\n\t\t// \t}\r\n\t\t// }\r\n\r\n\t\tif (!element && item.elementName) {\r\n\t\t\telement = document.createElement(item.elementName);\r\n\t\t}\r\n\r\n\t\tif (element) {\r\n\t\t\t// TODO: Enforce a type for the element, that has an `editor` property. [LK]\r\n\t\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t\t// @ts-ignore\r\n\t\t\telement.editor = this.editor;\r\n\t\t}\r\n\r\n\t\tlet items;\r\n\t\tif (item.items) {\r\n\t\t\titems = await this.#getMenuItems(item.items);\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\ticon: item.appearance?.icon ?? item.icon,\r\n\t\t\titems,\r\n\t\t\tlabel: item.label,\r\n\t\t\tstyle: item.appearance?.style ?? item.style,\r\n\t\t\tseparatorAfter: item.separatorAfter,\r\n\t\t\telement,\r\n\t\t\tisActive: () => this.api?.isActive(this.editor, item),\r\n\t\t\texecute: () => this.api?.execute(this.editor, item),\r\n\t\t};\r\n\t}\r\n\r\n\t#isMenuActive(items?: UmbCascadingMenuItem[]): boolean {\r\n\t\treturn !!items?.some((item) => item.isActive?.() || this.#isMenuActive(item.items));\r\n\t}\r\n\r\n\treadonly #onEditorUpdate = () => {\r\n\t\tif (this.api && this.editor && this.manifest) {\r\n\t\t\tthis.isActive = this.api.isActive(this.editor) || this.#isMenuActive(this.#menu) || false;\r\n\t\t}\r\n\t};\r\n\r\n\toverride render() {\r\n\t\tconst label = this.localize.string(this.manifest?.meta.label);\r\n\t\treturn html`\r\n\t\t\t${when(\r\n\t\t\t\tthis.manifest?.meta.look === 'icon',\r\n\t\t\t\t() => html`\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\tlabel=${label}\r\n\t\t\t\t\t\tlook=${this.isActive ? 'outline' : 'default'}\r\n\t\t\t\t\t\ttitle=${label}\r\n\t\t\t\t\t\tpopovertarget=\"popover-menu\">\r\n\t\t\t\t\t\t${when(\r\n\t\t\t\t\t\t\tthis.manifest?.meta.icon,\r\n\t\t\t\t\t\t\t(icon) => html`<umb-icon name=${icon}></umb-icon>`,\r\n\t\t\t\t\t\t\t() => html`<span>${label}</span>`,\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t<uui-symbol-expand slot=\"extra\" open></uui-symbol-expand>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t`,\r\n\t\t\t\t() => html`\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\tlabel=${label}\r\n\t\t\t\t\t\tlook=${this.isActive ? 'outline' : 'default'}\r\n\t\t\t\t\t\tpopovertarget=\"popover-menu\">\r\n\t\t\t\t\t\t<span>${label}</span>\r\n\t\t\t\t\t\t<uui-symbol-expand slot=\"extra\" open></uui-symbol-expand>\r\n\t\t\t\t\t</uui-button>\r\n\t\t\t\t`,\r\n\t\t\t)}\r\n\t\t\t${this.renderMenu()}\r\n\t\t`;\r\n\t}\r\n\r\n\tprotected renderMenu() {\r\n\t\treturn html`\r\n\t\t\t<umb-cascading-menu-popover id=\"popover-menu\" placement=\"bottom-start\" .items=${this.#menu}>\r\n\t\t\t</umb-cascading-menu-popover>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\t--uui-button-font-weight: normal;\r\n\t\t\t\t--uui-menu-item-flat-structure: 1;\r\n\r\n\t\t\t\tmargin-left: var(--uui-size-space-1);\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-1);\r\n\t\t\t}\r\n\r\n\t\t\tuui-button > uui-symbol-expand {\r\n\t\t\t\tmargin-left: var(--uui-size-space-2);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { UmbTiptapToolbarMenuElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-tiptap-toolbar-menu-element': UmbTiptapToolbarMenuElement;\r\n\t}\r\n}\r\n"],"names":["_menu","_manifest","_UmbTiptapToolbarMenuElement_instances","setMenu_fn","getMenuItems_fn","getMenuItem_fn","isMenuActive_fn","_onEditorUpdate","UmbTiptapToolbarMenuElement","UmbLitElement","__privateAdd","__privateMethod","__privateGet","value","__privateSet","label","html","when","icon","items","menu","item","menuItem","element","css","__decorateClass","state","customElement"],"mappings":"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"}