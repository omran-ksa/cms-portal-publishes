{"version":3,"file":"user-group-collection.repository-C6YjWsl5.js","sources":["../../../src/packages/user/user-group/collection/repository/user-group-collection.server.data-source.ts","../../../src/packages/user/user-group/collection/repository/user-group-collection.repository.ts"],"sourcesContent":["import type { UmbUserGroupCollectionFilterModel } from '../types.js';\r\nimport type { UmbUserGroupDetailModel } from '../../types.js';\r\nimport { UMB_USER_GROUP_ENTITY_TYPE } from '../../entity.js';\r\nimport { UserGroupService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbCollectionDataSource } from '@umbraco-cms/backoffice/collection';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { tryExecute } from '@umbraco-cms/backoffice/resources';\r\n\r\n/**\r\n * A data source for the UserGroup that fetches data from the server\r\n * @class UmbUserGroupCollectionServerDataSource\r\n * @implements {RepositoryDetailDataSource}\r\n */\r\nexport class UmbUserGroupCollectionServerDataSource implements UmbCollectionDataSource<UmbUserGroupDetailModel> {\r\n\t#host: UmbControllerHost;\r\n\r\n\t/**\r\n\t * Creates an instance of UmbUserGroupCollectionServerDataSource.\r\n\t * @param {UmbControllerHost} host - The controller host for this controller to be appended to\r\n\t * @memberof UmbUserGroupCollectionServerDataSource\r\n\t */\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tthis.#host = host;\r\n\t}\r\n\r\n\tasync getCollection(filter: UmbUserGroupCollectionFilterModel) {\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis.#host,\r\n\t\t\tUserGroupService.getFilterUserGroup({ query: { skip: filter.skip, take: filter.take, filter: filter.query } }),\r\n\t\t);\r\n\r\n\t\tif (data) {\r\n\t\t\tconst mappedItems = data.items.map((item) => {\r\n\t\t\t\tconst userGroup: UmbUserGroupDetailModel = {\r\n\t\t\t\t\talias: item.alias,\r\n\t\t\t\t\taliasCanBeChanged: item.aliasCanBeChanged,\r\n\t\t\t\t\tdocumentRootAccess: item.documentRootAccess,\r\n\t\t\t\t\tdocumentStartNode: item.documentStartNode ? { unique: item.documentStartNode.id } : null,\r\n\t\t\t\t\tentityType: UMB_USER_GROUP_ENTITY_TYPE,\r\n\t\t\t\t\tfallbackPermissions: item.fallbackPermissions,\r\n\t\t\t\t\thasAccessToAllLanguages: item.hasAccessToAllLanguages,\r\n\t\t\t\t\ticon: item.icon || null,\r\n\t\t\t\t\tisDeletable: item.isDeletable,\r\n\t\t\t\t\tlanguages: item.languages,\r\n\t\t\t\t\tmediaRootAccess: item.mediaRootAccess,\r\n\t\t\t\t\tmediaStartNode: item.mediaStartNode ? { unique: item.mediaStartNode.id } : null,\r\n\t\t\t\t\tname: item.name,\r\n\t\t\t\t\tpermissions: item.permissions,\r\n\t\t\t\t\tsections: item.sections,\r\n\t\t\t\t\tunique: item.id,\r\n\t\t\t\t};\r\n\t\t\t\treturn userGroup;\r\n\t\t\t});\r\n\r\n\t\t\treturn { data: { items: mappedItems, total: data.total } };\r\n\t\t}\r\n\r\n\t\treturn { error };\r\n\t}\r\n}\r\n","import type { UmbUserGroupDetailModel } from '../../types.js';\r\nimport { UMB_USER_GROUP_DETAIL_STORE_CONTEXT } from '../../repository/index.js';\r\nimport type { UmbUserGroupCollectionFilterModel } from '../types.js';\r\nimport { UmbUserGroupCollectionServerDataSource } from './user-group-collection.server.data-source.js';\r\nimport type { UmbCollectionDataSource, UmbCollectionRepository } from '@umbraco-cms/backoffice/collection';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\n\r\nexport class UmbUserGroupCollectionRepository extends UmbControllerBase implements UmbCollectionRepository {\r\n\t#init;\r\n\r\n\t#detailStore?: typeof UMB_USER_GROUP_DETAIL_STORE_CONTEXT.TYPE;\r\n\t#collectionSource: UmbCollectionDataSource<UmbUserGroupDetailModel>;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t\tthis.#collectionSource = new UmbUserGroupCollectionServerDataSource(this._host);\r\n\r\n\t\tthis.#init = this.consumeContext(UMB_USER_GROUP_DETAIL_STORE_CONTEXT, (instance) => {\r\n\t\t\tthis.#detailStore = instance;\r\n\t\t})\r\n\t\t\t.asPromise({ preventTimeout: true })\r\n\t\t\t// Ignore the error, we can assume that the flow was stopped (asPromise failed), but it does not mean that the consumption was not successful.\r\n\t\t\t.catch(() => undefined);\r\n\t}\r\n\r\n\tasync requestCollection(filter: UmbUserGroupCollectionFilterModel = { skip: 0, take: 100 }) {\r\n\t\tawait this.#init;\r\n\r\n\t\tconst { data, error } = await this.#collectionSource.getCollection(filter);\r\n\r\n\t\tif (data) {\r\n\t\t\tthis.#detailStore?.appendItems(data.items);\r\n\t\t}\r\n\r\n\t\treturn { data, error, asObservable: () => this.#detailStore!.all() };\r\n\t}\r\n}\r\n\r\nexport default UmbUserGroupCollectionRepository;\r\n"],"names":["UmbUserGroupCollectionServerDataSource","#host","host","filter","data","error","tryExecute","UserGroupService","item","UMB_USER_GROUP_ENTITY_TYPE","UmbUserGroupCollectionRepository","UmbControllerBase","#init","#detailStore","#collectionSource","UMB_USER_GROUP_DETAIL_STORE_CONTEXT","instance"],"mappings":";;;;;;;AAaO,MAAMA,EAAmG;AAAA,EAC/GC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,YAAYC,GAAyB;AACpC,SAAKD,KAAQC;AAAA,EAAA;AAAA,EAGd,MAAM,cAAcC,GAA2C;AAC9D,UAAM,EAAE,MAAAC,GAAM,OAAAC,EAAM,IAAI,MAAMC;AAAA,MAC7B,KAAKL;AAAA,MACLM,EAAiB,mBAAmB,EAAE,OAAO,EAAE,MAAMJ,EAAO,MAAM,MAAMA,EAAO,MAAM,QAAQA,EAAO,MAAA,EAAS,CAAA;AAAA,IAC9G;AAEA,WAAIC,IAuBI,EAAE,MAAM,EAAE,OAtBGA,EAAK,MAAM,IAAI,CAACI,OACQ;AAAA,MAC1C,OAAOA,EAAK;AAAA,MACZ,mBAAmBA,EAAK;AAAA,MACxB,oBAAoBA,EAAK;AAAA,MACzB,mBAAmBA,EAAK,oBAAoB,EAAE,QAAQA,EAAK,kBAAkB,OAAO;AAAA,MACpF,YAAYC;AAAA,MACZ,qBAAqBD,EAAK;AAAA,MAC1B,yBAAyBA,EAAK;AAAA,MAC9B,MAAMA,EAAK,QAAQ;AAAA,MACnB,aAAaA,EAAK;AAAA,MAClB,WAAWA,EAAK;AAAA,MAChB,iBAAiBA,EAAK;AAAA,MACtB,gBAAgBA,EAAK,iBAAiB,EAAE,QAAQA,EAAK,eAAe,OAAO;AAAA,MAC3E,MAAMA,EAAK;AAAA,MACX,aAAaA,EAAK;AAAA,MAClB,UAAUA,EAAK;AAAA,MACf,QAAQA,EAAK;AAAA,IACd,EAEA,GAEoC,OAAOJ,EAAK,QAAQ,IAGnD,EAAE,OAAAC,EAAM;AAAA,EAAA;AAEjB;ACnDO,MAAMK,UAAyCC,EAAqD;AAAA,EAC1GC;AAAA,EAEAC;AAAA,EACAC;AAAA,EAEA,YAAYZ,GAAyB;AACpC,UAAMA,CAAI,GACV,KAAKY,KAAoB,IAAId,EAAuC,KAAK,KAAK,GAE9E,KAAKY,KAAQ,KAAK,eAAeG,GAAqC,CAACC,MAAa;AACnF,WAAKH,KAAeG;AAAA,IAAA,CACpB,EACC,UAAU,EAAE,gBAAgB,IAAM,EAElC,MAAM,MAAA;AAAA,KAAe;AAAA,EAAA;AAAA,EAGxB,MAAM,kBAAkBb,IAA4C,EAAE,MAAM,GAAG,MAAM,OAAO;AAC3F,UAAM,KAAKS;AAEL,UAAA,EAAE,MAAAR,GAAM,OAAAC,EAAM,IAAI,MAAM,KAAKS,GAAkB,cAAcX,CAAM;AAEzE,WAAIC,KACE,KAAAS,IAAc,YAAYT,EAAK,KAAK,GAGnC,EAAE,MAAAA,GAAM,OAAAC,GAAO,cAAc,MAAM,KAAKQ,GAAc,MAAM;AAAA,EAAA;AAErE;"}