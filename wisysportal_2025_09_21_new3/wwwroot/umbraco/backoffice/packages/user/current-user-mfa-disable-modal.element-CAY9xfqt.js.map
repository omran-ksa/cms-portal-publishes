{"version":3,"file":"current-user-mfa-disable-modal.element-CAY9xfqt.js","sources":["../../../src/packages/user/current-user/modals/current-user-mfa-disable/current-user-mfa-disable-modal.element.ts"],"sourcesContent":["import { UmbCurrentUserRepository } from '../../repository/index.js';\r\nimport type { UmbCurrentUserMfaDisableModalConfig } from './current-user-mfa-disable-modal.token.js';\r\nimport { UMB_NOTIFICATION_CONTEXT, type UmbNotificationColor } from '@umbraco-cms/backoffice/notification';\r\nimport { css, customElement, html, query, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport type { UUIButtonState } from '@umbraco-cms/backoffice/external/uui';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { isApiError } from '@umbraco-cms/backoffice/resources';\r\n\r\n@customElement('umb-current-user-mfa-disable-modal')\r\nexport class UmbCurrentUserMfaDisableModalElement extends UmbModalBaseElement<\r\n\tUmbCurrentUserMfaDisableModalConfig,\r\n\tnever\r\n> {\r\n\t#currentUserRepository = new UmbCurrentUserRepository(this);\r\n\t#notificationContext?: typeof UMB_NOTIFICATION_CONTEXT.TYPE;\r\n\r\n\t@state()\r\n\t_buttonState?: UUIButtonState;\r\n\r\n\t@query('#code')\r\n\t_codeInput!: HTMLInputElement;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.consumeContext(UMB_NOTIFICATION_CONTEXT, (context) => {\r\n\t\t\tthis.#notificationContext = context;\r\n\t\t});\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this.data) {\r\n\t\t\treturn html`<uui-loader-bar></uui-loader-bar>`;\r\n\t\t}\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-form>\r\n\t\t\t\t<form id=\"authForm\" name=\"authForm\" @submit=${this.#onSubmit} novalidate>\r\n\t\t\t\t\t<umb-body-layout headline=${this.data.displayName}>\r\n\t\t\t\t\t\t<div id=\"main\">\r\n\t\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\t\t<umb-localize key=\"user_2faDisableText\">\r\n\t\t\t\t\t\t\t\t\tIf you wish to disable this two-factor provider, then you must enter the code shown on your\r\n\t\t\t\t\t\t\t\t\tauthentication device:\r\n\t\t\t\t\t\t\t\t</umb-localize>\r\n\t\t\t\t\t\t\t</p>\r\n\r\n\t\t\t\t\t\t\t<uui-form-layout-item class=\"text-center\">\r\n\t\t\t\t\t\t\t\t<uui-label for=\"code\" slot=\"label\" required>\r\n\t\t\t\t\t\t\t\t\t<umb-localize key=\"user_2faCodeInput\"></umb-localize>\r\n\t\t\t\t\t\t\t\t</uui-label>\r\n\t\t\t\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\t\t\t\tid=\"code\"\r\n\t\t\t\t\t\t\t\t\tname=\"code\"\r\n\t\t\t\t\t\t\t\t\ttype=\"text\"\r\n\t\t\t\t\t\t\t\t\tinputmode=\"numeric\"\r\n\t\t\t\t\t\t\t\t\tautocomplete=\"one-time-code\"\r\n\t\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\t\trequired-message=${this.localize.term('general_required')}\r\n\t\t\t\t\t\t\t\t\tlabel=${this.localize.term('user_2faCodeInputHelp')}\r\n\t\t\t\t\t\t\t\t\tplaceholder=${this.localize.term('user_2faCodeInputHelp')}></uui-input>\r\n\t\t\t\t\t\t\t</uui-form-layout-item>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div slot=\"actions\">\r\n\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\ttype=\"button\"\r\n\t\t\t\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\t\t\t\t.label=${this.localize.term('general_close')}\r\n\t\t\t\t\t\t\t\t@click=${this.#close}>\r\n\t\t\t\t\t\t\t\t${this.localize.term('general_close')}\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\t.state=${this._buttonState}\r\n\t\t\t\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\t\t\t.label=${this.localize.term('buttons_save')}>\r\n\t\t\t\t\t\t\t\t${this.localize.term('general_submit')}\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</umb-body-layout>\r\n\t\t\t\t</form>\r\n\t\t\t</uui-form>\r\n\t\t`;\r\n\t}\r\n\r\n\tasync #onSubmit(e: SubmitEvent) {\r\n\t\te.preventDefault();\r\n\r\n\t\tthis._codeInput.setCustomValidity('');\r\n\r\n\t\tif (!this.data) throw new Error('No data provided');\r\n\r\n\t\tconst form = e.target as HTMLFormElement;\r\n\r\n\t\tif (!form.checkValidity()) return;\r\n\r\n\t\tconst formData = new FormData(form);\r\n\t\tconst code = formData.get('code') as string;\r\n\r\n\t\tif (!code) return;\r\n\r\n\t\tthis._buttonState = 'waiting';\r\n\t\tconst { error } = await this.#currentUserRepository.disableMfaProvider(this.data.providerName, code);\r\n\r\n\t\tif (!error) {\r\n\t\t\tthis.#peek(this.localize.term('user_2faProviderIsDisabledMsg', this.data.displayName ?? this.data.providerName));\r\n\t\t\tthis.modalContext?.submit();\r\n\t\t\tthis._buttonState = 'success';\r\n\t\t} else {\r\n\t\t\tthis._buttonState = 'failed';\r\n\t\t\tif (isApiError(error)) {\r\n\t\t\t\tif ((error.body as any).operationStatus === 'InvalidCode') {\r\n\t\t\t\t\tthis._codeInput.setCustomValidity(this.localize.term('user_2faInvalidCode'));\r\n\t\t\t\t\tthis._codeInput.focus();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.#peek(\r\n\t\t\t\t\t\tthis.localize.term('user_2faProviderIsNotDisabledMsg', this.data.displayName ?? this.data.providerName),\r\n\t\t\t\t\t\t'warning',\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.#peek(error.message, 'warning');\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync #close() {\r\n\t\tthis.modalContext?.submit();\r\n\t}\r\n\r\n\tasync #peek(message: string, color?: UmbNotificationColor) {\r\n\t\tthis.#notificationContext?.peek(color ?? 'positive', {\r\n\t\t\tdata: {\r\n\t\t\t\theadline: this.localize.term('member_2fa'),\r\n\t\t\t\tmessage,\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#authForm {\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\r\n\t\t\t#code {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tmax-width: 300px;\r\n\t\t\t}\r\n\r\n\t\t\t.text-center {\r\n\t\t\t\ttext-align: center;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbCurrentUserMfaDisableModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-current-user-mfa-disable-modal': UmbCurrentUserMfaDisableModalElement;\r\n\t}\r\n}\r\n"],"names":["_currentUserRepository","_notificationContext","_UmbCurrentUserMfaDisableModalElement_instances","onSubmit_fn","close_fn","peek_fn","UmbCurrentUserMfaDisableModalElement","UmbModalBaseElement","__privateAdd","UmbCurrentUserRepository","UMB_NOTIFICATION_CONTEXT","context","__privateSet","html","__privateMethod","e","form","code","error","__privateGet","isApiError","message","color","UmbTextStyles","css","__decorateClass","state","query","customElement","UmbCurrentUserMfaDisableModalElement$1"],"mappings":"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"}