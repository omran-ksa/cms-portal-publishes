{"version":3,"file":"user-group-picker-modal.element-CKUTZdo8.js","sources":["../../../src/packages/user/user-group/modals/user-group-picker/user-group-picker-modal.element.ts"],"sourcesContent":["import { UmbUserGroupCollectionRepository } from '../../collection/repository/index.js';\r\nimport type { UmbUserGroupDetailModel } from '../../types.js';\r\nimport type { UMB_USER_GROUP_PICKER_MODAL } from './user-group-picker-modal.token.js';\r\nimport { css, customElement, html, repeat, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { debounce, UmbSelectionManager } from '@umbraco-cms/backoffice/utils';\r\nimport { umbFocus } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbDeselectedEvent, UmbSelectedEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport type { UUIInputEvent, UUIMenuItemEvent } from '@umbraco-cms/backoffice/external/uui';\r\n\r\nimport '../../components/user-group-ref/user-group-ref.element.js';\r\n\r\n@customElement('umb-user-group-picker-modal')\r\nexport class UmbUserGroupPickerModalElement extends UmbModalBaseElement<\r\n\ttypeof UMB_USER_GROUP_PICKER_MODAL.DATA,\r\n\ttypeof UMB_USER_GROUP_PICKER_MODAL.VALUE\r\n> {\r\n\t@state()\r\n\tprivate _filteredItems: Array<UmbUserGroupDetailModel> = [];\r\n\r\n\t@state()\r\n\tprivate _userGroups: Array<UmbUserGroupDetailModel> = [];\r\n\r\n\t#debouncedFilter = debounce((filter: string) => {\r\n\t\tthis._filteredItems = filter\r\n\t\t\t? this._userGroups.filter(\r\n\t\t\t\t\t(userGroup) =>\r\n\t\t\t\t\t\tuserGroup.alias.toLowerCase().includes(filter) || userGroup.name.toLowerCase().includes(filter),\r\n\t\t\t\t)\r\n\t\t\t: this._userGroups;\r\n\t}, 500);\r\n\r\n\t#selectionManager = new UmbSelectionManager(this);\r\n\r\n\t#userGroupCollectionRepository = new UmbUserGroupCollectionRepository(this);\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.#observeUserGroups();\r\n\t}\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\r\n\t\tthis.#selectionManager.setSelectable(true);\r\n\t\tthis.#selectionManager.setMultiple(this.data?.multiple ?? false);\r\n\t\tthis.#selectionManager.setSelection(this.value?.selection ?? []);\r\n\r\n\t\tthis.observe(this.#selectionManager.selection, (selection) => this.updateValue({ selection }), 'selectionObserver');\r\n\t}\r\n\r\n\tasync #observeUserGroups() {\r\n\t\tconst { error, asObservable } = await this.#userGroupCollectionRepository.requestCollection();\r\n\t\tif (error) return;\r\n\r\n\t\tthis.observe(asObservable(), (items) => (this._userGroups = this._filteredItems = items), 'umbUserGroupsObserver');\r\n\t}\r\n\r\n\t#onSelected(event: UUIMenuItemEvent, item: UmbUserGroupDetailModel) {\r\n\t\tif (!item.unique) throw new Error('User group unique is required');\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tthis.#selectionManager.select(item.unique);\r\n\r\n\t\tthis.requestUpdate();\r\n\t\tthis.modalContext?.dispatchEvent(new UmbSelectedEvent(item.unique));\r\n\t}\r\n\r\n\t#onDeselected(event: UUIMenuItemEvent, item: UmbUserGroupDetailModel) {\r\n\t\tif (!item.unique) throw new Error('User group unique is required');\r\n\t\tevent.stopPropagation();\r\n\r\n\t\tthis.#selectionManager.deselect(item.unique);\r\n\r\n\t\tthis.requestUpdate();\r\n\t\tthis.modalContext?.dispatchEvent(new UmbDeselectedEvent(item.unique));\r\n\t}\r\n\r\n\t#onFilterInput(event: UUIInputEvent) {\r\n\t\tconst query = (event.target.value as string) || '';\r\n\t\tthis.#debouncedFilter(query.toLowerCase());\r\n\t}\r\n\r\n\t#onSubmit() {\r\n\t\tthis.updateValue({ selection: this.#selectionManager.getSelection() });\r\n\t\tthis._submitModal();\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=${this.localize.term('user_chooseUserGroup', true)}>\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\ttype=\"search\"\r\n\t\t\t\t\t\tid=\"filter\"\r\n\t\t\t\t\t\tlabel=${this.localize.term('placeholders_filter')}\r\n\t\t\t\t\t\tplaceholder=${this.localize.term('placeholders_filter')}\r\n\t\t\t\t\t\t@input=${this.#onFilterInput}\r\n\t\t\t\t\t\t${umbFocus()}>\r\n\t\t\t\t\t\t<uui-icon name=\"search\" slot=\"prepend\" id=\"filter-icon\"></uui-icon>\r\n\t\t\t\t\t</uui-input>\r\n\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\tthis._filteredItems,\r\n\t\t\t\t\t\t(userGroup) => userGroup.alias,\r\n\t\t\t\t\t\t(userGroup) => html`\r\n\t\t\t\t\t\t\t<umb-user-group-ref\r\n\t\t\t\t\t\t\t\t.name=${userGroup.name}\r\n\t\t\t\t\t\t\t\tselect-only\r\n\t\t\t\t\t\t\t\tselectable\r\n\t\t\t\t\t\t\t\t?selected=${this.#selectionManager.isSelected(userGroup.unique)}\r\n\t\t\t\t\t\t\t\t?documentRootAccess=${userGroup.documentRootAccess}\r\n\t\t\t\t\t\t\t\t.documentStartNode=${!userGroup.documentRootAccess ? userGroup.documentStartNode?.unique : null}\r\n\t\t\t\t\t\t\t\t?mediaRootAccess=${userGroup.mediaRootAccess}\r\n\t\t\t\t\t\t\t\t.mediaStartNode=${!userGroup.mediaRootAccess ? userGroup.mediaStartNode?.unique : null}\r\n\t\t\t\t\t\t\t\t.sections=${userGroup.sections}\r\n\t\t\t\t\t\t\t\t@selected=${(event: UUIMenuItemEvent) => this.#onSelected(event, userGroup)}\r\n\t\t\t\t\t\t\t\t@deselected=${(event: UUIMenuItemEvent) => this.#onDeselected(event, userGroup)}>\r\n\t\t\t\t\t\t\t\t${when(userGroup.icon, () => html`<umb-icon name=${userGroup.icon!} slot=\"icon\"></umb-icon>`)}\r\n\t\t\t\t\t\t\t</umb-user-group-ref>\r\n\t\t\t\t\t\t`,\r\n\t\t\t\t\t)}\r\n\t\t\t\t</uui-box>\r\n\t\t\t\t<div slot=\"actions\">\r\n\t\t\t\t\t<uui-button label=${this.localize.term('general_cancel')} @click=${this._rejectModal}></uui-button>\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlabel=${this.localize.term('buttons_choose')}\r\n\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\t@click=${this.#onSubmit}></uui-button>\r\n\t\t\t\t</div>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t#filter {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tmargin-bottom: var(--uui-size-space-4);\r\n\t\t\t}\r\n\r\n\t\t\t#filter-icon {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tcolor: var(--uui-color-border);\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tpadding-left: var(--uui-size-space-2);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbUserGroupPickerModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-user-group-picker-modal': UmbUserGroupPickerModalElement;\r\n\t}\r\n}\r\n"],"names":["_debouncedFilter","_selectionManager","_userGroupCollectionRepository","_UmbUserGroupPickerModalElement_instances","observeUserGroups_fn","onSelected_fn","onDeselected_fn","onFilterInput_fn","onSubmit_fn","UmbUserGroupPickerModalElement","UmbModalBaseElement","__privateAdd","debounce","filter","userGroup","UmbSelectionManager","UmbUserGroupCollectionRepository","__privateMethod","__privateGet","selection","html","umbFocus","repeat","event","when","error","asObservable","items","item","UmbSelectedEvent","UmbDeselectedEvent","query","css","__decorateClass","state","customElement","UmbUserGroupPickerModalElement$1"],"mappings":"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"}