{"version":3,"file":"create-user-client-credential-modal.element-dHFt3WUs.js","sources":["../../../src/packages/user/user/client-credential/create/modal/create-user-client-credential-modal.element.ts"],"sourcesContent":["import type { UmbCreateUserClientCredentialRequestArgs } from '../../repository/index.js';\r\nimport { UmbUserClientCredentialRepository } from '../../repository/index.js';\r\nimport type {\r\n\tUmbCreateUserClientCredentialModalData,\r\n\tUmbCreateUserClientCredentialModalValue,\r\n} from './create-user-client-credential-modal.token.js';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { css, html, customElement, query } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport type { UUIInputElement } from '@umbraco-cms/backoffice/external/uui';\r\n\r\nconst elementName = 'umb-create-user-client-credential-modal';\r\n@customElement(elementName)\r\nexport class UmbCreateUserModalElement extends UmbModalBaseElement<\r\n\tUmbCreateUserClientCredentialModalData,\r\n\tUmbCreateUserClientCredentialModalValue\r\n> {\r\n\t@query('#CreateUserClientCredentialForm')\r\n\t_form?: HTMLFormElement;\r\n\r\n\t@query('#unique')\r\n\t_inputUniqueElement?: UUIInputElement;\r\n\r\n\t#userClientCredentialRepository = new UmbUserClientCredentialRepository(this);\r\n\r\n\t#uniquePrefix = 'umbraco-back-office-';\r\n\r\n\tprotected override firstUpdated(): void {\r\n\t\t// For some reason the pattern attribute is not working with this specific regex. It complains about the regex is invalid.\r\n\t\t// TODO: investigate why this is happening.\r\n\t\tthis._inputUniqueElement?.addValidator(\r\n\t\t\t'patternMismatch',\r\n\t\t\t() => 'Only alphanumeric characters and hyphens are allowed',\r\n\t\t\t() => {\r\n\t\t\t\tconst value = (this._inputUniqueElement?.value as string) || '';\r\n\t\t\t\t// eslint-disable-next-line no-useless-escape\r\n\t\t\t\treturn !new RegExp(/^[a-zA-Z0-9\\-]+$/).test(value);\r\n\t\t\t},\r\n\t\t);\r\n\t}\r\n\r\n\tasync #onSubmit(e: SubmitEvent) {\r\n\t\te.preventDefault();\r\n\r\n\t\tif (this.data?.user?.unique === undefined) throw new Error('User unique is required');\r\n\r\n\t\tconst form = e.target as HTMLFormElement;\r\n\t\tif (!form) return;\r\n\r\n\t\tconst isValid = form.checkValidity();\r\n\t\tif (!isValid) return;\r\n\r\n\t\tconst formData = new FormData(form);\r\n\r\n\t\tconst unique = formData.get('unique') as string;\r\n\t\tconst secret = formData.get('secret') as string;\r\n\r\n\t\tconst payload: UmbCreateUserClientCredentialRequestArgs = {\r\n\t\t\tuser: { unique: this.data.user.unique },\r\n\t\t\tclient: { unique, secret },\r\n\t\t};\r\n\r\n\t\t// TODO: figure out when to use email or username\r\n\t\tconst { data } = await this.#userClientCredentialRepository.requestCreate(payload);\r\n\r\n\t\tif (data) {\r\n\t\t\tthis.updateValue({ client: { unique: data.unique, secret } });\r\n\t\t\tthis._submitModal();\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`<uui-dialog-layout headline=\"Create client credential\">\r\n\t\t\t${this.#renderForm()}\r\n\t\t\t<uui-button @click=${this._rejectModal} slot=\"actions\" label=\"Cancel\" look=\"secondary\"></uui-button>\r\n\t\t\t<uui-button\r\n\t\t\t\tform=\"CreateUserClientCredentialForm\"\r\n\t\t\t\tslot=\"actions\"\r\n\t\t\t\ttype=\"submit\"\r\n\t\t\t\tlabel=\"Create\"\r\n\t\t\t\tlook=\"primary\"\r\n\t\t\t\tcolor=\"positive\"></uui-button>\r\n\t\t</uui-dialog-layout>`;\r\n\t}\r\n\r\n\t#renderForm() {\r\n\t\treturn html` <uui-form>\r\n\t\t\t<form id=\"CreateUserClientCredentialForm\" name=\"form\" @submit=\"${this.#onSubmit}\">\r\n\t\t\t\t<uui-form-layout-item>\r\n\t\t\t\t\t<uui-label id=\"uniqueLabel\" slot=\"label\" for=\"unique\" required>Id</uui-label>\r\n\t\t\t\t\t<uui-input id=\"unique\" label=\"unique\" type=\"text\" name=\"unique\" required>\r\n\t\t\t\t\t\t<div class=\"prepend\" slot=\"prepend\">${this.#uniquePrefix}</div>\r\n\t\t\t\t\t</uui-input>\r\n\t\t\t\t</uui-form-layout-item>\r\n\r\n\t\t\t\t<uui-form-layout-item>\r\n\t\t\t\t\t<div slot=\"description\">The secret cannot be retrieved again.</div>\r\n\t\t\t\t\t<uui-label id=\"secretLabel\" slot=\"label\" for=\"secret\" required>Secret</uui-label>\r\n\t\t\t\t\t<uui-input-password id=\"secret\" label=\"secret\" name=\"secret\" required></uui-input-password>\r\n\t\t\t\t</uui-form-layout-item>\r\n\t\t\t</form>\r\n\t\t</uui-form>`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\tuui-input,\r\n\t\t\tuui-input-password {\r\n\t\t\t\twidth: 580px;\r\n\t\t\t}\r\n\r\n\t\t\t.prepend {\r\n\t\t\t\tuser-select: none;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\tpadding: 0 var(--uui-size-3);\r\n\t\t\t\tborder-right: 1px solid var(--uui-input-border-color, var(--uui-color-border));\r\n\t\t\t\tbackground: #f3f3f3;\r\n\t\t\t\tcolor: grey;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tjustify-content: center;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\twhite-space: nowrap;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport { UmbCreateUserModalElement as element };\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t[elementName]: UmbCreateUserModalElement;\r\n\t}\r\n}\r\n"],"names":["_userClientCredentialRepository","_uniquePrefix","_UmbCreateUserModalElement_instances","onSubmit_fn","renderForm_fn","elementName","UmbCreateUserModalElement","UmbModalBaseElement","__privateAdd","UmbUserClientCredentialRepository","value","html","__privateMethod","form","formData","unique","secret","payload","data","__privateGet","UmbTextStyles","css","__decorateClass","query","customElement"],"mappings":";;;;;;;;;;+TAAAA,GAAAC,GAAAC,GAAAC,GAAAC;AAWA,MAAMC,IAAc;AAEP,IAAAC,IAAN,cAAwCC,EAG7C;AAAA,EAHK,cAAA;AAAA,UAAA,GAAA,SAAA,GAAAC,EAAA,MAAAN,CAAA,GAU4BM,EAAA,MAAAR,GAAA,IAAIS,EAAkC,IAAI,CAAA,GAE5DD,EAAA,MAAAP,GAAA,sBAAA;AAAA,EAAA;AAAA,EAEG,eAAqB;AAGvC,SAAK,qBAAqB;AAAA,MACzB;AAAA,MACA,MAAM;AAAA,MACN,MAAM;AACC,cAAAS,IAAS,KAAK,qBAAqB,SAAoB;AAE7D,eAAO,CAAC,IAAI,OAAO,kBAAkB,EAAE,KAAKA,CAAK;AAAA,MAAA;AAAA,IAEnD;AAAA,EAAA;AAAA,EAiCQ,SAAS;AACV,WAAAC;AAAA,KACJC,EAAA,MAAKV,MAAL,KAAkB,IAAA,CAAA;AAAA,wBACC,KAAK,YAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAAA;AAoDzC;AAvGCF,IAAA,oBAAA,QAAA;AAEAC,IAAA,oBAAA,QAAA;AAZMC,IAAA,oBAAA,QAAA;AA4BAC,IAAS,eAAC,GAAgB;AAG3B,MAFJ,EAAE,eAAe,GAEb,KAAK,MAAM,MAAM,WAAW,OAAiB,OAAA,IAAI,MAAM,yBAAyB;AAEpF,QAAMU,IAAO,EAAE;AAIf,MAHI,CAACA,KAGD,CADYA,EAAK,cAAc,EACrB;AAER,QAAAC,IAAW,IAAI,SAASD,CAAI,GAE5BE,IAASD,EAAS,IAAI,QAAQ,GAC9BE,IAASF,EAAS,IAAI,QAAQ,GAE9BG,IAAoD;AAAA,IACzD,MAAM,EAAE,QAAQ,KAAK,KAAK,KAAK,OAAO;AAAA,IACtC,QAAQ,EAAE,QAAAF,GAAQ,QAAAC,EAAO;AAAA,EAC1B,GAGM,EAAE,MAAAE,EAAK,IAAI,MAAMC,EAAK,MAAAnB,CAAA,EAAgC,cAAciB,CAAO;AAEjF,EAAIC,MACE,KAAA,YAAY,EAAE,QAAQ,EAAE,QAAQA,EAAK,QAAQ,QAAAF,EAAO,GAAG,GAC5D,KAAK,aAAa;AAEpB;AAgBAZ,IAAW,WAAG;AACN,SAAAO;AAAA,oEAC2DC,QAAKV,GAASC,CAAA,CAAA;AAAA;AAAA;AAAA;AAAA,4CAItCgB,QAAKlB,CAAa,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAW7D;AAzFYK,EA2FI,SAAS;AAAA,EACxBc;AAAA,EACAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAmBD;AA3GAC,EAAA;AAAA,EADCC,EAAM,iCAAiC;AAAA,GAJ5BjB,EAKZ,WAAA,SAAA,CAAA;AAGAgB,EAAA;AAAA,EADCC,EAAM,SAAS;AAAA,GAPJjB,EAQZ,WAAA,uBAAA,CAAA;AARYA,IAANgB,EAAA;AAAA,EADNE,EAAcnB,CAAW;AAAA,GACbC,CAAA;"}