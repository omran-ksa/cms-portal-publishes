{"version":3,"file":"change-password-modal.element-zsst8ztQ.js","sources":["../../../src/packages/user/change-password/modal/change-password-modal.element.ts"],"sourcesContent":["import type { UmbChangePasswordModalData, UmbChangePasswordModalValue } from './change-password-modal.token.js';\r\nimport { css, customElement, html, query, state, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbUserItemRepository } from '@umbraco-cms/backoffice/user';\r\nimport { UMB_CURRENT_USER_CONTEXT } from '@umbraco-cms/backoffice/current-user';\r\nimport type { UUIInputPasswordElement } from '@umbraco-cms/backoffice/external/uui';\r\n\r\n@customElement('umb-change-password-modal')\r\nexport class UmbChangePasswordModalElement extends UmbModalBaseElement<\r\n\tUmbChangePasswordModalData,\r\n\tUmbChangePasswordModalValue\r\n> {\r\n\t@query('#newPassword')\r\n\tprivate _newPasswordInput?: UUIInputPasswordElement;\r\n\r\n\t@query('#confirmPassword')\r\n\tprivate _confirmPasswordInput?: UUIInputPasswordElement;\r\n\r\n\t@state()\r\n\tprivate _headline: string = this.localize.term('general_changePassword');\r\n\r\n\t@state()\r\n\tprivate _isCurrentUser: boolean = false;\r\n\r\n\t#userItemRepository = new UmbUserItemRepository(this);\r\n\t#currentUserContext?: typeof UMB_CURRENT_USER_CONTEXT.TYPE;\r\n\r\n\t#onClose() {\r\n\t\tthis.modalContext?.reject();\r\n\t}\r\n\r\n\t#onSubmit(e: SubmitEvent) {\r\n\t\te.preventDefault();\r\n\r\n\t\tconst form = e.target as HTMLFormElement;\r\n\t\tif (!form) return;\r\n\r\n\t\tconst isValid = form.checkValidity();\r\n\t\tif (!isValid) return;\r\n\r\n\t\tconst formData = new FormData(form);\r\n\r\n\t\tconst oldPassword = formData.get('oldPassword') as string;\r\n\t\tconst newPassword = formData.get('newPassword') as string;\r\n\r\n\t\tthis.value = { oldPassword, newPassword };\r\n\t\tthis.modalContext?.submit();\r\n\t}\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_CURRENT_USER_CONTEXT, (instance) => {\r\n\t\t\tthis.#currentUserContext = instance;\r\n\t\t\tthis.#setIsCurrentUser();\r\n\t\t});\r\n\t}\r\n\r\n\tasync #setIsCurrentUser() {\r\n\t\tif (!this.#currentUserContext || !this.data?.user.unique) {\r\n\t\t\tthis._isCurrentUser = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis._isCurrentUser = await this.#currentUserContext.isUserCurrentUser(this.data.user.unique);\r\n\t}\r\n\r\n\tprotected override async firstUpdated() {\r\n\t\tthis._confirmPasswordInput?.addValidator(\r\n\t\t\t'customError',\r\n\t\t\t() => this.localize.term('user_passwordMismatch'),\r\n\t\t\t() => this._confirmPasswordInput?.value !== this._newPasswordInput?.value,\r\n\t\t);\r\n\r\n\t\tif (!this.data?.user.unique) return;\r\n\t\tconst { data } = await this.#userItemRepository.requestItems([this.data.user.unique]);\r\n\r\n\t\tif (data) {\r\n\t\t\tconst userName = data[0].name;\r\n\t\t\tthis._headline = `Change password for ${userName}`;\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<uui-dialog-layout class=\"uui-text\" headline=${this._headline}>\r\n\t\t\t\t<uui-form>\r\n\t\t\t\t\t<form id=\"ChangePasswordForm\" @submit=${this.#onSubmit}>\r\n\t\t\t\t\t\t${when(\r\n\t\t\t\t\t\t\tthis._isCurrentUser,\r\n\t\t\t\t\t\t\t() => html`\r\n\t\t\t\t\t\t\t\t<uui-form-layout-item style=\"margin-bottom: var(--uui-size-layout-2)\">\r\n\t\t\t\t\t\t\t\t\t<uui-label slot=\"label\" id=\"oldPasswordLabel\" for=\"oldPassword\" required>\r\n\t\t\t\t\t\t\t\t\t\t<umb-localize key=\"user_passwordCurrent\">Current password</umb-localize>\r\n\t\t\t\t\t\t\t\t\t</uui-label>\r\n\t\t\t\t\t\t\t\t\t<uui-input-password\r\n\t\t\t\t\t\t\t\t\t\tid=\"oldPassword\"\r\n\t\t\t\t\t\t\t\t\t\tname=\"oldPassword\"\r\n\t\t\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\t\t\trequired-message=\"Current password is required\">\r\n\t\t\t\t\t\t\t\t\t</uui-input-password>\r\n\t\t\t\t\t\t\t\t</uui-form-layout-item>\r\n\t\t\t\t\t\t\t`,\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t<uui-form-layout-item>\r\n\t\t\t\t\t\t\t<uui-label slot=\"label\" id=\"newPasswordLabel\" for=\"newPassword\" required>\r\n\t\t\t\t\t\t\t\t<umb-localize key=\"user_newPassword\">New password</umb-localize>\r\n\t\t\t\t\t\t\t</uui-label>\r\n\t\t\t\t\t\t\t<uui-input-password\r\n\t\t\t\t\t\t\t\tid=\"newPassword\"\r\n\t\t\t\t\t\t\t\tname=\"newPassword\"\r\n\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\trequired-message=\"New password is required\">\r\n\t\t\t\t\t\t\t</uui-input-password>\r\n\t\t\t\t\t\t</uui-form-layout-item>\r\n\t\t\t\t\t\t<uui-form-layout-item>\r\n\t\t\t\t\t\t\t<uui-label slot=\"label\" id=\"confirmPasswordLabel\" for=\"confirmPassword\" required>\r\n\t\t\t\t\t\t\t\t<umb-localize key=\"user_confirmNewPassword\">Confirm new password</umb-localize>\r\n\t\t\t\t\t\t\t</uui-label>\r\n\t\t\t\t\t\t\t<uui-input-password\r\n\t\t\t\t\t\t\t\tid=\"confirmPassword\"\r\n\t\t\t\t\t\t\t\tname=\"confirmPassword\"\r\n\t\t\t\t\t\t\t\trequired\r\n\t\t\t\t\t\t\t\trequired-message=\"Confirm password is required\">\r\n\t\t\t\t\t\t\t</uui-input-password>\r\n\t\t\t\t\t\t</uui-form-layout-item>\r\n\t\t\t\t\t</form>\r\n\t\t\t\t</uui-form>\r\n\t\t\t\t<uui-button slot=\"actions\" label=${this.localize.term('general_cancel')} @click=${this.#onClose}></uui-button>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\ttype=\"submit\"\r\n\t\t\t\t\tform=\"ChangePasswordForm\"\r\n\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\tlabel=${this.localize.term('general_confirm')}></uui-button>\r\n\t\t\t</uui-dialog-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override readonly styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\tuui-input-password {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbChangePasswordModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-change-password-modal': UmbChangePasswordModalElement;\r\n\t}\r\n}\r\n"],"names":["_userItemRepository","_currentUserContext","_UmbChangePasswordModalElement_instances","onClose_fn","onSubmit_fn","setIsCurrentUser_fn","UmbChangePasswordModalElement","UmbModalBaseElement","__privateAdd","UmbUserItemRepository","UMB_CURRENT_USER_CONTEXT","instance","__privateSet","__privateMethod","data","__privateGet","userName","html","when","form","formData","oldPassword","newPassword","UmbTextStyles","css","__decorateClass","query","state","customElement","UmbChangePasswordModalElement$1"],"mappings":"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"}