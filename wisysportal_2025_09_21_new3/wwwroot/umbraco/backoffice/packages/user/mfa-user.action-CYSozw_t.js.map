{"version":3,"file":"mfa-user.action-CYSozw_t.js","sources":["../../../src/packages/user/user/entity-actions/mfa/mfa-user.action.ts"],"sourcesContent":["import { UMB_USER_MFA_MODAL } from '../../modals/user-mfa/user-mfa-modal.token.js';\r\nimport { UMB_CURRENT_USER_MFA_MODAL } from '../../../current-user/modals/current-user-mfa/current-user-mfa-modal.token.js';\r\nimport type { UmbEntityActionArgs } from '@umbraco-cms/backoffice/entity-action';\r\nimport { UmbEntityActionBase } from '@umbraco-cms/backoffice/entity-action';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UMB_CURRENT_USER_CONTEXT } from '@umbraco-cms/backoffice/current-user';\r\nimport { firstValueFrom } from '@umbraco-cms/backoffice/external/rxjs';\r\nimport { umbOpenModal } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport class UmbMfaUserEntityAction extends UmbEntityActionBase<never> {\r\n\tconstructor(host: UmbControllerHost, args: UmbEntityActionArgs<never>) {\r\n\t\tsuper(host, args);\r\n\t}\r\n\r\n\toverride async execute() {\r\n\t\tconst { unique } = this.args;\r\n\t\tif (!unique) throw new Error('Unique is not available');\r\n\r\n\t\tconst currentUserContext = await this.getContext(UMB_CURRENT_USER_CONTEXT);\r\n\t\tif (!currentUserContext) throw new Error('Current user context not found');\r\n\t\tconst currentUserModel = await firstValueFrom(currentUserContext.currentUser);\r\n\r\n\t\tif (!currentUserModel) throw new Error('Current user is not available');\r\n\r\n\t\t// If you clicked on yourself, we can just use the current user modal\r\n\t\tif (currentUserModel.unique === unique) {\r\n\t\t\tawait umbOpenModal(this, UMB_CURRENT_USER_MFA_MODAL).catch(() => undefined);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Otherwise we will show the generic mfa modal\r\n\t\tawait umbOpenModal(this, UMB_USER_MFA_MODAL, {\r\n\t\t\tdata: { unique },\r\n\t\t}).catch(() => undefined);\r\n\t}\r\n}\r\n\r\nexport { UmbMfaUserEntityAction as api };\r\n"],"names":["UmbMfaUserEntityAction","UmbEntityActionBase","host","args","unique","currentUserContext","UMB_CURRENT_USER_CONTEXT","currentUserModel","firstValueFrom","umbOpenModal","UMB_CURRENT_USER_MFA_MODAL","UMB_USER_MFA_MODAL"],"mappings":";;;;;;AASO,MAAMA,UAA+BC,EAA2B;AAAA,EACtE,YAAYC,GAAyBC,GAAkC;AACtE,UAAMD,GAAMC,CAAI;AAAA,EAAA;AAAA,EAGjB,MAAe,UAAU;AAClB,UAAA,EAAE,QAAAC,MAAW,KAAK;AACxB,QAAI,CAACA,EAAc,OAAA,IAAI,MAAM,yBAAyB;AAEtD,UAAMC,IAAqB,MAAM,KAAK,WAAWC,CAAwB;AACzE,QAAI,CAACD,EAA0B,OAAA,IAAI,MAAM,gCAAgC;AACzE,UAAME,IAAmB,MAAMC,EAAeH,EAAmB,WAAW;AAE5E,QAAI,CAACE,EAAwB,OAAA,IAAI,MAAM,+BAA+B;AAGlE,QAAAA,EAAiB,WAAWH,GAAQ;AACvC,YAAMK,EAAa,MAAMC,CAA0B,EAAE,MAAM,MAAM;AAAA,OAAS;AAC1E;AAAA,IAAA;AAIK,UAAAD,EAAa,MAAME,GAAoB;AAAA,MAC5C,MAAM,EAAE,QAAAP,EAAO;AAAA,IAAA,CACf,EAAE,MAAM,MAAA;AAAA,KAAe;AAAA,EAAA;AAE1B;"}