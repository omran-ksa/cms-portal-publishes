{"version":3,"file":"input-document-granular-user-permission.element-CqyduZOV.js","sources":["../../../src/packages/documents/documents/user-permissions/document/input-document-granular-user-permission/input-document-granular-user-permission.element.ts"],"sourcesContent":["import type { UmbDocumentUserPermissionModel } from '../types.js';\r\nimport { UmbDocumentItemRepository } from '../../../item/index.js';\r\nimport type { UmbDocumentItemModel } from '../../../item/types.js';\r\nimport { UMB_DOCUMENT_PICKER_MODAL } from '../../../constants.js';\r\nimport { css, customElement, html, property, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { UmbModalManagerContext } from '@umbraco-cms/backoffice/modal';\r\nimport { UMB_MODAL_MANAGER_CONTEXT } from '@umbraco-cms/backoffice/modal';\r\nimport type { UmbDeselectedEvent } from '@umbraco-cms/backoffice/event';\r\nimport { UmbChangeEvent, UmbSelectedEvent } from '@umbraco-cms/backoffice/event';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport { UUIFormControlMixin } from '@umbraco-cms/backoffice/external/uui';\r\nimport {\r\n\tUMB_ENTITY_USER_PERMISSION_MODAL,\r\n\ttype ManifestEntityUserPermission,\r\n} from '@umbraco-cms/backoffice/user-permission';\r\n\r\n@customElement('umb-input-document-granular-user-permission')\r\nexport class UmbInputDocumentGranularUserPermissionElement extends UUIFormControlMixin(UmbLitElement, '') {\r\n\t_permissions: Array<UmbDocumentUserPermissionModel> = [];\r\n\tpublic get permissions(): Array<UmbDocumentUserPermissionModel> {\r\n\t\treturn this._permissions;\r\n\t}\r\n\tpublic set permissions(value: Array<UmbDocumentUserPermissionModel>) {\r\n\t\tthis._permissions = value;\r\n\t\tconst uniques = value.map((item) => item.document.id);\r\n\t\tthis.#observePickedDocuments(uniques);\r\n\t}\r\n\r\n\t@property({ type: Array, attribute: false })\r\n\tfallbackPermissions: Array<string> = [];\r\n\r\n\t@state()\r\n\tprivate _items?: Array<UmbDocumentItemModel>;\r\n\r\n\t#documentItemRepository = new UmbDocumentItemRepository(this);\r\n\t#modalManagerContext?: UmbModalManagerContext;\r\n\t#documentPickerModalContext?: any;\r\n\t#entityUserPermissionModalContext?: any;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_MODAL_MANAGER_CONTEXT, (instance) => (this.#modalManagerContext = instance));\r\n\t}\r\n\r\n\tprotected override getFormElement() {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\tasync #observePickedDocuments(uniques: Array<string>) {\r\n\t\tconst { asObservable } = await this.#documentItemRepository.requestItems(uniques);\r\n\t\tthis.observe(asObservable?.(), (items) => (this._items = items), 'observeItems');\r\n\t}\r\n\r\n\tasync #editGranularPermission(item: UmbDocumentItemModel) {\r\n\t\tconst currentPermissionVerbs = this.#getPermissionForDocument(item.unique)?.verbs ?? [];\r\n\t\tconst result = await this.#selectEntityUserPermissionsForDocument(item, currentPermissionVerbs);\r\n\t\t// don't do anything if the verbs have not been updated\r\n\t\tif (JSON.stringify(result) === JSON.stringify(currentPermissionVerbs)) return;\r\n\r\n\t\t// update permission with new verbs\r\n\t\tthis.permissions = this._permissions.map((permission) => {\r\n\t\t\tif (permission.document.id === item.unique) {\r\n\t\t\t\treturn {\r\n\t\t\t\t\t...permission,\r\n\t\t\t\t\tverbs: result,\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t\treturn permission;\r\n\t\t});\r\n\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\tasync #addGranularPermission() {\r\n\t\tthis.#documentPickerModalContext = this.#modalManagerContext?.open(this, UMB_DOCUMENT_PICKER_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\thideTreeRoot: true,\r\n\t\t\t\t// prevent already selected items to be picked again\r\n\t\t\t\t// TODO: this type is wrong. It should be the tree item type\r\n\t\t\t\tpickableFilter: (treeItem: UmbDocumentItemModel) =>\r\n\t\t\t\t\t!this._items?.map((i) => i.unique).includes(treeItem.unique),\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis.#documentPickerModalContext?.addEventListener(UmbSelectedEvent.TYPE, async (event: UmbDeselectedEvent) => {\r\n\t\t\tconst selectedEvent = event as UmbSelectedEvent;\r\n\t\t\tconst unique = selectedEvent.unique;\r\n\t\t\tif (!unique) return;\r\n\r\n\t\t\tconst documentItem = await this.#requestDocumentItem(unique);\r\n\r\n\t\t\tthis.#selectEntityUserPermissionsForDocument(documentItem).then(\r\n\t\t\t\t(result) => {\r\n\t\t\t\t\tthis.#documentPickerModalContext?.reject();\r\n\r\n\t\t\t\t\tconst permissionItem: UmbDocumentUserPermissionModel = {\r\n\t\t\t\t\t\t$type: 'DocumentPermissionPresentationModel',\r\n\t\t\t\t\t\tdocument: { id: unique },\r\n\t\t\t\t\t\tverbs: result,\r\n\t\t\t\t\t};\r\n\r\n\t\t\t\t\tthis.permissions = [...this._permissions, permissionItem];\r\n\t\t\t\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t\t\t\t},\r\n\t\t\t\t() => {\r\n\t\t\t\t\tthis.#documentPickerModalContext?.reject();\r\n\t\t\t\t},\r\n\t\t\t);\r\n\t\t});\r\n\t}\r\n\r\n\tasync #requestDocumentItem(unique: string) {\r\n\t\tif (!unique) throw new Error('Could not open permissions modal, no unique was provided');\r\n\r\n\t\tconst { data } = await this.#documentItemRepository.requestItems([unique]);\r\n\r\n\t\tconst documentItem = data?.[0];\r\n\t\tif (!documentItem) throw new Error('No document item found');\r\n\t\treturn documentItem;\r\n\t}\r\n\r\n\tasync #selectEntityUserPermissionsForDocument(item: UmbDocumentItemModel, allowedVerbs: Array<string> = []) {\r\n\t\t// TODO: get correct variant name\r\n\t\tconst name = item.variants[0]?.name;\r\n\t\tconst headline = name ? `Permissions for ${name}` : 'Permissions';\r\n\t\tconst fallbackVerbs = this.#getFallbackPermissionVerbsForEntityType(item.entityType);\r\n\t\tconst value = allowedVerbs.length > 0 ? { allowedVerbs } : undefined;\r\n\t\tthis.#entityUserPermissionModalContext = this.#modalManagerContext?.open(this, UMB_ENTITY_USER_PERMISSION_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\tunique: item.unique,\r\n\t\t\t\tentityType: item.entityType,\r\n\t\t\t\theadline,\r\n\t\t\t\tpreset: {\r\n\t\t\t\t\tallowedVerbs: fallbackVerbs,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tvalue,\r\n\t\t});\r\n\r\n\t\ttry {\r\n\t\t\t// When the modal is submitted we return the new value from the modal\r\n\t\t\tconst value = await this.#entityUserPermissionModalContext?.onSubmit();\r\n\t\t\treturn value?.allowedVerbs;\r\n\t\t} catch {\r\n\t\t\t// When the modal is rejected we return the current value\r\n\t\t\treturn allowedVerbs;\r\n\t\t}\r\n\t}\r\n\r\n\t#removeGranularPermission(item: UmbDocumentItemModel) {\r\n\t\tconst permission = this.#getPermissionForDocument(item.unique);\r\n\t\tif (!permission) return;\r\n\r\n\t\tthis.permissions = this._permissions.filter((v) => JSON.stringify(v) !== JSON.stringify(permission));\r\n\t\tthis.dispatchEvent(new UmbChangeEvent());\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`${this.#renderItems()} ${this.#renderAddButton()}`;\r\n\t}\r\n\r\n\t#renderItems() {\r\n\t\tif (!this._items) return;\r\n\t\treturn html`\r\n\t\t\t<uui-ref-list>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._items,\r\n\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t(item) => this.#renderRef(item),\r\n\t\t\t\t)}\r\n\t\t\t</uui-ref-list>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderAddButton() {\r\n\t\treturn html`<uui-button\r\n\t\t\tid=\"btn-add\"\r\n\t\t\tlook=\"placeholder\"\r\n\t\t\t@click=${this.#addGranularPermission}\r\n\t\t\tlabel=${this.localize.term('general_add')}></uui-button>`;\r\n\t}\r\n\r\n\t#renderRef(item: UmbDocumentItemModel) {\r\n\t\tif (!item.unique) return;\r\n\t\t// TODO: get correct variant name\r\n\t\tconst name = item.variants[0]?.name;\r\n\t\tconst permissionNames = this.#getPermissionNamesForDocument(item.unique);\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-ref-node .name=${name} .detail=${permissionNames || ''}>\r\n\t\t\t\t${this.#renderIcon(item)} ${this.#renderIsTrashed(item)}\r\n\t\t\t\t<uui-action-bar slot=\"actions\">\r\n\t\t\t\t\t${this.#renderEditButton(item)} ${this.#renderRemoveButton(item)}\r\n\t\t\t\t</uui-action-bar>\r\n\t\t\t</uui-ref-node>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderIcon(item: UmbDocumentItemModel) {\r\n\t\tif (!item.documentType.icon) return;\r\n\t\treturn html`<uui-icon slot=\"icon\" name=${item.documentType.icon}></uui-icon>`;\r\n\t}\r\n\r\n\t#renderIsTrashed(item: UmbDocumentItemModel) {\r\n\t\tif (!item.isTrashed) return;\r\n\t\treturn html`<uui-tag size=\"s\" slot=\"tag\" color=\"danger\">Trashed</uui-tag>`;\r\n\t}\r\n\r\n\t#renderEditButton(item: UmbDocumentItemModel) {\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\t@click=${() => this.#editGranularPermission(item)}\r\n\t\t\t\tlabel=${this.localize.term('general_edit')}></uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderRemoveButton(item: UmbDocumentItemModel) {\r\n\t\treturn html`<uui-button\r\n\t\t\t@click=${() => this.#removeGranularPermission(item)}\r\n\t\t\tlabel=${this.localize.term('general_remove')}></uui-button>`;\r\n\t}\r\n\r\n\t#getPermissionForDocument(unique: string) {\r\n\t\treturn this._permissions?.find((permission) => permission.document.id === unique);\r\n\t}\r\n\r\n\t#getPermissionNamesForDocument(unique: string) {\r\n\t\tconst permission = this.#getPermissionForDocument(unique);\r\n\t\tif (!permission) return;\r\n\r\n\t\treturn umbExtensionsRegistry\r\n\t\t\t.getByTypeAndFilter('entityUserPermission', (manifest) =>\r\n\t\t\t\tmanifest.meta.verbs.every((verb) => permission.verbs.includes(verb)),\r\n\t\t\t)\r\n\t\t\t.map((m) => {\r\n\t\t\t\tconst manifest = m as ManifestEntityUserPermission;\r\n\t\t\t\treturn manifest.meta.label ? this.localize.string(manifest.meta.label) : manifest.name;\r\n\t\t\t})\r\n\t\t\t.join(', ');\r\n\t}\r\n\r\n\t#getFallbackPermissionVerbsForEntityType(entityType: string) {\r\n\t\t// get all permissions that are allowed for the entity type and have at least one of the fallback permissions\r\n\t\t// this is used to determine the default permissions for a document\r\n\t\tconst verbs = umbExtensionsRegistry\r\n\t\t\t.getByTypeAndFilter(\r\n\t\t\t\t'entityUserPermission',\r\n\t\t\t\t(manifest) =>\r\n\t\t\t\t\tmanifest.forEntityTypes.includes(entityType) &&\r\n\t\t\t\t\tthis.fallbackPermissions.map((verb) => manifest.meta.verbs.includes(verb)).includes(true),\r\n\t\t\t)\r\n\t\t\t.flatMap((permission) => permission.meta.verbs);\r\n\r\n\t\t// ensure that the verbs are unique\r\n\t\treturn [...new Set([...verbs])];\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t#btn-add {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbInputDocumentGranularUserPermissionElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-granular-user-permission': UmbInputDocumentGranularUserPermissionElement;\r\n\t}\r\n}\r\n"],"names":["_documentItemRepository","_modalManagerContext","_documentPickerModalContext","_entityUserPermissionModalContext","_UmbInputDocumentGranularUserPermissionElement_instances","observePickedDocuments_fn","editGranularPermission_fn","addGranularPermission_fn","requestDocumentItem_fn","selectEntityUserPermissionsForDocument_fn","removeGranularPermission_fn","renderItems_fn","renderAddButton_fn","renderRef_fn","renderIcon_fn","renderIsTrashed_fn","renderEditButton_fn","renderRemoveButton_fn","getPermissionForDocument_fn","getPermissionNamesForDocument_fn","getFallbackPermissionVerbsForEntityType_fn","UmbInputDocumentGranularUserPermissionElement","UUIFormControlMixin","UmbLitElement","__privateAdd","UmbDocumentItemRepository","UMB_MODAL_MANAGER_CONTEXT","instance","__privateSet","value","uniques","item","__privateMethod","html","asObservable","__privateGet","items","currentPermissionVerbs","result","permission","UmbChangeEvent","UMB_DOCUMENT_PICKER_MODAL","treeItem","i","UmbSelectedEvent","event","unique","documentItem","permissionItem","data","allowedVerbs","name","headline","fallbackVerbs","UMB_ENTITY_USER_PERMISSION_MODAL","v","repeat","permissionNames","umbExtensionsRegistry","manifest","verb","m","entityType","verbs","css","__decorateClass","property","state","customElement","UmbInputDocumentGranularUserPermissionElement$1"],"mappings":"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"}