{"version":3,"file":"create-document-collection-action.element-CTmLcMa2.js","sources":["../../../src/packages/documents/documents/collection/action/create-document-collection-action.element.ts"],"sourcesContent":["import { UMB_DOCUMENT_COLLECTION_CONTEXT } from '../document-collection.context-token.js';\r\nimport { UMB_DOCUMENT_WORKSPACE_CONTEXT } from '../../workspace/constants.js';\r\nimport { UMB_CREATE_DOCUMENT_WORKSPACE_PATH_PATTERN } from '../../paths.js';\r\nimport { UMB_DOCUMENT_ENTITY_TYPE, UMB_DOCUMENT_ROOT_ENTITY_TYPE } from '../../entity.js';\r\nimport { css, customElement, html, map, property, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbDocumentTypeStructureRepository } from '@umbraco-cms/backoffice/document-type';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport type { ManifestCollectionAction } from '@umbraco-cms/backoffice/collection';\r\nimport type { UmbAllowedDocumentTypeModel } from '@umbraco-cms/backoffice/document-type';\r\nimport type { UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\nimport type { UmbModalRouteBuilder } from '@umbraco-cms/backoffice/router';\r\n\r\n@customElement('umb-create-document-collection-action')\r\nexport class UmbCreateDocumentCollectionActionElement extends UmbLitElement {\r\n\t@state()\r\n\tprivate _allowedDocumentTypes: Array<UmbAllowedDocumentTypeModel> = [];\r\n\r\n\t@state()\r\n\tprivate _workspacePathBuilder?: UmbModalRouteBuilder;\r\n\r\n\t@state()\r\n\tprivate _documentUnique?: UmbEntityUnique;\r\n\r\n\t@state()\r\n\tprivate _documentTypeUnique?: string;\r\n\r\n\t@state()\r\n\tprivate _popoverOpen = false;\r\n\r\n\t@property({ attribute: false })\r\n\tmanifest?: ManifestCollectionAction;\r\n\r\n\t#documentTypeStructureRepository = new UmbDocumentTypeStructureRepository(this);\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(UMB_DOCUMENT_WORKSPACE_CONTEXT, (workspaceContext) => {\r\n\t\t\tthis.observe(workspaceContext?.unique, (unique) => {\r\n\t\t\t\tthis._documentUnique = unique;\r\n\t\t\t});\r\n\t\t\tthis.observe(workspaceContext?.contentTypeUnique, (documentTypeUnique) => {\r\n\t\t\t\tthis._documentTypeUnique = documentTypeUnique;\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tthis.consumeContext(UMB_DOCUMENT_COLLECTION_CONTEXT, (collectionContext) => {\r\n\t\t\tthis.observe(collectionContext?.workspacePathBuilder, (builder) => {\r\n\t\t\t\tthis._workspacePathBuilder = builder;\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\toverride async firstUpdated() {\r\n\t\tif (this._documentTypeUnique) {\r\n\t\t\tthis.#retrieveAllowedDocumentTypesOf(this._documentTypeUnique, this._documentUnique || null);\r\n\t\t}\r\n\t}\r\n\r\n\tasync #retrieveAllowedDocumentTypesOf(unique: string | null, parentContentUnique: string | null) {\r\n\t\tconst { data } = await this.#documentTypeStructureRepository.requestAllowedChildrenOf(unique, parentContentUnique);\r\n\r\n\t\tif (data && data.items) {\r\n\t\t\tthis._allowedDocumentTypes = data.items;\r\n\t\t}\r\n\t}\r\n\r\n\t#onPopoverToggle(event: ToggleEvent) {\r\n\t\t// TODO: This ignorer is just needed for JSON SCHEMA TO WORK, As its not updated with latest TS jet.\r\n\t\t// eslint-disable-next-line @typescript-eslint/ban-ts-comment\r\n\t\t// @ts-ignore\r\n\t\tthis._popoverOpen = event.newState === 'open';\r\n\t}\r\n\r\n\t#getCreateUrl(item: UmbAllowedDocumentTypeModel) {\r\n\t\treturn item.unique && this._workspacePathBuilder\r\n\t\t\t? this._workspacePathBuilder({ entityType: UMB_DOCUMENT_ENTITY_TYPE }) +\r\n\t\t\t\t\tUMB_CREATE_DOCUMENT_WORKSPACE_PATH_PATTERN.generateLocal({\r\n\t\t\t\t\t\tparentEntityType: this._documentUnique ? UMB_DOCUMENT_ENTITY_TYPE : UMB_DOCUMENT_ROOT_ENTITY_TYPE,\r\n\t\t\t\t\t\tparentUnique: this._documentUnique ?? 'null',\r\n\t\t\t\t\t\tdocumentTypeUnique: item.unique,\r\n\t\t\t\t\t})\r\n\t\t\t: '';\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn this._allowedDocumentTypes.length !== 1 ? this.#renderDropdown() : this.#renderCreateButton();\r\n\t}\r\n\r\n\t#renderCreateButton() {\r\n\t\tif (this._allowedDocumentTypes.length !== 1) return;\r\n\r\n\t\tconst item = this._allowedDocumentTypes[0];\r\n\t\t// TODO: Stop appending values to labels, instead we need to parse the name as a argument to the label. [NL]\r\n\t\tconst label =\r\n\t\t\t(this.manifest?.meta.label\r\n\t\t\t\t? this.localize.string(this.manifest?.meta.label)\r\n\t\t\t\t: this.localize.term('general_create')) +\r\n\t\t\t' ' +\r\n\t\t\titem.name;\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-button color=\"default\" href=${this.#getCreateUrl(item)} label=${label} look=\"outline\"></uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderDropdown() {\r\n\t\tif (!this._allowedDocumentTypes.length) return;\r\n\r\n\t\tconst label = this.manifest?.meta.label\r\n\t\t\t? this.localize.string(this.manifest?.meta.label)\r\n\t\t\t: this.localize.term('general_create');\r\n\r\n\t\treturn html`\r\n\t\t\t<uui-button popovertarget=\"collection-action-menu-popover\" label=${label} color=\"default\" look=\"outline\">\r\n\t\t\t\t${label}\r\n\t\t\t\t<uui-symbol-expand .open=${this._popoverOpen}></uui-symbol-expand>\r\n\t\t\t</uui-button>\r\n\t\t\t<uui-popover-container\r\n\t\t\t\tid=\"collection-action-menu-popover\"\r\n\t\t\t\tplacement=\"bottom-start\"\r\n\t\t\t\t@toggle=${this.#onPopoverToggle}>\r\n\t\t\t\t<umb-popover-layout>\r\n\t\t\t\t\t<uui-scroll-container>\r\n\t\t\t\t\t\t${map(\r\n\t\t\t\t\t\t\tthis._allowedDocumentTypes,\r\n\t\t\t\t\t\t\t(item) => html`\r\n\t\t\t\t\t\t\t\t<uui-menu-item label=${item.name} href=${this.#getCreateUrl(item)}>\r\n\t\t\t\t\t\t\t\t\t<umb-icon slot=\"icon\" name=${item.icon ?? 'icon-document'}></umb-icon>\r\n\t\t\t\t\t\t\t\t</uui-menu-item>\r\n\t\t\t\t\t\t\t`,\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</uui-scroll-container>\r\n\t\t\t\t</umb-popover-layout>\r\n\t\t\t</uui-popover-container>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\tuui-scroll-container {\r\n\t\t\t\tmax-height: 500px;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbCreateDocumentCollectionActionElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-create-document-collection-action': UmbCreateDocumentCollectionActionElement;\r\n\t}\r\n}\r\n"],"names":["_documentTypeStructureRepository","_UmbCreateDocumentCollectionActionElement_instances","retrieveAllowedDocumentTypesOf_fn","onPopoverToggle_fn","getCreateUrl_fn","renderCreateButton_fn","renderDropdown_fn","UmbCreateDocumentCollectionActionElement","UmbLitElement","__privateAdd","UmbDocumentTypeStructureRepository","UMB_DOCUMENT_WORKSPACE_CONTEXT","workspaceContext","unique","documentTypeUnique","UMB_DOCUMENT_COLLECTION_CONTEXT","collectionContext","builder","__privateMethod","parentContentUnique","data","__privateGet","event","item","UMB_DOCUMENT_ENTITY_TYPE","UMB_CREATE_DOCUMENT_WORKSPACE_PATH_PATTERN","UMB_DOCUMENT_ROOT_ENTITY_TYPE","label","html","map","css","__decorateClass","state","property","customElement","UmbCreateDocumentCollectionActionElement$1"],"mappings":"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"}