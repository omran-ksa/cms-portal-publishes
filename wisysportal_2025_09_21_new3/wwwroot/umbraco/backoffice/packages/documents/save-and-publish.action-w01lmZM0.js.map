{"version":3,"file":"save-and-publish.action-w01lmZM0.js","sources":["../../../src/packages/documents/documents/publishing/publish/workspace-action/save-and-publish.action.ts"],"sourcesContent":["import { UmbDocumentUserPermissionCondition } from '../../../user-permissions/document/conditions/document-user-permission.condition.js';\r\nimport {\r\n\tUMB_USER_PERMISSION_DOCUMENT_PUBLISH,\r\n\tUMB_USER_PERMISSION_DOCUMENT_UPDATE,\r\n} from '../../../user-permissions/document/constants.js';\r\nimport { UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT } from '../../workspace-context/constants.js';\r\nimport { UMB_DOCUMENT_WORKSPACE_CONTEXT } from '../../../constants.js';\r\nimport { UmbWorkspaceActionBase, type UmbWorkspaceActionArgs } from '@umbraco-cms/backoffice/workspace';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\nexport class UmbDocumentSaveAndPublishWorkspaceAction extends UmbWorkspaceActionBase {\r\n\tconstructor(host: UmbControllerHost, args: UmbWorkspaceActionArgs<never>) {\r\n\t\tsuper(host, args);\r\n\r\n\t\t/* The action is disabled by default because the onChange callback\r\n\t\t will first be triggered when the condition is changed to permitted */\r\n\t\tthis.disable();\r\n\r\n\t\tnew UmbDocumentUserPermissionCondition(host, {\r\n\t\t\thost,\r\n\t\t\tconfig: {\r\n\t\t\t\talias: 'Umb.Condition.UserPermission.Document',\r\n\t\t\t\tallOf: [UMB_USER_PERMISSION_DOCUMENT_UPDATE, UMB_USER_PERMISSION_DOCUMENT_PUBLISH],\r\n\t\t\t},\r\n\t\t\tonChange: (permitted: boolean) => {\r\n\t\t\t\tif (permitted) {\r\n\t\t\t\t\tthis.enable();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.disable();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tasync hasAdditionalOptions() {\r\n\t\tconst workspaceContext = await this.getContext(UMB_DOCUMENT_WORKSPACE_CONTEXT);\r\n\t\tif (!workspaceContext) {\r\n\t\t\tthrow new Error('The workspace context is missing');\r\n\t\t}\r\n\t\tconst variantOptions = await this.observe(workspaceContext.variantOptions).asPromise();\r\n\t\tconst cultureVariantOptions = variantOptions?.filter((option) => option.segment === null);\r\n\t\treturn cultureVariantOptions?.length > 1;\r\n\t}\r\n\r\n\toverride async execute() {\r\n\t\tconst workspaceContext = await this.getContext(UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT);\r\n\t\tif (!workspaceContext) {\r\n\t\t\tthrow new Error('The workspace context is missing');\r\n\t\t}\r\n\t\treturn workspaceContext.saveAndPublish();\r\n\t}\r\n}\r\n\r\nexport { UmbDocumentSaveAndPublishWorkspaceAction as api };\r\n"],"names":["UmbDocumentSaveAndPublishWorkspaceAction","UmbWorkspaceActionBase","host","args","UmbDocumentUserPermissionCondition","UMB_USER_PERMISSION_DOCUMENT_UPDATE","UMB_USER_PERMISSION_DOCUMENT_PUBLISH","permitted","workspaceContext","UMB_DOCUMENT_WORKSPACE_CONTEXT","option","UMB_DOCUMENT_PUBLISHING_WORKSPACE_CONTEXT"],"mappings":";;;AAUO,MAAMA,UAAiDC,EAAuB;AAAA,EACpF,YAAYC,GAAyBC,GAAqC;AACzE,UAAMD,GAAMC,CAAI,GAIhB,KAAK,QAAQ,GAEb,IAAIC,EAAmCF,GAAM;AAAA,MAC5C,MAAAA;AAAA,MACA,QAAQ;AAAA,QACP,OAAO;AAAA,QACP,OAAO,CAACG,GAAqCC,CAAoC;AAAA,MAClF;AAAA,MACA,UAAU,CAACC,MAAuB;AACjC,QAAIA,IACH,KAAK,OAAO,IAEZ,KAAK,QAAQ;AAAA,MACd;AAAA,IACD,CACA;AAAA,EAAA;AAAA,EAGF,MAAM,uBAAuB;AAC5B,UAAMC,IAAmB,MAAM,KAAK,WAAWC,CAA8B;AAC7E,QAAI,CAACD;AACE,YAAA,IAAI,MAAM,kCAAkC;AAInD,YAFuB,MAAM,KAAK,QAAQA,EAAiB,cAAc,EAAE,UAAU,IACvC,OAAO,CAACE,MAAWA,EAAO,YAAY,IAAI,GAC1D,SAAS;AAAA,EAAA;AAAA,EAGxC,MAAe,UAAU;AACxB,UAAMF,IAAmB,MAAM,KAAK,WAAWG,CAAyC;AACxF,QAAI,CAACH;AACE,YAAA,IAAI,MAAM,kCAAkC;AAEnD,WAAOA,EAAiB,eAAe;AAAA,EAAA;AAEzC;"}