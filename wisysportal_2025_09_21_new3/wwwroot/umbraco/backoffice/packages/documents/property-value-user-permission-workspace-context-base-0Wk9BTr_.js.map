{"version":3,"file":"property-value-user-permission-workspace-context-base-0Wk9BTr_.js","sources":["../../../src/packages/documents/documents/user-permissions/document-property-value/workspace-context/property-value-user-permission-workspace-context-base.ts"],"sourcesContent":["import { UMB_DOCUMENT_PROPERTY_VALUE_USER_PERMISSION_CONDITION_ALIAS } from '../conditions/constants.js';\r\nimport {\r\n\tUMB_USER_PERMISSION_DOCUMENT_PROPERTY_VALUE_READ,\r\n\tUMB_USER_PERMISSION_DOCUMENT_PROPERTY_VALUE_WRITE,\r\n} from '../constants.js';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { createExtensionApiByAlias } from '@umbraco-cms/backoffice/extension-registry';\r\nimport type { UmbVariantPropertyGuardManager } from '@umbraco-cms/backoffice/property';\r\nimport type { UmbPropertyTypeModel } from '@umbraco-cms/backoffice/content-type';\r\n\r\nexport class UmbPropertyValueUserPermissionWorkspaceContextBase extends UmbControllerBase {\r\n\tprotected _setPermissions(\r\n\t\tproperties: Array<UmbPropertyTypeModel>,\r\n\t\tpropertyViewGuard: UmbVariantPropertyGuardManager,\r\n\t\tpropertyWriteGuard: UmbVariantPropertyGuardManager,\r\n\t) {\r\n\t\tproperties.forEach((property) => {\r\n\t\t\tthis.#setPermissionForProperty({\r\n\t\t\t\tverb: UMB_USER_PERMISSION_DOCUMENT_PROPERTY_VALUE_READ,\r\n\t\t\t\tstateManager: propertyViewGuard,\r\n\t\t\t\tproperty,\r\n\t\t\t});\r\n\r\n\t\t\tthis.#setPermissionForProperty({\r\n\t\t\t\tverb: UMB_USER_PERMISSION_DOCUMENT_PROPERTY_VALUE_WRITE,\r\n\t\t\t\tstateManager: propertyWriteGuard,\r\n\t\t\t\tproperty,\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\t#setPermissionForProperty(args: {\r\n\t\tverb: string;\r\n\t\tstateManager: UmbVariantPropertyGuardManager;\r\n\t\tproperty: UmbPropertyTypeModel;\r\n\t}) {\r\n\t\t// TODO: Oh, this results in quite a few Context Consumptions. Lets try not to use a condition in this case. [NL]\r\n\t\tcreateExtensionApiByAlias(this, UMB_DOCUMENT_PROPERTY_VALUE_USER_PERMISSION_CONDITION_ALIAS, [\r\n\t\t\t{\r\n\t\t\t\tconfig: {\r\n\t\t\t\t\tallOf: [args.verb],\r\n\t\t\t\t\tmatch: {\r\n\t\t\t\t\t\tpropertyType: {\r\n\t\t\t\t\t\t\tunique: args.property.unique,\r\n\t\t\t\t\t\t},\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\tonChange: (permitted: boolean) => {\r\n\t\t\t\t\tconst unique = 'UMB_PROPERTY_' + args.property.unique;\r\n\r\n\t\t\t\t\tif (permitted) {\r\n\t\t\t\t\t\targs.stateManager.addRule({\r\n\t\t\t\t\t\t\tunique,\r\n\t\t\t\t\t\t\tpropertyType: {\r\n\t\t\t\t\t\t\t\tunique: args.property.unique,\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\targs.stateManager.removeRule(unique);\r\n\t\t\t\t\t}\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t]);\r\n\t}\r\n}\r\n\r\nexport { UmbPropertyValueUserPermissionWorkspaceContextBase as api };\r\n"],"names":["UmbPropertyValueUserPermissionWorkspaceContextBase","UmbControllerBase","properties","propertyViewGuard","propertyWriteGuard","property","#setPermissionForProperty","UMB_USER_PERMISSION_DOCUMENT_PROPERTY_VALUE_READ","UMB_USER_PERMISSION_DOCUMENT_PROPERTY_VALUE_WRITE","args","createExtensionApiByAlias","UMB_DOCUMENT_PROPERTY_VALUE_USER_PERMISSION_CONDITION_ALIAS","permitted","unique"],"mappings":";;;AAUO,MAAMA,UAA2DC,EAAkB;AAAA,EAC/E,gBACTC,GACAC,GACAC,GACC;AACU,IAAAF,EAAA,QAAQ,CAACG,MAAa;AAChC,WAAKC,GAA0B;AAAA,QAC9B,MAAMC;AAAA,QACN,cAAcJ;AAAA,QACd,UAAAE;AAAA,MAAA,CACA,GAED,KAAKC,GAA0B;AAAA,QAC9B,MAAME;AAAA,QACN,cAAcJ;AAAA,QACd,UAAAC;AAAA,MAAA,CACA;AAAA,IAAA,CACD;AAAA,EAAA;AAAA,EAGFC,GAA0BG,GAIvB;AAEF,IAAAC,EAA0B,MAAMC,GAA6D;AAAA,MAC5F;AAAA,QACC,QAAQ;AAAA,UACP,OAAO,CAACF,EAAK,IAAI;AAAA,UACjB,OAAO;AAAA,YACN,cAAc;AAAA,cACb,QAAQA,EAAK,SAAS;AAAA,YAAA;AAAA,UACvB;AAAA,QAEF;AAAA,QACA,UAAU,CAACG,MAAuB;AAC3B,gBAAAC,IAAS,kBAAkBJ,EAAK,SAAS;AAE/C,UAAIG,IACHH,EAAK,aAAa,QAAQ;AAAA,YACzB,QAAAI;AAAA,YACA,cAAc;AAAA,cACb,QAAQJ,EAAK,SAAS;AAAA,YAAA;AAAA,UACvB,CACA,IAEIA,EAAA,aAAa,WAAWI,CAAM;AAAA,QACpC;AAAA,MACD;AAAA,IACD,CACA;AAAA,EAAA;AAEH;"}