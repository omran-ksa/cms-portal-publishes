{"version":3,"file":"document-urls-data-resolver-C8TSLzpK.js","sources":["../../../src/packages/documents/documents/url/document-urls-data-resolver.ts"],"sourcesContent":["import type { UmbDocumentUrlModel } from './repository/types.js';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbArrayState } from '@umbraco-cms/backoffice/observable-api';\r\nimport { UMB_VARIANT_CONTEXT, type UmbVariantId } from '@umbraco-cms/backoffice/variant';\r\n\r\n/**\r\n * A controller for resolving data for document urls\r\n * @exports\r\n * @class UmbDocumentUrlsDataResolver\r\n * @augments {UmbControllerBase}\r\n */\r\nexport class UmbDocumentUrlsDataResolver extends UmbControllerBase {\r\n\t#appCulture?: string;\r\n\t#variantId?: UmbVariantId;\r\n\t#data?: Array<UmbDocumentUrlModel> | undefined;\r\n\r\n\t#init: Promise<unknown>;\r\n\r\n\t#urls = new UmbArrayState<UmbDocumentUrlModel>([], (url) => url.url);\r\n\t/**\r\n\t * The urls for the current culture\r\n\t * @returns {ObservableArray<UmbDocumentUrlModel>} The urls for the current culture\r\n\t * @memberof UmbDocumentUrlsDataResolver\r\n\t */\r\n\tpublic readonly urls = this.#urls.asObservable();\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\r\n\t\tthis.#init = Promise.all([\r\n\t\t\tthis.consumeContext(UMB_VARIANT_CONTEXT, async (context) => {\r\n\t\t\t\tthis.#variantId = await context?.getVariantId();\r\n\t\t\t}).asPromise(),\r\n\t\t]);\r\n\t}\r\n\r\n\t/**\r\n\t * Get the current data\r\n\t * @returns {Array<UmbDocumentUrlModel> | undefined} The current data\r\n\t * @memberof UmbDocumentUrlsDataResolver\r\n\t */\r\n\tgetData(): Array<UmbDocumentUrlModel> | undefined {\r\n\t\treturn this.#data;\r\n\t}\r\n\r\n\t/**\r\n\t * Set the current data\r\n\t * @param {Array<UmbDocumentUrlModel> | undefined} data The current data\r\n\t * @memberof UmbDocumentUrlsDataResolver\r\n\t */\r\n\tsetData(data: Array<UmbDocumentUrlModel> | undefined) {\r\n\t\tthis.#data = data;\r\n\r\n\t\tif (!this.#data) {\r\n\t\t\tthis.#urls.setValue([]);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.#setCultureAwareValues();\r\n\t}\r\n\r\n\t/**\r\n\t * Get the urls for the current culture\r\n\t * @returns {(Promise<Array<UmbDocumentUrlModel> | []>)} The urls for the current culture\r\n\t * @memberof UmbDocumentUrlsDataResolver\r\n\t */\r\n\tasync getUrls(): Promise<Array<UmbDocumentUrlModel> | []> {\r\n\t\tawait this.#init;\r\n\t\treturn this.#urls.getValue();\r\n\t}\r\n\r\n\t#setCultureAwareValues() {\r\n\t\tthis.#setUrls();\r\n\t}\r\n\r\n\t#setUrls() {\r\n\t\tconst data = this.#getDataForCurrentCulture();\r\n\t\tthis.#urls.setValue(data ?? []);\r\n\t}\r\n\r\n\t#getCurrentCulture(): string | undefined {\r\n\t\treturn this.#variantId?.culture || this.#appCulture;\r\n\t}\r\n\r\n\t#getDataForCurrentCulture(): Array<UmbDocumentUrlModel> | undefined {\r\n\t\tconst culture = this.#getCurrentCulture();\r\n\t\t// If there is no culture context (invariant data) we return all urls\r\n\t\treturn culture ? this.#data?.filter((x) => x.culture === culture) : this.#data;\r\n\t}\r\n}\r\n"],"names":["UmbDocumentUrlsDataResolver","UmbControllerBase","host","#urls","UmbArrayState","url","#init","UMB_VARIANT_CONTEXT","context","#variantId","#appCulture","#data","data","#setCultureAwareValues","#setUrls","#getDataForCurrentCulture","#getCurrentCulture","culture","x"],"mappings":";;;AAYO,MAAMA,UAAoCC,EAAkB;AAAA,EAelE,YAAYC,GAAyB;AACpC,UAAMA,CAAI,GATX,KAAAC,KAAQ,IAAIC,EAAmC,IAAI,CAACC,MAAQA,EAAI,GAAG,GAMnD,KAAA,OAAO,KAAKF,GAAM,aAAa,GAKzC,KAAAG,KAAQ,QAAQ,IAAI;AAAA,MACxB,KAAK,eAAeC,GAAqB,OAAOC,MAAY;AACtD,aAAAC,KAAa,MAAMD,GAAS,aAAa;AAAA,MAC9C,CAAA,EAAE,UAAU;AAAA,IAAA,CACb;AAAA,EAAA;AAAA,EArBFE;AAAA,EACAD;AAAA,EACAE;AAAA,EAEAL;AAAA,EAEAH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAuBA,UAAkD;AACjD,WAAO,KAAKQ;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQb,QAAQC,GAA8C;AAGjD,QAFJ,KAAKD,KAAQC,GAET,CAAC,KAAKD,IAAO;AACX,WAAAR,GAAM,SAAS,EAAE;AACtB;AAAA,IAAA;AAGD,SAAKU,GAAuB;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQ7B,MAAM,UAAoD;AACzD,iBAAM,KAAKP,IACJ,KAAKH,GAAM,SAAS;AAAA,EAAA;AAAA,EAG5BU,KAAyB;AACxB,SAAKC,GAAS;AAAA,EAAA;AAAA,EAGfA,KAAW;AACJ,UAAAF,IAAO,KAAKG,GAA0B;AAC5C,SAAKZ,GAAM,SAASS,KAAQ,CAAA,CAAE;AAAA,EAAA;AAAA,EAG/BI,KAAyC;AACjC,WAAA,KAAKP,IAAY,WAAW,KAAKC;AAAA,EAAA;AAAA,EAGzCK,KAAoE;AAC7D,UAAAE,IAAU,KAAKD,GAAmB;AAEjC,WAAAC,IAAU,KAAKN,IAAO,OAAO,CAACO,MAAMA,EAAE,YAAYD,CAAO,IAAI,KAAKN;AAAA,EAAA;AAE3E;"}