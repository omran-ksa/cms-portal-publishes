{"version":3,"file":"document-blueprint-tree.repository-BMaFgzPh.js","sources":["../../../src/packages/documents/document-blueprints/tree/document-blueprint-tree.server.data-source.ts","../../../src/packages/documents/document-blueprints/tree/document-blueprint-tree.repository.ts"],"sourcesContent":["import {\r\n\tUMB_DOCUMENT_BLUEPRINT_ENTITY_TYPE,\r\n\tUMB_DOCUMENT_BLUEPRINT_FOLDER_ENTITY_TYPE,\r\n\tUMB_DOCUMENT_BLUEPRINT_ROOT_ENTITY_TYPE,\r\n} from '../entity.js';\r\nimport type { UmbDocumentBlueprintTreeItemModel } from './types.js';\r\nimport { UmbTreeServerDataSourceBase } from '@umbraco-cms/backoffice/tree';\r\nimport { DocumentBlueprintService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { DocumentBlueprintTreeItemResponseModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbTreeChildrenOfRequestArgs, UmbTreeRootItemsRequestArgs } from '@umbraco-cms/backoffice/tree';\r\n\r\n/**\r\n * A data source for a data type tree that fetches data from the server\r\n * @class UmbDocumentBlueprintTreeServerDataSource\r\n * @implements {DocumentTreeDataSource}\r\n */\r\nexport class UmbDocumentBlueprintTreeServerDataSource extends UmbTreeServerDataSourceBase<\r\n\tDocumentBlueprintTreeItemResponseModel,\r\n\tUmbDocumentBlueprintTreeItemModel\r\n> {\r\n\t/**\r\n\t * Creates an instance of UmbDocumentBlueprintTreeServerDataSource.\r\n\t * @param {UmbControllerHost} host - The controller host for this controller to be appended to\r\n\t * @memberof UmbDocumentBlueprintTreeServerDataSource\r\n\t */\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, {\r\n\t\t\tgetRootItems,\r\n\t\t\tgetChildrenOf,\r\n\t\t\tgetAncestorsOf,\r\n\t\t\tmapper,\r\n\t\t});\r\n\t}\r\n}\r\n\r\nconst getRootItems = (args: UmbTreeRootItemsRequestArgs) =>\r\n\t// eslint-disable-next-line local-rules/no-direct-api-import\r\n\tDocumentBlueprintService.getTreeDocumentBlueprintRoot({\r\n\t\tquery: { foldersOnly: args.foldersOnly, skip: args.skip, take: args.take },\r\n\t});\r\n\r\nconst getChildrenOf = (args: UmbTreeChildrenOfRequestArgs) => {\r\n\tif (args.parent.unique === null) {\r\n\t\treturn getRootItems(args);\r\n\t} else {\r\n\t\t// eslint-disable-next-line local-rules/no-direct-api-import\r\n\t\treturn DocumentBlueprintService.getTreeDocumentBlueprintChildren({\r\n\t\t\tquery: { parentId: args.parent.unique, foldersOnly: args.foldersOnly },\r\n\t\t});\r\n\t}\r\n};\r\n\r\nconst getAncestorsOf = () => {\r\n\tthrow new Error('Not implemented');\r\n\t/** TODO: Implement when endpoint becomes available... */\r\n};\r\n\r\nconst mapper = (item: DocumentBlueprintTreeItemResponseModel): UmbDocumentBlueprintTreeItemModel => {\r\n\treturn {\r\n\t\tunique: item.id,\r\n\t\tparent: {\r\n\t\t\tunique: item.parent ? item.parent.id : null,\r\n\t\t\tentityType: item.parent ? UMB_DOCUMENT_BLUEPRINT_ENTITY_TYPE : UMB_DOCUMENT_BLUEPRINT_ROOT_ENTITY_TYPE,\r\n\t\t},\r\n\t\tname: (item as any).variants?.[0].name ?? item.name,\r\n\t\tentityType: item.isFolder ? UMB_DOCUMENT_BLUEPRINT_FOLDER_ENTITY_TYPE : UMB_DOCUMENT_BLUEPRINT_ENTITY_TYPE,\r\n\t\tisFolder: item.isFolder,\r\n\t\thasChildren: item.hasChildren,\r\n\t\ticon: item.isFolder ? 'icon-folder' : 'icon-blueprint',\r\n\t};\r\n};\r\n","import { UMB_DOCUMENT_BLUEPRINT_ROOT_ENTITY_TYPE } from '../entity.js';\r\nimport { UmbDocumentBlueprintTreeServerDataSource } from './document-blueprint-tree.server.data-source.js';\r\nimport { UMB_DOCUMENT_BLUEPRINT_TREE_STORE_CONTEXT } from './document-blueprint-tree.store.context-token.js';\r\nimport type { UmbDocumentBlueprintTreeItemModel, UmbDocumentBlueprintTreeRootModel } from './types.js';\r\nimport { UmbTreeRepositoryBase } from '@umbraco-cms/backoffice/tree';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbApi } from '@umbraco-cms/backoffice/extension-api';\r\nimport { UmbLocalizationController } from '@umbraco-cms/backoffice/localization-api';\r\n\r\nexport class UmbDocumentBlueprintTreeRepository\r\n\textends UmbTreeRepositoryBase<UmbDocumentBlueprintTreeItemModel, UmbDocumentBlueprintTreeRootModel>\r\n\timplements UmbApi\r\n{\r\n\t#localize = new UmbLocalizationController(this);\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UmbDocumentBlueprintTreeServerDataSource, UMB_DOCUMENT_BLUEPRINT_TREE_STORE_CONTEXT);\r\n\t}\r\n\r\n\tasync requestTreeRoot() {\r\n\t\tconst { data: treeRootData } = await this._treeSource.getRootItems({ skip: 0, take: 1 });\r\n\t\tconst hasChildren = treeRootData ? treeRootData.total > 0 : false;\r\n\r\n\t\tconst data: UmbDocumentBlueprintTreeRootModel = {\r\n\t\t\tunique: null,\r\n\t\t\tentityType: UMB_DOCUMENT_BLUEPRINT_ROOT_ENTITY_TYPE,\r\n\t\t\tname: this.#localize.term('treeHeaders_contentBlueprints'),\r\n\t\t\thasChildren,\r\n\t\t\tisFolder: true,\r\n\t\t};\r\n\r\n\t\treturn { data };\r\n\t}\r\n}\r\n\r\nexport { UmbDocumentBlueprintTreeRepository as api };\r\n"],"names":["UmbDocumentBlueprintTreeServerDataSource","UmbTreeServerDataSourceBase","host","getRootItems","getChildrenOf","getAncestorsOf","mapper","args","DocumentBlueprintService","item","UMB_DOCUMENT_BLUEPRINT_ENTITY_TYPE","UMB_DOCUMENT_BLUEPRINT_ROOT_ENTITY_TYPE","UMB_DOCUMENT_BLUEPRINT_FOLDER_ENTITY_TYPE","UmbDocumentBlueprintTreeRepository","UmbTreeRepositoryBase","#localize","UmbLocalizationController","UMB_DOCUMENT_BLUEPRINT_TREE_STORE_CONTEXT","treeRootData","hasChildren"],"mappings":";;;;AAiBO,MAAMA,UAAiDC,EAG5D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMD,YAAYC,GAAyB;AACpC,UAAMA,GAAM;AAAA,MACX,cAAAC;AAAA,MACA,eAAAC;AAAA,MACA,gBAAAC;AAAA,MACA,QAAAC;AAAA,IAAA,CACA;AAAA,EAAA;AAEH;AAEA,MAAMH,IAAe,CAACI;AAAA;AAAA,EAErBC,EAAyB,6BAA6B;AAAA,IACrD,OAAO,EAAE,aAAaD,EAAK,aAAa,MAAMA,EAAK,MAAM,MAAMA,EAAK,KAAK;AAAA,EACzE,CAAA;AAAA,GAEIH,IAAgB,CAACG,MAClBA,EAAK,OAAO,WAAW,OACnBJ,EAAaI,CAAI,IAGjBC,EAAyB,iCAAiC;AAAA,EAChE,OAAO,EAAE,UAAUD,EAAK,OAAO,QAAQ,aAAaA,EAAK,YAAY;AAAA,CACrE,GAIGF,IAAiB,MAAM;AACtB,QAAA,IAAI,MAAM,iBAAiB;AAElC,GAEMC,IAAS,CAACG,OACR;AAAA,EACN,QAAQA,EAAK;AAAA,EACb,QAAQ;AAAA,IACP,QAAQA,EAAK,SAASA,EAAK,OAAO,KAAK;AAAA,IACvC,YAAYA,EAAK,SAASC,IAAqCC;AAAA,EAChE;AAAA,EACA,MAAOF,EAAa,WAAW,CAAC,EAAE,QAAQA,EAAK;AAAA,EAC/C,YAAYA,EAAK,WAAWG,IAA4CF;AAAA,EACxE,UAAUD,EAAK;AAAA,EACf,aAAaA,EAAK;AAAA,EAClB,MAAMA,EAAK,WAAW,gBAAgB;AACvC;AC7DM,MAAMI,UACJC,EAET;AAAA,EACCC,KAAY,IAAIC,EAA0B,IAAI;AAAA,EAE9C,YAAYd,GAAyB;AAC9B,UAAAA,GAAMF,GAA0CiB,CAAyC;AAAA,EAAA;AAAA,EAGhG,MAAM,kBAAkB;AACvB,UAAM,EAAE,MAAMC,EAAa,IAAI,MAAM,KAAK,YAAY,aAAa,EAAE,MAAM,GAAG,MAAM,GAAG,GACjFC,IAAcD,IAAeA,EAAa,QAAQ,IAAI;AAU5D,WAAO,EAAE,MARuC;AAAA,MAC/C,QAAQ;AAAA,MACR,YAAYP;AAAA,MACZ,MAAM,KAAKI,GAAU,KAAK,+BAA+B;AAAA,MACzD,aAAAI;AAAA,MACA,UAAU;AAAA,IACX,EAEc;AAAA,EAAA;AAEhB;"}