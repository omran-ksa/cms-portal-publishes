{"version":3,"file":"save-and-preview.action-CS2plqlq.js","sources":["../../../src/packages/documents/documents/workspace/actions/save-and-preview.action.ts"],"sourcesContent":["import { UmbDocumentUserPermissionCondition } from '../../user-permissions/document/conditions/document-user-permission.condition.js';\r\nimport { UMB_DOCUMENT_WORKSPACE_CONTEXT } from '../document-workspace.context-token.js';\r\nimport { UMB_USER_PERMISSION_DOCUMENT_UPDATE } from '../../user-permissions/document/constants.js';\r\nimport { UmbWorkspaceActionBase } from '@umbraco-cms/backoffice/workspace';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\n// TODO: Investigate how additional preview environments can be supported. [LK:2024-05-16]\r\n// https://docs.umbraco.com/umbraco-cms/reference/content-delivery-api/additional-preview-environments-support\r\n// In v13, they are registered on the server using `SendingContentNotification`, which is no longer available in v14.\r\n\r\nexport class UmbDocumentSaveAndPreviewWorkspaceAction extends UmbWorkspaceActionBase {\r\n\tconstructor(host: UmbControllerHost, args: any) {\r\n\t\tsuper(host, args);\r\n\r\n\t\t/* The action is disabled by default because the onChange callback\r\n\t\t will first be triggered when the condition is changed to permitted */\r\n\t\tthis.disable();\r\n\r\n\t\tconst condition = new UmbDocumentUserPermissionCondition(host, {\r\n\t\t\thost,\r\n\t\t\tconfig: {\r\n\t\t\t\talias: 'Umb.Condition.UserPermission.Document',\r\n\t\t\t\tallOf: [UMB_USER_PERMISSION_DOCUMENT_UPDATE],\r\n\t\t\t},\r\n\t\t\tonChange: () => {\r\n\t\t\t\tif (condition.permitted) {\r\n\t\t\t\t\tthis.enable();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.disable();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\toverride async execute() {\r\n\t\tconst workspaceContext = await this.getContext(UMB_DOCUMENT_WORKSPACE_CONTEXT);\r\n\t\tif (!workspaceContext) {\r\n\t\t\tthrow new Error('Document workspace context not found');\r\n\t\t}\r\n\t\tworkspaceContext.saveAndPreview();\r\n\t}\r\n}\r\n\r\nexport { UmbDocumentSaveAndPreviewWorkspaceAction as api };\r\n"],"names":["UmbDocumentSaveAndPreviewWorkspaceAction","UmbWorkspaceActionBase","host","args","condition","UmbDocumentUserPermissionCondition","UMB_USER_PERMISSION_DOCUMENT_UPDATE","workspaceContext","UMB_DOCUMENT_WORKSPACE_CONTEXT"],"mappings":";;;AAUO,MAAMA,UAAiDC,EAAuB;AAAA,EACpF,YAAYC,GAAyBC,GAAW;AAC/C,UAAMD,GAAMC,CAAI,GAIhB,KAAK,QAAQ;AAEP,UAAAC,IAAY,IAAIC,EAAmCH,GAAM;AAAA,MAC9D,MAAAA;AAAA,MACA,QAAQ;AAAA,QACP,OAAO;AAAA,QACP,OAAO,CAACI,CAAmC;AAAA,MAC5C;AAAA,MACA,UAAU,MAAM;AACf,QAAIF,EAAU,YACb,KAAK,OAAO,IAEZ,KAAK,QAAQ;AAAA,MACd;AAAA,IACD,CACA;AAAA,EAAA;AAAA,EAGF,MAAe,UAAU;AACxB,UAAMG,IAAmB,MAAM,KAAK,WAAWC,CAA8B;AAC7E,QAAI,CAACD;AACE,YAAA,IAAI,MAAM,sCAAsC;AAEvD,IAAAA,EAAiB,eAAe;AAAA,EAAA;AAElC;"}