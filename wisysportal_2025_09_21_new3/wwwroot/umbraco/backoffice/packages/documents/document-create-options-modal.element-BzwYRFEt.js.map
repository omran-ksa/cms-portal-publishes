{"version":3,"file":"document-create-options-modal.element-BzwYRFEt.js","sources":["../../../src/packages/documents/documents/entity-actions/create/document-create-options-modal.element.ts"],"sourcesContent":["import { UmbDocumentItemRepository } from '../../item/index.js';\r\nimport type {\r\n\tUmbDocumentCreateOptionsModalData,\r\n\tUmbDocumentCreateOptionsModalValue,\r\n} from './document-create-options-modal.token.js';\r\nimport { html, customElement, state, repeat, css, when } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport {\r\n\tUmbDocumentTypeStructureRepository,\r\n\ttype UmbAllowedDocumentTypeModel,\r\n} from '@umbraco-cms/backoffice/document-type';\r\nimport {\r\n\tUmbDocumentBlueprintItemRepository,\r\n\ttype UmbDocumentBlueprintItemBaseModel,\r\n} from '@umbraco-cms/backoffice/document-blueprint';\r\nimport type { UmbEntityUnique } from '@umbraco-cms/backoffice/entity';\r\nimport {\r\n\tUMB_CREATE_DOCUMENT_WORKSPACE_PATH_PATTERN,\r\n\tUMB_CREATE_FROM_BLUEPRINT_DOCUMENT_WORKSPACE_PATH_PATTERN,\r\n} from '../../paths.js';\r\nimport type { UmbDocumentEntityTypeUnion } from '../../entity.js';\r\n\r\n@customElement('umb-document-create-options-modal')\r\nexport class UmbDocumentCreateOptionsModalElement extends UmbModalBaseElement<\r\n\tUmbDocumentCreateOptionsModalData,\r\n\tUmbDocumentCreateOptionsModalValue\r\n> {\r\n\t#documentTypeStructureRepository = new UmbDocumentTypeStructureRepository(this);\r\n\t#documentItemRepository = new UmbDocumentItemRepository(this);\r\n\t#documentBlueprintItemRepository = new UmbDocumentBlueprintItemRepository(this);\r\n\r\n\t#documentTypeUnique = '';\r\n\t#documentTypeIcon = '';\r\n\r\n\t@state()\r\n\tprivate _allowedDocumentTypes: UmbAllowedDocumentTypeModel[] = [];\r\n\r\n\t@state()\r\n\tprivate _headline: string =\r\n\t\t`${this.localize.term('create_createUnder')} ${this.localize.term('actionCategories_content')}`;\r\n\r\n\t@state()\r\n\tprivate _availableBlueprints: Array<UmbDocumentBlueprintItemBaseModel> = [];\r\n\r\n\toverride async firstUpdated() {\r\n\t\tconst parentUnique = this.data?.parent.unique;\r\n\t\tconst documentTypeUnique = this.data?.documentType?.unique || null;\r\n\r\n\t\tthis.#retrieveAllowedDocumentTypesOf(documentTypeUnique, parentUnique || null);\r\n\r\n\t\tif (parentUnique) {\r\n\t\t\tthis.#retrieveHeadline(parentUnique);\r\n\t\t}\r\n\t}\r\n\r\n\tasync #retrieveAllowedDocumentTypesOf(unique: string | null, parentContentUnique: string | null) {\r\n\t\tconst { data } = await this.#documentTypeStructureRepository.requestAllowedChildrenOf(unique, parentContentUnique);\r\n\r\n\t\tif (data) {\r\n\t\t\t// TODO: implement pagination, or get 1000?\r\n\t\t\tthis._allowedDocumentTypes = data.items;\r\n\t\t}\r\n\t}\r\n\r\n\tasync #retrieveHeadline(parentUnique: string) {\r\n\t\tif (!parentUnique) return;\r\n\t\tconst { data } = await this.#documentItemRepository.requestItems([parentUnique]);\r\n\t\tif (data) {\r\n\t\t\t// TODO: we need to get the correct variant context here\r\n\t\t\tthis._headline = `${this.localize.term('create_createUnder')} ${data[0].variants?.[0].name ?? this.localize.term('actionCategories_content')}`;\r\n\t\t}\r\n\t}\r\n\r\n\t// close the modal when navigating to data type\r\n\t#onNavigate(documentTypeUnique: string, blueprintUnique?: string) {\r\n\t\tif (!this.data) {\r\n\t\t\tthrow new Error('Data is not defined');\r\n\t\t}\r\n\t\tif (!blueprintUnique) {\r\n\t\t\thistory.pushState(\r\n\t\t\t\tnull,\r\n\t\t\t\t'',\r\n\t\t\t\tUMB_CREATE_DOCUMENT_WORKSPACE_PATH_PATTERN.generateAbsolute({\r\n\t\t\t\t\tparentEntityType: this.data.parent.entityType as UmbDocumentEntityTypeUnion,\r\n\t\t\t\t\tparentUnique: this.data.parent.unique,\r\n\t\t\t\t\tdocumentTypeUnique,\r\n\t\t\t\t}),\r\n\t\t\t);\r\n\t\t} else {\r\n\t\t\thistory.pushState(\r\n\t\t\t\tnull,\r\n\t\t\t\t'',\r\n\t\t\t\tUMB_CREATE_FROM_BLUEPRINT_DOCUMENT_WORKSPACE_PATH_PATTERN.generateAbsolute({\r\n\t\t\t\t\tparentEntityType: this.data.parent.entityType as UmbDocumentEntityTypeUnion,\r\n\t\t\t\t\tparentUnique: this.data.parent.unique,\r\n\t\t\t\t\tdocumentTypeUnique,\r\n\t\t\t\t\tblueprintUnique,\r\n\t\t\t\t}),\r\n\t\t\t);\r\n\t\t}\r\n\t\tthis._submitModal();\r\n\t}\r\n\r\n\tasync #onSelectDocumentType(documentTypeUnique: UmbEntityUnique) {\r\n\t\tif (!documentTypeUnique) {\r\n\t\t\tthrow new Error('Document type unique is not defined');\r\n\t\t}\r\n\t\tthis.#documentTypeUnique = documentTypeUnique;\r\n\t\tthis.#documentTypeIcon = this._allowedDocumentTypes.find((dt) => dt.unique === documentTypeUnique)?.icon ?? '';\r\n\r\n\t\tconst { data } = await this.#documentBlueprintItemRepository.requestItemsByDocumentType(documentTypeUnique);\r\n\r\n\t\tthis._availableBlueprints = data ?? [];\r\n\r\n\t\tif (!this._availableBlueprints.length) {\r\n\t\t\tthis.#onNavigate(documentTypeUnique);\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=${this.localize.term('actions_create')}>\r\n\t\t\t\t${when(\r\n\t\t\t\t\tthis._availableBlueprints.length && this.#documentTypeUnique,\r\n\t\t\t\t\t() => this.#renderBlueprints(),\r\n\t\t\t\t\t() => this.#renderDocumentTypes(),\r\n\t\t\t\t)}\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\tid=\"cancel\"\r\n\t\t\t\t\tlabel=${this.localize.term('general_cancel')}\r\n\t\t\t\t\t@click=\"${this._rejectModal}\"></uui-button>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderNoDocumentTypes() {\r\n\t\tif (this.data?.documentType?.unique) {\r\n\t\t\treturn html`\r\n\t\t\t\t<umb-localize key=\"create_noDocumentTypes\">\r\n\t\t\t\t\tThere are no allowed Document Types available for creating content here. You must enable these in\r\n\t\t\t\t\t<strong>Document Types</strong> within the <strong>Settings</strong> section, by editing the\r\n\t\t\t\t\t<strong>Allowed child node types</strong> under <strong>Structure</strong>.\r\n\t\t\t\t</umb-localize>\r\n\t\t\t\t<br />\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tid=\"edit-permissions\"\r\n\t\t\t\t\tlook=\"secondary\"\r\n\t\t\t\t\thref=${`/section/settings/workspace/document-type/edit/${this.data?.documentType?.unique}/view/structure`}\r\n\t\t\t\t\tlabel=${this.localize.term('create_noDocumentTypesEditPermissions')}\r\n\t\t\t\t\t@click=${() => this._rejectModal()}></uui-button>\r\n\t\t\t`;\r\n\t\t} else {\r\n\t\t\treturn html`\r\n\t\t\t\t<umb-localize key=\"create_noDocumentTypesAllowedAtRoot\">\r\n\t\t\t\t\tThere are no allowed Document Types available for creating content here. You must enable these in\r\n\t\t\t\t\t<strong>Document Types</strong> within the <strong>Settings</strong> section, by changing the\r\n\t\t\t\t\t<strong>Allow as root</strong> option under <strong>Structure</strong>.\r\n\t\t\t\t</umb-localize>\r\n\t\t\t`;\r\n\t\t}\r\n\t}\r\n\r\n\t#renderDocumentTypes() {\r\n\t\treturn html`\r\n\t\t\t<uui-box .headline=${this._headline}>\r\n\t\t\t\t${when(\r\n\t\t\t\t\tthis._allowedDocumentTypes.length === 0,\r\n\t\t\t\t\t() => this.#renderNoDocumentTypes(),\r\n\t\t\t\t\t() =>\r\n\t\t\t\t\t\trepeat(\r\n\t\t\t\t\t\t\tthis._allowedDocumentTypes,\r\n\t\t\t\t\t\t\t(documentType) => documentType.unique,\r\n\t\t\t\t\t\t\t(documentType) => html`\r\n\t\t\t\t\t\t\t\t<uui-ref-node-document-type\r\n\t\t\t\t\t\t\t\t\t.name=${this.localize.string(documentType.name)}\r\n\t\t\t\t\t\t\t\t\t.alias=${this.localize.string(documentType.description ?? '')}\r\n\t\t\t\t\t\t\t\t\tselect-only\r\n\t\t\t\t\t\t\t\t\tselectable\r\n\t\t\t\t\t\t\t\t\t@selected=${() => this.#onSelectDocumentType(documentType.unique)}\r\n\t\t\t\t\t\t\t\t\t@open=${() => this.#onSelectDocumentType(documentType.unique)}>\r\n\t\t\t\t\t\t\t\t\t<umb-icon slot=\"icon\" name=${documentType.icon || 'icon-circle-dotted'}></umb-icon>\r\n\t\t\t\t\t\t\t\t</uui-ref-node-document-type>\r\n\t\t\t\t\t\t\t`,\r\n\t\t\t\t\t\t),\r\n\t\t\t\t)}\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderBlueprints() {\r\n\t\treturn html`\r\n\t\t\t<uui-box headline=${this.localize.term('blueprints_selectBlueprint')}>\r\n\t\t\t\t<uui-menu-item\r\n\t\t\t\t\tid=\"blank\"\r\n\t\t\t\t\tlabel=${this.localize.term('blueprints_blankBlueprint')}\r\n\t\t\t\t\t@click=${() => this.#onNavigate(this.#documentTypeUnique)}>\r\n\t\t\t\t\t<umb-icon slot=\"icon\" name=${this.#documentTypeIcon}></umb-icon>\r\n\t\t\t\t</uui-menu-item>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._availableBlueprints,\r\n\t\t\t\t\t(blueprint) => blueprint.unique,\r\n\t\t\t\t\t(blueprint) =>\r\n\t\t\t\t\t\thtml`<uui-menu-item\r\n\t\t\t\t\t\t\tlabel=${blueprint.name}\r\n\t\t\t\t\t\t\t@click=${() => this.#onNavigate(this.#documentTypeUnique, blueprint.unique)}>\r\n\t\t\t\t\t\t\t<umb-icon slot=\"icon\" name=\"icon-blueprint\"></umb-icon>\r\n\t\t\t\t\t\t</uui-menu-item>`,\r\n\t\t\t\t)}\r\n\t\t\t</uui-box>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t#blank {\r\n\t\t\t\tborder-bottom: 1px solid var(--uui-color-border);\r\n\t\t\t}\r\n\r\n\t\t\t#edit-permissions {\r\n\t\t\t\tmargin-top: var(--uui-size-6);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbDocumentCreateOptionsModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-create-options-modal': UmbDocumentCreateOptionsModalElement;\r\n\t}\r\n}\r\n"],"names":["_documentTypeStructureRepository","_documentItemRepository","_documentBlueprintItemRepository","_documentTypeUnique","_documentTypeIcon","_UmbDocumentCreateOptionsModalElement_instances","retrieveAllowedDocumentTypesOf_fn","retrieveHeadline_fn","onNavigate_fn","onSelectDocumentType_fn","renderNoDocumentTypes_fn","renderDocumentTypes_fn","renderBlueprints_fn","UmbDocumentCreateOptionsModalElement","UmbModalBaseElement","__privateAdd","UmbDocumentTypeStructureRepository","UmbDocumentItemRepository","UmbDocumentBlueprintItemRepository","parentUnique","documentTypeUnique","__privateMethod","html","when","__privateGet","unique","parentContentUnique","data","blueprintUnique","UMB_CREATE_FROM_BLUEPRINT_DOCUMENT_WORKSPACE_PATH_PATTERN","UMB_CREATE_DOCUMENT_WORKSPACE_PATH_PATTERN","__privateSet","dt","repeat","documentType","blueprint","UmbTextStyles","css","__decorateClass","state","customElement","UmbDocumentCreateOptionsModalElement$1"],"mappings":"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"}