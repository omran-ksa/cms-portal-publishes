{"version":3,"file":"document-publish-with-descendants-modal.element-BHe7VdlT.js","sources":["../../../src/packages/documents/documents/publishing/publish-with-descendants/modal/document-publish-with-descendants-modal.element.ts"],"sourcesContent":["import { UmbDocumentVariantState, type UmbDocumentVariantOptionModel } from '../../../types.js';\r\nimport { isNotPublishedMandatory } from '../../utils.js';\r\nimport type {\r\n\tUmbDocumentPublishWithDescendantsModalData,\r\n\tUmbDocumentPublishWithDescendantsModalValue,\r\n} from './document-publish-with-descendants-modal.token.js';\r\nimport { css, customElement, html, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbSelectionManager } from '@umbraco-cms/backoffice/utils';\r\n\r\nimport '../../../modals/shared/document-variant-language-picker.element.js';\r\n\r\n@customElement('umb-document-publish-with-descendants-modal')\r\nexport class UmbDocumentPublishWithDescendantsModalElement extends UmbModalBaseElement<\r\n\tUmbDocumentPublishWithDescendantsModalData,\r\n\tUmbDocumentPublishWithDescendantsModalValue\r\n> {\r\n\t#selectionManager = new UmbSelectionManager<string>(this);\r\n\t#includeUnpublishedDescendants = false;\r\n\r\n\t@state()\r\n\t_options: Array<UmbDocumentVariantOptionModel> = [];\r\n\r\n\t@state()\r\n\t_hasNotSelectedMandatory?: boolean;\r\n\r\n\t#pickableFilter = (option: UmbDocumentVariantOptionModel) => {\r\n\t\tif (!option.variant) {\r\n\t\t\t// If not data present, then its not pickable.\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\treturn this.data?.pickableFilter ? this.data.pickableFilter(option) : true;\r\n\t};\r\n\r\n\toverride firstUpdated() {\r\n\t\tthis.#configureSelectionManager();\r\n\t}\r\n\r\n\tasync #configureSelectionManager() {\r\n\t\tthis.#selectionManager.setMultiple(true);\r\n\t\tthis.#selectionManager.setSelectable(true);\r\n\r\n\t\t// Only display variants that are relevant to pick from, i.e. variants that are draft, not-published-mandatory or published with pending changes:\r\n\t\tthis._options =\r\n\t\t\tthis.data?.options.filter(\r\n\t\t\t\t(option) => isNotPublishedMandatory(option) || option.variant?.state !== UmbDocumentVariantState.NOT_CREATED,\r\n\t\t\t) ?? [];\r\n\r\n\t\tlet selected = this.value?.selection ?? [];\r\n\r\n\t\tconst validOptions = this._options.filter((o) => this.#pickableFilter!(o));\r\n\r\n\t\t// Filter selection based on options:\r\n\t\tselected = selected.filter((s) => validOptions.some((o) => o.unique === s));\r\n\r\n\t\t// Additionally select mandatory languages:\r\n\t\t// [NL]: I think for now lets make it an active choice to select the languages. If you just made them, they would be selected. So it just to underline the act of actually selecting these languages.\r\n\t\t/*\r\n\t\tthis._options.forEach((variant) => {\r\n\t\t\tif (variant.language?.isMandatory) {\r\n\t\t\t\tselected.push(variant.unique);\r\n\t\t\t}\r\n\t\t});\r\n\t\t*/\r\n\r\n\t\tthis.#selectionManager.setSelection(selected);\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#selectionManager.selection,\r\n\t\t\t(selection: Array<string>) => {\r\n\t\t\t\tif (!this._options && !selection) return;\r\n\r\n\t\t\t\t//Getting not published mandatory options â€” the options that are mandatory and not currently published.\r\n\t\t\t\tconst missingMandatoryOptions = this._options.filter(isNotPublishedMandatory);\r\n\t\t\t\tthis._hasNotSelectedMandatory = missingMandatoryOptions.some((option) => !selection.includes(option.unique));\r\n\t\t\t},\r\n\t\t\t'observeSelection',\r\n\t\t);\r\n\t}\r\n\r\n\t#onIncludeUnpublishedDescendantsChange() {\r\n\t\tthis.#includeUnpublishedDescendants = !this.#includeUnpublishedDescendants;\r\n\t}\r\n\r\n\tasync #submit() {\r\n\t\tthis.value = {\r\n\t\t\tselection: this.#selectionManager.getSelection(),\r\n\t\t\tincludeUnpublishedDescendants: this.#includeUnpublishedDescendants,\r\n\t\t};\r\n\t\tthis.modalContext?.submit();\r\n\t}\r\n\r\n\t#close() {\r\n\t\tthis.modalContext?.reject();\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`<uui-dialog-layout headline=${this.localize.term('buttons_publishDescendants')}>\r\n\t\t\t<p id=\"subtitle\">\r\n\t\t\t\t${this._options.length === 1\r\n\t\t\t\t\t? html`<umb-localize\r\n\t\t\t\t\t\t\tkey=\"content_publishDescendantsHelp\"\r\n\t\t\t\t\t\t\t.args=${[this._options[0].variant?.name ?? this._options[0].language.name]}>\r\n\t\t\t\t\t\t\tPublish <strong>${this._options[0].variant?.name}</strong> and all content items underneath and thereby\r\n\t\t\t\t\t\t\tmaking their content publicly available.\r\n\t\t\t\t\t\t</umb-localize>`\r\n\t\t\t\t\t: html`\r\n\t\t\t\t\t\t\t<umb-localize key=\"content_publishDescendantsWithVariantsHelp\">\r\n\t\t\t\t\t\t\t\tPublish variants and variants of same type underneath and thereby making their content publicly\r\n\t\t\t\t\t\t\t\tavailable.\r\n\t\t\t\t\t\t\t</umb-localize>\r\n\t\t\t\t\t\t`}\r\n\t\t\t</p>\r\n\r\n\t\t\t<umb-document-variant-language-picker\r\n\t\t\t\t.selectionManager=${this.#selectionManager}\r\n\t\t\t\t.variantLanguageOptions=${this._options}\r\n\t\t\t\t.requiredFilter=${isNotPublishedMandatory}\r\n\t\t\t\t.pickableFilter=${this.#pickableFilter}></umb-document-variant-language-picker>\r\n\r\n\t\t\t<uui-form-layout-item>\r\n\t\t\t\t<uui-toggle\r\n\t\t\t\t\tid=\"includeUnpublishedDescendants\"\r\n\t\t\t\t\tlabel=${this.localize.term('content_includeUnpublished')}\r\n\t\t\t\t\t?checked=${this.value?.includeUnpublishedDescendants}\r\n\t\t\t\t\t@change=${this.#onIncludeUnpublishedDescendantsChange}></uui-toggle>\r\n\t\t\t</uui-form-layout-item>\r\n\r\n\t\t\t<div slot=\"actions\">\r\n\t\t\t\t<uui-button label=${this.localize.term('general_close')} @click=${this.#close}></uui-button>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tlabel=\"${this.localize.term('buttons_publishDescendants')}\"\r\n\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t?disabled=${this._hasNotSelectedMandatory}\r\n\t\t\t\t\t@click=${this.#submit}></uui-button>\r\n\t\t\t</div>\r\n\t\t</uui-dialog-layout> `;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\tmin-width: 460px;\r\n\t\t\t\tmax-width: 90vw;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbDocumentPublishWithDescendantsModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-publish-with-descendants-modal': UmbDocumentPublishWithDescendantsModalElement;\r\n\t}\r\n}\r\n"],"names":["_selectionManager","_includeUnpublishedDescendants","_pickableFilter","_UmbDocumentPublishWithDescendantsModalElement_instances","configureSelectionManager_fn","onIncludeUnpublishedDescendantsChange_fn","submit_fn","close_fn","UmbDocumentPublishWithDescendantsModalElement","UmbModalBaseElement","__privateAdd","UmbSelectionManager","option","__privateMethod","html","__privateGet","isNotPublishedMandatory","UmbDocumentVariantState","selected","validOptions","o","s","selection","missingMandatoryOptions","__privateSet","UmbTextStyles","css","__decorateClass","state","customElement","UmbDocumentPublishWithDescendantsModalElement$1"],"mappings":"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"}