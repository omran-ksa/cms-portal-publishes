{"version":3,"file":"document-blueprint-workspace-editor.element-jwIXg1cx.js","sources":["../../../src/packages/documents/document-blueprints/workspace/document-blueprint-workspace-split-view.element.ts","../../../src/packages/documents/document-blueprints/workspace/document-blueprint-workspace-editor.element.ts"],"sourcesContent":["import { UMB_DOCUMENT_BLUEPRINT_WORKSPACE_ALIAS, UMB_DOCUMENT_BLUEPRINT_WORKSPACE_CONTEXT } from './constants.js';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { css, html, nothing, customElement, state, repeat } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { ActiveVariant } from '@umbraco-cms/backoffice/workspace';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\n\r\n@customElement('umb-document-blueprint-workspace-split-view')\r\nexport class UmbDocumentBlueprintWorkspaceSplitViewElement extends UmbLitElement {\r\n\t// TODO: Refactor: use the split view context token:\r\n\tprivate _workspaceContext?: typeof UMB_DOCUMENT_BLUEPRINT_WORKSPACE_CONTEXT.TYPE;\r\n\r\n\t@state()\r\n\t_variants?: Array<ActiveVariant>;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\t// TODO: Refactor: use a split view workspace context token:\r\n\t\tthis.consumeContext(UMB_DOCUMENT_BLUEPRINT_WORKSPACE_CONTEXT, (context) => {\r\n\t\t\tthis._workspaceContext = context;\r\n\t\t\tthis._observeActiveVariantInfo();\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _observeActiveVariantInfo() {\r\n\t\tif (!this._workspaceContext) return;\r\n\t\tthis.observe(\r\n\t\t\tthis._workspaceContext.splitView.activeVariantsInfo,\r\n\t\t\t(variants) => {\r\n\t\t\t\tthis._variants = variants;\r\n\t\t\t},\r\n\t\t\t'_observeActiveVariantsInfo',\r\n\t\t);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn this._variants\r\n\t\t\t? html`<div id=\"splitViews\">\r\n\t\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\t\tthis._variants,\r\n\t\t\t\t\t\t\t(view) =>\r\n\t\t\t\t\t\t\t\tview.index + '_' + (view.culture ?? '') + '_' + (view.segment ?? '') + '_' + this._variants!.length,\r\n\t\t\t\t\t\t\t(view) => html`\r\n\t\t\t\t\t\t\t\t<umb-workspace-split-view\r\n\t\t\t\t\t\t\t\t\t.splitViewIndex=${view.index}\r\n\t\t\t\t\t\t\t\t\t.displayNavigation=${view.index === this._variants!.length - 1}></umb-workspace-split-view>\r\n\t\t\t\t\t\t\t`,\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<umb-workspace-footer alias=${UMB_DOCUMENT_BLUEPRINT_WORKSPACE_ALIAS}></umb-workspace-footer>`\r\n\t\t\t: nothing;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t}\r\n\r\n\t\t\t#splitViews {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: calc(100% - var(--umb-footer-layout-height));\r\n\t\t\t}\r\n\r\n\t\t\t#breadcrumbs {\r\n\t\t\t\tmargin: 0 var(--uui-size-layout-1);\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbDocumentBlueprintWorkspaceSplitViewElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-blueprint-workspace-split-view': UmbDocumentBlueprintWorkspaceSplitViewElement;\r\n\t}\r\n}\r\n","import type { UmbDocumentBlueprintVariantOptionModel } from '../types.js';\r\nimport { UMB_DOCUMENT_BLUEPRINT_WORKSPACE_CONTEXT } from './document-blueprint-workspace.context-token.js';\r\nimport { UmbDocumentBlueprintWorkspaceSplitViewElement } from './document-blueprint-workspace-split-view.element.js';\r\nimport { customElement, state, css, html } from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { UmbRoute, UmbRouterSlotInitEvent } from '@umbraco-cms/backoffice/router';\r\n\r\n@customElement('umb-document-blueprint-workspace-editor')\r\nexport class UmbDocumentBlueprintWorkspaceEditorElement extends UmbLitElement {\r\n\t//\r\n\t// TODO: Refactor: when having a split view/variants context token, we can rename the split view/variants component to a generic and make this component generic as well. [NL]\r\n\tprivate splitViewElement = new UmbDocumentBlueprintWorkspaceSplitViewElement();\r\n\r\n\t#workspaceContext?: typeof UMB_DOCUMENT_BLUEPRINT_WORKSPACE_CONTEXT.TYPE;\r\n\t#variants?: Array<UmbDocumentBlueprintVariantOptionModel>;\r\n\t#isForbidden = false;\r\n\r\n\t@state()\r\n\t_routes?: Array<UmbRoute>;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\t\tthis.consumeContext(UMB_DOCUMENT_BLUEPRINT_WORKSPACE_CONTEXT, (instance) => {\r\n\t\t\tthis.#workspaceContext = instance;\r\n\t\t\tthis.#observeVariants();\r\n\t\t\tthis.#observeForbidden();\r\n\t\t});\r\n\t}\r\n\r\n\t#observeVariants() {\r\n\t\tif (!this.#workspaceContext) return;\r\n\t\tthis.observe(\r\n\t\t\tthis.#workspaceContext.variantOptions,\r\n\t\t\t(variants) => {\r\n\t\t\t\tthis.#variants = variants;\r\n\t\t\t\tthis._generateRoutes();\r\n\t\t\t},\r\n\t\t\t'_observeVariants',\r\n\t\t);\r\n\t}\r\n\r\n\t#observeForbidden() {\r\n\t\tthis.observe(\r\n\t\t\tthis.#workspaceContext?.forbidden.isOn,\r\n\t\t\t(isForbidden) => {\r\n\t\t\t\tthis.#isForbidden = isForbidden ?? false;\r\n\t\t\t\tthis._generateRoutes();\r\n\t\t\t},\r\n\t\t\t'_observeForbidden',\r\n\t\t);\r\n\t}\r\n\r\n\tprivate _handleVariantFolderPart(index: number, folderPart: string) {\r\n\t\tconst variantSplit = folderPart.split('_');\r\n\t\tconst culture = variantSplit[0];\r\n\t\tconst segment = variantSplit[1];\r\n\t\tthis.#workspaceContext?.splitView.setActiveVariant(index, culture, segment);\r\n\t}\r\n\r\n\tprivate async _generateRoutes() {\r\n\t\t// Generate split view routes for all available routes\r\n\t\tconst routes: Array<UmbRoute> = [];\r\n\r\n\t\t// Split view routes:\r\n\t\tthis.#variants?.forEach((variantA) => {\r\n\t\t\tthis.#variants?.forEach((variantB) => {\r\n\t\t\t\troutes.push({\r\n\t\t\t\t\t// TODO: When implementing Segments, be aware if using the unique is URL Safe... [NL]\r\n\t\t\t\t\tpath: variantA.unique + '_&_' + variantB.unique,\r\n\t\t\t\t\tcomponent: this.splitViewElement,\r\n\t\t\t\t\tsetup: (_component, info) => {\r\n\t\t\t\t\t\t// Set split view/active info..\r\n\t\t\t\t\t\tconst variantSplit = info.match.fragments.consumed.split('_&_');\r\n\t\t\t\t\t\tvariantSplit.forEach((part, index) => {\r\n\t\t\t\t\t\t\tthis._handleVariantFolderPart(index, part);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\t// Single view:\r\n\t\tthis.#variants?.forEach((variant) => {\r\n\t\t\troutes.push({\r\n\t\t\t\t// TODO: When implementing Segments, be aware if using the unique is URL Safe... [NL]\r\n\t\t\t\tpath: variant.unique,\r\n\t\t\t\tcomponent: this.splitViewElement,\r\n\t\t\t\tsetup: (_component, info) => {\r\n\t\t\t\t\t// cause we might come from a split-view, we need to reset index 1.\r\n\t\t\t\t\tthis.#workspaceContext?.splitView.removeActiveVariant(1);\r\n\t\t\t\t\tthis._handleVariantFolderPart(0, info.match.fragments.consumed);\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\tif (routes.length !== 0 && this.#variants?.length) {\r\n\t\t\t// Using first single view as the default route for now (hence the math below):\r\n\t\t\troutes.push({\r\n\t\t\t\tpath: '',\r\n\t\t\t\tpathMatch: 'full',\r\n\t\t\t\tredirectTo: routes[this.#variants.length * this.#variants.length]?.path,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\troutes.push({\r\n\t\t\tpath: `**`,\r\n\t\t\tcomponent: async () => {\r\n\t\t\t\tconst router = await import('@umbraco-cms/backoffice/router');\r\n\t\t\t\treturn this.#isForbidden ? router.UmbRouteForbiddenElement : router.UmbRouteNotFoundElement;\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tthis._routes = routes;\r\n\t}\r\n\r\n\tprivate _gotWorkspaceRoute = (e: UmbRouterSlotInitEvent) => {\r\n\t\tthis.#workspaceContext?.splitView.setWorkspaceRoute(e.target.absoluteRouterPath);\r\n\t};\r\n\r\n\toverride render() {\r\n\t\treturn this._routes\r\n\t\t\t? html`<umb-router-slot .routes=${this._routes} @init=${this._gotWorkspaceRoute}></umb-router-slot>`\r\n\t\t\t: '';\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tdisplay: block;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\theight: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbDocumentBlueprintWorkspaceEditorElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-document-blueprint-workspace-editor': UmbDocumentBlueprintWorkspaceEditorElement;\r\n\t}\r\n}\r\n"],"names":["UmbDocumentBlueprintWorkspaceSplitViewElement","UmbLitElement","UMB_DOCUMENT_BLUEPRINT_WORKSPACE_CONTEXT","context","variants","html","repeat","view","UMB_DOCUMENT_BLUEPRINT_WORKSPACE_ALIAS","nothing","UmbTextStyles","css","__decorateClass","state","customElement","_workspaceContext","_variants","_isForbidden","_UmbDocumentBlueprintWorkspaceEditorElement_instances","observeVariants_fn","observeForbidden_fn","UmbDocumentBlueprintWorkspaceEditorElement","__privateAdd","e","__privateGet","instance","__privateSet","__privateMethod","index","folderPart","variantSplit","culture","segment","routes","variantA","variantB","_component","info","part","variant","router","isForbidden","UmbDocumentBlueprintWorkspaceEditorElement$1"],"mappings":"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"}