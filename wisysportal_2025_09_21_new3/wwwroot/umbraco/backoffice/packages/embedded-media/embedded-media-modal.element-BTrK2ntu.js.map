{"version":3,"file":"embedded-media-modal.element-BTrK2ntu.js","sources":["../../../src/packages/embedded-media/modal/embedded-media-modal.element.ts"],"sourcesContent":["import { UmbOEmbedRepository } from '../repository/oembed.repository.js';\r\nimport type { UmbEmbeddedMediaModalData, UmbEmbeddedMediaModalValue } from './embedded-media-modal.token.js';\r\nimport { css, html, unsafeHTML, when, customElement, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { umbFocus } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbModalBaseElement } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport type { UUIButtonState, UUIInputEvent } from '@umbraco-cms/backoffice/external/uui';\r\n\r\n@customElement('umb-embedded-media-modal')\r\nexport class UmbEmbeddedMediaModalElement extends UmbModalBaseElement<\r\n\tUmbEmbeddedMediaModalData,\r\n\tUmbEmbeddedMediaModalValue\r\n> {\r\n\t#oEmbedRepository = new UmbOEmbedRepository(this);\r\n\t#validUrl?: string;\r\n\r\n\t@state()\r\n\tprivate _loading?: UUIButtonState;\r\n\r\n\t@state()\r\n\tprivate _width = 360;\r\n\r\n\t@state()\r\n\tprivate _height = 240;\r\n\r\n\t@state()\r\n\tprivate _url = '';\r\n\r\n\toverride connectedCallback() {\r\n\t\tsuper.connectedCallback();\r\n\r\n\t\tif (this.data?.width) this._width = this.data.width;\r\n\t\tif (this.data?.height) this._height = this.data.height;\r\n\t\tif (this.data?.constrain) this.value = { ...this.value, constrain: this.data.constrain };\r\n\r\n\t\tif (this.data?.url) {\r\n\t\t\tthis._url = this.data.url;\r\n\t\t\tthis.#getPreview();\r\n\t\t}\r\n\t}\r\n\r\n\tasync #getPreview() {\r\n\t\tthis._loading = 'waiting';\r\n\r\n\t\tconst { data } = await this.#oEmbedRepository.requestOEmbed({\r\n\t\t\turl: this._url,\r\n\t\t\tmaxWidth: this._width > 0 ? this._width : undefined,\r\n\t\t\tmaxHeight: this._height > 0 ? this._height : undefined,\r\n\t\t});\r\n\r\n\t\tif (data) {\r\n\t\t\tthis.#validUrl = this._url;\r\n\t\t\tthis.value = { ...this.value, markup: data.markup, url: this.#validUrl };\r\n\t\t\tthis._loading = 'success';\r\n\t\t} else {\r\n\t\t\tthis.#validUrl = undefined;\r\n\t\t\tthis._loading = 'failed';\r\n\t\t}\r\n\t}\r\n\r\n\t#onUrlChange(e: UUIInputEvent) {\r\n\t\tthis._url = e.target.value as string;\r\n\t}\r\n\r\n\t#onWidthChange(e: UUIInputEvent) {\r\n\t\tthis._width = parseInt(e.target.value as string, 10);\r\n\t\tthis.value = { ...this.value, width: this._width };\r\n\t\tthis.#getPreview();\r\n\t}\r\n\r\n\t#onHeightChange(e: UUIInputEvent) {\r\n\t\tthis._height = parseInt(e.target.value as string, 10);\r\n\t\tthis.value = { ...this.value, height: this._height };\r\n\t\tthis.#getPreview();\r\n\t}\r\n\r\n\t#onConstrainChange() {\r\n\t\tconst constrain = !this.value?.constrain;\r\n\t\tthis.value = { ...this.value, constrain };\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout headline=\"Embed\">\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t<umb-property-layout label=${this.localize.term('general_url')} orientation=\"vertical\">\r\n\t\t\t\t\t\t<div slot=\"editor\">\r\n\t\t\t\t\t\t\t<uui-input id=\"url\" .value=${this._url} @input=${this.#onUrlChange} required=\"true\" ${umbFocus()}>\r\n\t\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\t\tslot=\"append\"\r\n\t\t\t\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\t\t\t\t@click=${this.#getPreview}\r\n\t\t\t\t\t\t\t\t\tlabel=${this.localize.term('general_retrieve')}></uui-button>\r\n\t\t\t\t\t\t\t</uui-input>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</umb-property-layout>\r\n\r\n\t\t\t\t\t${when(\r\n\t\t\t\t\t\tthis.#validUrl !== undefined,\r\n\t\t\t\t\t\t() =>\r\n\t\t\t\t\t\t\thtml` <umb-property-layout label=${this.localize.term('general_preview')} orientation=\"vertical\">\r\n\t\t\t\t\t\t\t\t<div slot=\"editor\">\r\n\t\t\t\t\t\t\t\t\t${when(this._loading === 'waiting', () => html`<uui-loader-circle></uui-loader-circle>`)}\r\n\t\t\t\t\t\t\t\t\t${when(this.value?.markup, () => html`${unsafeHTML(this.value.markup)}`)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</umb-property-layout>`,\r\n\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t<umb-property-layout label=${this.localize.term('general_width')} orientation=\"vertical\">\r\n\t\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\t\tslot=\"editor\"\r\n\t\t\t\t\t\t\t.value=${this._width}\r\n\t\t\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\t\t\t@change=${this.#onWidthChange}\r\n\t\t\t\t\t\t\t?disabled=${this.#validUrl ? false : true}></uui-input>\r\n\t\t\t\t\t</umb-property-layout>\r\n\r\n\t\t\t\t\t<umb-property-layout label=${this.localize.term('general_height')} orientation=\"vertical\">\r\n\t\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\t\tslot=\"editor\"\r\n\t\t\t\t\t\t\t.value=${this._height}\r\n\t\t\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\t\t\t@change=${this.#onHeightChange}\r\n\t\t\t\t\t\t\t?disabled=${this.#validUrl ? false : true}></uui-input>\r\n\t\t\t\t\t</umb-property-layout>\r\n\r\n\t\t\t\t\t<umb-property-layout label=${this.localize.term('general_constrainProportions')} orientation=\"vertical\">\r\n\t\t\t\t\t\t<uui-toggle\r\n\t\t\t\t\t\t\tslot=\"editor\"\r\n\t\t\t\t\t\t\t@change=${this.#onConstrainChange}\r\n\t\t\t\t\t\t\t.checked=${this.value?.constrain ?? false}></uui-toggle>\r\n\t\t\t\t\t</umb-property-layout>\r\n\t\t\t\t</uui-box>\r\n\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\tid=\"cancel\"\r\n\t\t\t\t\tlabel=${this.localize.term('buttons_confirmActionCancel')}\r\n\t\t\t\t\t@click=${() => this.modalContext?.reject()}></uui-button>\r\n\t\t\t\t<uui-button\r\n\t\t\t\t\tslot=\"actions\"\r\n\t\t\t\t\tid=\"submit\"\r\n\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\tlabel=${this.localize.term('buttons_confirmActionConfirm')}\r\n\t\t\t\t\t@click=${() => this.modalContext?.submit()}></uui-button>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\tuui-input {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\t--uui-button-border-radius: 0;\r\n\t\t\t}\r\n\r\n\t\t\tumb-property-layout:first-child {\r\n\t\t\t\tpadding-top: 0;\r\n\t\t\t}\r\n\r\n\t\t\tumb-property-layout:last-child {\r\n\t\t\t\tpadding-bottom: 0;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbEmbeddedMediaModalElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-embedded-media-modal': UmbEmbeddedMediaModalElement;\r\n\t}\r\n}\r\n"],"names":["_oEmbedRepository","_validUrl","_UmbEmbeddedMediaModalElement_instances","getPreview_fn","onUrlChange_fn","onWidthChange_fn","onHeightChange_fn","onConstrainChange_fn","UmbEmbeddedMediaModalElement","UmbModalBaseElement","__privateAdd","UmbOEmbedRepository","__privateMethod","html","umbFocus","when","__privateGet","unsafeHTML","data","__privateSet","e","constrain","UmbTextStyles","css","__decorateClass","state","customElement","UmbEmbeddedMediaModalElement$1"],"mappings":"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"}