{"version":3,"file":"content-type-design-editor.element-DxZdtbOy.js","sources":["../../../src/packages/content/content-type/workspace/views/design/content-type-design-editor.context.ts","../../../src/packages/content/content-type/workspace/views/design/content-type-design-editor.element.ts"],"sourcesContent":["import { UMB_CONTENT_TYPE_DESIGN_EDITOR_CONTEXT } from './content-type-design-editor.context-token.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbContextBase } from '@umbraco-cms/backoffice/class-api';\r\nimport { UmbBooleanState } from '@umbraco-cms/backoffice/observable-api';\r\n\r\nexport class UmbContentTypeDesignEditorContext extends UmbContextBase {\r\n\t#isSorting = new UmbBooleanState(false);\r\n\treadonly isSorting = this.#isSorting.asObservable();\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_CONTENT_TYPE_DESIGN_EDITOR_CONTEXT);\r\n\t}\r\n\r\n\tgetIsSorting() {\r\n\t\treturn this.#isSorting.getValue();\r\n\t}\r\n\r\n\tsetIsSorting(isSorting: boolean) {\r\n\t\tthis.#isSorting.setValue(isSorting);\r\n\t}\r\n\r\n\tpublic override destroy(): void {\r\n\t\tthis.#isSorting.destroy();\r\n\t\tsuper.destroy();\r\n\t}\r\n}\r\n\r\nexport { UmbContentTypeDesignEditorContext as api };\r\n","import { UMB_CONTENT_TYPE_WORKSPACE_CONTEXT } from '../../content-type-workspace.context-token.js';\r\nimport type {\r\n\tUmbContentTypeCompositionModel,\r\n\tUmbContentTypeModel,\r\n\tUmbPropertyTypeContainerModel,\r\n} from '../../../types.js';\r\nimport {\r\n\tUmbContentTypeContainerStructureHelper,\r\n\tUmbContentTypeMoveRootGroupsIntoFirstTabHelper,\r\n} from '../../../structure/index.js';\r\nimport { UMB_COMPOSITION_PICKER_MODAL } from '../../../modals/constants.js';\r\nimport type { UmbContentTypeDesignEditorTabElement } from './content-type-design-editor-tab.element.js';\r\nimport { UmbContentTypeDesignEditorContext } from './content-type-design-editor.context.js';\r\nimport { css, html, customElement, state, repeat, ifDefined, nothing } from '@umbraco-cms/backoffice/external/lit';\r\nimport type { UUIInputElement, UUIInputEvent, UUITabElement } from '@umbraco-cms/backoffice/external/uui';\r\nimport { encodeFolderName } from '@umbraco-cms/backoffice/router';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { CompositionTypeModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type {\r\n\tIComponentRoute,\r\n\tUmbRoute,\r\n\tUmbRouterSlotChangeEvent,\r\n\tUmbRouterSlotInitEvent,\r\n} from '@umbraco-cms/backoffice/router';\r\nimport type {\r\n\tManifestWorkspaceViewContentTypeDesignEditorKind,\r\n\tUmbWorkspaceViewElement,\r\n} from '@umbraco-cms/backoffice/workspace';\r\nimport type { UmbConfirmModalData } from '@umbraco-cms/backoffice/modal';\r\nimport { umbConfirmModal, umbOpenModal } from '@umbraco-cms/backoffice/modal';\r\nimport { UmbTextStyles } from '@umbraco-cms/backoffice/style';\r\nimport { UmbSorterController } from '@umbraco-cms/backoffice/sorter';\r\n\r\n@customElement('umb-content-type-design-editor')\r\nexport class UmbContentTypeDesignEditorElement extends UmbLitElement implements UmbWorkspaceViewElement {\r\n\t#sorter = new UmbSorterController<UmbPropertyTypeContainerModel, UUITabElement>(this, {\r\n\t\tgetUniqueOfElement: (element) => element.getAttribute('data-umb-tab-id'),\r\n\t\tgetUniqueOfModel: (tab) => tab.id,\r\n\t\tidentifier: 'content-type-tabs-sorter',\r\n\t\titemSelector: 'uui-tab',\r\n\t\tcontainerSelector: 'uui-tab-group',\r\n\t\tdisabledItemSelector: ':not([sortable])',\r\n\t\tresolvePlacement: (args) => args.relatedRect.left + args.relatedRect.width * 0.5 > args.pointerX,\r\n\t\tonChange: ({ model }) => {\r\n\t\t\tthis._tabs = model;\r\n\t\t},\r\n\t\tonEnd: ({ item }) => {\r\n\t\t\t/**\r\n\t\t\t * Explanation: If the item is the first in list, we compare it to the item behind it to set a sortOrder.\r\n\t\t\t * If it's not the first in list, we will compare to the item in before it, and check the following item to see if it caused overlapping sortOrder, then update\r\n\t\t\t * the overlap if true, which may cause another overlap, so we loop through them till no more overlaps...\r\n\t\t\t */\r\n\t\t\tconst model = this._tabs ?? [];\r\n\t\t\tconst newIndex = model.findIndex((entry) => entry.id === item.id);\r\n\r\n\t\t\t// Doesn't exist in model\r\n\t\t\tif (newIndex === -1) return;\r\n\r\n\t\t\t// As origin we set prev sort order to -1, so if no other then our item will become 0\r\n\t\t\tlet prevSortOrder = -1;\r\n\r\n\t\t\t// If not first in list, then get the sortOrder of the item before.  [NL]\r\n\t\t\tif (newIndex > 0 && model.length > 0) {\r\n\t\t\t\tprevSortOrder = model[newIndex - 1].sortOrder;\r\n\t\t\t}\r\n\r\n\t\t\t// increase the prevSortOrder and use it for the moved item,\r\n\t\t\tthis.#tabsStructureHelper.partialUpdateContainer(item.id, {\r\n\t\t\t\tsortOrder: ++prevSortOrder,\r\n\t\t\t});\r\n\r\n\t\t\t// Adjust everyone right after, until there is a gap between the sortOrders: [NL]\r\n\t\t\tlet i = newIndex + 1;\r\n\t\t\tlet entry: UmbPropertyTypeContainerModel | undefined;\r\n\t\t\t// As long as there is an item with the index & the sortOrder is less or equal to the prevSortOrder, we will update the sortOrder:\r\n\t\t\twhile ((entry = model[i]) !== undefined && entry.sortOrder <= prevSortOrder) {\r\n\t\t\t\t// Increase the prevSortOrder and use it for the item:\r\n\t\t\t\tthis.#tabsStructureHelper.partialUpdateContainer(entry.id, {\r\n\t\t\t\t\tsortOrder: ++prevSortOrder,\r\n\t\t\t\t});\r\n\r\n\t\t\t\ti++;\r\n\t\t\t}\r\n\t\t},\r\n\t});\r\n\r\n\t#workspaceContext?: (typeof UMB_CONTENT_TYPE_WORKSPACE_CONTEXT)['TYPE'];\r\n\t#designContext = new UmbContentTypeDesignEditorContext(this);\r\n\t#tabsStructureHelper = new UmbContentTypeContainerStructureHelper<UmbContentTypeModel>(this);\r\n\t#currentTabComponent?: UmbContentTypeDesignEditorTabElement;\r\n\t#processingTabId?: string;\r\n\r\n\tset manifest(value: ManifestWorkspaceViewContentTypeDesignEditorKind) {\r\n\t\tthis._compositionRepositoryAlias = value.meta.compositionRepositoryAlias;\r\n\t}\r\n\r\n\t@state()\r\n\tprivate _compositionRepositoryAlias?: string;\r\n\t//private _hasRootProperties = false;\r\n\r\n\t@state()\r\n\tprivate _hasRootGroups = false;\r\n\r\n\t@state()\r\n\tprivate _routes: UmbRoute[] = [];\r\n\r\n\t@state()\r\n\tprivate _tabs?: Array<UmbPropertyTypeContainerModel>;\r\n\r\n\t@state()\r\n\tprivate _routerPath?: string;\r\n\r\n\t@state()\r\n\tprivate _activePath = '';\r\n\r\n\t@state()\r\n\tprivate _sortModeActive?: boolean;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.#sorter.disable();\r\n\r\n\t\tthis.observe(\r\n\t\t\tthis.#designContext.isSorting,\r\n\t\t\t(isSorting) => {\r\n\t\t\t\tthis._sortModeActive = isSorting;\r\n\t\t\t\tif (isSorting) {\r\n\t\t\t\t\tthis.#sorter.enable();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.#sorter.disable();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tnull,\r\n\t\t);\r\n\r\n\t\tthis.#tabsStructureHelper.setContainerChildType('Tab');\r\n\t\tthis.#tabsStructureHelper.setIsRoot(true);\r\n\t\tthis.observe(this.#tabsStructureHelper.mergedContainers, (tabs) => {\r\n\t\t\tthis._tabs = tabs;\r\n\t\t\tthis.#sorter.setModel(tabs);\r\n\t\t\tthis.#createRoutes();\r\n\t\t});\r\n\r\n\t\t// _hasRootProperties can be gotten via _tabsStructureHelper.hasProperties. But we do not support root properties currently.\r\n\r\n\t\tthis.consumeContext(UMB_CONTENT_TYPE_WORKSPACE_CONTEXT, (workspaceContext) => {\r\n\t\t\tthis.#workspaceContext = workspaceContext;\r\n\t\t\tthis.#tabsStructureHelper.setStructureManager(workspaceContext?.structure);\r\n\r\n\t\t\tthis.#observeRootGroups();\r\n\t\t});\r\n\t}\r\n\r\n\t#toggleSortMode() {\r\n\t\tthis.#designContext?.setIsSorting(!this._sortModeActive);\r\n\t}\r\n\r\n\tasync #observeRootGroups() {\r\n\t\tif (!this.#workspaceContext) return;\r\n\r\n\t\tthis.observe(\r\n\t\t\tawait this.#workspaceContext.structure.hasRootContainers('Group'),\r\n\t\t\t(hasRootGroups) => {\r\n\t\t\t\tthis._hasRootGroups = hasRootGroups;\r\n\t\t\t\tthis.#createRoutes();\r\n\t\t\t},\r\n\t\t\t'_observeGroups',\r\n\t\t);\r\n\t}\r\n\r\n\t#createRoutes() {\r\n\t\t// TODO: How about storing a set of elements based on tab ids? to prevent re-initializing the element when renaming..[NL]\r\n\t\tif (!this.#workspaceContext || !this._tabs || this._hasRootGroups === undefined) return;\r\n\t\tconst routes: UmbRoute[] = [];\r\n\r\n\t\t// We gather the activeTab name to check for rename, this is a bit hacky way to redirect the user without noticing the url changes to the new name [NL]\r\n\t\tlet activeTabName: string | undefined = undefined;\r\n\r\n\t\tif (this._tabs.length > 0) {\r\n\t\t\tthis._tabs?.forEach((tab) => {\r\n\t\t\t\tconst tabName = tab.name && tab.name !== '' ? tab.name : '-';\r\n\t\t\t\tif (tab.id === this.#processingTabId) {\r\n\t\t\t\t\tactiveTabName = tabName;\r\n\t\t\t\t}\r\n\t\t\t\troutes.push({\r\n\t\t\t\t\tpath: `tab/${encodeFolderName(tabName)}`,\r\n\t\t\t\t\tcomponent: () => import('./content-type-design-editor-tab.element.js'),\r\n\t\t\t\t\tsetup: (component) => {\r\n\t\t\t\t\t\tthis.#currentTabComponent = component as UmbContentTypeDesignEditorTabElement;\r\n\t\t\t\t\t\tthis.#currentTabComponent.containerId = tab.id;\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (this._hasRootGroups || this._tabs.length === 0) {\r\n\t\t\troutes.push({\r\n\t\t\t\tpath: 'root',\r\n\t\t\t\tcomponent: () => import('./content-type-design-editor-tab.element.js'),\r\n\t\t\t\tsetup: (component) => {\r\n\t\t\t\t\tthis.#currentTabComponent = component as UmbContentTypeDesignEditorTabElement;\r\n\t\t\t\t\tthis.#currentTabComponent.containerId = null;\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t\troutes.push({\r\n\t\t\t\tpath: '',\r\n\t\t\t\tpathMatch: 'full',\r\n\t\t\t\tredirectTo: 'root',\r\n\t\t\t\tguards: [() => this.#processingTabId === undefined],\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\troutes.push({\r\n\t\t\t\tpath: '',\r\n\t\t\t\tpathMatch: 'full',\r\n\t\t\t\tredirectTo: routes[0]?.path,\r\n\t\t\t\tguards: [() => this.#processingTabId === undefined],\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tif (routes.length !== 0) {\r\n\t\t\troutes.push({\r\n\t\t\t\tpath: `**`,\r\n\t\t\t\tcomponent: async () => (await import('@umbraco-cms/backoffice/router')).UmbRouteNotFoundElement,\r\n\t\t\t\tguards: [() => this.#processingTabId === undefined],\r\n\t\t\t\tsetup: () => {\r\n\t\t\t\t\tthis.#currentTabComponent = undefined;\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\troutes.push({\r\n\t\t\t\tpath: `**`,\r\n\t\t\t\tcomponent: async () => (await import('@umbraco-cms/backoffice/router')).UmbRouteNotFoundElement,\r\n\t\t\t\tsetup: () => {\r\n\t\t\t\t\tthis.#currentTabComponent = undefined;\r\n\t\t\t\t},\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis._routes = routes;\r\n\r\n\t\t// If we have a active tab, then we want to make sure its up to date with latest tab id, as an already active route is not getting its setup method triggered again [NL]\r\n\t\tif (this._activePath && this.#currentTabComponent) {\r\n\t\t\tconst route = routes.find((x) => this._routerPath + '/' + x.path === this._activePath) as\r\n\t\t\t\t| IComponentRoute\r\n\t\t\t\t| undefined;\r\n\t\t\troute?.setup?.(this.#currentTabComponent, undefined as any);\r\n\t\t}\r\n\r\n\t\t// If we have an active tab name, then we might have a active tab name re-name, then we will redirect to the new name if it has been changed: [NL]\r\n\t\tif (activeTabName !== undefined) {\r\n\t\t\tif (this._activePath && this._routerPath) {\r\n\t\t\t\tconst oldPath = this._activePath.split(this._routerPath)[1];\r\n\t\t\t\tconst newPath = '/tab/' + encodeFolderName(activeTabName);\r\n\t\t\t\tif (oldPath !== newPath) {\r\n\t\t\t\t\t// Lets cheat a bit and update the activePath already, in this way our input does not loose focus [NL]\r\n\t\t\t\t\tthis._activePath = this._routerPath + newPath;\r\n\t\t\t\t\t// Update the current URL, so we are still on this specific tab: [NL]\r\n\t\t\t\t\twindow.history.replaceState(null, '', this._activePath);\r\n\r\n\t\t\t\t\t// TODO: We have some flickering when renaming, this could potentially be fixed if we cache the view and re-use it if the same is requested [NL]\r\n\t\t\t\t\t// Or maybe its just about we just send the updated tabName to the view, and let it handle the update itself [NL]\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tasync #requestDeleteTab(tab: UmbPropertyTypeContainerModel | undefined) {\r\n\t\tif (!tab) return;\r\n\t\t// TODO: Localize this:\r\n\t\tconst tabName = tab.name === '' ? 'Unnamed' : tab.name;\r\n\t\t// TODO: Localize this:\r\n\t\tconst modalData: UmbConfirmModalData = {\r\n\t\t\theadline: 'Delete tab',\r\n\t\t\tcontent: html`<umb-localize key=\"contentTypeEditor_confirmDeleteTabMessage\" .args=${[tabName]}>\r\n\t\t\t\t\tAre you sure you want to delete the tab <strong>${tabName}</strong>\r\n\t\t\t\t</umb-localize>\r\n\t\t\t\t<div style=\"color:var(--uui-color-danger-emphasis)\">\r\n\t\t\t\t\t<umb-localize key=\"contentTypeEditor_confirmDeleteTabNotice\">\r\n\t\t\t\t\t\tThis will delete all items that doesn't belong to a composition.\r\n\t\t\t\t\t</umb-localize>\r\n\t\t\t\t</div>`,\r\n\t\t\tconfirmLabel: this.localize.term('actions_delete'),\r\n\t\t\tcolor: 'danger',\r\n\t\t};\r\n\r\n\t\t// TODO: If this tab is composed of other tabs, then notify that it will only delete the local tab. [NL]\r\n\r\n\t\tawait umbConfirmModal(this, modalData);\r\n\r\n\t\tthis.#deleteTab(tab?.id);\r\n\t}\r\n\t#deleteTab(tabId?: string) {\r\n\t\tif (!tabId) return;\r\n\t\tthis.#workspaceContext?.structure.removeContainer(null, tabId);\r\n\t\tif (this.#processingTabId === tabId) {\r\n\t\t\tthis.#processingTabId = undefined;\r\n\t\t}\r\n\t}\r\n\tasync #addTab() {\r\n\t\t// If there is already a Tab with no name, then focus it instead of adding a new one: [NL]\r\n\t\t// TODO: Optimize this so it looks at the data instead of the DOM [NL]\r\n\t\tconst inputEl = this.shadowRoot?.querySelector('uui-tab[active] uui-input') as UUIInputElement;\r\n\t\tif (inputEl?.value === '') {\r\n\t\t\tthis.#focusInput();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (!this.#workspaceContext) {\r\n\t\t\tthrow new Error('Workspace context has not been found');\r\n\t\t}\r\n\r\n\t\tif (!this._tabs) return;\r\n\r\n\t\tconst len = this._tabs.length;\r\n\t\tconst sortOrder = len === 0 ? 0 : this._tabs[len - 1].sortOrder + 1;\r\n\t\tconst tab = await this.#workspaceContext.structure.createContainer(null, null, 'Tab', sortOrder);\r\n\t\t// If length was 0 before, then we need to move the root groups into the first tab: [NL]\r\n\t\tif (len === 0) {\r\n\t\t\tnew UmbContentTypeMoveRootGroupsIntoFirstTabHelper(this, this.#workspaceContext.structure);\r\n\t\t}\r\n\t\tif (tab) {\r\n\t\t\tconst path = this._routerPath + '/tab/' + encodeFolderName(tab.name && tab.name !== '' ? tab.name : '-');\r\n\t\t\twindow.history.replaceState(null, '', path);\r\n\t\t\tthis.#focusInput();\r\n\t\t}\r\n\t}\r\n\r\n\tasync #focusInput() {\r\n\t\tsetTimeout(() => {\r\n\t\t\t(this.shadowRoot?.querySelector('uui-tab[active] uui-input') as UUIInputElement | undefined)?.focus();\r\n\t\t}, 100);\r\n\t}\r\n\r\n\tasync #tabNameChanged(event: InputEvent, tab: UmbPropertyTypeContainerModel) {\r\n\t\tthis.#processingTabId = tab.id;\r\n\t\tlet newName = (event.target as HTMLInputElement).value;\r\n\r\n\t\tconst changedName = this.#workspaceContext?.structure.makeContainerNameUniqueForOwnerContentType(\r\n\t\t\ttab.id,\r\n\t\t\tnewName,\r\n\t\t\t'Tab',\r\n\t\t);\r\n\r\n\t\t// Check if it collides with another tab name of this same content-type, if so adjust name:\r\n\t\t// Notice changed name might be an empty string... [NL]\r\n\t\tif (changedName !== null && changedName !== undefined) {\r\n\t\t\tnewName = changedName;\r\n\t\t\t(event.target as HTMLInputElement).value = newName;\r\n\t\t}\r\n\r\n\t\tthis.#tabsStructureHelper.partialUpdateContainer(tab.id!, {\r\n\t\t\tname: newName,\r\n\t\t});\r\n\t}\r\n\r\n\tasync #tabNameBlur(event: FocusEvent, tab: UmbPropertyTypeContainerModel) {\r\n\t\tif (!this.#processingTabId) return;\r\n\t\tconst newName = (event.target as HTMLInputElement | undefined)?.value;\r\n\t\tif (newName === '') {\r\n\t\t\tconst changedName = this.#workspaceContext!.structure.makeEmptyContainerName(this.#processingTabId, 'Tab');\r\n\r\n\t\t\t(event.target as HTMLInputElement).value = changedName;\r\n\r\n\t\t\tthis.#tabsStructureHelper.partialUpdateContainer(tab.id!, {\r\n\t\t\t\tname: changedName,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\tthis.#processingTabId = undefined;\r\n\t}\r\n\r\n\tasync #openCompositionModal() {\r\n\t\tif (!this.#workspaceContext || !this._compositionRepositoryAlias) return;\r\n\r\n\t\tconst unique = this.#workspaceContext.getUnique();\r\n\t\tif (!unique) {\r\n\t\t\tthrow new Error('Content Type unique is undefined');\r\n\t\t}\r\n\t\tconst ownerContentType = this.#workspaceContext.structure.getOwnerContentType();\r\n\t\tif (!ownerContentType) {\r\n\t\t\tthrow new Error('Owner Content Type not found');\r\n\t\t}\r\n\r\n\t\tconst currentCompositions = await this.#workspaceContext.structure.getContentTypeCompositions();\r\n\t\tconst currentInheritanceCompositions = currentCompositions.filter(\r\n\t\t\t(composition) => composition.compositionType === CompositionTypeModel.INHERITANCE,\r\n\t\t);\r\n\r\n\t\tconst currentOwnerCompositions = await this.#workspaceContext.structure.getOwnerContentTypeCompositions();\r\n\t\tconst currentOwnerCompositionCompositions = currentOwnerCompositions.filter(\r\n\t\t\t(composition) => composition.compositionType === CompositionTypeModel.COMPOSITION,\r\n\t\t);\r\n\r\n\t\tconst currentOwnerCompositionCompositionUniques = currentOwnerCompositionCompositions.map(\r\n\t\t\t(composition) => composition.contentType.unique,\r\n\t\t);\r\n\r\n\t\tconst currentOwnerInheritanceCompositions = currentOwnerCompositions.filter(\r\n\t\t\t(composition) => composition.compositionType === CompositionTypeModel.INHERITANCE,\r\n\t\t);\r\n\r\n\t\tconst currentPropertyAliases = await this.#workspaceContext.structure.getContentTypePropertyAliases();\r\n\r\n\t\tconst compositionConfiguration = {\r\n\t\t\tcompositionRepositoryAlias: this._compositionRepositoryAlias,\r\n\t\t\tunique: unique,\r\n\t\t\tselection: currentOwnerCompositionCompositionUniques,\r\n\t\t\tusedForInheritance: currentInheritanceCompositions.map((composition) => composition.contentType.unique),\r\n\t\t\tusedForComposition: currentOwnerCompositionCompositionUniques,\r\n\t\t\tisElement: ownerContentType.isElement,\r\n\t\t\tcurrentPropertyAliases,\r\n\t\t\tisNew: this.#workspaceContext.getIsNew()!,\r\n\t\t};\r\n\r\n\t\tconst value = await umbOpenModal(this, UMB_COMPOSITION_PICKER_MODAL, {\r\n\t\t\tdata: compositionConfiguration,\r\n\t\t}).catch(() => undefined);\r\n\r\n\t\tif (!value) return;\r\n\r\n\t\tconst compositionIds = value.selection;\r\n\r\n\t\tthis.#workspaceContext.setCompositions([\r\n\t\t\t...currentOwnerInheritanceCompositions,\r\n\t\t\t...compositionIds.map((unique) => {\r\n\t\t\t\tconst model: UmbContentTypeCompositionModel = {\r\n\t\t\t\t\tcontentType: { unique },\r\n\t\t\t\t\tcompositionType: CompositionTypeModel.COMPOSITION,\r\n\t\t\t\t};\r\n\t\t\t\treturn model;\r\n\t\t\t}),\r\n\t\t]);\r\n\t}\r\n\r\n\t#onDragOver(event: DragEvent, path: string) {\r\n\t\tif (this._activePath === path) return;\r\n\t\tevent.preventDefault();\r\n\t\twindow.history.replaceState(null, '', path);\r\n\t}\r\n\r\n\toverride render() {\r\n\t\treturn html`\r\n\t\t\t<umb-body-layout header-fit-height>\r\n\t\t\t\t<div id=\"header\" slot=\"header\">\r\n\t\t\t\t\t<div id=\"container-list\">${this.renderTabsNavigation()} ${this.#renderAddButton()}</div>\r\n\t\t\t\t\t${this.#renderActions()}\r\n\t\t\t\t</div>\r\n\t\t\t\t<umb-router-slot\r\n\t\t\t\t\t.routes=${this._routes}\r\n\t\t\t\t\t@init=${(event: UmbRouterSlotInitEvent) => {\r\n\t\t\t\t\t\tthis._routerPath = event.target.absoluteRouterPath;\r\n\t\t\t\t\t}}\r\n\t\t\t\t\t@change=${(event: UmbRouterSlotChangeEvent) => {\r\n\t\t\t\t\t\tthis._activePath = event.target.absoluteActiveViewPath ?? '';\r\n\t\t\t\t\t}}>\r\n\t\t\t\t</umb-router-slot>\r\n\t\t\t</umb-body-layout>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderAddButton() {\r\n\t\t// TODO: Localize this:\r\n\t\tif (this._sortModeActive) return;\r\n\t\treturn html`\r\n\t\t\t<uui-button id=\"add-tab\" @click=\"${this.#addTab}\" label=\"Add tab\">\r\n\t\t\t\t<uui-icon name=\"icon-add\"></uui-icon>\r\n\t\t\t\tAdd tab\r\n\t\t\t</uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\t#renderActions() {\r\n\t\tconst sortButtonText = this._sortModeActive\r\n\t\t\t? this.localize.term('general_reorderDone')\r\n\t\t\t: this.localize.term('general_reorder');\r\n\r\n\t\treturn html`\r\n\t\t\t<div id=\"actions\">\r\n\t\t\t\t${this._compositionRepositoryAlias\r\n\t\t\t\t\t? html`\r\n\t\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\t\tlook=\"outline\"\r\n\t\t\t\t\t\t\t\tlabel=${this.localize.term('contentTypeEditor_compositions')}\r\n\t\t\t\t\t\t\t\tcompact\r\n\t\t\t\t\t\t\t\t@click=${this.#openCompositionModal}>\r\n\t\t\t\t\t\t\t\t<uui-icon name=\"icon-merge\"></uui-icon>\r\n\t\t\t\t\t\t\t\t${this.localize.term('contentTypeEditor_compositions')}\r\n\t\t\t\t\t\t\t</uui-button>\r\n\t\t\t\t\t\t`\r\n\t\t\t\t\t: ''}\r\n\t\t\t\t<uui-button look=\"outline\" label=${sortButtonText} compact @click=${this.#toggleSortMode}>\r\n\t\t\t\t\t<uui-icon name=\"icon-height\"></uui-icon>\r\n\t\t\t\t\t${sortButtonText}\r\n\t\t\t\t</uui-button>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\trenderTabsNavigation() {\r\n\t\tif (!this._tabs || this._tabs.length === 0) return;\r\n\r\n\t\treturn html`\r\n\t\t\t<div id=\"tabs-group\">\r\n\t\t\t\t<uui-tab-group>\r\n\t\t\t\t\t${this.renderRootTab()}\r\n\t\t\t\t\t${repeat(\r\n\t\t\t\t\t\tthis._tabs,\r\n\t\t\t\t\t\t(tab) => tab.id,\r\n\t\t\t\t\t\t(tab) => this.renderTab(tab),\r\n\t\t\t\t\t)}\r\n\t\t\t\t</uui-tab-group>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\trenderRootTab() {\r\n\t\tconst path = this._routerPath + '/root';\r\n\t\tconst rootTabActive = path === this._activePath;\r\n\t\tif (!this._hasRootGroups && !this._sortModeActive) {\r\n\t\t\t// If we don't have any root groups and we are not in sort mode, then we don't want to render the root tab.\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\t\treturn html`\r\n\t\t\t<uui-tab\r\n\t\t\t\tid=\"root-tab\"\r\n\t\t\t\tdata-mark=\"root-tab\"\r\n\t\t\t\tclass=${this._hasRootGroups || rootTabActive ? '' : 'content-tab-is-empty'}\r\n\t\t\t\tlabel=${this.localize.term('general_generic')}\r\n\t\t\t\t.active=${rootTabActive}\r\n\t\t\t\thref=${path}\r\n\t\t\t\t@dragover=${(event: DragEvent) => this.#onDragOver(event, path)}>\r\n\t\t\t\t${this.localize.term('general_generic')}\r\n\t\t\t</uui-tab>\r\n\t\t`;\r\n\t}\r\n\r\n\trenderTab(tab: UmbPropertyTypeContainerModel) {\r\n\t\tconst path = this._routerPath + '/tab/' + encodeFolderName(tab.name && tab.name !== '' ? tab.name : '-');\r\n\t\tconst tabActive = path === this._activePath;\r\n\t\tconst ownedTab = this.#tabsStructureHelper.isOwnerChildContainer(tab.id!) ?? false;\r\n\r\n\t\treturn html`<uui-tab\r\n\t\t\tlabel=${tab.name && tab.name !== '' ? tab.name : 'Unnamed'}\r\n\t\t\t.active=${tabActive}\r\n\t\t\thref=${path}\r\n\t\t\tdata-umb-tab-id=${ifDefined(tab.id)}\r\n\t\t\tdata-mark=\"tab:${tab.name}\"\r\n\t\t\t?sortable=${ownedTab}\r\n\t\t\t@dragover=${(event: DragEvent) => this.#onDragOver(event, path)}>\r\n\t\t\t${this.renderTabInner(tab, tabActive, ownedTab)}\r\n\t\t</uui-tab>`;\r\n\t}\r\n\r\n\trenderTabInner(tab: UmbPropertyTypeContainerModel, tabActive: boolean, ownedTab: boolean) {\r\n\t\t// TODO: Localize this:\r\n\t\tconst hasTabName = tab.name && tab.name !== '';\r\n\t\tconst tabName = hasTabName ? tab.name : 'Unnamed';\r\n\t\tif (this._sortModeActive) {\r\n\t\t\treturn html`<div class=\"tab\">\r\n\t\t\t\t${ownedTab\r\n\t\t\t\t\t? html`<uui-icon name=\"icon-grip\" class=\"drag-${tab.id}\"> </uui-icon>${tabName}\r\n\t\t\t\t\t\t\t<uui-input\r\n\t\t\t\t\t\t\t\tlabel=\"sort order\"\r\n\t\t\t\t\t\t\t\ttype=\"number\"\r\n\t\t\t\t\t\t\t\tvalue=${ifDefined(tab.sortOrder)}\r\n\t\t\t\t\t\t\t\tstyle=\"width:50px\"\r\n\t\t\t\t\t\t\t\t@change=${(e: UUIInputEvent) => this.#changeOrderNumber(tab, e)}></uui-input>`\r\n\t\t\t\t\t: html`<uui-icon name=\"icon-merge\"></uui-icon>${tab.name!}`}\r\n\t\t\t</div>`;\r\n\t\t}\r\n\r\n\t\tif (tabActive && ownedTab) {\r\n\t\t\treturn html`<div class=\"tab\">\r\n\t\t\t\t<uui-input\r\n\t\t\t\t\tid=\"input\"\r\n\t\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t\tplaceholder=\"Unnamed\"\r\n\t\t\t\t\tlabel=${tab.name!}\r\n\t\t\t\t\tvalue=\"${tab.name!}\"\r\n\t\t\t\t\tauto-width\r\n\t\t\t\t\tminlength=\"1\"\r\n\t\t\t\t\t@change=${(e: InputEvent) => this.#tabNameChanged(e, tab)}\r\n\t\t\t\t\t@input=${(e: InputEvent) => this.#tabNameChanged(e, tab)}\r\n\t\t\t\t\t@blur=${(e: FocusEvent) => this.#tabNameBlur(e, tab)}>\r\n\t\t\t\t\t${this.renderDeleteFor(tab)}\r\n\t\t\t\t</uui-input>\r\n\t\t\t</div>`;\r\n\t\t}\r\n\r\n\t\tif (ownedTab) {\r\n\t\t\treturn html`<div class=\"not-active\">\r\n\t\t\t\t<span class=${hasTabName ? '' : 'invaild'}>${hasTabName ? tab.name : 'Unnamed'}</span> ${this.renderDeleteFor(\r\n\t\t\t\t\ttab,\r\n\t\t\t\t)}\r\n\t\t\t</div>`;\r\n\t\t} else {\r\n\t\t\treturn html`<div class=\"not-active\"><uui-icon name=\"icon-merge\"></uui-icon>${tab.name!}</div>`;\r\n\t\t}\r\n\t}\r\n\r\n\t#changeOrderNumber(tab: UmbPropertyTypeContainerModel, e: UUIInputEvent) {\r\n\t\tif (!e.target.value || !tab.id) return;\r\n\t\tconst sortOrder = Number(e.target.value);\r\n\t\tthis.#tabsStructureHelper.partialUpdateContainer(tab.id, { sortOrder });\r\n\t}\r\n\r\n\trenderDeleteFor(tab: UmbPropertyTypeContainerModel) {\r\n\t\treturn html`<uui-button\r\n\t\t\tlabel=${this.localize.term('actions_remove')}\r\n\t\t\tclass=\"trash\"\r\n\t\t\tslot=\"append\"\r\n\t\t\t@click=${(e: MouseEvent) => {\r\n\t\t\t\te.stopPropagation();\r\n\t\t\t\te.preventDefault();\r\n\t\t\t\tthis.#requestDeleteTab(tab);\r\n\t\t\t}}\r\n\t\t\tcompact>\r\n\t\t\t<uui-icon name=\"icon-trash\"></uui-icon>\r\n\t\t</uui-button>`;\r\n\t}\r\n\r\n\toverride destroy(): void {\r\n\t\tthis.#currentTabComponent = undefined;\r\n\t\tsuper.destroy();\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tUmbTextStyles,\r\n\t\tcss`\r\n\t\t\t:host {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tflex-direction: column;\r\n\t\t\t\theight: 100%;\r\n\t\t\t\t--uui-tab-background: var(--uui-color-surface);\r\n\t\t\t}\r\n\r\n\t\t\t#buttons-wrapper {\r\n\t\t\t\tflex: 1;\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\talign-items: stretch;\r\n\t\t\t}\r\n\r\n\t\t\t[drag-placeholder] {\r\n\t\t\t\topacity: 0.5;\r\n\t\t\t}\r\n\r\n\t\t\t[drag-placeholder] uui-input {\r\n\t\t\t\tvisibility: hidden;\r\n\t\t\t}\r\n\r\n\t\t\t/* TODO: This should be replaced with a general workspace bar â€” naming is hard */\r\n\r\n\t\t\t#header {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tmin-height: var(--uui-size-16);\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tjustify-content: space-between;\r\n\t\t\t\tflex-wrap: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\t#container-list {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t}\r\n\r\n\t\t\t#tabs-group {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t}\r\n\r\n\t\t\t#actions {\r\n\t\t\t\tdisplay: flex;\r\n\t\t\t\tgap: var(--uui-size-space-2);\r\n\t\t\t}\r\n\r\n\t\t\tuui-tab-group {\r\n\t\t\t\tflex-wrap: nowrap;\r\n\t\t\t}\r\n\r\n\t\t\tuui-tab.content-tab-is-empty {\r\n\t\t\t\talign-self: center;\r\n\t\t\t\tborder-radius: 3px;\r\n\t\t\t\t--uui-tab-text: var(--uui-color-text-alt);\r\n\t\t\t\tborder: dashed 1px var(--uui-color-border-emphasis);\r\n\t\t\t}\r\n\r\n\t\t\tuui-tab {\r\n\t\t\t\tposition: relative;\r\n\t\t\t\tborder-left: 1px hidden transparent;\r\n\t\t\t\tborder-right: 1px solid var(--uui-color-border);\r\n\t\t\t\tbackground-color: var(--uui-color-surface);\r\n\t\t\t}\r\n\r\n\t\t\t.not-active uui-button {\r\n\t\t\t\tpointer-events: auto;\r\n\t\t\t}\r\n\r\n\t\t\t.not-active {\r\n\t\t\t\tpointer-events: none;\r\n\t\t\t\tdisplay: inline-flex;\r\n\t\t\t\tpadding-left: var(--uui-size-space-3);\r\n\t\t\t\tborder: 1px solid transparent;\r\n\t\t\t\talign-items: center;\r\n\t\t\t\tgap: var(--uui-size-space-3);\r\n\t\t\t}\r\n\r\n\t\t\t.invaild {\r\n\t\t\t\tcolor: var(--uui-color-danger, var(--uui-color-invalid));\r\n\t\t\t}\r\n\r\n\t\t\t.trash {\r\n\t\t\t\topacity: 1;\r\n\t\t\t\ttransition: opacity 100ms;\r\n\t\t\t}\r\n\r\n\t\t\tuui-tab:not(:hover, :focus) .trash {\r\n\t\t\t\topacity: 0;\r\n\t\t\t\ttransition: opacity 100ms;\r\n\t\t\t}\r\n\r\n\t\t\tuui-input:not(:focus, :hover, :invalid) {\r\n\t\t\t\tborder: 1px solid transparent;\r\n\t\t\t}\r\n\r\n\t\t\t.inherited {\r\n\t\t\t\tvertical-align: sub;\r\n\t\t\t}\r\n\r\n\t\t\t[drag-placeholder] {\r\n\t\t\t\topacity: 0.2;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbContentTypeDesignEditorElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-content-type-design-editor': UmbContentTypeDesignEditorElement;\r\n\t}\r\n}\r\n"],"names":["UmbContentTypeDesignEditorContext","UmbContextBase","host","UMB_CONTENT_TYPE_DESIGN_EDITOR_CONTEXT","#isSorting","UmbBooleanState","isSorting","_sorter","_workspaceContext","_designContext","_tabsStructureHelper","_currentTabComponent","_processingTabId","_UmbContentTypeDesignEditorElement_instances","toggleSortMode_fn","observeRootGroups_fn","createRoutes_fn","requestDeleteTab_fn","deleteTab_fn","addTab_fn","focusInput_fn","tabNameChanged_fn","tabNameBlur_fn","openCompositionModal_fn","onDragOver_fn","renderAddButton_fn","renderActions_fn","changeOrderNumber_fn","UmbContentTypeDesignEditorElement","UmbLitElement","__privateAdd","UmbSorterController","element","tab","args","model","item","newIndex","entry","prevSortOrder","__privateGet","i","UmbContentTypeContainerStructureHelper","tabs","__privateMethod","UMB_CONTENT_TYPE_WORKSPACE_CONTEXT","workspaceContext","__privateSet","value","html","event","repeat","path","rootTabActive","nothing","encodeFolderName","tabActive","ownedTab","ifDefined","hasTabName","tabName","e","hasRootGroups","routes","activeTabName","component","x","oldPath","newPath","modalData","umbConfirmModal","tabId","len","sortOrder","UmbContentTypeMoveRootGroupsIntoFirstTabHelper","newName","changedName","unique","ownerContentType","currentInheritanceCompositions","composition","CompositionTypeModel","currentOwnerCompositions","currentOwnerCompositionCompositionUniques","currentOwnerInheritanceCompositions","currentPropertyAliases","compositionConfiguration","umbOpenModal","UMB_COMPOSITION_PICKER_MODAL","compositionIds","sortButtonText","UmbTextStyles","css","__decorateClass","state","customElement","UmbContentTypeDesignEditorElement$1"],"mappings":"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"}