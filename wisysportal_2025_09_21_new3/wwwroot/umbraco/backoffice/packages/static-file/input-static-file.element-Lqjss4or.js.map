{"version":3,"file":"input-static-file.element-Lqjss4or.js","sources":["../../../src/packages/static-file/modals/static-file-picker-modal.token.ts","../../../src/packages/static-file/components/input-static-file/input-static-file.context.ts","../../../src/packages/static-file/components/input-static-file/input-static-file.element.ts"],"sourcesContent":["import { UMB_STATIC_FILE_TREE_ALIAS } from '../tree/constants.js';\r\nimport type { UmbStaticFileItemModel } from '../repository/item/types.js';\r\nimport {\r\n\ttype UmbTreePickerModalValue,\r\n\ttype UmbTreePickerModalData,\r\n\tUMB_TREE_PICKER_MODAL_ALIAS,\r\n} from '@umbraco-cms/backoffice/tree';\r\nimport { UmbModalToken } from '@umbraco-cms/backoffice/modal';\r\n\r\nexport type UmbStaticFilePickerModalData = UmbTreePickerModalData<UmbStaticFileItemModel>;\r\nexport type UmbStaticFilePickerModalValue = UmbTreePickerModalValue;\r\n\r\nexport const UMB_STATIC_FILE_PICKER_MODAL = new UmbModalToken<\r\n\tUmbStaticFilePickerModalData,\r\n\tUmbStaticFilePickerModalValue\r\n>(UMB_TREE_PICKER_MODAL_ALIAS, {\r\n\tmodal: {\r\n\t\ttype: 'sidebar',\r\n\t\tsize: 'small',\r\n\t},\r\n\tdata: {\r\n\t\ttreeAlias: UMB_STATIC_FILE_TREE_ALIAS,\r\n\t},\r\n});\r\n","import { UMB_STATIC_FILE_PICKER_MODAL } from '../../modals/index.js';\r\nimport type { UmbStaticFilePickerModalData, UmbStaticFilePickerModalValue } from '../../modals/index.js';\r\nimport { UMB_STATIC_FILE_ITEM_REPOSITORY_ALIAS } from '../../constants.js';\r\nimport type { UmbStaticFileItemModel } from '../../types.js';\r\nimport { UmbPickerInputContext } from '@umbraco-cms/backoffice/picker-input';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\n\r\nexport class UmbStaticFilePickerInputContext extends UmbPickerInputContext<\r\n\tUmbStaticFileItemModel,\r\n\tUmbStaticFileItemModel,\r\n\tUmbStaticFilePickerModalData,\r\n\tUmbStaticFilePickerModalValue\r\n> {\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UMB_STATIC_FILE_ITEM_REPOSITORY_ALIAS, UMB_STATIC_FILE_PICKER_MODAL);\r\n\t}\r\n}\r\n","import type { UmbStaticFileItemModel } from '../../repository/item/types.js';\r\nimport { UmbStaticFilePickerInputContext } from './input-static-file.context.js';\r\nimport { css, customElement, html, nothing, property, repeat, state } from '@umbraco-cms/backoffice/external/lit';\r\nimport { splitStringToArray } from '@umbraco-cms/backoffice/utils';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport { UmbServerFilePathUniqueSerializer } from '@umbraco-cms/backoffice/server-file-system';\r\nimport { UmbFormControlMixin } from '@umbraco-cms/backoffice/validation';\r\n\r\n@customElement('umb-input-static-file')\r\nexport class UmbInputStaticFileElement extends UmbFormControlMixin<string | undefined, typeof UmbLitElement>(\r\n\tUmbLitElement,\r\n) {\r\n\t#serializer = new UmbServerFilePathUniqueSerializer();\r\n\r\n\t/**\r\n\t * This is a minimum amount of selected files in this input.\r\n\t * @type {number}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Number })\r\n\tpublic set min(value: number) {\r\n\t\tthis.#pickerContext.min = value;\r\n\t}\r\n\tpublic get min(): number {\r\n\t\treturn this.#pickerContext.min;\r\n\t}\r\n\r\n\t/**\r\n\t * Min validation message.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: String, attribute: 'min-message' })\r\n\tminMessage = 'This field need more files';\r\n\r\n\t/**\r\n\t * This is a maximum amount of selected files in this input.\r\n\t * @type {number}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: Number })\r\n\tpublic set max(value: number) {\r\n\t\tthis.#pickerContext.max = value;\r\n\t}\r\n\tpublic get max(): number {\r\n\t\treturn this.#pickerContext.max;\r\n\t}\r\n\r\n\t/**\r\n\t * Max validation message.\r\n\t * @type {boolean}\r\n\t * @attr\r\n\t * @default\r\n\t */\r\n\t@property({ type: String, attribute: 'min-message' })\r\n\tmaxMessage = 'This field exceeds the allowed amount of files';\r\n\r\n\tpublic set selection(paths: Array<string>) {\r\n\t\tthis.#pickerContext.setSelection(paths);\r\n\t}\r\n\tpublic get selection(): Array<string> {\r\n\t\treturn this.#pickerContext.getSelection();\r\n\t}\r\n\r\n\t@property({ type: String })\r\n\tpublic override set value(selectionString: string | undefined) {\r\n\t\tthis.selection = splitStringToArray(selectionString);\r\n\t}\r\n\tpublic override get value(): string | undefined {\r\n\t\treturn this.selection.length > 0 ? this.selection.join(',') : undefined;\r\n\t}\r\n\r\n\t@property()\r\n\tpublic pickableFilter?: (item: UmbStaticFileItemModel) => boolean;\r\n\r\n\t@state()\r\n\tprivate _items?: Array<UmbStaticFileItemModel>;\r\n\r\n\t#pickerContext = new UmbStaticFilePickerInputContext(this);\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.addValidator(\r\n\t\t\t'rangeUnderflow',\r\n\t\t\t() => this.minMessage,\r\n\t\t\t() => !!this.min && this.#pickerContext.getSelection().length < this.min,\r\n\t\t);\r\n\r\n\t\tthis.addValidator(\r\n\t\t\t'rangeOverflow',\r\n\t\t\t() => this.maxMessage,\r\n\t\t\t() => !!this.max && this.#pickerContext.getSelection().length > this.max,\r\n\t\t);\r\n\r\n\t\tthis.observe(this.#pickerContext.selection, (selection) => (this.value = selection.join(',')));\r\n\t\tthis.observe(this.#pickerContext.selectedItems, (selectedItems) => (this._items = selectedItems));\r\n\t}\r\n\r\n\tprotected override getFormElement() {\r\n\t\treturn undefined;\r\n\t}\r\n\r\n\toverride render() {\r\n\t\tif (!this._items) return nothing;\r\n\t\treturn html`\r\n\t\t\t<uui-ref-list>\r\n\t\t\t\t${repeat(\r\n\t\t\t\t\tthis._items,\r\n\t\t\t\t\t(item) => item.unique,\r\n\t\t\t\t\t(item) => this._renderItem(item),\r\n\t\t\t\t)}\r\n\t\t\t</uui-ref-list>\r\n\t\t\t${this.#renderAddButton()}\r\n\t\t`;\r\n\t}\r\n\r\n\t#openPicker() {\r\n\t\tthis.#pickerContext.openPicker({\r\n\t\t\tpickableFilter: this.pickableFilter,\r\n\t\t\tmultiple: this.max === 1 ? false : true,\r\n\t\t\thideTreeRoot: true,\r\n\t\t});\r\n\t}\r\n\r\n\t#renderAddButton() {\r\n\t\tif (this.max === 1 && this.selection.length >= this.max) return;\r\n\t\treturn html`\r\n\t\t\t<uui-button\r\n\t\t\t\tid=\"btn-add\"\r\n\t\t\t\tlook=\"placeholder\"\r\n\t\t\t\t@click=${this.#openPicker}\r\n\t\t\t\tlabel=${this.localize.term('general_choose')}></uui-button>\r\n\t\t`;\r\n\t}\r\n\r\n\tprivate _renderItem(item: UmbStaticFileItemModel) {\r\n\t\tif (!item.unique) return;\r\n\t\treturn html`\r\n\t\t\t<uui-ref-node name=${item.name} .detail=${this.#serializer.toServerPath(item.unique) || ''}>\r\n\t\t\t\t<!-- TODO: implement is trashed, if we cant retrieve the item on the server (but only ask the server if we need to anyway...). <uui-tag size=\"s\" slot=\"tag\" color=\"danger\">Trashed</uui-tag> -->\r\n\t\t\t\t<uui-action-bar slot=\"actions\">\r\n\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\tlabel=${this.localize.term('general_remove')}\r\n\t\t\t\t\t\t@click=${() => this.#pickerContext.requestRemoveItem(item.unique)}></uui-button>\r\n\t\t\t\t</uui-action-bar>\r\n\t\t\t</uui-ref-node>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic override styles = [\r\n\t\tcss`\r\n\t\t\t#btn-add {\r\n\t\t\t\twidth: 100%;\r\n\t\t\t}\r\n\t\t`,\r\n\t];\r\n}\r\n\r\nexport default UmbInputStaticFileElement;\r\n\r\ndeclare global {\r\n\tinterface HTMLElementTagNameMap {\r\n\t\t'umb-input-static-file': UmbInputStaticFileElement;\r\n\t}\r\n}\r\n"],"names":["UMB_STATIC_FILE_PICKER_MODAL","UmbModalToken","UMB_TREE_PICKER_MODAL_ALIAS","UMB_STATIC_FILE_TREE_ALIAS","UmbStaticFilePickerInputContext","UmbPickerInputContext","host","UMB_STATIC_FILE_ITEM_REPOSITORY_ALIAS","_serializer","_pickerContext","_UmbInputStaticFileElement_instances","openPicker_fn","renderAddButton_fn","UmbInputStaticFileElement","UmbFormControlMixin","UmbLitElement","__privateAdd","UmbServerFilePathUniqueSerializer","__privateGet","selection","selectedItems","value","paths","selectionString","splitStringToArray","html","repeat","item","__privateMethod","nothing","css","__decorateClass","property","state","customElement"],"mappings":"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"}