{"version":3,"file":"data-type-tree.repository-siBRczJW.js","sources":["../../../src/packages/data-type/tree/data-type-tree.server.data-source.ts","../../../src/packages/data-type/tree/data-type-tree.repository.ts"],"sourcesContent":["import {\r\n\tUMB_DATA_TYPE_ENTITY_TYPE,\r\n\tUMB_DATA_TYPE_FOLDER_ENTITY_TYPE,\r\n\tUMB_DATA_TYPE_ROOT_ENTITY_TYPE,\r\n} from '../entity.js';\r\nimport type { UmbDataTypeTreeItemModel } from './types.js';\r\nimport type {\r\n\tUmbTreeChildrenOfRequestArgs,\r\n\tUmbTreeRootItemsRequestArgs,\r\n\tUmbTreeAncestorsOfRequestArgs,\r\n} from '@umbraco-cms/backoffice/tree';\r\nimport { UmbTreeServerDataSourceBase } from '@umbraco-cms/backoffice/tree';\r\nimport type { DataTypeTreeItemResponseModel } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { DataTypeService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { umbExtensionsRegistry } from '@umbraco-cms/backoffice/extension-registry';\r\nimport type { ManifestPropertyEditorUi } from '@umbraco-cms/backoffice/property-editor';\r\n\r\nlet manifestPropertyEditorUis: Array<ManifestPropertyEditorUi> = [];\r\n\r\n/**\r\n * A data source for a data type tree that fetches data from the server\r\n * @class UmbDataTypeTreeServerDataSource\r\n * @implements {DocumentTreeDataSource}\r\n */\r\nexport class UmbDataTypeTreeServerDataSource extends UmbTreeServerDataSourceBase<\r\n\tDataTypeTreeItemResponseModel,\r\n\tUmbDataTypeTreeItemModel\r\n> {\r\n\t/**\r\n\t * Creates an instance of UmbDataTypeTreeServerDataSource.\r\n\t * @param {UmbControllerHost} host - The controller host for this controller to be appended to\r\n\t * @memberof UmbDataTypeTreeServerDataSource\r\n\t */\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, {\r\n\t\t\tgetRootItems,\r\n\t\t\tgetChildrenOf,\r\n\t\t\tgetAncestorsOf,\r\n\t\t\tmapper,\r\n\t\t});\r\n\t\tumbExtensionsRegistry\r\n\t\t\t.byType('propertyEditorUi')\r\n\t\t\t.subscribe((manifestPropertyEditorUIs) => {\r\n\t\t\t\tmanifestPropertyEditorUis = manifestPropertyEditorUIs;\r\n\t\t\t})\r\n\t\t\t.unsubscribe();\r\n\t}\r\n}\r\n\r\nconst getRootItems = async (args: UmbTreeRootItemsRequestArgs) => {\r\n\t// eslint-disable-next-line local-rules/no-direct-api-import\r\n\treturn DataTypeService.getTreeDataTypeRoot({\r\n\t\tquery: { foldersOnly: args.foldersOnly, skip: args.skip, take: args.take },\r\n\t});\r\n};\r\n\r\nconst getChildrenOf = (args: UmbTreeChildrenOfRequestArgs) => {\r\n\tif (args.parent.unique === null) {\r\n\t\treturn getRootItems(args);\r\n\t} else {\r\n\t\t// eslint-disable-next-line local-rules/no-direct-api-import\r\n\t\treturn DataTypeService.getTreeDataTypeChildren({\r\n\t\t\tquery: { parentId: args.parent.unique, foldersOnly: args.foldersOnly, skip: args.skip, take: args.take },\r\n\t\t});\r\n\t}\r\n};\r\n\r\nconst getAncestorsOf = (args: UmbTreeAncestorsOfRequestArgs) =>\r\n\t// eslint-disable-next-line local-rules/no-direct-api-import\r\n\tDataTypeService.getTreeDataTypeAncestors({\r\n\t\tquery: { descendantId: args.treeItem.unique },\r\n\t});\r\n\r\nconst mapper = (item: DataTypeTreeItemResponseModel): UmbDataTypeTreeItemModel => {\r\n\treturn {\r\n\t\tunique: item.id,\r\n\t\tparent: {\r\n\t\t\tunique: item.parent?.id || null,\r\n\t\t\tentityType: item.parent ? UMB_DATA_TYPE_ENTITY_TYPE : UMB_DATA_TYPE_ROOT_ENTITY_TYPE,\r\n\t\t},\r\n\t\ticon: manifestPropertyEditorUis.find((ui) => ui.alias === item.editorUiAlias)?.meta.icon,\r\n\t\tname: item.name,\r\n\t\tentityType: item.isFolder ? UMB_DATA_TYPE_FOLDER_ENTITY_TYPE : UMB_DATA_TYPE_ENTITY_TYPE,\r\n\t\tisFolder: item.isFolder,\r\n\t\thasChildren: item.hasChildren,\r\n\t};\r\n};\r\n","import { UMB_DATA_TYPE_ROOT_ENTITY_TYPE } from '../entity.js';\r\nimport { UmbDataTypeTreeServerDataSource } from './data-type-tree.server.data-source.js';\r\nimport { UMB_DATA_TYPE_TREE_STORE_CONTEXT } from './data-type-tree.store.context-token.js';\r\nimport type { UmbDataTypeTreeItemModel, UmbDataTypeTreeRootModel } from './types.js';\r\nimport { UmbTreeRepositoryBase } from '@umbraco-cms/backoffice/tree';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport type { UmbApi } from '@umbraco-cms/backoffice/extension-api';\r\n\r\nexport class UmbDataTypeTreeRepository\r\n\textends UmbTreeRepositoryBase<UmbDataTypeTreeItemModel, UmbDataTypeTreeRootModel>\r\n\timplements UmbApi\r\n{\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host, UmbDataTypeTreeServerDataSource, UMB_DATA_TYPE_TREE_STORE_CONTEXT);\r\n\t}\r\n\r\n\tasync requestTreeRoot() {\r\n\t\tconst { data: treeRootData } = await this._treeSource.getRootItems({ skip: 0, take: 1 });\r\n\t\tconst hasChildren = treeRootData ? treeRootData.total > 0 : false;\r\n\r\n\t\tconst data: UmbDataTypeTreeRootModel = {\r\n\t\t\tunique: null,\r\n\t\t\tentityType: UMB_DATA_TYPE_ROOT_ENTITY_TYPE,\r\n\t\t\tname: '#treeHeaders_dataTypes',\r\n\t\t\thasChildren,\r\n\t\t\tisFolder: true,\r\n\t\t};\r\n\r\n\t\treturn { data };\r\n\t}\r\n}\r\n\r\nexport { UmbDataTypeTreeRepository as api };\r\n"],"names":["manifestPropertyEditorUis","UmbDataTypeTreeServerDataSource","UmbTreeServerDataSourceBase","host","getRootItems","getChildrenOf","getAncestorsOf","mapper","umbExtensionsRegistry","manifestPropertyEditorUIs","args","DataTypeService","item","UMB_DATA_TYPE_ENTITY_TYPE","UMB_DATA_TYPE_ROOT_ENTITY_TYPE","ui","UMB_DATA_TYPE_FOLDER_ENTITY_TYPE","UmbDataTypeTreeRepository","UmbTreeRepositoryBase","UMB_DATA_TYPE_TREE_STORE_CONTEXT","treeRootData","hasChildren"],"mappings":";;;;AAkBA,IAAIA,IAA6D,CAAC;AAO3D,MAAMC,UAAwCC,EAGnD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMD,YAAYC,GAAyB;AACpC,UAAMA,GAAM;AAAA,MACX,cAAAC;AAAA,MACA,eAAAC;AAAA,MACA,gBAAAC;AAAA,MACA,QAAAC;AAAA,IAAA,CACA,GACDC,EACE,OAAO,kBAAkB,EACzB,UAAU,CAACC,MAA8B;AACb,MAAAT,IAAAS;AAAA,IAC5B,CAAA,EACA,YAAY;AAAA,EAAA;AAEhB;AAEA,MAAML,IAAe,OAAOM,MAEpBC,EAAgB,oBAAoB;AAAA,EAC1C,OAAO,EAAE,aAAaD,EAAK,aAAa,MAAMA,EAAK,MAAM,MAAMA,EAAK,KAAK;AAAA,CACzE,GAGIL,IAAgB,CAACK,MAClBA,EAAK,OAAO,WAAW,OACnBN,EAAaM,CAAI,IAGjBC,EAAgB,wBAAwB;AAAA,EAC9C,OAAO,EAAE,UAAUD,EAAK,OAAO,QAAQ,aAAaA,EAAK,aAAa,MAAMA,EAAK,MAAM,MAAMA,EAAK,KAAK;AAAA,CACvG,GAIGJ,IAAiB,CAACI;AAAA;AAAA,EAEvBC,EAAgB,yBAAyB;AAAA,IACxC,OAAO,EAAE,cAAcD,EAAK,SAAS,OAAO;AAAA,EAC5C,CAAA;AAAA,GAEIH,IAAS,CAACK,OACR;AAAA,EACN,QAAQA,EAAK;AAAA,EACb,QAAQ;AAAA,IACP,QAAQA,EAAK,QAAQ,MAAM;AAAA,IAC3B,YAAYA,EAAK,SAASC,IAA4BC;AAAA,EACvD;AAAA,EACA,MAAMd,EAA0B,KAAK,CAACe,MAAOA,EAAG,UAAUH,EAAK,aAAa,GAAG,KAAK;AAAA,EACpF,MAAMA,EAAK;AAAA,EACX,YAAYA,EAAK,WAAWI,IAAmCH;AAAA,EAC/D,UAAUD,EAAK;AAAA,EACf,aAAaA,EAAK;AACnB;AC9EM,MAAMK,UACJC,EAET;AAAA,EACC,YAAYf,GAAyB;AAC9B,UAAAA,GAAMF,GAAiCkB,CAAgC;AAAA,EAAA;AAAA,EAG9E,MAAM,kBAAkB;AACvB,UAAM,EAAE,MAAMC,EAAa,IAAI,MAAM,KAAK,YAAY,aAAa,EAAE,MAAM,GAAG,MAAM,GAAG,GACjFC,IAAcD,IAAeA,EAAa,QAAQ,IAAI;AAU5D,WAAO,EAAE,MAR8B;AAAA,MACtC,QAAQ;AAAA,MACR,YAAYN;AAAA,MACZ,MAAM;AAAA,MACN,aAAAO;AAAA,MACA,UAAU;AAAA,IACX,EAEc;AAAA,EAAA;AAEhB;"}