{"version":3,"file":"data-type-reference.repository-DfWr1QMT.js","sources":["../../../src/packages/data-type/reference/repository/data-type-reference.server.data.ts","../../../src/packages/data-type/reference/repository/data-type-reference.repository.ts"],"sourcesContent":["import { tryExecute } from '@umbraco-cms/backoffice/resources';\r\nimport { DataTypeService } from '@umbraco-cms/backoffice/external/backend-api';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbEntityModel } from '@umbraco-cms/backoffice/entity';\r\nimport type { UmbEntityReferenceDataSource, UmbReferenceItemModel } from '@umbraco-cms/backoffice/relations';\r\nimport type { UmbPagedModel, UmbDataSourceResponse } from '@umbraco-cms/backoffice/repository';\r\nimport { UmbManagementApiDataMapper } from '@umbraco-cms/backoffice/repository';\r\n\r\n/**\r\n * @class UmbDataTypeReferenceServerDataSource\r\n * @implements {UmbEntityReferenceDataSource}\r\n */\r\nexport class UmbDataTypeReferenceServerDataSource extends UmbControllerBase implements UmbEntityReferenceDataSource {\r\n\t#dataMapper = new UmbManagementApiDataMapper(this);\r\n\r\n\t/**\r\n\t * Fetches the item for the given unique from the server\r\n\t * @param {string} unique - The unique identifier of the item to fetch\r\n\t * @param {number} skip - The number of items to skip\r\n\t * @param {number} take - The number of items to take\r\n\t * @returns {Promise<UmbDataSourceResponse<UmbPagedModel<UmbReferenceItemModel>>>} - Items that are referenced by the given unique\r\n\t * @memberof UmbDataTypeReferenceServerDataSource\r\n\t */\r\n\tasync getReferencedBy(\r\n\t\tunique: string,\r\n\t\tskip = 0,\r\n\t\ttake = 20,\r\n\t): Promise<UmbDataSourceResponse<UmbPagedModel<UmbReferenceItemModel>>> {\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tthis,\r\n\t\t\tDataTypeService.getDataTypeByIdReferencedBy({ path: { id: unique }, query: { skip, take } }),\r\n\t\t);\r\n\r\n\t\tif (data) {\r\n\t\t\tconst promises = data.items.map(async (item) => {\r\n\t\t\t\treturn this.#dataMapper.map({\r\n\t\t\t\t\tforDataModel: item.$type,\r\n\t\t\t\t\tdata: item,\r\n\t\t\t\t\tfallback: async () => {\r\n\t\t\t\t\t\treturn {\r\n\t\t\t\t\t\t\t...item,\r\n\t\t\t\t\t\t\tunique: item.id,\r\n\t\t\t\t\t\t\tentityType: 'unknown',\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t},\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tconst items = await Promise.all(promises);\r\n\r\n\t\t\treturn { data: { items, total: data.total } };\r\n\t\t}\r\n\r\n\t\treturn { data, error };\r\n\t}\r\n\r\n\t/**\r\n\t * Checks if the items are referenced by other items\r\n\t * @param {Array<string>} uniques - The unique identifiers of the items to fetch\r\n\t * @param {number} skip - The number of items to skip\r\n\t * @param {number} take - The number of items to take\r\n\t * @returns {Promise<UmbDataSourceResponse<UmbPagedModel<UmbEntityModel>>>} - Items that are referenced by other items\r\n\t * @memberof UmbDataTypeReferenceServerDataSource\r\n\t */\r\n\tasync getAreReferenced(\r\n\t\tuniques: Array<string>,\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\tskip: number = 0,\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\r\n\t\ttake: number = 20,\r\n\t): Promise<UmbDataSourceResponse<UmbPagedModel<UmbEntityModel>>> {\r\n\t\tconsole.warn('getAreReferenced is not implemented for DataTypeReferenceServerDataSource');\r\n\t\treturn { data: { items: [], total: 0 } };\r\n\t}\r\n}\r\n","import { UmbDataTypeReferenceServerDataSource } from './data-type-reference.server.data.js';\r\nimport type { UmbControllerHost } from '@umbraco-cms/backoffice/controller-api';\r\nimport { UmbControllerBase } from '@umbraco-cms/backoffice/class-api';\r\nimport type { UmbEntityReferenceRepository } from '@umbraco-cms/backoffice/relations';\r\n\r\nexport class UmbDataTypeReferenceRepository extends UmbControllerBase implements UmbEntityReferenceRepository {\r\n\t#referenceSource: UmbDataTypeReferenceServerDataSource;\r\n\r\n\tconstructor(host: UmbControllerHost) {\r\n\t\tsuper(host);\r\n\t\tthis.#referenceSource = new UmbDataTypeReferenceServerDataSource(this);\r\n\t}\r\n\r\n\tasync requestReferencedBy(unique: string, skip = 0, take = 20) {\r\n\t\tif (!unique) throw new Error(`unique is required`);\r\n\t\treturn this.#referenceSource.getReferencedBy(unique, skip, take);\r\n\t}\r\n\r\n\tasync requestAreReferenced(uniques: Array<string>, skip = 0, take = 20) {\r\n\t\tif (!uniques || uniques.length === 0) throw new Error(`uniques is required`);\r\n\t\treturn this.#referenceSource.getAreReferenced(uniques, skip, take);\r\n\t}\r\n}\r\n\r\nexport default UmbDataTypeReferenceRepository;\r\n"],"names":["UmbDataTypeReferenceServerDataSource","UmbControllerBase","#dataMapper","UmbManagementApiDataMapper","unique","skip","take","data","error","tryExecute","DataTypeService","promises","item","uniques","UmbDataTypeReferenceRepository","#referenceSource","host"],"mappings":";;;;AAYO,MAAMA,UAA6CC,EAA0D;AAAA,EACnHC,KAAc,IAAIC,EAA2B,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAUjD,MAAM,gBACLC,GACAC,IAAO,GACPC,IAAO,IACgE;AACvE,UAAM,EAAE,MAAAC,GAAM,OAAAC,EAAM,IAAI,MAAMC;AAAA,MAC7B;AAAA,MACAC,EAAgB,4BAA4B,EAAE,MAAM,EAAE,IAAIN,EAAO,GAAG,OAAO,EAAE,MAAAC,GAAM,MAAAC,IAAQ,CAAA;AAAA,IAC5F;AAEA,QAAIC,GAAM;AACT,YAAMI,IAAWJ,EAAK,MAAM,IAAI,OAAOK,MAC/B,KAAKV,GAAY,IAAI;AAAA,QAC3B,cAAcU,EAAK;AAAA,QACnB,MAAMA;AAAA,QACN,UAAU,aACF;AAAA,UACN,GAAGA;AAAA,UACH,QAAQA,EAAK;AAAA,UACb,YAAY;AAAA,QACb;AAAA,MACD,CACA,CACD;AAID,aAAO,EAAE,MAAM,EAAE,OAFH,MAAM,QAAQ,IAAID,CAAQ,GAEhB,OAAOJ,EAAK,QAAQ;AAAA,IAAA;AAGtC,WAAA,EAAE,MAAAA,GAAM,OAAAC,EAAM;AAAA,EAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAWtB,MAAM,iBACLK,GAEAR,IAAe,GAEfC,IAAe,IACiD;AAChE,mBAAQ,KAAK,2EAA2E,GACjF,EAAE,MAAM,EAAE,OAAO,CAAA,GAAI,OAAO,IAAI;AAAA,EAAA;AAEzC;ACrEO,MAAMQ,UAAuCb,EAA0D;AAAA,EAC7Gc;AAAA,EAEA,YAAYC,GAAyB;AACpC,UAAMA,CAAI,GACL,KAAAD,KAAmB,IAAIf,EAAqC,IAAI;AAAA,EAAA;AAAA,EAGtE,MAAM,oBAAoBI,GAAgBC,IAAO,GAAGC,IAAO,IAAI;AAC9D,QAAI,CAACF,EAAc,OAAA,IAAI,MAAM,oBAAoB;AACjD,WAAO,KAAKW,GAAiB,gBAAgBX,GAAQC,GAAMC,CAAI;AAAA,EAAA;AAAA,EAGhE,MAAM,qBAAqBO,GAAwBR,IAAO,GAAGC,IAAO,IAAI;AACnE,QAAA,CAACO,KAAWA,EAAQ,WAAW,EAAS,OAAA,IAAI,MAAM,qBAAqB;AAC3E,WAAO,KAAKE,GAAiB,iBAAiBF,GAASR,GAAMC,CAAI;AAAA,EAAA;AAEnE;"}