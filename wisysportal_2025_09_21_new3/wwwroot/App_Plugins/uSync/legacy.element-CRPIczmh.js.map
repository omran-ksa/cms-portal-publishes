{"version":3,"file":"legacy.element-CRPIczmh.js","sources":["../../../usync-assets/src/workspace/views/legacy/legacy.element.ts"],"sourcesContent":["import {\r\n\tcss,\r\n\tcustomElement,\r\n\thtml,\r\n\tnothing,\r\n\tstate,\r\n} from '@umbraco-cms/backoffice/external/lit';\r\nimport { UmbLitElement } from '@umbraco-cms/backoffice/lit-element';\r\nimport {\r\n\tUMB_CONFIRM_MODAL,\r\n\tUMB_MODAL_MANAGER_CONTEXT,\r\n} from '@umbraco-cms/backoffice/modal';\r\nimport {\r\n\tuSyncWorkspaceContext,\r\n\tUSYNC_CORE_CONTEXT_TOKEN,\r\n\tSyncLegacyCheckResponse,\r\n} from '@jumoo/uSync';\r\n\r\n@customElement('usync-sync-legacy-files')\r\nexport class SyncLegacyFilesElement extends UmbLitElement {\r\n\t#actionContext?: uSyncWorkspaceContext;\r\n\r\n\t@state()\r\n\t_legacy?: SyncLegacyCheckResponse;\r\n\r\n\tconstructor() {\r\n\t\tsuper();\r\n\r\n\t\tthis.consumeContext(USYNC_CORE_CONTEXT_TOKEN, (_instance) => {\r\n\t\t\tif (!_instance) return;\r\n\r\n\t\t\tthis.#actionContext = _instance;\r\n\r\n\t\t\tthis.observe(_instance.legacy, (_legacy) => {\r\n\t\t\t\tthis._legacy = _legacy;\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n\r\n\tasync #onCopy() {\r\n\t\tconst modalContext = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\r\n\t\tconst confirmContext = modalContext?.open(this, UMB_CONFIRM_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\theadline: this.localize.term('uSync_legacyCopyTitle', [\r\n\t\t\t\t\tthis._legacy?.latestVersion,\r\n\t\t\t\t]),\r\n\t\t\t\tcontent: html`${this.localize.term('uSync_legacyCopyContent', [\r\n\t\t\t\t\tthis._legacy?.latestFolder,\r\n\t\t\t\t])}`,\r\n\t\t\t\tcolor: 'danger',\r\n\t\t\t\tconfirmLabel: 'Copy',\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconfirmContext\r\n\t\t\t?.onSubmit()\r\n\t\t\t.then(async () => {\r\n\t\t\t\tawait this.#actionContext?.copyLegacy();\r\n\t\t\t\twindow.location.reload();\r\n\t\t\t})\r\n\t\t\t.catch(() => {\r\n\t\t\t\tconsole.log('copy cancelled');\r\n\t\t\t});\r\n\t}\r\n\r\n\tasync #onIgnore() {\r\n\t\tconst modalContext = await this.getContext(UMB_MODAL_MANAGER_CONTEXT);\r\n\t\tconst confirmContext = modalContext?.open(this, UMB_CONFIRM_MODAL, {\r\n\t\t\tdata: {\r\n\t\t\t\theadline: this.localize.term('uSync_legacyIgnoreTitle'),\r\n\t\t\t\tcontent: html`${this.localize.term('uSync_legacyIgnoreContent')}`,\r\n\t\t\t\tcolor: 'danger',\r\n\t\t\t\tconfirmLabel: 'Ignore',\r\n\t\t\t},\r\n\t\t});\r\n\r\n\t\tconfirmContext\r\n\t\t\t?.onSubmit()\r\n\t\t\t.then(async () => {\r\n\t\t\t\tawait this.#actionContext?.ignoreLegacy();\r\n\t\t\t\twindow.location.reload();\r\n\t\t\t})\r\n\t\t\t.catch(() => {\r\n\t\t\t\tconsole.log('ignore cancelled');\r\n\t\t\t});\r\n\t}\r\n\r\n\trender() {\r\n\t\treturn html`<umb-body-layout>\r\n\t\t\t${this.renderLegacyNote()} ${this.renderActions()}\r\n\t\t</umb-body-layout>`;\r\n\t}\r\n\r\n\trenderLegacyNote() {\r\n\t\treturn html` <uui-box headline=\"Legacy uSync files detected\">\r\n\t\t\t<p>\r\n\t\t\t\tuSync has found an old uSync folder at\r\n\t\t\t\t<strong>${this._legacy?.legacyFolder ?? ''}</strong>. It is likely that the\r\n\t\t\t\tcontent will need converting in some way.\r\n\t\t\t</p>\r\n\t\t\t${this.renderLegacyTypes(this._legacy?.legacyTypes)}\r\n\t\t</uui-box>`;\r\n\t}\r\n\r\n\trenderLegacyTypes(legacyTypes: Array<string> | undefined) {\r\n\t\tif (legacyTypes == undefined || legacyTypes.length == 0) {\r\n\t\t\treturn nothing;\r\n\t\t}\r\n\r\n\t\tconst legacyTypeHtml = legacyTypes.map((datatype) => {\r\n\t\t\treturn html`<li>${datatype}</li>`;\r\n\t\t});\r\n\r\n\t\treturn html`\r\n\t\t\t<div>\r\n\t\t\t\t<h3>Obsolete DataTypes</h3>\r\n\t\t\t\t<p>\r\n\t\t\t\t\tThe following DataTypes - found in the legacy folder - are no longer supported\r\n\t\t\t\t\tin Umbraco 14+ and will need to be converted.\r\n\t\t\t\t</p>\r\n\t\t\t\t<ul>\r\n\t\t\t\t\t${legacyTypeHtml}\r\n\t\t\t\t</ul>\r\n\t\t\t\t<p>\r\n\t\t\t\t\tYou can convert these DataTypes using\r\n\t\t\t\t\t<a href=\"https://github.com/Jumoo/uSyncMigrations\" target=\"_blank\"\r\n\t\t\t\t\t\t>uSync.Migrations</a\r\n\t\t\t\t\t><br />\r\n\t\t\t\t</p>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\trenderActions() {\r\n\t\treturn html`\r\n\t\t\t<div class=\"legacy-actions\">\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t<div class=\"actions\">\r\n\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\tlabel=\"copy\"\r\n\t\t\t\t\t\t\tcolor=\"positive\"\r\n\t\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\t\t@click=${this.#onCopy}\r\n\t\t\t\t\t\t\t>Overwrite v${this._legacy?.latestVersion} folder</uui-button\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t<p>\r\n\t\t\t\t\t\t\tCopy the contents of the legacy folder to the new\r\n\t\t\t\t\t\t\t${this._legacy?.latestFolder} folder\r\n\t\t\t\t\t\t</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\r\n\t\t\t\t<uui-box>\r\n\t\t\t\t\t<div class=\"actions\">\r\n\t\t\t\t\t\t<uui-button\r\n\t\t\t\t\t\t\tlabel=\"ignore\"\r\n\t\t\t\t\t\t\tcolor=\"warning\"\r\n\t\t\t\t\t\t\tlook=\"primary\"\r\n\t\t\t\t\t\t\t@click=${this.#onIgnore}\r\n\t\t\t\t\t\t\t>Ignore legacy folder</uui-button\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t<p>Ignore the legacy folder and continue</p>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</uui-box>\r\n\t\t\t</div>\r\n\t\t`;\r\n\t}\r\n\r\n\tstatic styles = css`\r\n\t\tuui-box {\r\n\t\t\tmargin-bottom: var(--uui-size-3);\r\n\t\t}\r\n\r\n\t\t.legacy-actions {\r\n\t\t\tdisplay: flex;\r\n\t\t\tgap: var(--uui-size-space-4);\r\n\t\t\tjustify-content: space-between;\r\n\t\t}\r\n\r\n\t\t.legacy-actions uui-box {\r\n\t\t\tflex-basis: 50%;\r\n\t\t}\r\n\r\n\t\t.legacy-actions .actions {\r\n\t\t\tdisplay: flex;\r\n\t\t\tflex-direction: column;\r\n\t\t\talign-items: center;\r\n\t\t}\r\n\r\n\t\tuui-button {\r\n\t\t\tfont-size: var(--uui-type-h5-size);\r\n\t\t}\r\n\t`;\r\n}\r\n\r\nexport default SyncLegacyFilesElement;\r\n"],"names":["_actionContext","_SyncLegacyFilesElement_instances","onCopy_fn","onIgnore_fn","SyncLegacyFilesElement","UmbLitElement","__privateAdd","USYNC_CORE_CONTEXT_TOKEN","_instance","__privateSet","_legacy","html","_a","_b","legacyTypes","nothing","legacyTypeHtml","datatype","__privateMethod","modalContext","UMB_MODAL_MANAGER_CONTEXT","confirmContext","UMB_CONFIRM_MODAL","__privateGet","css","__decorateClass","state","customElement","SyncLegacyFilesElement$1"],"mappings":"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"}